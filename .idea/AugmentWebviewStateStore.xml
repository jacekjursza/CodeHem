<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="AugmentWebviewStateStore">
    <option name="stateMap">
      <map>
        <entry key="CHAT_STATE" value="eyJjdXJyZW50Q29udmVyc2F0aW9uSWQiOiIyNDc1ZDY1Ny0zYmZiLTRiOWEtYTNkOC1jODBlMTViZGQ0MzUiLCJjb252ZXJzYXRpb25zIjp7IjI5OGVkZjkzLTk2ZGUtNDY0Yi1hZjM3LTEwYTVkZWJjNTBmMiI6eyJpZCI6IjI5OGVkZjkzLTk2ZGUtNDY0Yi1hZjM3LTEwYTVkZWJjNTBmMiIsIm5hbWUiOiJXZWxjb21lIHRvIHRoZSBBdWdtZW50IEFnZW50IiwiY3JlYXRlZEF0SXNvIjoiMjAyNS0wNC0wNVQxMDo1NTo0My4wMjFaIiwibGFzdEludGVyYWN0ZWRBdElzbyI6IjIwMjUtMDQtMDVUMTA6NTU6NDMuMDIxWiIsImNoYXRIaXN0b3J5IjpbeyJyZXF1ZXN0X2lkIjoiNjNjN2VmZjMtMjJiMC00ZGI5LTkzOWMtN2VlNjJiNjc1NTE3IiwidXVpZCI6ImQ3ZTU1MWI4LTM3YmYtNGU2NS1iZjNlLTFhNGNkZmY4YjM1MiIsImNoYXRJdGVtVHlwZSI6ImFnZW50aWMtY2hlY2twb2ludC1kZWxpbWl0ZXIiLCJzdGF0dXMiOiJzdWNjZXNzIiwiZnJvbVRpbWVzdGFtcCI6MCwidG9UaW1lc3RhbXAiOjE3NDM4NTA1NDMwMjEsInNlZW5fc3RhdGUiOiJzZWVuIn1dLCJmZWVkYmFja1N0YXRlcyI6e30sInRvb2xVc2VTdGF0ZXMiOnt9LCJkcmFmdEV4Y2hhbmdlIjp7InJlcXVlc3RfbWVzc2FnZSI6IiIsInJpY2hfdGV4dF9qc29uX3JlcHIiOnsidHlwZSI6ImRvYyIsImNvbnRlbnQiOlt7InR5cGUiOiJwYXJhZ3JhcGgifV19LCJtZW50aW9uZWRfaXRlbXMiOltdLCJzdGF0dXMiOiJkcmFmdCJ9LCJkcmFmdEFjdGl2ZUNvbnRleHRJZHMiOlsiRDovY29kZS9Db2RlSGVtL2NvZGVoZW0yL3Rlc3RzL3B5dGhvbi9jb25mdGVzdC5weSIsIkQ6L2NvZGUvQ29kZUhlbWZhbHNlZmFsc2UiLCJhZ2VudE1lbW9yaWVzIl0sInJlcXVlc3RJZHMiOltdLCJpc1Bpbm5lZCI6ZmFsc2UsImlzU2hhcmVhYmxlIjpmYWxzZSwiZXh0cmFEYXRhIjp7ImlzQWdlbnRDb252ZXJzYXRpb24iOnRydWUsImhhc0FnZW50T25ib2FyZGVkIjp0cnVlLCJoYXNEaXJ0eUVkaXRzIjpmYWxzZX19LCIyNDc1ZDY1Ny0zYmZiLTRiOWEtYTNkOC1jODBlMTViZGQ0MzUiOnsiaWQiOiIyNDc1ZDY1Ny0zYmZiLTRiOWEtYTNkOC1jODBlMTViZGQ0MzUiLCJjcmVhdGVkQXRJc28iOiIyMDI1LTA0LTA1VDEwOjU3OjM1LjU3OVoiLCJsYXN0SW50ZXJhY3RlZEF0SXNvIjoiMjAyNS0wNC0wNlQwNjo0NTo1MS44MThaIiwiY2hhdEhpc3RvcnkiOlt7InJlcXVlc3RfaWQiOiJhZjhiOTE5ZC05ZGU5LTRjODUtOWE5OC1jZjcxMmI4ZDI3NzYiLCJ1dWlkIjoiNGJlNTEwOGQtMjYwNS00ZDgxLWFlNjEtNzdlMzU2Yjc0MDFjIiwiY2hhdEl0ZW1UeXBlIjoiYWdlbnRpYy1jaGVja3BvaW50LWRlbGltaXRlciIsInN0YXR1cyI6InN1Y2Nlc3MiLCJmcm9tVGltZXN0YW1wIjowLCJ0b1RpbWVzdGFtcCI6MTc0Mzg1MDY1NTU4MCwic2Vlbl9zdGF0ZSI6InNlZW4ifSx7InN0YXR1cyI6InN1Y2Nlc3MiLCJyZXF1ZXN0X2lkIjoiNzEwZTAxYTctOWUzOC00MjkwLTlmYWMtNjUwMWIxYzRjOGYyIiwicmVxdWVzdF9tZXNzYWdlIjoibyBjenltIGplc3QgdGVuIGNvZGViYXNlPyIsInJpY2hfdGV4dF9qc29uX3JlcHIiOnsidHlwZSI6ImRvYyIsImNvbnRlbnQiOlt7InR5cGUiOiJwYXJhZ3JhcGgiLCJjb250ZW50IjpbeyJ0eXBlIjoidGV4dCIsInRleHQiOiJvIGN6eW0gamVzdCB0ZW4gY29kZWJhc2U/In1dfV19LCJtZW50aW9uZWRfaXRlbXMiOltdLCJzdHJ1Y3R1cmVkX291dHB1dF9ub2RlcyI6W3siaWQiOjEsInR5cGUiOjUsImNvbnRlbnQiOiIiLCJ0b29sX3VzZSI6eyJ0b29sX3VzZV9pZCI6InRvb2x1X3ZydHhfMDFVd3ZhUjVycmpkM3hDRENvWUs5Vm5wIiwidG9vbF9uYW1lIjoiY29kZWJhc2UtcmV0cmlldmFsIiwiaW5wdXRfanNvbiI6IntcImluZm9ybWF0aW9uX3JlcXVlc3RcIjogXCJGaW5kIG1haW4gZmlsZXMsIFJFQURNRSwgb3IgYW55IGRvY3VtZW50YXRpb24gdGhhdCBleHBsYWlucyB3aGF0IHRoaXMgY29kZWJhc2UgaXMgYWJvdXQuIExvb2sgZm9yIHByb2plY3Qgc3RydWN0dXJlLCBwdXJwb3NlLCBhbmQgbWFpbiBmdW5jdGlvbmFsaXR5LlwifSJ9fSx7ImlkIjowLCJ0eXBlIjowLCJjb250ZW50IjoiSSdsbCBoZWxwIHlvdSB1bmRlcnN0YW5kIHdoYXQgdGhpcyBjb2RlYmFzZSBpcyBhYm91dC4gTGV0IG1lIGV4cGxvcmUgaXQgdG8gZ2l2ZSB5b3UgYSBjb21wcmVoZW5zaXZlIG92ZXJ2aWV3LlxuIn0seyJpZCI6MiwidHlwZSI6MiwiY29udGVudCI6IiJ9LHsiaWQiOjMsInR5cGUiOjMsImNvbnRlbnQiOiIifV0sInNlZW5fc3RhdGUiOiJzZWVuIiwic3RydWN0dXJlZF9yZXF1ZXN0X25vZGVzIjpbeyJpZCI6MSwidHlwZSI6MCwidGV4dF9ub2RlIjp7ImNvbnRlbnQiOiJvIGN6eW0gamVzdCB0ZW4gY29kZWJhc2U/In19LHsiaWQiOjIsInR5cGUiOjQsImlkZV9zdGF0ZV9ub2RlIjp7IndvcmtzcGFjZUZvbGRlcnMiOlt7InJlcG9zaXRvcnlSb290IjoiRDovY29kZS9Db2RlSGVtIiwiZm9sZGVyUm9vdCI6IkQ6L2NvZGUvQ29kZUhlbSJ9XSwid29ya3NwYWNlRm9sZGVyc1VuY2hhbmdlZCI6ZmFsc2V9fV0sInJlc3BvbnNlX3RleHQiOiJJJ2xsIGhlbHAgeW91IHVuZGVyc3RhbmQgd2hhdCB0aGlzIGNvZGViYXNlIGlzIGFib3V0LiBMZXQgbWUgZXhwbG9yZSBpdCB0byBnaXZlIHlvdSBhIGNvbXByZWhlbnNpdmUgb3ZlcnZpZXcuXG4iLCJ3b3Jrc3BhY2VfZmlsZV9jaHVua3MiOltdfSx7InN0YXR1cyI6InN1Y2Nlc3MiLCJyZXF1ZXN0X2lkIjoiYThiMzBkNzMtZDMwOC00MGE1LWEyOTAtZDFhM2UyMDY4YmFhIiwicmVxdWVzdF9tZXNzYWdlIjoiIiwic3RydWN0dXJlZF9vdXRwdXRfbm9kZXMiOlt7ImlkIjowLCJ0eXBlIjowLCJjb250ZW50IjoiQmFzZWQgb24gbXkgZXhwbG9yYXRpb24gb2YgdGhlIGNvZGViYXNlLCBJIGNhbiBwcm92aWRlIHlvdSB3aXRoIGFuIG92ZXJ2aWV3IG9mIHdoYXQgQ29kZUhlbSBpcyBhYm91dDpcblxuIyMgQ29kZUhlbSBPdmVydmlld1xuXG5Db2RlSGVtIGlzIGEgbGFuZ3VhZ2UtYWdub3N0aWMgbGlicmFyeSBkZXNpZ25lZCBmb3Igc29waGlzdGljYXRlZCBxdWVyeWluZyBhbmQgbWFuaXB1bGF0aW9uIG9mIHNvdXJjZSBjb2RlLiBJdCBwcm92aWRlcyB0b29scyB0byBuYXZpZ2F0ZSwgYW5hbHl6ZSwgYW5kIG1vZGlmeSBjb2RlIGVsZW1lbnRzIHN1Y2ggYXMgZnVuY3Rpb25zLCBjbGFzc2VzLCBtZXRob2RzLCBhbmQgcHJvcGVydGllcyBhY3Jvc3MgbXVsdGlwbGUgcHJvZ3JhbW1pbmcgbGFuZ3VhZ2VzLlxuXG4jIyMgS2V5IEZlYXR1cmVzXG5cbjEuICoqQ29kZSBRdWVyeWluZyoqOiBMb2NhdGUgY29kZSBlbGVtZW50cyAoZnVuY3Rpb25zLCBjbGFzc2VzLCBtZXRob2RzLCBwcm9wZXJ0aWVzLCBpbXBvcnRzKSB1c2luZyBhIHVuaWZvcm0gQVBJXG4yLiAqKkNvZGUgTWFuaXB1bGF0aW9uKio6IFJlcGxhY2UsIGFkZCwgb3IgcmVtb3ZlIGNvZGUgZWxlbWVudHMgd2hpbGUgcHJlc2VydmluZyBzeW50YXggaW50ZWdyaXR5XG4zLiAqKlN5bnRheC1hd2FyZSBPcGVyYXRpb25zKio6IFVzZXMgdHJlZS1zaXR0ZXIgcGFyc2VyIHRvIGVuc3VyZSBhY2N1cmF0ZSBtYW5pcHVsYXRpb25cbjQuICoqTGFuZ3VhZ2UgRGV0ZWN0aW9uKio6IEF1dG9tYXRpY2FsbHkgaWRlbnRpZmllcyBwcm9ncmFtbWluZyBsYW5ndWFnZXMgZnJvbSBjb2RlIG9yIGZpbGUgZXh0ZW5zaW9uc1xuNS4gKipFeHRlbnNpYmxlIEFyY2hpdGVjdHVyZSoqOiBTdXBwb3J0cyBhZGRpbmcgbmV3IHByb2dyYW1taW5nIGxhbmd1YWdlcyB0aHJvdWdoIGEgc3RyYXRlZ3kgcGF0dGVyblxuXG4jIyMgQ3VycmVudGx5IFN1cHBvcnRlZCBMYW5ndWFnZXNcblxuLSBQeXRob25cbi0gSmF2YVNjcmlwdC9UeXBlU2NyaXB0IChpbmNsdWRpbmcgVFNYKVxuXG4jIyMgTWFpbiBDb21wb25lbnRzXG5cblRoZSBjb2RlYmFzZSBpcyBvcmdhbml6ZWQgaW50byBzZXZlcmFsIGtleSBtb2R1bGVzOlxuXG4xLiAqKkNvcmUgRW5naW5lKio6IEluY2x1ZGVzIFhQYXRoIHBhcnNpbmcgYW5kIHNlcnZpY2VzIGZvciBleHRyYWN0aW9uIGFuZCBtYW5pcHVsYXRpb25cbjIuICoqTGFuZ3VhZ2UgU2VydmljZXMqKjogTGFuZ3VhZ2Utc3BlY2lmaWMgaW1wbGVtZW50YXRpb25zIGZvciBkaWZmZXJlbnQgcHJvZ3JhbW1pbmcgbGFuZ3VhZ2VzXG4zLiAqKlJlZ2lzdHJ5IFN5c3RlbSoqOiBDZW50cmFsIHJlZ2lzdHJ5IGZvciBjb21wb25lbnRzIGxpa2UgbGFuZ3VhZ2UgZGV0ZWN0b3JzLCBleHRyYWN0b3JzLCBhbmQgbWFuaXB1bGF0b3JzXG40LiAqKk1vZGVscyoqOiBEZWZpbmVzIGNvZGUgZWxlbWVudHMsIFhQYXRoIGV4cHJlc3Npb25zLCBhbmQgb3RoZXIgZGF0YSBzdHJ1Y3R1cmVzXG5cbiMjIyBNYWluIFVzYWdlXG5cblRoZSBtYWluIGVudHJ5IHBvaW50IGlzIHRoZSBgQ29kZUhlbWAgY2xhc3MsIHdoaWNoIHByb3ZpZGVzIG1ldGhvZHMgdG86XG4tIEV4dHJhY3QgY29kZSBlbGVtZW50cyBmcm9tIHNvdXJjZSBjb2RlXG4tIEZpbmQgZWxlbWVudHMgdXNpbmcgWFBhdGgtbGlrZSBleHByZXNzaW9uc1xuLSBNYW5pcHVsYXRlIGNvZGUgYnkgYWRkaW5nLCByZXBsYWNpbmcsIG9yIHJlbW92aW5nIGVsZW1lbnRzXG4tIFF1ZXJ5IGNvZGUgc3RydWN0dXJlXG5cblRoZSBsaWJyYXJ5IHNlZW1zIHRvIGJlIGRlc2lnbmVkIGZvciBib3RoIHByb2dyYW1tYXRpYyB1c2UgYW5kIHBvdGVudGlhbGx5IGFzIGEgZm91bmRhdGlvbiBmb3IgZGV2ZWxvcGVyIHRvb2xzIHRoYXQgbmVlZCB0byB1bmRlcnN0YW5kIGFuZCBtb2RpZnkgY29kZS5cblxuV291bGQgeW91IGxpa2UgbWUgdG8gZXhwbG9yZSBhbnkgc3BlY2lmaWMgYXNwZWN0IG9mIHRoZSBjb2RlYmFzZSBpbiBtb3JlIGRldGFpbD9cbiJ9LHsiaWQiOjIsInR5cGUiOjIsImNvbnRlbnQiOiIifSx7ImlkIjozLCJ0eXBlIjozLCJjb250ZW50IjoiIn1dLCJzZWVuX3N0YXRlIjoic2VlbiIsInN0cnVjdHVyZWRfcmVxdWVzdF9ub2RlcyI6W3siaWQiOjEsInR5cGUiOjEsInRvb2xfcmVzdWx0X25vZGUiOnsiY29udGVudCI6IlRoZSBmb2xsb3dpbmcgY29kZSBzZWN0aW9ucyB3ZXJlIHJldHJpZXZlZDpcblBhdGg6IGNvZGVoZW0vbWFpbi5weVxuaW1wb3J0IG9zXG5pbXBvcnQgbG9nZ2luZ1xuZnJvbSB0eXBpbmcgaW1wb3J0IExpc3QsIE9wdGlvbmFsLCBUdXBsZVxuXG5mcm9tIC5jb3JlLmVuZ2luZS54cGF0aF9wYXJzZXIgaW1wb3J0IFhQYXRoUGFyc2VyXG5mcm9tIC5jb3JlLmV4dHJhY3Rpb25fc2VydmljZSBpbXBvcnQgRXh0cmFjdGlvblNlcnZpY2VcbmZyb20gLmNvcmUubWFuaXB1bGF0aW9uX3NlcnZpY2UgaW1wb3J0IE1hbmlwdWxhdGlvblNlcnZpY2VcbmZyb20gLmxhbmd1YWdlcyBpbXBvcnQgKFxuICAgIGdldF9sYW5ndWFnZV9zZXJ2aWNlLFxuICAgIGdldF9sYW5ndWFnZV9zZXJ2aWNlX2Zvcl9jb2RlLFxuICAgIGdldF9sYW5ndWFnZV9zZXJ2aWNlX2Zvcl9maWxlLFxuICAgIGdldF9zdXBwb3J0ZWRfbGFuZ3VhZ2VzLFxuKVxuZnJvbSAubW9kZWxzLmNvZGVfZWxlbWVudCBpbXBvcnQgQ29kZUVsZW1lbnQsIENvZGVFbGVtZW50c1Jlc3VsdFxuZnJvbSAubW9kZWxzLmVudW1zIGltcG9ydCBDb2RlRWxlbWVudFR5cGVcbmZyb20gLm1vZGVscy54cGF0aCBpbXBvcnQgQ29kZUVsZW1lbnRYUGF0aE5vZGVcblxubG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoX19uYW1lX18pXG5cbmNsYXNzIENvZGVIZW06XG4gICAgXCJcIlwiXG4gICAgTWFpbiBlbnRyeSBwb2ludCBmb3IgQ29kZUhlbS5cbiAgICBQcm92aWRlcyBsYW5ndWFnZS1hZ25vc3RpYyBpbnRlcmZhY2UgZm9yIGNvZGUgbWFuaXB1bGF0aW9uLlxuICAgIFwiXCJcIlxuXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsIGxhbmd1YWdlX2NvZGU6IHN0cik6XG4gICAgICAgIFwiXCJcIlxuICAgICAgICBJbml0aWFsaXplIENvZGVIZW0gZm9yIGEgc3BlY2lmaWMgbGFuZ3VhZ2UuXG5cbiAgICAgICAgQXJnczpcbiAgICAgICAgICAgIGxhbmd1YWdlX2NvZGU6IExhbmd1YWdlIGNvZGUgKGUuZy4sICdweXRob24nLCAndHlwZXNjcmlwdCcpXG5cbiAgICAgICAgUmFpc2VzOlxuICAgICAgICAgICAgVmFsdWVFcnJvcjogSWYgdGhlIGxhbmd1YWdlIGlzIG5vdCBzdXBwb3J0ZWRcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIHNlbGYubGFuZ3VhZ2Vfc2VydmljZSA9IGdldF9sYW5ndWFnZV9zZXJ2aWNlKGxhbmd1YWdlX2NvZGUpXG4gICAgICAgIGlmIG5vdCBzZWxmLmxhbmd1YWdlX3NlcnZpY2U6XG4gICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGZcIlVuc3VwcG9ydGVkIGxhbmd1YWdlOiB7bGFuZ3VhZ2VfY29kZX1cIilcbi4uLlxuXG4gICAgQGNsYXNzbWV0aG9kXG4gICAgZGVmIGZyb21fcmF3X2NvZGUoY2xzLCBjb2RlOiBzdHIpIC0+IFwiQ29kZUhlbVwiOlxuICAgICAgICBcIlwiXCJcbiAgICAgICAgQ3JlYXRlIGEgQ29kZUhlbSBpbnN0YW5jZSBieSBkZXRlY3RpbmcgbGFuZ3VhZ2UgZnJvbSBjb2RlLlxuXG4gICAgICAgIEFyZ3M6XG4gICAgICAgICAgICBjb2RlOiBTb3VyY2UgY29kZSBhcyBzdHJpbmdcblxuICAgICAgICBSZXR1cm5zOlxuICAgICAgICAgICAgQ29kZUhlbSBpbnN0YW5jZVxuXG4gICAgICAgIFJhaXNlczpcbiAgICAgICAgICAgIFZhbHVlRXJyb3I6IElmIHRoZSBsYW5ndWFnZSBjb3VsZCBub3QgYmUgZGV0ZWN0ZWRcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIGxhbmd1YWdlX3NlcnZpY2UgPSBnZXRfbGFuZ3VhZ2Vfc2VydmljZV9mb3JfY29kZShjb2RlKVxuICAgICAgICBpZiBub3QgbGFuZ3VhZ2Vfc2VydmljZTpcbiAgICAgICAgICAgICMgUmFpc2UgZXJyb3IgaW5zdGVhZCBvZiBkZWZhdWx0aW5nIHRvIFB5dGhvblxuICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihcIkNvdWxkIG5vdCBkZXRlY3QgbGFuZ3VhZ2UgZnJvbSBjb2RlXCIpXG4gICAgICAgICAgICAjIHJldHVybiBjbHMoJ3B5dGhvbicpICMgT2xkIGJlaGF2aW9yXG4gICAgICAgIHJldHVybiBjbHMobGFuZ3VhZ2Vfc2VydmljZS5sYW5ndWFnZV9jb2RlKVxuXG4gICAgQHN0YXRpY21ldGhvZFxuICAgIGRlZiBzdXBwb3J0ZWRfbGFuZ3VhZ2VzKCkgLT4gTGlzdFtzdHJdOlxuICAgICAgICBcIlwiXCJcbiAgICAgICAgR2V0IGEgbGlzdCBvZiBzdXBwb3J0ZWQgbGFuZ3VhZ2UgY29kZXMuXG5cbiAgICAgICAgUmV0dXJuczpcbiAgICAgICAgICAgIExpc3Qgb2Ygc3VwcG9ydGVkIGxhbmd1YWdlIGNvZGVzXG4gICAgICAgIFwiXCJcIlxuICAgICAgICByZXR1cm4gZ2V0X3N1cHBvcnRlZF9sYW5ndWFnZXMoKVxuLi4uXG5cbiAgICBkZWYgdXBzZXJ0X2VsZW1lbnQoXG4gICAgICAgIHNlbGYsXG4gICAgICAgIG9yaWdpbmFsX2NvZGU6IHN0cixcbiAgICAgICAgZWxlbWVudF90eXBlOiBzdHIsXG4gICAgICAgIG5hbWU6IHN0cixcbiAgICAgICAgbmV3X2NvZGU6IHN0cixcbiAgICAgICAgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl0gPSBOb25lLFxuICAgICkgLT4gc3RyOlxuICAgICAgICBcIlwiXCJcbiAgICAgICAgQWRkIG9yIHJlcGxhY2UgYW4gZWxlbWVudCBpbiB0aGUgY29kZS5cblxuICAgICAgICBBcmdzOlxuICAgICAgICAgICAgb3JpZ2luYWxfY29kZTogT3JpZ2luYWwgc291cmNlIGNvZGVcbiAgICAgICAgICAgIGVsZW1lbnRfdHlwZTogVHlwZSBvZiBlbGVtZW50IHRvIGFkZC9yZXBsYWNlIChmcm9tIENvZGVFbGVtZW50VHlwZSlcbiAgICAgICAgICAgIG5hbWU6IE5hbWUgb2YgdGhlIGVsZW1lbnRcbiAgICAgICAgICAgIG5ld19jb2RlOiBOZXcgY29udGVudCBmb3IgdGhlIGVsZW1lbnRcbiAgICAgICAgICAgIHBhcmVudF9uYW1lOiBOYW1lIG9mIHBhcmVudCBlbGVtZW50IChlLmcuLCBjbGFzcyBuYW1lIGZvciBtZXRob2RzKVxuXG4gICAgICAgIFJldHVybnM6XG4gICAgICAgICAgICBNb2RpZmllZCBjb2RlXG4gICAgICAgIFwiXCJcIlxuICAgICAgICBpZiBub3Qgc2VsZi5tYW5pcHVsYXRpb246XG4gICAgICAgICAgICAgcmFpc2UgUnVudGltZUVycm9yKFwiTWFuaXB1bGF0aW9uIHNlcnZpY2Ugbm90IGluaXRpYWxpemVkLlwiKVxuICAgICAgICByZXR1cm4gc2VsZi5tYW5pcHVsYXRpb24udXBzZXJ0X2VsZW1lbnQoXG4gICAgICAgICAgICBvcmlnaW5hbF9jb2RlLCBlbGVtZW50X3R5cGUsIG5hbWUsIG5ld19jb2RlLCBwYXJlbnRfbmFtZVxuICAgICAgICApXG4uLi5cblxuICAgIGRlZiB1cHNlcnRfZWxlbWVudF9ieV94cGF0aChcbiAgICAgICAgc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCB4cGF0aDogc3RyLCBuZXdfY29kZTogc3RyXG4gICAgKSAtPiBzdHI6XG4gICAgICAgIFwiXCJcIlxuICAgICAgICBBZGQgb3IgcmVwbGFjZSBhbiBlbGVtZW50IGluIHRoZSBjb2RlIHVzaW5nIFhQYXRoIGV4cHJlc3Npb24uXG4gICAgICAgIEF1dG9tYXRpY2FsbHkgcHJlcGVuZHMgXCJGSUxFLlwiIGlmIG1pc3NpbmcuXG5cbiAgICAgICAgQXJnczpcbiAgICAgICAgICAgIG9yaWdpbmFsX2NvZGU6IE9yaWdpbmFsIHNvdXJjZSBjb2RlXG4gICAgICAgICAgICB4cGF0aDogWFBhdGggZXhwcmVzc2lvbiAoZS5nLiwgJ0NsYXNzTmFtZS5tZXRob2RfbmFtZScsICdDbGFzc05hbWVbaW50ZXJmYWNlXS5tZXRob2RfbmFtZVtwcm9wZXJ0eV9nZXR0ZXJdJylcbiAgICAgICAgICAgIG5ld19jb2RlOiBOZXcgY29udGVudCBmb3IgdGhlIGVsZW1lbnRcblxuICAgICAgICBSZXR1cm5zOlxuICAgICAgICAgICAgTW9kaWZpZWQgY29kZVxuICAgICAgICBcIlwiXCJcbiAgICAgICAgaWYgbm90IHNlbGYubWFuaXB1bGF0aW9uOlxuICAgICAgICAgICAgcmFpc2UgUnVudGltZUVycm9yKFwiTWFuaXB1bGF0aW9uIHNlcnZpY2Ugbm90IGluaXRpYWxpemVkLlwiKVxuICAgICAgICAjIEVuc3VyZSB4cGF0aCBzdGFydHMgd2l0aCBGSUxFLiBiZWZvcmUgcGFzc2luZyB0byBtYW5pcHVsYXRpb24gc2VydmljZVxuICAgICAgICBwcm9jZXNzZWRfeHBhdGggPSBzZWxmLl9lbnN1cmVfZmlsZV9wcmVmaXgoeHBhdGgpXG4gICAgICAgIHJldHVybiBzZWxmLm1hbmlwdWxhdGlvbi51cHNlcnRfZWxlbWVudF9ieV94cGF0aChcbiAgICAgICAgICAgIG9yaWdpbmFsX2NvZGUsIHByb2Nlc3NlZF94cGF0aCwgbmV3X2NvZGVcbiAgICAgICAgKVxuXG4gICAgIyAtLS0gWk1JQU5BOiBXeWtvcnp5c3RhbmllIF9lbnN1cmVfZmlsZV9wcmVmaXggLS0tXG4gICAgZGVmIGZpbmRfYnlfeHBhdGgoc2VsZiwgY29kZTogc3RyLCB4cGF0aDogc3RyKSAtPiBUdXBsZVtpbnQsIGludF06XG4gICAgICAgIFwiXCJcIlxuICAgICAgICBGaW5kIGFuIGVsZW1lbnQncyBsb2NhdGlvbiB1c2luZyBhbiBYUGF0aCBleHByZXNzaW9uLlxuICAgICAgICBBdXRvbWF0aWNhbGx5IHByZXBlbmRzIFwiRklMRS5cIiBpZiBtaXNzaW5nLlxuXG4gICAgICAgIEFyZ3M6XG4gICAgICAgICAgICBjb2RlOiBTb3VyY2UgY29kZSBhcyBzdHJpbmdcbiAgICAgICAgICAgIHhwYXRoOiBYUGF0aCBleHByZXNzaW9uIChlLmcuLCAnQ2xhc3NOYW1lLm1ldGhvZF9uYW1lJywgJ0NsYXNzTmFtZVtpbnRlcmZhY2VdLm1ldGhvZF9uYW1lW3Byb3BlcnR5X2dldHRlcl0nKVxuXG4gICAgICAgIFJldHVybnM6XG4gICAgICAgICAgICBUdXBsZSBvZiAoc3RhcnRfbGluZSwgZW5kX2xpbmUpIG9yICgwLCAwKSBpZiBub3QgZm91bmRcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIGlmIG5vdCBzZWxmLmV4dHJhY3Rpb246XG4gICAgICAgICAgICAgcmFpc2UgUnVudGltZUVycm9yKFwiRXh0cmFjdGlvbiBzZXJ2aWNlIG5vdCBpbml0aWFsaXplZC5cIilcbiAgICAgICAgcHJvY2Vzc2VkX3hwYXRoID0gc2VsZi5fZW5zdXJlX2ZpbGVfcHJlZml4KHhwYXRoKVxuICAgICAgICByZXR1cm4gc2VsZi5leHRyYWN0aW9uLmZpbmRfYnlfeHBhdGgoY29kZSwgcHJvY2Vzc2VkX3hwYXRoKVxuLi4uXG5cbiAgICAgICAgUmV0dXJuczpcbiAgICAgICAgICAgIFRleHQgY29udGVudCBvZiB0aGUgZWxlbWVudCwgb3IgTm9uZSBpZiBub3QgZm91bmRcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIGlmIG5vdCBzZWxmLmxhbmd1YWdlX3NlcnZpY2U6XG4gICAgICAgICAgICByYWlzZSBSdW50aW1lRXJyb3IoXCJMYW5ndWFnZSBzZXJ2aWNlIG5vdCBpbml0aWFsaXplZC5cIilcbiAgICAgICAgIyBFbnN1cmUgeHBhdGggc3RhcnRzIHdpdGggRklMRS4gYmVmb3JlIHBhcnNpbmdcbiAgICAgICAgcHJvY2Vzc2VkX3hwYXRoID0gc2VsZi5fZW5zdXJlX2ZpbGVfcHJlZml4KHhwYXRoKVxuICAgICAgICB0cnk6XG4gICAgICAgICAgICAjIFBhcnNlIHRoZSBwb3RlbnRpYWxseSBtb2RpZmllZCB4cGF0aFxuICAgICAgICAgICAgeHBhdGhfbm9kZXMgPSBYUGF0aFBhcnNlci5wYXJzZShwcm9jZXNzZWRfeHBhdGgpXG4gICAgICAgICAgICBpZiBub3QgeHBhdGhfbm9kZXM6XG4gICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGZcIkNvdWxkIG5vdCBwYXJzZSBYUGF0aDogJ3twcm9jZXNzZWRfeHBhdGh9J1wiKVxuICAgICAgICAgICAgICAgICByZXR1cm4gTm9uZVxuICAgICAgICAgICAgIyBDYWxsIGludGVybmFsIG1ldGhvZCB3aXRoIHBhcnNlZCBub2Rlc1xuICAgICAgICAgICAgcmV0dXJuIHNlbGYubGFuZ3VhZ2Vfc2VydmljZS5nZXRfdGV4dF9ieV94cGF0aF9pbnRlcm5hbChjb2RlLCB4cGF0aF9ub2RlcylcbiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxuICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJFcnJvciBnZXR0aW5nIHRleHQgYnkgWFBhdGggJ3t4cGF0aH0nIChwcm9jZXNzZWQ6ICd7cHJvY2Vzc2VkX3hwYXRofScpOiB7ZX1cIiwgZXhjX2luZm89VHJ1ZSlcbiAgICAgICAgICAgICByZXR1cm4gTm9uZVxuXG4gICAgZGVmIGV4dHJhY3Qoc2VsZiwgY29kZTogc3RyKSAtPiBDb2RlRWxlbWVudHNSZXN1bHQ6XG4gICAgICAgIFwiXCJcIlxuICAgICAgICBFeHRyYWN0IGNvZGUgZWxlbWVudHMgZnJvbSB0aGUgc291cmNlIGNvZGUuXG5cbiAgICAgICAgQXJnczpcbiAgICAgICAgICAgIGNvZGU6IFNvdXJjZSBjb2RlIGFzIHN0cmluZ1xuXG4gICAgICAgIFJldHVybnM6XG4gICAgICAgICAgICBDb2RlRWxlbWVudHNSZXN1bHQgY29udGFpbmluZyBleHRyYWN0ZWQgZWxlbWVudHNcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIGlmIG5vdCBzZWxmLmV4dHJhY3Rpb246XG4gICAgICAgICAgICAgcmFpc2UgUnVudGltZUVycm9yKFwiRXh0cmFjdGlvbiBzZXJ2aWNlIG5vdCBpbml0aWFsaXplZC5cIilcbiAgICAgICAgcmV0dXJuIHNlbGYuZXh0cmFjdGlvbi5leHRyYWN0X2FsbChjb2RlKVxuXG4gICAgQHN0YXRpY21ldGhvZFxuICAgIGRlZiBfZW5zdXJlX2ZpbGVfcHJlZml4X3N0YXRpYyh4cGF0aDogc3RyKSAtPiBzdHI6XG4gICAgICAgIFwiXCJcIlN0YXRpYyBoZWxwZXIgdG8gZW5zdXJlIFhQYXRoIHN0YXJ0cyB3aXRoIEZJTEUuXCJcIlwiXG4gICAgICAgIHJvb3RfcHJlZml4ID0gWFBhdGhQYXJzZXIuUk9PVF9FTEVNRU5UICsgXCIuXCJcbiAgICAgICAgaWYgbm90IHhwYXRoLnN0YXJ0c3dpdGgocm9vdF9wcmVmaXgpIGFuZCBub3QgeHBhdGguc3RhcnRzd2l0aChcIltcIik6XG4gICAgICAgICAgICAjIE5vdGU6IFN0YXRpYyBtZXRob2QgZG9lc24ndCBoYXZlIGxvZ2dlciBpbnN0YW5jZSBlYXNpbHlcbiAgICAgICAgICAgICMgcHJpbnQoZlwiREVCVUc6IFhQYXRoICd7eHBhdGh9JyBkb2VzIG5vdCBzdGFydCB3aXRoICd7cm9vdF9wcmVmaXh9Jy4gUHJlcGVuZGluZyBpdC5cIilcbiAgICAgICAgICAgIHhwYXRoID0gcm9vdF9wcmVmaXggKyB4cGF0aFxuICAgICAgICByZXR1cm4geHBhdGhcblxuICAgIEBzdGF0aWNtZXRob2RcbiAgICBkZWYgZmlsdGVyKGVsZW1lbnRzOiBDb2RlRWxlbWVudHNSZXN1bHQsIHhwYXRoOiBzdHIgPSBcIlwiKSAtPiBPcHRpb25hbFtDb2RlRWxlbWVudF06XG4gICAgICAgIFwiXCJcIlxuICAgICAgICBGaWx0ZXIgY29kZSBlbGVtZW50cyBiYXNlZCBvbiBYUGF0aCBleHByZXNzaW9uLlxuICAgICAgICBBdXRvbWF0aWNhbGx5IHByZXBlbmRzIFwiRklMRS5cIiBpZiBtaXNzaW5nLlxuXG4gICAgICAgIEFyZ3M6XG4gICAgICAgICAgICBlbGVtZW50czogQ29kZUVsZW1lbnRzUmVzdWx0IGNvbnRhaW5pbmcgZWxlbWVudHNcbiAgICAgICAgICAgIHhwYXRoOiBYUGF0aCBleHByZXNzaW9uIChlLmcuLCAnQ2xhc3NOYW1lLm1ldGhvZF9uYW1lJywgJ0NsYXNzTmFtZVtpbnRlcmZhY2VdLm1ldGhvZF9uYW1lW3Byb3BlcnR5X2dldHRlcl0nKVxuXG4gICAgICAgIFJldHVybnM6XG4gICAgICAgICAgICBNYXRjaGluZyBDb2RlRWxlbWVudCBvciBOb25lIGlmIG5vdCBmb3VuZFxuICAgICAgICBcIlwiXCJcbiAgICAgICAgaWYgbm90IHhwYXRoIG9yIG5vdCBlbGVtZW50cyBvciBub3QgaGFzYXR0cihlbGVtZW50cywgJ2VsZW1lbnRzJykgb3Igbm90IGVsZW1lbnRzLmVsZW1lbnRzOlxuICAgICAgICAgICAgcmV0dXJuIE5vbmVcblxuICAgICAgICAjIEVuc3VyZSB4cGF0aCBzdGFydHMgd2l0aCBGSUxFLiBiZWZvcmUgcGFyc2luZ1xuICAgICAgICBwcm9jZXNzZWRfeHBhdGggPSBDb2RlSGVtLl9lbnN1cmVfZmlsZV9wcmVmaXhfc3RhdGljKHhwYXRoKVxuXG4gICAgICAgIHRyeTpcbiAgICAgICAgICAgICMgUGFyc2UgdGhlIHBvdGVudGlhbGx5IG1vZGlmaWVkIHhwYXRoXG4gICAgICAgICAgICBlbGVtZW50X25hbWUsIHBhcmVudF9uYW1lLCBlbGVtZW50X3R5cGUgPSBYUGF0aFBhcnNlci5nZXRfZWxlbWVudF9pbmZvKHByb2Nlc3NlZF94cGF0aClcbi4uLlxuUGF0aDogUkVBRE1FLm1kXG4jIENvZGVIZW1cblxuQ29kZUhlbSBpcyBhIGxhbmd1YWdlLWFnbm9zdGljIGxpYnJhcnkgZGVzaWduZWQgZm9yIHNvcGhpc3RpY2F0ZWQgcXVlcnlpbmcgYW5kIG1hbmlwdWxhdGlvbiBvZiBzb3VyY2UgY29kZS4gXG5JdCBwcm92aWRlcyBhIGhpZ2gtbGV2ZWwgaW50ZXJmYWNlIHRvIGVmZm9ydGxlc3NseSBuYXZpZ2F0ZSwgYW5hbHl6ZSwgYW5kIG1vZGlmeSBjb2RlIGVsZW1lbnRzIHN1Y2ggYXMgZnVuY3Rpb25zLCBcbmNsYXNzZXMsIG1ldGhvZHMsIGFuZCBwcm9wZXJ0aWVzIGFjcm9zcyBtdWx0aXBsZSBwcm9ncmFtbWluZyBsYW5ndWFnZXMsIGluY2x1ZGluZyBQeXRob24sIEphdmFTY3JpcHQsIGFuZCBUeXBlU2NyaXB0LlxuXG4jIyBLZXkgRmVhdHVyZXNcblxuLSAqKkFkdmFuY2VkIENvZGUgUXVlcnlpbmcqKjogRWFzaWx5IGxvY2F0ZSBmdW5jdGlvbnMsIGNsYXNzZXMsIG1ldGhvZHMsIHByb3BlcnRpZXMsIGltcG9ydHMsIGFuZCBtb3JlIHdpdGhpbiB5b3VyIHNvdXJjZSBjb2RlLCB1c2luZyBhIHVuaWZvcm0sIGludHVpdGl2ZSBBUEkuXG4tICoqUG93ZXJmdWwgQ29kZSBNYW5pcHVsYXRpb24qKjogUmVwbGFjZSwgYWRkLCBvciByZW1vdmUgZnVuY3Rpb25zLCBtZXRob2RzLCBjbGFzc2VzLCBwcm9wZXJ0aWVzLCBvciBlbnRpcmUgY29kZSBzZWN0aW9ucyB3aXRoIG1pbmltYWwgZWZmb3J0LlxuLSAqKlN5bnRheC1hd2FyZSBPcGVyYXRpb25zKio6IEVuc3VyZXMgYWNjdXJhdGUgbWFuaXB1bGF0aW9uIHByZXNlcnZpbmcgc3ludGF4IGludGVncml0eSB0aHJvdWdoIHRoZSBgdHJlZS1zaXR0ZXJgIHBhcnNlci5cbi0gKipMYW5ndWFnZSBEZXRlY3Rpb24qKjogQXV0b21hdGljYWxseSBpZGVudGlmaWVzIHRoZSBwcm9ncmFtbWluZyBsYW5ndWFnZSBiYXNlZCBvbiBmaWxlIGV4dGVuc2lvbnMgb3IgY29kZSBhbmFseXNpcy5cbi0gKipFeHRlbnNpYmxlIEFyY2hpdGVjdHVyZSoqOiBFYXNpbHkgYWRkIHN1cHBvcnQgZm9yIG5ldyBwcm9ncmFtbWluZyBsYW5ndWFnZXMgdGhyb3VnaCB0aGUgc3RyYXRlZ3kgcGF0dGVybi5cblxuIyMgU3VwcG9ydGVkIExhbmd1YWdlc1xuXG4tIFB5dGhvblxuLSBKYXZhU2NyaXB0IC8gVHlwZVNjcmlwdCAoaW5jbHVkaW5nIFRTWClcblxuIyMgSW5zdGFsbGF0aW9uXG5cbiMjIyBVc2luZyBwaXAgLyBwaXB4XG5cblRoZSBzaW1wbGVzdCB3YXkgdG8gaW5zdGFsbCBDb2RlSGVtOlxuXG5gYGBiYXNoXG5waXAgaW5zdGFsbCBjb2RlaGVtXG5gYGBgXG5vclxuXG5gYGBiYXNoXG5waXB4IGluc3RhbGwgY29kZWhlbVxuYGBgYFxuXG4jIyBQcm9qZWN0IFN0cnVjdHVyZVxuXG5gYGBcbkNvZGVIZW0vXG7ilJzilIDilIAgYXN0X2hhbmRsZXIucHkgICAgICAgICAgICAjIFVuaWZpZWQgaW50ZXJmYWNlIGZvciBBU1Qgb3BlcmF0aW9uc1xu4pSc4pSA4pSAIGNhY2hpbmcvICAgICAgICAgICAgICAgICAgIyBQZXJmb3JtYW5jZSBvcHRpbWl6YXRpb24gdGhyb3VnaCBjYWNoaW5nXG7ilIIgICDilJzilIDilIAgX19pbml0X18ucHlcbuKUgiAgIOKUlOKUgOKUgCBjYWNoZV9tYW5hZ2VyLnB5XG7ilIJcbuKUnOKUgOKUgCBmaW5kZXIvICAgICAgICAgICAgICAgICAgICMgQ29kZSBlbGVtZW50IGxvY2F0aW9uXG7ilIIgICDilJzilIDilIAgYmFzZS5weSAgICAgICAgICAgICAgICMgQWJzdHJhY3QgYmFzZSBjbGFzcyBmb3IgcXVlcnlpbmcgY29kZSBlbGVtZW50c1xu4pSCICAg4pSc4pSA4pSAIGZhY3RvcnkucHkgICAgICAgICAgICAjIEZhY3RvcnkgZm9yIGNyZWF0aW5nIGNvZGUgZmluZGVyc1xu4pSCICAg4pSU4pSA4pSAIGxhbmcvXG7ilIIgICAgICAg4pSc4pSA4pSAIHB5dGhvbl9jb2RlX2ZpbmRlci5weVxu4pSCICAgICAgIOKUlOKUgOKUgCB0eXBlc2NyaXB0X2NvZGVfZmluZGVyLnB5XG7ilIJcbuKUnOKUgOKUgCBmb3JtYXR0aW5nLyAgICAgICAgICAgICAgICMgQ29kZSBmb3JtYXR0aW5nIHN5c3RlbVxu4pSCICAg4pSc4pSA4pSAIF9faW5pdF9fLnB5XG7ilIIgICDilJzilIDilIAgZm9ybWF0dGVyLnB5ICAgICAgICAgICMgQmFzZSBmb3JtYXR0ZXIgY2xhc3NcbuKUgiAgIOKUnOKUgOKUgCBweXRob25fZm9ybWF0dGVyLnB5ICAgIyBQeXRob24tc3BlY2lmaWMgZm9ybWF0dGVyXG7ilIIgICDilJTilIDilIAgdHlwZXNjcmlwdF9mb3JtYXR0ZXIucHkgIyBUeXBlU2NyaXB0LXNwZWNpZmljIGZvcm1hdHRlclxu4pSCXG7ilJzilIDilIAgbGFuZ3VhZ2VfaGFuZGxlci5weSAgICAgICAjIEhpZ2gtbGV2ZWwgbGFuZ3VhZ2UgaGFuZGxpbmcgaW50ZXJmYWNlIChMYW5nSGVtKVxu4pSc4pSA4pSAIGxhbmd1YWdlcy5weSAgICAgICAgICAgICAgIyBMYW5ndWFnZSBkZWZpbml0aW9ucyBhbmQgcGFyc2Vyc1xu4pSCXG7ilJzilIDilIAgbWFuaXB1bGF0b3IvICAgICAgICAgICAgICAjIENvZGUgbWFuaXB1bGF0aW9uXG7ilIIgICDilJzilIDilIAgYWJzdHJhY3QucHkgICAgICAgICAgICMgQWJzdHJhY3QgaW50ZXJmYWNlIGZvciBjb2RlIG1hbmlwdWxhdG9yc1xu4pSCICAg4pSc4pSA4pSAIGJhc2UucHkgICAgICAgICAgICAgICAjIEJhc2UgaW1wbGVtZW50YXRpb25cbuKUgiAgIOKUnOKUgOKUgCBmYWN0b3J5LnB5ICAgICAgICAgICAgIyBGYWN0b3J5IGZvciBtYW5pcHVsYXRvcnNcbuKUgiAgIOKUlOKUgOKUgCBsYW5nL1xu4pSCICAgICAgIOKUnOKUgOKUgCBweXRob25fbWFuaXB1bGF0b3IucHlcbuKUgiAgICAgICDilJTilIDilIAgdHlwZXNjcmlwdF9tYW5pcHVsYXRvci5weVxu4pSCXG7ilJzilIDilIAgcXVlcnlfYnVpbGRlci5weSAgICAgICAgICAjIFVuaWZpZWQgcXVlcnkgY29uc3RydWN0aW9uXG7ilIJcbuKUnOKUgOKUgCBzdHJhdGVnaWVzLyAgICAgICAgICAgICAgICMgU3RyYXRlZ3kgcGF0dGVybiBmb3IgbGFuZ3VhZ2Utc3BlY2lmaWMgb3BlcmF0aW9uc1xu4pSCICAg4pSc4pSA4pSAIF9faW5pdF9fLnB5XG7ilIIgICDilJzilIDilIAgbGFuZ3VhZ2Vfc3RyYXRlZ3kucHkgICMgQWJzdHJhY3Qgc3RyYXRlZ3kgaW50ZXJmYWNlXG7ilIIgICDilJzilIDilIAgcHl0aG9uX3N0cmF0ZWd5LnB5ICAgICMgUHl0aG9uLXNwZWNpZmljIHN0cmF0ZWd5XG7ilIIgICDilJTilIDilIAgdHlwZXNjcmlwdF9zdHJhdGVneS5weSAjIFR5cGVTY3JpcHQtc3BlY2lmaWMgc3RyYXRlZ3lcbuKUglxu4pSc4pSA4pSAIHRlbXBsYXRlcy8gICAgICAgICAgICAgICAgIyBUZW1wbGF0ZXMgZm9yIGFkZGluZyBuZXcgbGFuZ3VhZ2VzXG7ilIIgICDilJTilIDilIAgbmV3X2xhbmd1YWdlX3RlbXBsYXRlLnB5XG7ilIJcbuKUlOKUgOKUgCB1dGlscy9cbiAgICDilJTilIDilIAgbG9ncy5weSAgICAgICAgICAgICAgICMgTG9nZ2luZyB1dGlsaXRpZXNcbiMjIFVzYWdlIEV4YW1wbGVcblxuIyMjIFF1ZXJ5aW5nIENvZGVcblxuaGFuZGxlciA9IENvZGVIZW0oJ3B5dGhvbicpXG5cbmNvZGUgPSAnJydcbmNsYXNzIEV4YW1wbGU6XG4gICAgZGVmIGdyZWV0KHNlbGYpOlxuICAgICAgICBwcmludChcIkhlbGxvXCIpXG4nJydcblxuIyBGaW5kIG1ldGhvZCBsb2NhdGlvblxuc3RhcnQsIGVuZCA9IGhhbmRsZXIuZmluZGVyLmZpbmRfbWV0aG9kKGNvZGUsICdFeGFtcGxlJywgJ2dyZWV0JylcbnByaW50KGYnTWV0aG9kIGZvdW5kIGZyb20gbGluZSB7c3RhcnR9IHRvIHtlbmR9JylcbiMjIyBNYW5pcHVsYXRpbmcgQ29kZVxuXG5cbm9yaWdpbmFsX2NvZGUgPSAnJydcbmRlZiBncmVldCgpOlxuICAgIHByaW50KFwiSGVsbG9cIilcbicnJ1xuXG5uZXdfZnVuY3Rpb24gPSAnJydcbmRlZiBncmVldCgpOlxuICAgIHByaW50KFwiSGVsbG8sIFdvcmxkIVwiKVxuJycnXG5cbm1vZGlmaWVkX2NvZGUgPSBoYW5kbGVyLm1hbmlwdWxhdG9yLnJlcGxhY2VfZnVuY3Rpb24ob3JpZ2luYWxfY29kZSwgJ2dyZWV0JywgbmV3X2Z1bmN0aW9uKVxuYGBgXG5cbiMjIENvbnRyaWJ1dGluZ1xuXG5XZSB3YXJtbHkgd2VsY29tZSBjb250cmlidXRpb25zLCB3aGV0aGVyIGl0J3MgdGhyb3VnaCByZXBvcnRpbmcgaXNzdWVzLCBzdWdnZXN0aW5nIGVuaGFuY2VtZW50cywgb3Igc3VibWl0dGluZyBwdWxsIHJlcXVlc3RzLiBGZWVsIGZyZWUgdG8gcGFydGljaXBhdGUhXG5cbiMjIExpY2Vuc2VcblxuVGhpcyBwcm9qZWN0IGlzIGxpY2Vuc2VkIHVuZGVyIHRoZSBNSVQgbGljZW5zZS4gU2VlIGBMSUNFTlNFYCBmb3IgZGV0YWlscy4uLi5cblBhdGg6IGNvZGVoZW0yL2xhbmd1YWdlcy9kZXRlY3Rpb24ucHlcbi4uLlxuXG4gICAgICAgICMgQm9vc3QgY29uZmlkZW5jZSBmb3Igc2hvcnQgc25pcHBldHMgd2l0aCBzdHJvbmcgaW5kaWNhdG9yc1xuICAgICAgICBpZiBudW1fbGluZXMgPCAxMCBhbmQgc2NvcmUgPiAzMDpcbiAgICAgICAgICAgIGNvbmZpZGVuY2UgPSBtYXgoY29uZmlkZW5jZSwgMC43KVxuICAgICAgICBpZiBudW1fbGluZXMgPCA1IGFuZCBzY29yZSA+IDE1OlxuICAgICAgICAgICAgIGNvbmZpZGVuY2UgPSBtYXgoY29uZmlkZW5jZSwgMC42KVxuXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJQeXRob24gZGV0ZWN0aW9uIGNvbmZpZGVuY2U6IHtjb25maWRlbmNlOi4yZn0gKFNjb3JlOiB7c2NvcmV9LCBMaW5lczoge251bV9saW5lc30pXCIpXG4gICAgICAgIHJldHVybiBjb25maWRlbmNlXG5cbiMgVE9ETzogQWRkIGRldGVjdG9ycyBmb3IgVHlwZVNjcmlwdCwgSmF2YVNjcmlwdCBldGMuXG4jIGNsYXNzIFR5cGVTY3JpcHRMYW5ndWFnZURldGVjdG9yKEJhc2VMYW5ndWFnZURldGVjdG9yKTogLi4uXG5cbiMgLS0tIERldGVjdGlvbiBGdW5jdGlvbiAtLS1cblxuX0RFVEVDVE9SUzogTGlzdFtCYXNlTGFuZ3VhZ2VEZXRlY3Rvcl0gPSBbXG4gICAgUHl0aG9uTGFuZ3VhZ2VEZXRlY3RvcigpLFxuICAgICMgQWRkIG90aGVyIGRldGVjdG9yIGluc3RhbmNlcyBoZXJlXG4gICAgIyBUeXBlU2NyaXB0TGFuZ3VhZ2VEZXRlY3RvcigpLFxuXVxuLi4uXG5cbiAgICBiZXN0X21hdGNoOiBPcHRpb25hbFtzdHJdID0gTm9uZVxuICAgIGhpZ2hlc3RfY29uZmlkZW5jZTogZmxvYXQgPSAwLjBcbiAgICBtaW5fY29uZmlkZW5jZV90aHJlc2hvbGQgPSAwLjMgIyBNaW5pbXVtIGNvbmZpZGVuY2UgdG8gY29uc2lkZXIgYSBtYXRjaFxuXG4gICAgbG9nZ2VyLmRlYnVnKGZcIkF0dGVtcHRpbmcgbGFuZ3VhZ2UgZGV0ZWN0aW9uIGZvciBjb2RlIHNuaXBwZXQgKGxlbmd0aDoge2xlbihjb2RlKX0pLlwiKVxuXG4gICAgZm9yIGRldGVjdG9yIGluIF9ERVRFQ1RPUlM6XG4gICAgICAgIHRyeTpcbiAgICAgICAgICAgIGNvbmZpZGVuY2UgPSBkZXRlY3Rvci5kZXRlY3RfY29uZmlkZW5jZShjb2RlKVxuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIiAgRGV0ZWN0b3IgJ3tkZXRlY3Rvci5sYW5ndWFnZV9jb2RlfScgY29uZmlkZW5jZToge2NvbmZpZGVuY2U6LjNmfVwiKVxuICAgICAgICAgICAgaWYgY29uZmlkZW5jZSA+IGhpZ2hlc3RfY29uZmlkZW5jZSBhbmQgY29uZmlkZW5jZSA+PSBtaW5fY29uZmlkZW5jZV90aHJlc2hvbGQ6XG4gICAgICAgICAgICAgICAgaGlnaGVzdF9jb25maWRlbmNlID0gY29uZmlkZW5jZVxuICAgICAgICAgICAgICAgIGJlc3RfbWF0Y2ggPSBkZXRlY3Rvci5sYW5ndWFnZV9jb2RlXG4gICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJFcnJvciBydW5uaW5nIGRldGVjdG9yIHtkZXRlY3Rvci5sYW5ndWFnZV9jb2RlfToge2V9XCIsIGV4Y19pbmZvPUZhbHNlKVxuLi4uXG5QYXRoOiBjb2RlaGVtL2xhbmd1YWdlcy9fX2luaXRfXy5weVxuLi4uXG5cbmRlZiBnZXRfbGFuZ3VhZ2Vfc2VydmljZV9mb3JfY29kZShjb2RlOiBzdHIpIC0+IE9wdGlvbmFsW0xhbmd1YWdlU2VydmljZV06XG4gICAgXCJcIlwiXG4gICAgQXR0ZW1wdCB0byBkZXRlY3QgbGFuZ3VhZ2UgZnJvbSBjb2RlIGNvbnRlbnQuXG4gICAgVGhpcyBpcyBhIGhldXJpc3RpYyBhcHByb2FjaCBhbmQgbm90IDEwMCUgcmVsaWFibGUuXG4gICAgXCJcIlwiXG4gICAgaWYgbm90IGNvZGUuc3RyaXAoKTpcbiAgICAgICAgcmV0dXJuIE5vbmVcbiAgICBcbiAgICByZXN1bHRzID0gW11cbiAgICAjIFVzZSBhbGwgYXZhaWxhYmxlIGRldGVjdG9yc1xuICAgIGZvciBsYW5ndWFnZV9jb2RlIGluIHJlZ2lzdHJ5LmdldF9zdXBwb3J0ZWRfbGFuZ3VhZ2VzKCk6XG4gICAgICAgIGRldGVjdG9yID0gcmVnaXN0cnkuZ2V0X2xhbmd1YWdlX2RldGVjdG9yKGxhbmd1YWdlX2NvZGUpXG4gICAgICAgIGlmIGRldGVjdG9yOlxuICAgICAgICAgICAgY29uZmlkZW5jZSA9IGRldGVjdG9yLmRldGVjdF9jb25maWRlbmNlKGNvZGUpXG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoZlwiTGFuZ3VhZ2UgZGV0ZWN0aW9uIGNvbmZpZGVuY2UgZm9yIHtsYW5ndWFnZV9jb2RlfToge2NvbmZpZGVuY2V9XCIpXG4gICAgICAgICAgICBpZiBjb25maWRlbmNlID4gMDpcbiAgICAgICAgICAgICAgICByZXN1bHRzLmFwcGVuZCgobGFuZ3VhZ2VfY29kZSwgY29uZmlkZW5jZSkpXG4gICAgXG4gICAgaWYgbm90IHJlc3VsdHM6XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhcIk5vIGxhbmd1YWdlIGRldGVjdGVkXCIpXG4gICAgICAgIHJldHVybiBOb25lXG4gICAgXG4gICAgIyBTb3J0IGJ5IGNvbmZpZGVuY2Ugc2NvcmVcbiAgICByZXN1bHRzLnNvcnQoa2V5PWxhbWJkYSB4OiB4WzFdLCByZXZlcnNlPVRydWUpXG4gICAgbG9nZ2VyLmRlYnVnKGZcIkJlc3QgbGFuZ3VhZ2UgbWF0Y2g6IHtyZXN1bHRzWzBdWzBdfSB3aXRoIGNvbmZpZGVuY2Uge3Jlc3VsdHNbMF1bMV19XCIpXG4gICAgXG4gICAgIyBVc2UgdGhlIGxhbmd1YWdlIHdpdGggdGhlIGhpZ2hlc3QgY29uZmlkZW5jZSBpZiBpdCdzIGFib3ZlIGEgdGhyZXNob2xkXG4gICAgaWYgcmVzdWx0c1swXVsxXSA+IDAuNTpcbiAgICAgICAgcmV0dXJuIGdldF9sYW5ndWFnZV9zZXJ2aWNlKHJlc3VsdHNbMF1bMF0pXG4gICAgXG4gICAgIyBGYWxsYmFjayB0byBiYXNpYyBwYXR0ZXJuIG1hdGNoaW5nXG4gICAgaWYgcmUuc2VhcmNoKCdkZWZcXFxccytcXFxcdytcXFxccypcXFxcKCcsIGNvZGUpIGFuZCByZS5zZWFyY2goJzpcXFxccypcXFxcbicsIGNvZGUpOlxuICAgICAgICByZXR1cm4gZ2V0X2xhbmd1YWdlX3NlcnZpY2UoJ3B5dGhvbicpXG4gICAgZWxpZiByZS5zZWFyY2goJ2Z1bmN0aW9uXFxcXHMrXFxcXHcrXFxcXHMqXFxcXCgnLCBjb2RlKSBvciByZS5zZWFyY2goJzpcXFxccypcXFxcdysnLCBjb2RlKTpcbiAgICAgICAgcmV0dXJuIGdldF9sYW5ndWFnZV9zZXJ2aWNlKCd0eXBlc2NyaXB0JylcbiAgICBcbiAgICByZXR1cm4gTm9uZVxuXG5kZWYgZ2V0X3N1cHBvcnRlZF9sYW5ndWFnZXMoKSAtPiBMaXN0W3N0cl06XG4gICAgXCJcIlwiR2V0IGEgbGlzdCBvZiBhbGwgc3VwcG9ydGVkIGxhbmd1YWdlIGNvZGVzLlwiXCJcIlxuICAgIHJldHVybiByZWdpc3RyeS5nZXRfc3VwcG9ydGVkX2xhbmd1YWdlcygpLi4uXG5QYXRoOiBjb2RlaGVtL2NvcmUvcmVnaXN0cnkucHlcbi4uLlxuXG5jbGFzcyBSZWdpc3RyeTpcbiAgICBcIlwiXCJDZW50cmFsIHJlZ2lzdHJ5IGZvciBDb2RlSGVtIGNvbXBvbmVudHMuXCJcIlwiXG4gICAgX2luc3RhbmNlID0gTm9uZVxuXG4gICAgZGVmIF9faW5pdF9fKHNlbGYpOlxuICAgICAgICBzZWxmLl9pbml0aWFsaXplZCA9IEZhbHNlXG4gICAgICAgIHNlbGYuX2luaXRpYWxpemUoKVxuXG4gICAgZGVmIF9fbmV3X18oY2xzKTpcbiAgICAgICAgaWYgY2xzLl9pbnN0YW5jZSBpcyBOb25lOlxuICAgICAgICAgICAgY2xzLl9pbnN0YW5jZSA9IHN1cGVyKFJlZ2lzdHJ5LCBjbHMpLl9fbmV3X18oY2xzKVxuICAgICAgICByZXR1cm4gY2xzLl9pbnN0YW5jZVxuXG4gICAgZGVmIF9pbml0aWFsaXplKHNlbGYpOlxuICAgICAgICBcIlwiXCJJbml0aWFsaXplcyBlbXB0eSByZWdpc3RyaWVzLlwiXCJcIlxuICAgICAgICBpZiBoYXNhdHRyKHNlbGYsICdfaW5pdGlhbGl6ZWQnKSBhbmQgc2VsZi5faW5pdGlhbGl6ZWQ6XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgc2VsZi5sYW5ndWFnZV9kZXRlY3RvcnMgPSB7fVxuICAgICAgICBzZWxmLmxhbmd1YWdlX3NlcnZpY2VzID0ge31cbiAgICAgICAgc2VsZi5hbGxfZGVzY3JpcHRvcnMgPSB7fVxuICAgICAgICBzZWxmLmFsbF9leHRyYWN0b3JzID0ge31cbiAgICAgICAgc2VsZi5hbGxfbWFuaXB1bGF0b3JzID0ge31cbiAgICAgICAgc2VsZi5kaXNjb3ZlcmVkX21vZHVsZXMgPSBzZXQoKVxuICAgICAgICBzZWxmLmxhbmd1YWdlX3NlcnZpY2VfaW5zdGFuY2VzID0ge31cbiAgICAgICAgc2VsZi5faW5pdGlhbGl6ZWQgPSBGYWxzZVxuICAgICAgICBsb2dnZXIuZGVidWcoJ1JlZ2lzdHJ5IF9pbml0aWFsaXplIGNvbXBsZXRlZC4nKVxuLi4uXG5cbiAgICBkZWYgcmVnaXN0ZXJfbGFuZ3VhZ2Vfc2VydmljZShzZWxmLCBjbHM6IFR5cGVbTGFuZ3VhZ2VTZXJ2aWNlXSk6XG4gICAgICAgIFwiXCJcIlJlZ2lzdGVycyBhIGxhbmd1YWdlIHNlcnZpY2UgY2xhc3MuXCJcIlwiXG4gICAgICAgIHRyeTpcbiAgICAgICAgICAgIGxhbmd1YWdlX2NvZGUgPSBjbHMuTEFOR1VBR0VfQ09ERS5sb3dlcigpXG4gICAgICAgICAgICBpZiBsYW5ndWFnZV9jb2RlIGluIHNlbGYubGFuZ3VhZ2Vfc2VydmljZXM6XG4gICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZlwiTGFuZ3VhZ2Ugc2VydmljZSBmb3IgJ3tsYW5ndWFnZV9jb2RlfScgaXMgYWxyZWFkeSByZWdpc3RlcmVkICh7c2VsZi5sYW5ndWFnZV9zZXJ2aWNlc1tsYW5ndWFnZV9jb2RlXS5fX25hbWVfX30pLiBPdmVyd3JpdGluZyB3aXRoIHtjbHMuX19uYW1lX199LlwiKVxuICAgICAgICAgICAgc2VsZi5sYW5ndWFnZV9zZXJ2aWNlc1tsYW5ndWFnZV9jb2RlXSA9IGNsc1xuICAgICAgICAgICAgcmljaC5wcmludChmJ1JlZ2lzdGVyZWQgbGFuZ3VhZ2Ugc2VydmljZToge2Nscy5fX25hbWVfX30gZm9yIHtsYW5ndWFnZV9jb2RlfScpXG4gICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGR1cmluZyByZWdpc3RyYXRpb24gb2YgbGFuZ3VhZ2Ugc2VydmljZSB7Y2xzLl9fbmFtZV9ffToge2V9JywgZXhjX2luZm89VHJ1ZSlcbiAgICAgICAgcmV0dXJuIGNsc1xuXG4gICAgZGVmIHJlZ2lzdGVyX2V4dHJhY3RvcihzZWxmLCBjbHM6IFR5cGVbQmFzZUV4dHJhY3Rvcl0pOlxuICAgICAgICBcIlwiXCJSZWdpc3RlcnMgYW4gZXh0cmFjdG9yIGNsYXNzLlwiXCJcIlxuICAgICAgICB0cnk6XG4gICAgICAgICAgICBsYW5ndWFnZV9jb2RlID0gY2xzLkxBTkdVQUdFX0NPREUubG93ZXIoKVxuICAgICAgICAgICAgZWxlbWVudF90eXBlID0gY2xzLkVMRU1FTlRfVFlQRS52YWx1ZS5sb3dlcigpXG4gICAgICAgICAgICBleHRyYWN0b3Jfa2V5ID0gZid7bGFuZ3VhZ2VfY29kZX0ve2VsZW1lbnRfdHlwZX0nXG4gICAgICAgICAgICBpZiBleHRyYWN0b3Jfa2V5IGluIHNlbGYuYWxsX2V4dHJhY3RvcnM6XG4gICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZlwiRXh0cmFjdG9yIGZvciAne2V4dHJhY3Rvcl9rZXl9JyBpcyBhbHJlYWR5IHJlZ2lzdGVyZWQgKHtzZWxmLmFsbF9leHRyYWN0b3JzW2V4dHJhY3Rvcl9rZXldLl9fbmFtZV9ffSkuIE92ZXJ3cml0aW5nIHdpdGgge2Nscy5fX25hbWVfX30uXCIpXG4gICAgICAgICAgICBzZWxmLmFsbF9leHRyYWN0b3JzW2V4dHJhY3Rvcl9rZXldID0gY2xzXG4gICAgICAgICAgICByaWNoLnByaW50KGYnUmVnaXN0ZXJlZCBleHRyYWN0b3I6IHtjbHMuX19uYW1lX199IGZvciB7ZXh0cmFjdG9yX2tleX0nKVxuICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBkdXJpbmcgcmVnaXN0cmF0aW9uIG9mIGV4dHJhY3RvciB7Y2xzLl9fbmFtZV9ffToge2V9JywgZXhjX2luZm89VHJ1ZSlcbiAgICAgICAgcmV0dXJuIGNsc1xuLi4uXG5cbiAgICBkZWYgaW5pdGlhbGl6ZV9jb21wb25lbnRzKHNlbGYpOlxuICAgICAgICBcIlwiXCJEaXNjb3ZlcnMgYW5kIGluaXRpYWxpemVzIGFsbCBjb21wb25lbnRzLiBDYWxsZWQgb25jZS5cIlwiXCJcbiAgICAgICAgaWYgc2VsZi5faW5pdGlhbGl6ZWQ6XG4gICAgICAgICAgICBsb2dnZXIuZGVidWcoJ0NvbXBvbmVudHMgYWxyZWFkeSBpbml0aWFsaXplZC4nKVxuICAgICAgICAgICAgcmV0dXJuXG5cbiAgICAgICAgbG9nZ2VyLmluZm8oJ1N0YXJ0aW5nIENvZGVIZW0gY29tcG9uZW50IGluaXRpYWxpemF0aW9uLi4uJylcbiAgICAgICAgc2VsZi5kaXNjb3Zlcl9tb2R1bGVzKCkgIyBEaXNjb3ZlciBjb21wb25lbnRzIGluIHRoZSBtYWluIHBhY2thZ2UgYW5kIHN1YnBhY2thZ2VzXG4gICAgICAgIHNlbGYuX2luaXRpYWxpemVkID0gVHJ1ZVxuICAgICAgICByaWNoLnByaW50KGYnQ29tcG9uZW50cyBpbml0aWFsaXplZDoge2xlbihzZWxmLmxhbmd1YWdlX2RldGVjdG9ycyl9IGRldGVjdG9ycywge2xlbihzZWxmLmxhbmd1YWdlX3NlcnZpY2VzKX0gc2VydmljZXMsIHtsZW4oc2VsZi5hbGxfZXh0cmFjdG9ycyl9IGV4dHJhY3RvcnMsIHtsZW4oc2VsZi5hbGxfbWFuaXB1bGF0b3JzKX0gbWFuaXB1bGF0b3JzIHJlZ2lzdGVyZWQuJylcbiAgICAgICAgbG9nZ2VyLmluZm8oJ0NvbXBvbmVudCBpbml0aWFsaXphdGlvbiBmaW5pc2hlZC4nKVxuXG4jIEdsb2JhbCByZWdpc3RyeSBpbnN0YW5jZVxucmVnaXN0cnkgPSBSZWdpc3RyeSgpXG5cbiMgRGVjb3JhdG9ycyBmb3IgcmVnaXN0cmF0aW9uXG5kZWYgbGFuZ3VhZ2VfZGV0ZWN0b3IoY2xzKTpcbiAgICBcIlwiXCJEZWNvcmF0b3IgZm9yIHJlZ2lzdGVyaW5nIGEgbGFuZ3VhZ2UgZGV0ZWN0b3IuXCJcIlwiXG4gICAgcmV0dXJuIHJlZ2lzdHJ5LnJlZ2lzdGVyX2xhbmd1YWdlX2RldGVjdG9yKGNscylcblxuZGVmIGxhbmd1YWdlX3NlcnZpY2UoY2xzKTpcbiAgICBcIlwiXCJEZWNvcmF0b3IgZm9yIHJlZ2lzdGVyaW5nIGEgbGFuZ3VhZ2Ugc2VydmljZS5cIlwiXCJcbiAgICByZXR1cm4gcmVnaXN0cnkucmVnaXN0ZXJfbGFuZ3VhZ2Vfc2VydmljZShjbHMpXG5cbmRlZiBleHRyYWN0b3IoY2xzKTpcbiAgICBcIlwiXCJEZWNvcmF0b3IgZm9yIHJlZ2lzdGVyaW5nIGFuIGV4dHJhY3Rvci5cIlwiXCJcbiAgICByZXR1cm4gcmVnaXN0cnkucmVnaXN0ZXJfZXh0cmFjdG9yKGNscylcblxuZGVmIG1hbmlwdWxhdG9yKGNscyk6XG4gICAgXCJcIlwiRGVjb3JhdG9yIGZvciByZWdpc3RlcmluZyBhIG1hbmlwdWxhdG9yLlwiXCJcIlxuICAgIHJldHVybiByZWdpc3RyeS5yZWdpc3Rlcl9tYW5pcHVsYXRvcihjbHMpXG5cbmRlZiBlbGVtZW50X3R5cGVfZGVzY3JpcHRvcihjbHMpOlxuICAgIFwiXCJcIkRlY29yYXRvciBmb3IgcmVnaXN0ZXJpbmcgYW4gZWxlbWVudCB0eXBlIGRlc2NyaXB0b3IuXCJcIlwiXG4gICAgcmV0dXJuIHJlZ2lzdHJ5LnJlZ2lzdGVyX2VsZW1lbnRfdHlwZV9kZXNjcmlwdG9yKGNscykuLi5cbiIsImlzX2Vycm9yIjpmYWxzZSwicmVxdWVzdF9pZCI6IiIsInRvb2xfdXNlX2lkIjoidG9vbHVfdnJ0eF8wMVV3dmFSNXJyamQzeENEQ29ZSzlWbnAifX0seyJpZCI6MiwidHlwZSI6NCwiaWRlX3N0YXRlX25vZGUiOnsid29ya3NwYWNlRm9sZGVycyI6W3sicmVwb3NpdG9yeVJvb3QiOiJEOi9jb2RlL0NvZGVIZW0iLCJmb2xkZXJSb290IjoiRDovY29kZS9Db2RlSGVtIn1dLCJ3b3Jrc3BhY2VGb2xkZXJzVW5jaGFuZ2VkIjpmYWxzZX19XSwicmVzcG9uc2VfdGV4dCI6IkJhc2VkIG9uIG15IGV4cGxvcmF0aW9uIG9mIHRoZSBjb2RlYmFzZSwgSSBjYW4gcHJvdmlkZSB5b3Ugd2l0aCBhbiBvdmVydmlldyBvZiB3aGF0IENvZGVIZW0gaXMgYWJvdXQ6XG5cbiMjIENvZGVIZW0gT3ZlcnZpZXdcblxuQ29kZUhlbSBpcyBhIGxhbmd1YWdlLWFnbm9zdGljIGxpYnJhcnkgZGVzaWduZWQgZm9yIHNvcGhpc3RpY2F0ZWQgcXVlcnlpbmcgYW5kIG1hbmlwdWxhdGlvbiBvZiBzb3VyY2UgY29kZS4gSXQgcHJvdmlkZXMgdG9vbHMgdG8gbmF2aWdhdGUsIGFuYWx5emUsIGFuZCBtb2RpZnkgY29kZSBlbGVtZW50cyBzdWNoIGFzIGZ1bmN0aW9ucywgY2xhc3NlcywgbWV0aG9kcywgYW5kIHByb3BlcnRpZXMgYWNyb3NzIG11bHRpcGxlIHByb2dyYW1taW5nIGxhbmd1YWdlcy5cblxuIyMjIEtleSBGZWF0dXJlc1xuXG4xLiAqKkNvZGUgUXVlcnlpbmcqKjogTG9jYXRlIGNvZGUgZWxlbWVudHMgKGZ1bmN0aW9ucywgY2xhc3NlcywgbWV0aG9kcywgcHJvcGVydGllcywgaW1wb3J0cykgdXNpbmcgYSB1bmlmb3JtIEFQSVxuMi4gKipDb2RlIE1hbmlwdWxhdGlvbioqOiBSZXBsYWNlLCBhZGQsIG9yIHJlbW92ZSBjb2RlIGVsZW1lbnRzIHdoaWxlIHByZXNlcnZpbmcgc3ludGF4IGludGVncml0eVxuMy4gKipTeW50YXgtYXdhcmUgT3BlcmF0aW9ucyoqOiBVc2VzIHRyZWUtc2l0dGVyIHBhcnNlciB0byBlbnN1cmUgYWNjdXJhdGUgbWFuaXB1bGF0aW9uXG40LiAqKkxhbmd1YWdlIERldGVjdGlvbioqOiBBdXRvbWF0aWNhbGx5IGlkZW50aWZpZXMgcHJvZ3JhbW1pbmcgbGFuZ3VhZ2VzIGZyb20gY29kZSBvciBmaWxlIGV4dGVuc2lvbnNcbjUuICoqRXh0ZW5zaWJsZSBBcmNoaXRlY3R1cmUqKjogU3VwcG9ydHMgYWRkaW5nIG5ldyBwcm9ncmFtbWluZyBsYW5ndWFnZXMgdGhyb3VnaCBhIHN0cmF0ZWd5IHBhdHRlcm5cblxuIyMjIEN1cnJlbnRseSBTdXBwb3J0ZWQgTGFuZ3VhZ2VzXG5cbi0gUHl0aG9uXG4tIEphdmFTY3JpcHQvVHlwZVNjcmlwdCAoaW5jbHVkaW5nIFRTWClcblxuIyMjIE1haW4gQ29tcG9uZW50c1xuXG5UaGUgY29kZWJhc2UgaXMgb3JnYW5pemVkIGludG8gc2V2ZXJhbCBrZXkgbW9kdWxlczpcblxuMS4gKipDb3JlIEVuZ2luZSoqOiBJbmNsdWRlcyBYUGF0aCBwYXJzaW5nIGFuZCBzZXJ2aWNlcyBmb3IgZXh0cmFjdGlvbiBhbmQgbWFuaXB1bGF0aW9uXG4yLiAqKkxhbmd1YWdlIFNlcnZpY2VzKio6IExhbmd1YWdlLXNwZWNpZmljIGltcGxlbWVudGF0aW9ucyBmb3IgZGlmZmVyZW50IHByb2dyYW1taW5nIGxhbmd1YWdlc1xuMy4gKipSZWdpc3RyeSBTeXN0ZW0qKjogQ2VudHJhbCByZWdpc3RyeSBmb3IgY29tcG9uZW50cyBsaWtlIGxhbmd1YWdlIGRldGVjdG9ycywgZXh0cmFjdG9ycywgYW5kIG1hbmlwdWxhdG9yc1xuNC4gKipNb2RlbHMqKjogRGVmaW5lcyBjb2RlIGVsZW1lbnRzLCBYUGF0aCBleHByZXNzaW9ucywgYW5kIG90aGVyIGRhdGEgc3RydWN0dXJlc1xuXG4jIyMgTWFpbiBVc2FnZVxuXG5UaGUgbWFpbiBlbnRyeSBwb2ludCBpcyB0aGUgYENvZGVIZW1gIGNsYXNzLCB3aGljaCBwcm92aWRlcyBtZXRob2RzIHRvOlxuLSBFeHRyYWN0IGNvZGUgZWxlbWVudHMgZnJvbSBzb3VyY2UgY29kZVxuLSBGaW5kIGVsZW1lbnRzIHVzaW5nIFhQYXRoLWxpa2UgZXhwcmVzc2lvbnNcbi0gTWFuaXB1bGF0ZSBjb2RlIGJ5IGFkZGluZywgcmVwbGFjaW5nLCBvciByZW1vdmluZyBlbGVtZW50c1xuLSBRdWVyeSBjb2RlIHN0cnVjdHVyZVxuXG5UaGUgbGlicmFyeSBzZWVtcyB0byBiZSBkZXNpZ25lZCBmb3IgYm90aCBwcm9ncmFtbWF0aWMgdXNlIGFuZCBwb3RlbnRpYWxseSBhcyBhIGZvdW5kYXRpb24gZm9yIGRldmVsb3BlciB0b29scyB0aGF0IG5lZWQgdG8gdW5kZXJzdGFuZCBhbmQgbW9kaWZ5IGNvZGUuXG5cbldvdWxkIHlvdSBsaWtlIG1lIHRvIGV4cGxvcmUgYW55IHNwZWNpZmljIGFzcGVjdCBvZiB0aGUgY29kZWJhc2UgaW4gbW9yZSBkZXRhaWw/XG4iLCJ3b3Jrc3BhY2VfZmlsZV9jaHVua3MiOltdfSx7InJlcXVlc3RfaWQiOiJkOWZmOTU2Ni1iYTMxLTRlODktOTlkMi02ZjRlMTIyZDZkZmYiLCJzdGF0dXMiOiJjYW5jZWxsZWQiLCJjaGF0SXRlbVR5cGUiOiJhZ2VudGljLXR1cm4tZGVsaW1pdGVyIn0seyJzdGF0dXMiOiJzdWNjZXNzIiwicmVxdWVzdF9pZCI6ImMxY2NlM2M3LTEwYTUtNDc3Mi04MzZhLTgzMWEwZTE3MDQwZSIsInJlcXVlc3RfbWVzc2FnZSI6ImN6eW0gc2EgbWFuaXB1bGF0b3J5PyIsInJpY2hfdGV4dF9qc29uX3JlcHIiOnsidHlwZSI6ImRvYyIsImNvbnRlbnQiOlt7InR5cGUiOiJwYXJhZ3JhcGgiLCJjb250ZW50IjpbeyJ0eXBlIjoidGV4dCIsInRleHQiOiJjenltIHNhIG1hbmlwdWxhdG9yeT8ifV19XX0sIm1lbnRpb25lZF9pdGVtcyI6W10sInN0cnVjdHVyZWRfb3V0cHV0X25vZGVzIjpbeyJpZCI6MSwidHlwZSI6NSwiY29udGVudCI6IiIsInRvb2xfdXNlIjp7InRvb2xfdXNlX2lkIjoidG9vbHVfdnJ0eF8wMTZETkg3SGNDcWRheENIR2Vkc3lSRloiLCJ0b29sX25hbWUiOiJjb2RlYmFzZS1yZXRyaWV2YWwiLCJpbnB1dF9qc29uIjoie1wiaW5mb3JtYXRpb25fcmVxdWVzdFwiOiBcIkZpbmQgZGV0YWlsZWQgaW5mb3JtYXRpb24gYWJvdXQgbWFuaXB1bGF0b3JzIGluIHRoZSBjb2RlYmFzZS4gTG9vayBmb3IgbWFuaXB1bGF0b3IgYmFzZSBjbGFzc2VzLCBpbXBsZW1lbnRhdGlvbnMsIGFuZCBob3cgdGhleSdyZSB1c2VkLiBGb2N1cyBvbiBmaWxlcyBpbiB0aGUgbWFuaXB1bGF0b3IgZGlyZWN0b3J5IGFuZCBhbnkgcmVsYXRlZCBjb2RlIHRoYXQgZXhwbGFpbnMgdGhlaXIgcHVycG9zZSBhbmQgZnVuY3Rpb25hbGl0eS5cIn0ifX0seyJpZCI6MCwidHlwZSI6MCwiY29udGVudCI6IkxldCBtZSBleHBsb3JlIHRoZSBtYW5pcHVsYXRvciBjb21wb25lbnRzIGluIHRoZSBDb2RlSGVtIGNvZGViYXNlIHRvIGV4cGxhaW4gd2hhdCB0aGV5IGFyZSBhbmQgaG93IHRoZXkgd29yay5cbiJ9LHsiaWQiOjIsInR5cGUiOjIsImNvbnRlbnQiOiIifSx7ImlkIjozLCJ0eXBlIjozLCJjb250ZW50IjoiIn1dLCJzZWVuX3N0YXRlIjoic2VlbiIsInN0cnVjdHVyZWRfcmVxdWVzdF9ub2RlcyI6W3siaWQiOjEsInR5cGUiOjAsInRleHRfbm9kZSI6eyJjb250ZW50IjoiY3p5bSBzYSBtYW5pcHVsYXRvcnk/In19LHsiaWQiOjIsInR5cGUiOjQsImlkZV9zdGF0ZV9ub2RlIjp7IndvcmtzcGFjZUZvbGRlcnMiOlt7InJlcG9zaXRvcnlSb290IjoiRDovY29kZS9Db2RlSGVtIiwiZm9sZGVyUm9vdCI6IkQ6L2NvZGUvQ29kZUhlbSJ9XSwid29ya3NwYWNlRm9sZGVyc1VuY2hhbmdlZCI6ZmFsc2V9fV0sInJlc3BvbnNlX3RleHQiOiJMZXQgbWUgZXhwbG9yZSB0aGUgbWFuaXB1bGF0b3IgY29tcG9uZW50cyBpbiB0aGUgQ29kZUhlbSBjb2RlYmFzZSB0byBleHBsYWluIHdoYXQgdGhleSBhcmUgYW5kIGhvdyB0aGV5IHdvcmsuXG4iLCJ3b3Jrc3BhY2VfZmlsZV9jaHVua3MiOltdfSx7InN0YXR1cyI6InN1Y2Nlc3MiLCJyZXF1ZXN0X2lkIjoiYjVhMGZiODEtNDIxNC00ZjhiLThjYzctNDk3ZDUwZGRlYjZhIiwicmVxdWVzdF9tZXNzYWdlIjoiIiwic3RydWN0dXJlZF9vdXRwdXRfbm9kZXMiOlt7ImlkIjowLCJ0eXBlIjowLCJjb250ZW50IjoiIyMgTWFuaXB1bGF0b3J5IHcgQ29kZUhlbVxuXG5NYW5pcHVsYXRvcnkgKG1hbmlwdWxhdG9ycykgdyBDb2RlSGVtIHRvIGtsdWN6b3dlIGtvbXBvbmVudHkgb2Rwb3dpZWR6aWFsbmUgemEgbW9keWZpa2FjasSZIGtvZHUgxbpyw7NkxYJvd2Vnby4gT3RvIHN6Y3plZ8OzxYJvd2Ugd3lqYcWbbmllbmllOlxuXG4jIyMgQ3p5bSBzxIUgbWFuaXB1bGF0b3J5XG5cbk1hbmlwdWxhdG9yeSB0byBrbGFzeSwga3TDs3JlIGltcGxlbWVudHVqxIUgbG9naWvEmSBkbyBtb2R5Zmlrb3dhbmlhIGtvZHUgxbpyw7NkxYJvd2VnbyB3IHNwb3PDs2IgxZt3aWFkb215IHNrxYJhZG5pIGRhbmVnbyBqxJl6eWthIHByb2dyYW1vd2FuaWEuIFPEhSBvbmUgb2Rwb3dpZWR6aWFsbmUgemE6XG5cbjEuICoqRG9kYXdhbmllIGVsZW1lbnTDs3cga29kdSoqIChhZGRfZWxlbWVudCkgLSBkb2Rhd2FuaWUgbm93eWNoIGZ1bmtjamksIGtsYXMsIG1ldG9kLCBpbXBvcnTDs3cgaXRwLlxuMi4gKipaYXN0xJlwb3dhbmllIGVsZW1lbnTDs3cga29kdSoqIChyZXBsYWNlX2VsZW1lbnQpIC0gcG9kbWlhbmEgaXN0bmllasSFY3ljaCBlbGVtZW50w7N3IG5hIG5vd2VcbjMuICoqVXN1d2FuaWUgZWxlbWVudMOzdyBrb2R1KiogKHJlbW92ZV9lbGVtZW50KSAtIHVzdXdhbmllIG9rcmXFm2xvbnljaCBlbGVtZW50w7N3XG40LiAqKkZvcm1hdG93YW5pZSBrb2R1KiogLSB6YXBld25pZW5pZSwgxbxlIHptb2R5Zmlrb3dhbnkga29kIHphY2hvd3VqZSBvZHBvd2llZG5pZSB3Y2nEmWNpYSBpIHN0eWxcblxuIyMjIFN0cnVrdHVyYSBtYW5pcHVsYXRvcsOzd1xuXG5NYW5pcHVsYXRvcnkgdyBDb2RlSGVtIHPEhSB6b3JnYW5pem93YW5lIGhpZXJhcmNoaWN6bmllOlxuXG4xLiAqKk1hbmlwdWxhdG9yQmFzZSoqIC0gYWJzdHJha2N5am5hIGtsYXNhIGJhem93YSBkZWZpbml1asSFY2EgcG9kc3Rhd293eSBpbnRlcmZlanNcbjIuICoqVGVtcGxhdGVNYW5pcHVsYXRvcioqIC0gaW1wbGVtZW50dWplIHd6b3J6ZWMgcHJvamVrdG93eSBUZW1wbGF0ZSBNZXRob2QsIHphcGV3bmlhasSFYyBzdGFuZGFyZG93ZSBpbXBsZW1lbnRhY2plIHogbW/FvGxpd2/Fm2NpxIUgZG9zdG9zb3dhbmlhIHByemV6IGtsYXN5IHBvY2hvZG5lXG4zLiAqKlNwZWNqYWxpem93YW5lIG1hbmlwdWxhdG9yeSoqIC0ga29ua3JldG5lIGltcGxlbWVudGFjamUgZGxhIHLDs8W8bnljaCB0eXDDs3cgZWxlbWVudMOzdyBrb2R1IGkgasSZenlrw7N3IHByb2dyYW1vd2FuaWE6XG4gICAtIFB5dGhvbkNsYXNzTWFuaXB1bGF0b3IgLSBkbyBtYW5pcHVsYWNqaSBrbGFzYW1pIHcgUHl0aG9uaWVcbiAgIC0gUHl0aG9uSW1wb3J0TWFuaXB1bGF0b3IgLSBkbyBtYW5pcHVsYWNqaSBpbXBvcnRhbWkgdyBQeXRob25pZVxuICAgLSBQeXRob25NZXRob2RNYW5pcHVsYXRvciAtIGRvIG1hbmlwdWxhY2ppIG1ldG9kYW1pIHcgUHl0aG9uaWVcbiAgIC0gaSBpbm5lXG5cbiMjIyBSZWplc3RyYWNqYSBtYW5pcHVsYXRvcsOzd1xuXG5NYW5pcHVsYXRvcnkgc8SFIHJlamVzdHJvd2FuZSB3IGNlbnRyYWxueW0gcmVqZXN0cnplIChSZWdpc3RyeSkgemEgcG9tb2PEhSBkZWtvcmF0b3JhIGBAbWFuaXB1bGF0b3JgLiBLYcW8ZHkgbWFuaXB1bGF0b3IgamVzdCBpZGVudHlmaWtvd2FueSBwcnpleiBrb21iaW5hY2rEmTpcbi0ga29kdSBqxJl6eWthIChucC4gJ3B5dGhvbicpXG4tIHR5cHUgZWxlbWVudHUga29kdSAobnAuIENMQVNTLCBNRVRIT0QsIElNUE9SVClcblxuYGBgcHl0aG9uXG5AbWFuaXB1bGF0b3JcbmNsYXNzIFB5dGhvbkNsYXNzTWFuaXB1bGF0b3IoVGVtcGxhdGVDbGFzc01hbmlwdWxhdG9yKTpcbiAgICBcIlwiXCJNYW5pcHVsYXRvciBmb3IgUHl0aG9uIGNsYXNzZXMuXCJcIlwiXG4gICAgTEFOR1VBR0VfQ09ERSA9ICdweXRob24nXG4gICAgRUxFTUVOVF9UWVBFID0gQ29kZUVsZW1lbnRUeXBlLkNMQVNTXG4gICAgQ09NTUVOVF9NQVJLRVJTID0gWycjJ11cbiAgICBERUNPUkFUT1JfTUFSS0VSUyA9IFsnQCddXG5gYGBcblxuIyMjIEphayBkemlhxYJhasSFIG1hbmlwdWxhdG9yeVxuXG4xLiAqKkxva2FsaXphY2phIGVsZW1lbnR1KiogLSBtYW5pcHVsYXRvciB1xbx5d2EgdXPFgnVnaSBla3N0cmFrY2ppIChleHRyYWN0aW9uX3NlcnZpY2UpIGRvIHpuYWxlemllbmlhIGVsZW1lbnR1IHcga29kemllXG4yLiAqKkRvc3Rvc293YW5pZSB3Y2nEmcSHKiogLSBvYmxpY3plbmllIG9kcG93aWVkbmllZ28gcG96aW9tdSB3Y2nEmWNpYSBkbGEgbm93ZWdvIGtvZHVcbjMuICoqRm9ybWF0b3dhbmllKiogLSBmb3JtYXRvd2FuaWUgbm93ZWdvIGtvZHUgemdvZG5pZSB6IGtvbndlbmNqYW1pIGrEmXp5a2FcbjQuICoqTW9keWZpa2FjamEqKiAtIHd5a29uYW5pZSB3xYJhxZtjaXdlaiBvcGVyYWNqaSAoZG9kYW5pZSwgemFzdMSFcGllbmllLCB1c3VuacSZY2llKVxuNS4gKipPYnPFgnVnYSBzcGVjamFsbnljaCBwcnp5cGFka8OzdyoqIC0gemFjaG93YW5pZSBrb21lbnRhcnp5LCBkZWtvcmF0b3LDs3csIGRvY3N0cmluZ8OzdyBpdHAuXG5cbiMjIyBQcnp5a8WCYWQgdcW8eWNpYSBtYW5pcHVsYXRvcmFcblxuTWFuaXB1bGF0b3J5IHPEhSB1xbx5d2FuZSBwcnpleiBgTWFuaXB1bGF0aW9uU2VydmljZWAsIGt0w7NyeSBzdGFub3dpIHd5c29rb3BvemlvbW93eSBpbnRlcmZlanMgZG8gbW9keWZpa2Fjamkga29kdTpcblxuYGBgcHl0aG9uXG5kZWYgdXBzZXJ0X2VsZW1lbnQoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCBlbGVtZW50X3R5cGU6IHN0ciwgbmFtZTogc3RyLCBuZXdfY29kZTogc3RyLCBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXT1Ob25lKSAtPiBzdHI6XG4gICAgXCJcIlwiXG4gICAgQWRkIG9yIHJlcGxhY2UgYSBjb2RlIGVsZW1lbnQuXG4gICAgXCJcIlwiXG4gICAgbWFuaXB1bGF0b3IgPSBzZWxmLmxhbmd1YWdlX3NlcnZpY2UuZ2V0X21hbmlwdWxhdG9yKGVsZW1lbnRfdHlwZSlcbiAgICBpZiBtYW5pcHVsYXRvcjpcbiAgICAgICAgcmV0dXJuIG1hbmlwdWxhdG9yLnJlcGxhY2VfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBuYW1lLCBuZXdfY29kZSwgcGFyZW50X25hbWUpXG4gICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbmBgYFxuXG5NYW5pcHVsYXRvcnkgc8SFIGtsdWN6b3d5bSBlbGVtZW50ZW0gQ29kZUhlbSwga3TDs3J5IHVtb8W8bGl3aWEgaW50ZWxpZ2VudG7EhSBtb2R5ZmlrYWNqxJkga29kdSB6IHphY2hvd2FuaWVtIGplZ28gc3RydWt0dXJ5LCBmb3JtYXRvd2FuaWEgaSBza8WCYWRuaSBzcGVjeWZpY3puZWogZGxhIGRhbmVnbyBqxJl6eWthIHByb2dyYW1vd2FuaWEuXG4ifSx7ImlkIjoyLCJ0eXBlIjoyLCJjb250ZW50IjoiIn0seyJpZCI6MywidHlwZSI6MywiY29udGVudCI6IiJ9XSwic2Vlbl9zdGF0ZSI6InNlZW4iLCJzdHJ1Y3R1cmVkX3JlcXVlc3Rfbm9kZXMiOlt7ImlkIjoxLCJ0eXBlIjoxLCJ0b29sX3Jlc3VsdF9ub2RlIjp7ImNvbnRlbnQiOiJUaGUgZm9sbG93aW5nIGNvZGUgc2VjdGlvbnMgd2VyZSByZXRyaWV2ZWQ6XG5QYXRoOiBjb2RlaGVtL2NvcmUvbWFuaXB1bGF0b3JzL21hbmlwdWxhdG9yX2Jhc2UucHlcbi4uLlxuXG5jbGFzcyBNYW5pcHVsYXRvckJhc2UoQUJDKTpcbiAgICBcIlwiXCJCYXNlIGNsYXNzIGZvciBhbGwgbGFuZ3VhZ2Utc3BlY2lmaWMgbWFuaXB1bGF0b3JzLlwiXCJcIlxuICAgIExBTkdVQUdFX0NPREU6IHN0ciA9ICcnXG4gICAgRUxFTUVOVF9UWVBFOiBPcHRpb25hbFtDb2RlRWxlbWVudFR5cGVdID0gTm9uZVxuICAgIENPTU1FTlRfTUFSS0VSUzogTGlzdFtzdHJdID0gW11cbiAgICBERUNPUkFUT1JfTUFSS0VSUzogTGlzdFtzdHJdID0gW11cblxuICAgIGRlZiBfX2luaXRfXyhzZWxmLCBsYW5ndWFnZV9jb2RlOiBzdHI9Tm9uZSwgZWxlbWVudF90eXBlOiBDb2RlRWxlbWVudFR5cGU9Tm9uZSwgZm9ybWF0dGVyOiBCYXNlRm9ybWF0dGVyPU5vbmUsIGV4dHJhY3Rpb25fc2VydmljZT1Ob25lKTpcbiAgICAgICAgXCJcIlwiSW5pdGlhbGl6ZSB0aGUgbWFuaXB1bGF0b3IuXCJcIlwiXG4gICAgICAgIHNlbGYubGFuZ3VhZ2VfY29kZSA9IGxhbmd1YWdlX2NvZGUgb3Igc2VsZi5MQU5HVUFHRV9DT0RFXG4gICAgICAgIHNlbGYuZWxlbWVudF90eXBlID0gZWxlbWVudF90eXBlIG9yIHNlbGYuRUxFTUVOVF9UWVBFXG4gICAgICAgIHNlbGYuX2V4dHJhY3Rpb25fc2VydmljZSA9IGV4dHJhY3Rpb25fc2VydmljZVxuICAgICAgICBzZWxmLmZvcm1hdHRlciA9IGZvcm1hdHRlciBvciBCYXNlRm9ybWF0dGVyKClcbiAgICAgICAgaWYgbm90IHNlbGYubGFuZ3VhZ2VfY29kZTpcbiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoJ01hbmlwdWxhdG9yIHJlcXVpcmVzIGEgbGFuZ3VhZ2VfY29kZS4nKVxuXG4gICAgQHByb3BlcnR5XG4gICAgZGVmIGV4dHJhY3Rpb25fc2VydmljZShzZWxmKTpcbiAgICAgICAgXCJcIlwiR2V0IGV4dHJhY3Rpb24gc2VydmljZSwgY3JlYXRpbmcgaXQgb24gZGVtYW5kLlwiXCJcIlxuICAgICAgICBpZiBzZWxmLl9leHRyYWN0aW9uX3NlcnZpY2UgaXMgTm9uZTpcbiAgICAgICAgICAgIGZyb20gY29kZWhlbS5jb3JlLmV4dHJhY3Rpb25fc2VydmljZSBpbXBvcnQgRXh0cmFjdGlvblNlcnZpY2VcbiAgICAgICAgICAgIHRyeTpcbiAgICAgICAgICAgICAgICBzZWxmLl9leHRyYWN0aW9uX3NlcnZpY2UgPSBFeHRyYWN0aW9uU2VydmljZShzZWxmLmxhbmd1YWdlX2NvZGUpXG4gICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvciBhcyBlOlxuICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmJ0ZhaWxlZCB0byBjcmVhdGUgRXh0cmFjdGlvblNlcnZpY2UgZm9yIHtzZWxmLmxhbmd1YWdlX2NvZGV9OiB7ZX0nKVxuICAgICAgICAgICAgICAgIHJhaXNlXG4gICAgICAgIHJldHVybiBzZWxmLl9leHRyYWN0aW9uX3NlcnZpY2VcblxuICAgIEBhYnN0cmFjdG1ldGhvZFxuICAgIGRlZiBhZGRfZWxlbWVudChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIG5ld19lbGVtZW50OiBzdHIsIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IHN0cjpcbiAgICAgICAgXCJcIlwiQWRkIGFuIGVsZW1lbnQgdG8gdGhlIGNvZGUuIE11c3QgYmUgaW1wbGVtZW50ZWQgYnkgc3ViY2xhc3Nlcy5cIlwiXCJcbiAgICAgICAgcmFpc2UgTm90SW1wbGVtZW50ZWRFcnJvcignU3ViY2xhc3NlcyBtdXN0IGltcGxlbWVudCBhZGRfZWxlbWVudCcpXG5cbiAgICBkZWYgZmluZF9lbGVtZW50KHNlbGYsIGNvZGU6IHN0ciwgZWxlbWVudF9uYW1lOiBzdHIsIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IFR1cGxlW2ludCwgaW50XTpcbiAgICAgICAgXCJcIlwiRmluZCBhbiBlbGVtZW50IGluIHRoZSBjb2RlIHVzaW5nIHRoZSBFeHRyYWN0aW9uIFNlcnZpY2UuXCJcIlwiXG4gICAgICAgIGlmIG5vdCBzZWxmLmVsZW1lbnRfdHlwZTpcbiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKCdmaW5kX2VsZW1lbnQgY2FsbGVkIHdpdGhvdXQgRUxFTUVOVF9UWVBFIHNldC4nKVxuICAgICAgICAgICAgcmV0dXJuICgwLCAwKVxuICAgICAgICB0cnk6XG4gICAgICAgICAgICByZXR1cm4gc2VsZi5leHRyYWN0aW9uX3NlcnZpY2UuZmluZF9lbGVtZW50KGNvZGUsIHNlbGYuZWxlbWVudF90eXBlLnZhbHVlLCBlbGVtZW50X25hbWUsIHBhcmVudF9uYW1lKVxuICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBmaW5kaW5nIGVsZW1lbnQgKHtzZWxmLmVsZW1lbnRfdHlwZS52YWx1ZX0sIHtlbGVtZW50X25hbWV9LCB7cGFyZW50X25hbWV9KToge2V9JylcbiAgICAgICAgICAgIHJldHVybiAoMCwgMClcblxuICAgIGRlZiBmb3JtYXRfZWxlbWVudChzZWxmLCBlbGVtZW50X2NvZGU6IHN0ciwgaW5kZW50X2xldmVsOiBpbnQ9MCkgLT4gc3RyOlxuICAgICAgICBcIlwiXCJGb3JtYXQgYSBjb2RlIGVsZW1lbnQgdXNpbmcgdGhlIGxhbmd1YWdlLXNwZWNpZmljIGZvcm1hdHRlci5cIlwiXCJcbiAgICAgICAgaWYgaGFzYXR0cihzZWxmLmZvcm1hdHRlciwgJ2Zvcm1hdF9lbGVtZW50JykgYW5kIHNlbGYuZWxlbWVudF90eXBlOlxuICAgICAgICAgICAgZGVkZW50ZWRfY29kZSA9IHNlbGYuZm9ybWF0dGVyLmRlZGVudChlbGVtZW50X2NvZGUpXG4gICAgICAgICAgICBmb3JtYXR0ZWRfbm9fYmFzZV9pbmRlbnQgPSBzZWxmLmZvcm1hdHRlci5mb3JtYXRfZWxlbWVudChzZWxmLmVsZW1lbnRfdHlwZS52YWx1ZSwgZGVkZW50ZWRfY29kZSlcbiAgICAgICAgICAgIGJhc2VfaW5kZW50ID0gc2VsZi5mb3JtYXR0ZXIuaW5kZW50X3N0cmluZyAqIGluZGVudF9sZXZlbFxuICAgICAgICAgICAgcmV0dXJuIHNlbGYuYXBwbHlfaW5kZW50YXRpb24oZm9ybWF0dGVkX25vX2Jhc2VfaW5kZW50LCBiYXNlX2luZGVudClcbiAgICAgICAgaW5kZW50ID0gJyAnICogKHNlbGYuZm9ybWF0dGVyLmluZGVudF9zaXplIGlmIGhhc2F0dHIoc2VsZi5mb3JtYXR0ZXIsICdpbmRlbnRfc2l6ZScpIGVsc2UgNCkgKiBpbmRlbnRfbGV2ZWxcbiAgICAgICAgcmV0dXJuIHNlbGYuYXBwbHlfaW5kZW50YXRpb24oZWxlbWVudF9jb2RlLnN0cmlwKCksIGluZGVudClcblxuICAgIGRlZiByZXBsYWNlX2VsZW1lbnQoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCBlbGVtZW50X25hbWU6IHN0ciwgbmV3X2VsZW1lbnQ6IHN0ciwgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl09Tm9uZSkgLT4gc3RyOlxuICAgICAgICBcIlwiXCJSZXBsYWNlIGFuIGVsZW1lbnQgaW4gdGhlIGNvZGUsIGhhbmRsaW5nIGRlY29yYXRvcnMvY29tbWVudHMuXCJcIlwiXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJSZXBsYWNpbmcge3NlbGYuZWxlbWVudF90eXBlfSAne2VsZW1lbnRfbmFtZX0nIChwYXJlbnQ6IHtwYXJlbnRfbmFtZX0pXCIpXG4gICAgICAgIHN0YXJ0X2xpbmUsIGVuZF9saW5lID0gc2VsZi5maW5kX2VsZW1lbnQob3JpZ2luYWxfY29kZSwgZWxlbWVudF9uYW1lLCBwYXJlbnRfbmFtZSlcbiAgICAgICAgaWYgc3RhcnRfbGluZSA9PSAwIGFuZCBlbmRfbGluZSA9PSAwOlxuICAgICAgICAgICAgbG9nZ2VyLmluZm8oZlwie3NlbGYuZWxlbWVudF90eXBlfSAne2VsZW1lbnRfbmFtZX0nIG5vdCBmb3VuZC4gQXR0ZW1wdGluZyB0byBhZGQuXCIpXG4gICAgICAgICAgICBjYW5fYWRkID0gcGFyZW50X25hbWUgb3Igc2VsZi5lbGVtZW50X3R5cGUgaW4gW0NvZGVFbGVtZW50VHlwZS5GVU5DVElPTiwgQ29kZUVsZW1lbnRUeXBlLkNMQVNTLCBDb2RlRWxlbWVudFR5cGUuSU1QT1JUXVxuICAgICAgICAgICAgaWYgY2FuX2FkZDpcbiAgICAgICAgICAgICAgICB0cnk6XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLmFkZF9lbGVtZW50KG9yaWdpbmFsX2NvZGUsIG5ld19lbGVtZW50LCBwYXJlbnRfbmFtZSlcbiAgICAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XG4gICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJFcnJvciBhZGRpbmcgbWlzc2luZyBlbGVtZW50ICd7ZWxlbWVudF9uYW1lfSc6IHtlfVwiKVxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgICAgICAgICAgZWxzZTpcbiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmXCJFbGVtZW50ICd7ZWxlbWVudF9uYW1lfScgbm90IGZvdW5kIGFuZCBjYW5ub3QgYmUgYWRkZWQgd2l0aG91dCBwYXJlbnQgY29udGV4dC5cIilcbiAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgICAgICBsaW5lcyA9IG9yaWdpbmFsX2NvZGUuc3BsaXRsaW5lcygpXG4gICAgICAgIGFkanVzdGVkX3N0YXJ0ID0gc2VsZi5fYWRqdXN0X3N0YXJ0X2xpbmUobGluZXMsIHN0YXJ0X2xpbmUpXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0ZvdW5kIGVsZW1lbnQgYXQgbGluZXMge3N0YXJ0X2xpbmV9LXtlbmRfbGluZX0uIEFkanVzdGVkIHN0YXJ0OiB7YWRqdXN0ZWRfc3RhcnR9JylcbiAgICAgICAgaW5kZW50X2xldmVsID0gc2VsZi5nZXRfZWxlbWVudF9pbmRlbnRfbGV2ZWwob3JpZ2luYWxfY29kZSwgYWRqdXN0ZWRfc3RhcnQsIHBhcmVudF9uYW1lKVxuICAgICAgICBmb3JtYXR0ZWRfZWxlbWVudCA9IHNlbGYuZm9ybWF0X2VsZW1lbnQobmV3X2VsZW1lbnQsIGluZGVudF9sZXZlbClcbiAgICAgICAgcmV0dXJuIHNlbGYucmVwbGFjZV9saW5lcyhvcmlnaW5hbF9jb2RlLCBhZGp1c3RlZF9zdGFydCwgZW5kX2xpbmUsIGZvcm1hdHRlZF9lbGVtZW50KVxuXG4gICAgZGVmIHJlbW92ZV9lbGVtZW50KHNlbGYsIG9yaWdpbmFsX2NvZGU6IHN0ciwgZWxlbWVudF9uYW1lOiBzdHIsIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IHN0cjpcbiAgICAgICAgXCJcIlwiUmVtb3ZlIGFuIGVsZW1lbnQgZnJvbSB0aGUgY29kZSwgaGFuZGxpbmcgZGVjb3JhdG9ycy9jb21tZW50cy5cIlwiXCJcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIlJlbW92aW5nIHtzZWxmLmVsZW1lbnRfdHlwZX0gJ3tlbGVtZW50X25hbWV9JyAocGFyZW50OiB7cGFyZW50X25hbWV9KVwiKVxuICAgICAgICBzdGFydF9saW5lLCBlbmRfbGluZSA9IHNlbGYuZmluZF9lbGVtZW50KG9yaWdpbmFsX2NvZGUsIGVsZW1lbnRfbmFtZSwgcGFyZW50X25hbWUpXG4gICAgICAgIGlmIHN0YXJ0X2xpbmUgPT0gMCBhbmQgZW5kX2xpbmUgPT0gMDpcbiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGZcIkVsZW1lbnQgJ3tlbGVtZW50X25hbWV9JyBub3QgZm91bmQuIENhbm5vdCByZW1vdmUuXCIpXG4gICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgICAgICBsaW5lcyA9IG9yaWdpbmFsX2NvZGUuc3BsaXRsaW5lcygpXG4gICAgICAgIGFkanVzdGVkX3N0YXJ0ID0gc2VsZi5fYWRqdXN0X3N0YXJ0X2xpbmUobGluZXMsIHN0YXJ0X2xpbmUpXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0ZvdW5kIGVsZW1lbnQgZm9yIHJlbW92YWwgYXQgbGluZXMge3N0YXJ0X2xpbmV9LXtlbmRfbGluZX0uIEFkanVzdGVkOiB7YWRqdXN0ZWRfc3RhcnR9JylcbiAgICAgICAgcmV0dXJuIHNlbGYucmVwbGFjZV9saW5lcyhvcmlnaW5hbF9jb2RlLCBhZGp1c3RlZF9zdGFydCwgZW5kX2xpbmUsICcnKVxuXG4gICAgZGVmIGdldF9lbGVtZW50X2luZGVudF9sZXZlbChzZWxmLCBjb2RlOiBzdHIsIGVsZW1lbnRfc3RhcnRfbGluZTogaW50LCBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXT1Ob25lKSAtPiBpbnQ6XG4gICAgICAgIFwiXCJcIkNhbGN1bGF0ZSBpbmRlbnRhdGlvbiBsZXZlbCBmb3IgYW4gZWxlbWVudC5cIlwiXCJcbiAgICAgICAgaWYgZWxlbWVudF9zdGFydF9saW5lIDw9IDA6XG4gICAgICAgICAgICByZXR1cm4gMFxuICAgICAgICBsaW5lcyA9IGNvZGUuc3BsaXRsaW5lcygpXG4gICAgICAgIGlmIGVsZW1lbnRfc3RhcnRfbGluZSA+IGxlbihsaW5lcyk6XG4gICAgICAgICAgICByZXR1cm4gMFxuICAgICAgICBsaW5lX2luZGV4ID0gZWxlbWVudF9zdGFydF9saW5lIC0gMVxuICAgICAgICBpbmRlbnRfc3RyID0gc2VsZi5nZXRfaW5kZW50YXRpb24obGluZXNbbGluZV9pbmRleF0pXG4gICAgICAgIGluZGVudF9zaXplID0gc2VsZi5mb3JtYXR0ZXIuaW5kZW50X3NpemUgaWYgaGFzYXR0cihzZWxmLmZvcm1hdHRlciwgJ2luZGVudF9zaXplJykgZWxzZSA0XG4gICAgICAgIHJldHVybiBsZW4oaW5kZW50X3N0cikgLy8gaW5kZW50X3NpemUgaWYgaW5kZW50X3NpemUgPiAwIGVsc2UgMFxuLi4uXG5QYXRoOiBjb2RlaGVtL2xhbmd1YWdlcy9sYW5nX3B5dGhvbi9tYW5pcHVsYXRvci9pbXBvcnRfaGFuZGxlci5weVxuXCJcIlwiXG5QeXRob24gaW1wb3J0IG1hbmlwdWxhdG9yIGltcGxlbWVudGF0aW9uLlxuXCJcIlwiXG5pbXBvcnQgcmVcbmltcG9ydCBsb2dnaW5nXG5mcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWwsIFR1cGxlLCBMaXN0XG5mcm9tIGNvZGVoZW0ubW9kZWxzLmVudW1zIGltcG9ydCBDb2RlRWxlbWVudFR5cGVcbmZyb20gY29kZWhlbS5jb3JlLnJlZ2lzdHJ5IGltcG9ydCBtYW5pcHVsYXRvclxuZnJvbSBjb2RlaGVtLmNvcmUubWFuaXB1bGF0b3JzLnRlbXBsYXRlX2ltcG9ydF9tYW5pcHVsYXRvciBpbXBvcnQgVGVtcGxhdGVJbXBvcnRNYW5pcHVsYXRvclxuXG5sb2dnZXIgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXylcblxuQG1hbmlwdWxhdG9yXG5jbGFzcyBQeXRob25JbXBvcnRNYW5pcHVsYXRvcihUZW1wbGF0ZUltcG9ydE1hbmlwdWxhdG9yKTpcbiAgICBcIlwiXCJNYW5pcHVsYXRvciBmb3IgUHl0aG9uIGltcG9ydHMuXCJcIlwiXG4gICAgTEFOR1VBR0VfQ09ERSA9ICdweXRob24nXG4gICAgRUxFTUVOVF9UWVBFID0gQ29kZUVsZW1lbnRUeXBlLklNUE9SVFxuICAgIENPTU1FTlRfTUFSS0VSUyA9IFsnIyddXG4gICAgXG4gICAgZGVmIF9wZXJmb3JtX2luc2VydGlvbihzZWxmLCBjb2RlOiBzdHIsIGZvcm1hdHRlZF9lbGVtZW50OiBzdHIsIGluc2VydGlvbl9wb2ludDogaW50LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl09Tm9uZSkgLT4gc3RyOlxuICAgICAgICBcIlwiXCJBZGQgYW4gaW1wb3J0IHRvIFB5dGhvbiBjb2RlIHdpdGggcHJvcGVyIHNwYWNpbmcuXCJcIlwiXG4gICAgICAgIGxpbmVzID0gY29kZS5zcGxpdGxpbmVzKCkgaWYgY29kZSBlbHNlIFtdXG4uLi5cblBhdGg6IGNvZGVoZW0vbGFuZ3VhZ2VzL2xhbmdfcHl0aG9uL21hbmlwdWxhdG9yL2NsYXNzX2hhbmRsZXIucHlcbi4uLlxuXG5AbWFuaXB1bGF0b3JcbmNsYXNzIFB5dGhvbkNsYXNzTWFuaXB1bGF0b3IoVGVtcGxhdGVDbGFzc01hbmlwdWxhdG9yKTpcbiAgICBcIlwiXCJNYW5pcHVsYXRvciBmb3IgUHl0aG9uIGNsYXNzZXMuXCJcIlwiXG4gICAgTEFOR1VBR0VfQ09ERSA9ICdweXRob24nXG4gICAgRUxFTUVOVF9UWVBFID0gQ29kZUVsZW1lbnRUeXBlLkNMQVNTXG4gICAgQ09NTUVOVF9NQVJLRVJTID0gWycjJ11cbiAgICBERUNPUkFUT1JfTUFSS0VSUyA9IFsnQCddXG4gICAgXG4gICAgZGVmIF9wZXJmb3JtX2luc2VydGlvbihzZWxmLCBjb2RlOiBzdHIsIGZvcm1hdHRlZF9lbGVtZW50OiBzdHIsIGluc2VydGlvbl9wb2ludDogaW50LCBcbiAgICAgICAgICAgICAgICAgICAgICAgICAgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl09Tm9uZSkgLT4gc3RyOlxuICAgICAgICBcIlwiXCJBZGQgYSBjbGFzcyB0byBQeXRob24gY29kZSB3aXRoIGFwcHJvcHJpYXRlIHNwYWNpbmcuXCJcIlwiXG4gICAgICAgIGlmIG5vdCBjb2RlOlxuICAgICAgICAgICAgcmV0dXJuIGZvcm1hdHRlZF9lbGVtZW50ICsgJ1xcbidcbiAgICAgICAgICAgIFxuICAgICAgICByZXN1bHQgPSBzdXBlcigpLl9wZXJmb3JtX2luc2VydGlvbihjb2RlLCBmb3JtYXR0ZWRfZWxlbWVudCwgaW5zZXJ0aW9uX3BvaW50LCBwYXJlbnRfbmFtZSlcbiAgICAgICAgXG4gICAgICAgICMgRW5zdXJlIHByb3BlciBzcGFjaW5nIGFuZCBuZXdsaW5lIGF0IGVuZFxuICAgICAgICBpZiBub3QgcmVzdWx0LmVuZHN3aXRoKCdcXG4nKTpcbiAgICAgICAgICAgIHJlc3VsdCArPSAnXFxuJ1xuICAgICAgICAgICAgXG4gICAgICAgIHJldHVybiByZXN1bHQuLi5cblBhdGg6IGNvZGVoZW0vbGFuZ3VhZ2VzL2xhbmdfcHl0aG9uL21hbmlwdWxhdG9yL21ldGhvZF9oYW5kbGVyLnB5XG5cIlwiXCJcblB5dGhvbiBtZXRob2QgbWFuaXB1bGF0b3IgaW1wbGVtZW50YXRpb24uXG5cIlwiXCJcbmltcG9ydCBsb2dnaW5nXG5mcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWxcbmZyb20gY29kZWhlbS5tb2RlbHMuZW51bXMgaW1wb3J0IENvZGVFbGVtZW50VHlwZVxuZnJvbSBjb2RlaGVtLmNvcmUucmVnaXN0cnkgaW1wb3J0IG1hbmlwdWxhdG9yXG5mcm9tIGNvZGVoZW0uY29yZS5tYW5pcHVsYXRvcnMudGVtcGxhdGVfbWV0aG9kX21hbmlwdWxhdG9yIGltcG9ydCBUZW1wbGF0ZU1ldGhvZE1hbmlwdWxhdG9yXG5cbmxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKVxuXG4jIEBtYW5pcHVsYXRvciAjIERpc2FibGVkOiBVc2luZyBQeXRob25BU1RNYW5pcHVsYXRvciB2aWEgX19pbml0X18ucHkgcmVnaXN0cmF0aW9uXG5jbGFzcyBQeXRob25NZXRob2RNYW5pcHVsYXRvcihUZW1wbGF0ZU1ldGhvZE1hbmlwdWxhdG9yKTpcbiAgICBcIlwiXCJNYW5pcHVsYXRvciBmb3IgUHl0aG9uIG1ldGhvZHMuXCJcIlwiXG4gICAgTEFOR1VBR0VfQ09ERSA9ICdweXRob24nXG4gICAgRUxFTUVOVF9UWVBFID0gQ29kZUVsZW1lbnRUeXBlLk1FVEhPRFxuICAgIENPTU1FTlRfTUFSS0VSUyA9IFsnIyddXG4gICAgREVDT1JBVE9SX01BUktFUlMgPSBbJ0AnXVxuLi4uXG5QYXRoOiBjb2RlaGVtL2xhbmd1YWdlcy9sYW5nX3B5dGhvbi9tYW5pcHVsYXRvci9iYXNlLnB5XG4uLi5cblxuICAgIGRlZiBfX2luaXRfXyhzZWxmLCBlbGVtZW50X3R5cGU6IENvZGVFbGVtZW50VHlwZSA9IE5vbmUsIGZvcm1hdHRlcjogQmFzZUZvcm1hdHRlciA9IE5vbmUsIFxuICAgICAgICAgICAgICAgICBleHRyYWN0aW9uX3NlcnZpY2UgPSBOb25lKTpcbiAgICAgICAgXCJcIlwiSW5pdGlhbGl6ZSBQeXRob24gbWFuaXB1bGF0b3Igd2l0aCBhcHByb3ByaWF0ZSBmb3JtYXR0ZXIuXCJcIlwiXG4gICAgICAgIGlmIGZvcm1hdHRlciBpcyBOb25lOlxuICAgICAgICAgICAgdHJ5OlxuICAgICAgICAgICAgICAgIGxhbmdfc2VydmljZSA9IHJlZ2lzdHJ5LmdldF9sYW5ndWFnZV9zZXJ2aWNlKCdweXRob24nKVxuICAgICAgICAgICAgICAgIGlmIGxhbmdfc2VydmljZSBhbmQgaGFzYXR0cihsYW5nX3NlcnZpY2UsICdmb3JtYXR0ZXInKTpcbiAgICAgICAgICAgICAgICAgICAgIGZvcm1hdHRlciA9IGxhbmdfc2VydmljZS5mb3JtYXR0ZXJcbiAgICAgICAgICAgICAgICBlbHNlOlxuXG4gICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZXIgPSBQeXRob25Gb3JtYXR0ZXIoKVxuICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxuICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGZcIkNvdWxkIG5vdCBnZXQgUHl0aG9uRm9ybWF0dGVyOiB7ZX1cIilcblxuICAgICAgICBzdXBlcigpLl9faW5pdF9fKFxuICAgICAgICAgICAgbGFuZ3VhZ2VfY29kZT1cInB5dGhvblwiLFxuICAgICAgICAgICAgZWxlbWVudF90eXBlPWVsZW1lbnRfdHlwZSxcbiAgICAgICAgICAgIGZvcm1hdHRlcj1mb3JtYXR0ZXIsXG4gICAgICAgICAgICBleHRyYWN0aW9uX3NlcnZpY2U9ZXh0cmFjdGlvbl9zZXJ2aWNlLFxuICAgICAgICApXG4uLi5cblBhdGg6IGNvZGVoZW0vY29yZS9tYW5pcHVsYXRvcnMvdGVtcGxhdGVfbWFuaXB1bGF0b3IucHlcblwiXCJcIlxuVGVtcGxhdGUgcGF0dGVybiBmb3IgbWFuaXB1bGF0b3JzIHRvIHN0YW5kYXJkaXplIGxhbmd1YWdlLXNwZWNpZmljIGltcGxlbWVudGF0aW9ucy5cblwiXCJcIlxuaW1wb3J0IGxvZ2dpbmdcbmZyb20gdHlwaW5nIGltcG9ydCBPcHRpb25hbFxuZnJvbSBjb2RlaGVtLmNvcmUubWFuaXB1bGF0b3JzLm1hbmlwdWxhdG9yX2Jhc2UgaW1wb3J0IE1hbmlwdWxhdG9yQmFzZVxuXG5sb2dnZXIgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXylcblxuY2xhc3MgVGVtcGxhdGVNYW5pcHVsYXRvcihNYW5pcHVsYXRvckJhc2UpOlxuICAgIFwiXCJcIlxuICAgIFRlbXBsYXRlIG1ldGhvZCBwYXR0ZXJuIGZvciBtYW5pcHVsYXRvcnMuXG4gICAgUHJvdmlkZXMgc3RhbmRhcmRpemVkIGltcGxlbWVudGF0aW9ucyB3aXRoIGhvb2tzIGZvciBsYW5ndWFnZS1zcGVjaWZpYyBjdXN0b21pemF0aW9uLlxuICAgIFwiXCJcIlxuXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsICphcmdzLCAqKmt3YXJncyk6XG4gICAgICAgIHN1cGVyKCkuX19pbml0X18oKmFyZ3MsICoqa3dhcmdzKVxuXG4gICAgZGVmIHJlcGxhY2VfZWxlbWVudChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIG5hbWU6IHN0ciwgbmV3X2NvZGU6IHN0ciwgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl0gPSBOb25lKSAtPiBzdHI6XG4gICAgICAgIFwiXCJcIlxuICAgICAgICBSZXBsYWNlIGFuIGV4aXN0aW5nIGVsZW1lbnQgKGZ1bmN0aW9uLCBtZXRob2QsIGNsYXNzLCBpbXBvcnQpIGJ5IG5hbWUuXG4gICAgICAgIElmIG5vdCBmb3VuZCwgaW5zZXJ0IHRoZSBuZXcgZWxlbWVudC5cblxuICAgICAgICBBcmdzOlxuICAgICAgICAgICAgb3JpZ2luYWxfY29kZTogT3JpZ2luYWwgc291cmNlIGNvZGVcbiAgICAgICAgICAgIG5hbWU6IE5hbWUgb2YgdGhlIGVsZW1lbnQgdG8gcmVwbGFjZVxuICAgICAgICAgICAgbmV3X2NvZGU6IE5ldyBjb250ZW50IGZvciB0aGUgZWxlbWVudFxuICAgICAgICAgICAgcGFyZW50X25hbWU6IE9wdGlvbmFsIHBhcmVudCBlbGVtZW50IG5hbWUgKGUuZy4sIGNsYXNzIG5hbWUgZm9yIG1ldGhvZHMpXG4uLi5cbiAgICAgICAgICAgICAgICAgICAgICAgIGVuZF9pZHggPSBsZW4oY29kZV9saW5lcylcblxuICAgICAgICBpZiBzdGFydF9pZHggaXMgbm90IE5vbmUgYW5kIGVuZF9pZHggaXMgbm90IE5vbmU6XG4gICAgICAgICAgICBiZWZvcmUgPSBjb2RlX2xpbmVzWzpzdGFydF9pZHhdXG4gICAgICAgICAgICBhZnRlciA9IGNvZGVfbGluZXNbZW5kX2lkeDpdXG4gICAgICAgICAgICBuZXdfY29kZV9saW5lcyA9IG5ld19jb2RlLnN0cmlwKCdcXG4nKS5zcGxpdGxpbmVzKClcbiAgICAgICAgICAgICMgQWRqdXN0IGluZGVudGF0aW9uIHRvIG1hdGNoIGV4aXN0aW5nIGVsZW1lbnRcbiAgICAgICAgICAgIGluZGVudCA9ICcnXG4gICAgICAgICAgICBpZiBiZWZvcmUgYW5kIGJlZm9yZVstMV0uc3RhcnRzd2l0aCgnICcpOlxuICAgICAgICAgICAgICAgIGluZGVudCA9IHJlLm1hdGNoKHInXihcXHMqKScsIGJlZm9yZVstMV0pLmdyb3VwKDEpXG4gICAgICAgICAgICBlbGlmIHN0YXJ0X2lkeCA8IGxlbihjb2RlX2xpbmVzKTpcbiAgICAgICAgICAgICAgICBpbmRlbnQgPSByZS5tYXRjaChyJ14oXFxzKiknLCBjb2RlX2xpbmVzW3N0YXJ0X2lkeF0pLmdyb3VwKDEpXG4gICAgICAgICAgICBuZXdfY29kZV9saW5lcyA9IFtpbmRlbnQgKyBsaW5lIGlmIGxpbmUuc3RyaXAoKSBlbHNlIGxpbmUgZm9yIGxpbmUgaW4gbmV3X2NvZGVfbGluZXNdXG4gICAgICAgICAgICByZXN1bHRfbGluZXMgPSBiZWZvcmUgKyBuZXdfY29kZV9saW5lcyArIGFmdGVyXG4gICAgICAgICAgICByZXR1cm4gJ1xcbicuam9pbihyZXN1bHRfbGluZXMpXG4gICAgICAgIGVsc2U6XG4gICAgICAgICAgICAjIEVsZW1lbnQgbm90IGZvdW5kLCBmYWxsYmFjayB0byBhZGRcbiAgICAgICAgICAgIHJldHVybiBzZWxmLmFkZF9lbGVtZW50KG9yaWdpbmFsX2NvZGUsIG5ld19jb2RlLCBwYXJlbnRfbmFtZSlcblxuICAgIGRlZiBfX2luaXRfXyhzZWxmLCBpbnNlcnRfYmxhbmtfbGluZV9iZWZvcmVfZWxlbWVudDogYm9vbCA9IFRydWUsIGluc2VydF9ibGFua19saW5lX2FmdGVyX2VsZW1lbnQ6IGJvb2wgPSBGYWxzZSwgaGFuZGxlX2RvY3N0cmluZ3Nfc3BlY2lhbDogYm9vbCA9IEZhbHNlKTpcbiAgICAgICAgc2VsZi5pbnNlcnRfYmxhbmtfbGluZV9iZWZvcmVfZWxlbWVudCA9IGluc2VydF9ibGFua19saW5lX2JlZm9yZV9lbGVtZW50XG4gICAgICAgIHNlbGYuaW5zZXJ0X2JsYW5rX2xpbmVfYWZ0ZXJfZWxlbWVudCA9IGluc2VydF9ibGFua19saW5lX2FmdGVyX2VsZW1lbnRcbiAgICAgICAgc2VsZi5oYW5kbGVfZG9jc3RyaW5nc19zcGVjaWFsID0gaGFuZGxlX2RvY3N0cmluZ3Nfc3BlY2lhbFxuXG4gICAgZGVmIGFkZF9lbGVtZW50KHNlbGYsIG9yaWdpbmFsX2NvZGU6IHN0ciwgbmV3X2VsZW1lbnQ6IHN0ciwgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl09Tm9uZSkgLT4gc3RyOlxuICAgICAgICBpbXBvcnQgcmVcblxuICAgICAgICBsaW5lcyA9IG9yaWdpbmFsX2NvZGUuc3BsaXRsaW5lcygpXG4gICAgICAgIGluZGVudF9sZXZlbCA9IDBcbiAgICAgICAgaW5zZXJ0aW9uX2lkeCA9IGxlbihsaW5lcylcbi4uLlxuUGF0aDogY29kZWhlbS9jb3JlL21hbmlwdWxhdGlvbl9zZXJ2aWNlLnB5XG4uLi5cblxuICAgIGRlZiB1cHNlcnRfZWxlbWVudChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIGVsZW1lbnRfdHlwZTogc3RyLCBuYW1lOiBzdHIsIG5ld19jb2RlOiBzdHIsIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IHN0cjpcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIEFkZCBvciByZXBsYWNlIGEgY29kZSBlbGVtZW50LlxuXG4gICAgICAgIEFyZ3M6XG4gICAgICAgIG9yaWdpbmFsX2NvZGU6IE9yaWdpbmFsIHNvdXJjZSBjb2RlXG4gICAgICAgIGVsZW1lbnRfdHlwZTogVHlwZSBvZiBlbGVtZW50IHRvIGFkZC9yZXBsYWNlIChmcm9tIENvZGVFbGVtZW50VHlwZSlcbiAgICAgICAgbmFtZTogTmFtZSBvZiB0aGUgZWxlbWVudFxuICAgICAgICBuZXdfY29kZTogTmV3IGNvbnRlbnQgZm9yIHRoZSBlbGVtZW50XG4gICAgICAgIHBhcmVudF9uYW1lOiBOYW1lIG9mIHBhcmVudCBlbGVtZW50IChlLmcuLCBjbGFzcyBuYW1lIGZvciBtZXRob2RzKVxuXG4gICAgICAgIFJldHVybnM6XG4gICAgICAgIE1vZGlmaWVkIGNvZGVcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJVcHNlcnRpbmcgZWxlbWVudCBvZiB0eXBlICd7ZWxlbWVudF90eXBlfScsIG5hbWUgJ3tuYW1lfScsIHBhcmVudCAne3BhcmVudF9uYW1lfSdcIilcbiAgICAgICAgbWFuaXB1bGF0b3IgPSBzZWxmLmxhbmd1YWdlX3NlcnZpY2UuZ2V0X21hbmlwdWxhdG9yKGVsZW1lbnRfdHlwZSlcbi4uLlxuXG4gICAgZGVmIHVwc2VydF9lbGVtZW50X2J5X3hwYXRoKHNlbGYsIG9yaWdpbmFsX2NvZGU6IHN0ciwgeHBhdGg6IHN0ciwgbmV3X2NvZGU6IHN0cikgLT4gc3RyOlxuICAgICAgICBcIlwiXCJcbiAgICAgICAgQWRkIG9yIHJlcGxhY2UgYW4gZWxlbWVudCBpbiB0aGUgY29kZSB1c2luZyBYUGF0aCBleHByZXNzaW9uLlxuICAgICAgICBcbiAgICAgICAgQXJnczpcbiAgICAgICAgICAgIG9yaWdpbmFsX2NvZGU6IE9yaWdpbmFsIHNvdXJjZSBjb2RlXG4gICAgICAgICAgICB4cGF0aDogWFBhdGggZXhwcmVzc2lvbiAoZS5nLiwgJ0NsYXNzTmFtZS5tZXRob2RfbmFtZScsICdDbGFzc05hbWVbaW50ZXJmYWNlXS5tZXRob2RfbmFtZVtwcm9wZXJ0eV9nZXR0ZXJdJylcbiAgICAgICAgICAgIG5ld19jb2RlOiBOZXcgY29udGVudCBmb3IgdGhlIGVsZW1lbnRcbiAgICAgICAgICAgIFxuICAgICAgICBSZXR1cm5zOlxuICAgICAgICAgICAgTW9kaWZpZWQgY29kZVxuICAgICAgICBcIlwiXCJcbiAgICAgICAgKGVsZW1lbnRfbmFtZSwgcGFyZW50X25hbWUsIGVsZW1lbnRfdHlwZSkgPSBYUGF0aFBhcnNlci5nZXRfZWxlbWVudF9pbmZvKHhwYXRoKVxuICAgICAgICBpZiBub3QgZWxlbWVudF90eXBlOlxuICAgICAgICAgICAgZWxlbWVudF90eXBlID0gc2VsZi5sYW5ndWFnZV9zZXJ2aWNlLmRldGVjdF9lbGVtZW50X3R5cGUobmV3X2NvZGUpXG4gICAgICAgIHJldHVybiBzZWxmLnVwc2VydF9lbGVtZW50KG9yaWdpbmFsX2NvZGUsIGVsZW1lbnRfdHlwZSwgZWxlbWVudF9uYW1lLCBuZXdfY29kZSwgcGFyZW50X25hbWUpXG4uLi5cbiAgICAgICAgICAgIFxuICAgICAgICBSZXR1cm5zOlxuICAgICAgICAgICAgTW9kaWZpZWQgY29kZVxuICAgICAgICBcIlwiXCJcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIkFkZGluZyBlbGVtZW50IG9mIHR5cGUgJ3tlbGVtZW50X3R5cGV9JywgcGFyZW50ICd7cGFyZW50X25hbWV9J1wiKVxuICAgICAgICBtYW5pcHVsYXRvciA9IHNlbGYubGFuZ3VhZ2Vfc2VydmljZS5nZXRfbWFuaXB1bGF0b3IoZWxlbWVudF90eXBlKVxuICAgICAgICBpZiBtYW5pcHVsYXRvcjpcbiAgICAgICAgICAgIGlmIGhhc2F0dHIobWFuaXB1bGF0b3IsICdhZGRfZWxlbWVudCcpOlxuICAgICAgICAgICAgICAgIHJldHVybiBtYW5pcHVsYXRvci5hZGRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBuZXdfY29kZSwgcGFyZW50X25hbWUpXG4gICAgICAgICAgICBsb2dnZXIud2FybmluZyhmXCJNYW5pcHVsYXRvciBmb3Ige2VsZW1lbnRfdHlwZX0gZG9lcyBub3QgaW1wbGVtZW50IGFkZF9lbGVtZW50IG1ldGhvZFwiKVxuICAgICAgICBlbHNlOlxuICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZlwiTm8gbWFuaXB1bGF0b3IgZm91bmQgZm9yIGVsZW1lbnQgdHlwZToge2VsZW1lbnRfdHlwZX1cIilcbiAgICAgICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbi4uLlxuICAgICAgICAgICAgXG4gICAgICAgIFJldHVybnM6XG4gICAgICAgICAgICBNb2RpZmllZCBjb2RlXG4gICAgICAgIFwiXCJcIlxuICAgICAgICBsb2dnZXIuZGVidWcoZlwiUmVtb3ZpbmcgZWxlbWVudCBvZiB0eXBlICd7ZWxlbWVudF90eXBlfScsIG5hbWUgJ3tlbGVtZW50X25hbWV9JywgcGFyZW50ICd7cGFyZW50X25hbWV9J1wiKVxuICAgICAgICBtYW5pcHVsYXRvciA9IHNlbGYubGFuZ3VhZ2Vfc2VydmljZS5nZXRfbWFuaXB1bGF0b3IoZWxlbWVudF90eXBlKVxuICAgICAgICBpZiBtYW5pcHVsYXRvcjpcbiAgICAgICAgICAgIGlmIGhhc2F0dHIobWFuaXB1bGF0b3IsICdyZW1vdmVfZWxlbWVudCcpOlxuICAgICAgICAgICAgICAgIHJldHVybiBtYW5pcHVsYXRvci5yZW1vdmVfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBlbGVtZW50X25hbWUsIHBhcmVudF9uYW1lKVxuICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZlwiTWFuaXB1bGF0b3IgZm9yIHtlbGVtZW50X3R5cGV9IGRvZXMgbm90IGltcGxlbWVudCByZW1vdmVfZWxlbWVudCBtZXRob2RcIilcbiAgICAgICAgZWxzZTpcbiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGZcIk5vIG1hbmlwdWxhdG9yIGZvdW5kIGZvciBlbGVtZW50IHR5cGU6IHtlbGVtZW50X3R5cGV9XCIpXG4gICAgICAgIHJldHVybiBvcmlnaW5hbF9jb2RlXG4uLi5cblBhdGg6IGNvZGVoZW0vY29yZS9yZWdpc3RyeS5weVxuLi4uXG5cbmNsYXNzIFJlZ2lzdHJ5OlxuICAgIFwiXCJcIkNlbnRyYWwgcmVnaXN0cnkgZm9yIENvZGVIZW0gY29tcG9uZW50cy5cIlwiXCJcbiAgICBfaW5zdGFuY2UgPSBOb25lXG5cbiAgICBkZWYgX19pbml0X18oc2VsZik6XG4gICAgICAgIHNlbGYuX2luaXRpYWxpemVkID0gRmFsc2VcbiAgICAgICAgc2VsZi5faW5pdGlhbGl6ZSgpXG5cbiAgICBkZWYgX19uZXdfXyhjbHMpOlxuICAgICAgICBpZiBjbHMuX2luc3RhbmNlIGlzIE5vbmU6XG4gICAgICAgICAgICBjbHMuX2luc3RhbmNlID0gc3VwZXIoUmVnaXN0cnksIGNscykuX19uZXdfXyhjbHMpXG4gICAgICAgIHJldHVybiBjbHMuX2luc3RhbmNlXG5cbiAgICBkZWYgX2luaXRpYWxpemUoc2VsZik6XG4gICAgICAgIFwiXCJcIkluaXRpYWxpemVzIGVtcHR5IHJlZ2lzdHJpZXMuXCJcIlwiXG4gICAgICAgIGlmIGhhc2F0dHIoc2VsZiwgJ19pbml0aWFsaXplZCcpIGFuZCBzZWxmLl9pbml0aWFsaXplZDpcbiAgICAgICAgICAgIHJldHVyblxuICAgICAgICBzZWxmLmxhbmd1YWdlX2RldGVjdG9ycyA9IHt9XG4gICAgICAgIHNlbGYubGFuZ3VhZ2Vfc2VydmljZXMgPSB7fVxuICAgICAgICBzZWxmLmFsbF9kZXNjcmlwdG9ycyA9IHt9XG4gICAgICAgIHNlbGYuYWxsX2V4dHJhY3RvcnMgPSB7fVxuICAgICAgICBzZWxmLmFsbF9tYW5pcHVsYXRvcnMgPSB7fVxuICAgICAgICBzZWxmLmRpc2NvdmVyZWRfbW9kdWxlcyA9IHNldCgpXG4gICAgICAgIHNlbGYubGFuZ3VhZ2Vfc2VydmljZV9pbnN0YW5jZXMgPSB7fVxuICAgICAgICBzZWxmLl9pbml0aWFsaXplZCA9IEZhbHNlXG4gICAgICAgIGxvZ2dlci5kZWJ1ZygnUmVnaXN0cnkgX2luaXRpYWxpemUgY29tcGxldGVkLicpXG4uLi5cblxuICAgIGRlZiByZWdpc3Rlcl9leHRyYWN0b3Ioc2VsZiwgY2xzOiBUeXBlW0Jhc2VFeHRyYWN0b3JdKTpcbiAgICAgICAgXCJcIlwiUmVnaXN0ZXJzIGFuIGV4dHJhY3RvciBjbGFzcy5cIlwiXCJcbiAgICAgICAgdHJ5OlxuICAgICAgICAgICAgbGFuZ3VhZ2VfY29kZSA9IGNscy5MQU5HVUFHRV9DT0RFLmxvd2VyKClcbiAgICAgICAgICAgIGVsZW1lbnRfdHlwZSA9IGNscy5FTEVNRU5UX1RZUEUudmFsdWUubG93ZXIoKVxuICAgICAgICAgICAgZXh0cmFjdG9yX2tleSA9IGYne2xhbmd1YWdlX2NvZGV9L3tlbGVtZW50X3R5cGV9J1xuICAgICAgICAgICAgaWYgZXh0cmFjdG9yX2tleSBpbiBzZWxmLmFsbF9leHRyYWN0b3JzOlxuICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGZcIkV4dHJhY3RvciBmb3IgJ3tleHRyYWN0b3Jfa2V5fScgaXMgYWxyZWFkeSByZWdpc3RlcmVkICh7c2VsZi5hbGxfZXh0cmFjdG9yc1tleHRyYWN0b3Jfa2V5XS5fX25hbWVfX30pLiBPdmVyd3JpdGluZyB3aXRoIHtjbHMuX19uYW1lX199LlwiKVxuICAgICAgICAgICAgc2VsZi5hbGxfZXh0cmFjdG9yc1tleHRyYWN0b3Jfa2V5XSA9IGNsc1xuICAgICAgICAgICAgcmljaC5wcmludChmJ1JlZ2lzdGVyZWQgZXh0cmFjdG9yOiB7Y2xzLl9fbmFtZV9ffSBmb3Ige2V4dHJhY3Rvcl9rZXl9JylcbiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZHVyaW5nIHJlZ2lzdHJhdGlvbiBvZiBleHRyYWN0b3Ige2Nscy5fX25hbWVfX306IHtlfScsIGV4Y19pbmZvPVRydWUpXG4gICAgICAgIHJldHVybiBjbHNcblxuICAgIGRlZiByZWdpc3Rlcl9tYW5pcHVsYXRvcihzZWxmLCBjbHMpOlxuICAgICAgICBcIlwiXCJSZWdpc3RlcnMgYSBtYW5pcHVsYXRvciBjbGFzcy5cIlwiXCJcbiAgICAgICAgdHJ5OlxuICAgICAgICAgICAgbGFuZ3VhZ2VfY29kZSA9IGNscy5MQU5HVUFHRV9DT0RFLmxvd2VyKClcbiAgICAgICAgICAgIGVsZW1lbnRfdHlwZSA9IGNscy5FTEVNRU5UX1RZUEUudmFsdWUubG93ZXIoKVxuICAgICAgICAgICAga2V5ID0gZid7bGFuZ3VhZ2VfY29kZX1fe2VsZW1lbnRfdHlwZX0nXG4gICAgICAgICAgICBpZiBrZXkgaW4gc2VsZi5hbGxfbWFuaXB1bGF0b3JzOlxuICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGZcIk1hbmlwdWxhdG9yIGZvciAne2tleX0nIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCAoe3NlbGYuYWxsX21hbmlwdWxhdG9yc1trZXldLl9fbmFtZV9ffSkuIE92ZXJ3cml0aW5nIHdpdGgge2Nscy5fX25hbWVfX30uXCIpXG4gICAgICAgICAgICBzZWxmLmFsbF9tYW5pcHVsYXRvcnNba2V5XSA9IGNsc1xuICAgICAgICAgICAgcmljaC5wcmludChmJ1JlZ2lzdGVyZWQgbWFuaXB1bGF0b3I6IHtjbHMuX19uYW1lX199IGZvciB7bGFuZ3VhZ2VfY29kZX0ve2VsZW1lbnRfdHlwZX0nKVxuICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBkdXJpbmcgcmVnaXN0cmF0aW9uIG9mIG1hbmlwdWxhdG9yIHtjbHMuX19uYW1lX199OiB7ZX0nLCBleGNfaW5mbz1UcnVlKVxuICAgICAgICByZXR1cm4gY2xzXG4uLi5cblxuIyBHbG9iYWwgcmVnaXN0cnkgaW5zdGFuY2VcbnJlZ2lzdHJ5ID0gUmVnaXN0cnkoKVxuXG4jIERlY29yYXRvcnMgZm9yIHJlZ2lzdHJhdGlvblxuZGVmIGxhbmd1YWdlX2RldGVjdG9yKGNscyk6XG4gICAgXCJcIlwiRGVjb3JhdG9yIGZvciByZWdpc3RlcmluZyBhIGxhbmd1YWdlIGRldGVjdG9yLlwiXCJcIlxuICAgIHJldHVybiByZWdpc3RyeS5yZWdpc3Rlcl9sYW5ndWFnZV9kZXRlY3RvcihjbHMpXG5cbmRlZiBsYW5ndWFnZV9zZXJ2aWNlKGNscyk6XG4gICAgXCJcIlwiRGVjb3JhdG9yIGZvciByZWdpc3RlcmluZyBhIGxhbmd1YWdlIHNlcnZpY2UuXCJcIlwiXG4gICAgcmV0dXJuIHJlZ2lzdHJ5LnJlZ2lzdGVyX2xhbmd1YWdlX3NlcnZpY2UoY2xzKVxuXG5kZWYgZXh0cmFjdG9yKGNscyk6XG4gICAgXCJcIlwiRGVjb3JhdG9yIGZvciByZWdpc3RlcmluZyBhbiBleHRyYWN0b3IuXCJcIlwiXG4gICAgcmV0dXJuIHJlZ2lzdHJ5LnJlZ2lzdGVyX2V4dHJhY3RvcihjbHMpXG5cbmRlZiBtYW5pcHVsYXRvcihjbHMpOlxuICAgIFwiXCJcIkRlY29yYXRvciBmb3IgcmVnaXN0ZXJpbmcgYSBtYW5pcHVsYXRvci5cIlwiXCJcbiAgICByZXR1cm4gcmVnaXN0cnkucmVnaXN0ZXJfbWFuaXB1bGF0b3IoY2xzKVxuXG5kZWYgZWxlbWVudF90eXBlX2Rlc2NyaXB0b3IoY2xzKTpcbiAgICBcIlwiXCJEZWNvcmF0b3IgZm9yIHJlZ2lzdGVyaW5nIGFuIGVsZW1lbnQgdHlwZSBkZXNjcmlwdG9yLlwiXCJcIlxuICAgIHJldHVybiByZWdpc3RyeS5yZWdpc3Rlcl9lbGVtZW50X3R5cGVfZGVzY3JpcHRvcihjbHMpLi4uXG4iLCJpc19lcnJvciI6ZmFsc2UsInJlcXVlc3RfaWQiOiIiLCJ0b29sX3VzZV9pZCI6InRvb2x1X3ZydHhfMDE2RE5IN0hjQ3FkYXhDSEdlZHN5UkZaIn19LHsiaWQiOjIsInR5cGUiOjQsImlkZV9zdGF0ZV9ub2RlIjp7IndvcmtzcGFjZUZvbGRlcnMiOlt7InJlcG9zaXRvcnlSb290IjoiRDovY29kZS9Db2RlSGVtIiwiZm9sZGVyUm9vdCI6IkQ6L2NvZGUvQ29kZUhlbSJ9XSwid29ya3NwYWNlRm9sZGVyc1VuY2hhbmdlZCI6ZmFsc2V9fV0sInJlc3BvbnNlX3RleHQiOiIjIyBNYW5pcHVsYXRvcnkgdyBDb2RlSGVtXG5cbk1hbmlwdWxhdG9yeSAobWFuaXB1bGF0b3JzKSB3IENvZGVIZW0gdG8ga2x1Y3pvd2Uga29tcG9uZW50eSBvZHBvd2llZHppYWxuZSB6YSBtb2R5ZmlrYWNqxJkga29kdSDFunLDs2TFgm93ZWdvLiBPdG8gc3pjemVnw7PFgm93ZSB3eWphxZtuaWVuaWU6XG5cbiMjIyBDenltIHPEhSBtYW5pcHVsYXRvcnlcblxuTWFuaXB1bGF0b3J5IHRvIGtsYXN5LCBrdMOzcmUgaW1wbGVtZW50dWrEhSBsb2dpa8SZIGRvIG1vZHlmaWtvd2FuaWEga29kdSDFunLDs2TFgm93ZWdvIHcgc3Bvc8OzYiDFm3dpYWRvbXkgc2vFgmFkbmkgZGFuZWdvIGrEmXp5a2EgcHJvZ3JhbW93YW5pYS4gU8SFIG9uZSBvZHBvd2llZHppYWxuZSB6YTpcblxuMS4gKipEb2Rhd2FuaWUgZWxlbWVudMOzdyBrb2R1KiogKGFkZF9lbGVtZW50KSAtIGRvZGF3YW5pZSBub3d5Y2ggZnVua2NqaSwga2xhcywgbWV0b2QsIGltcG9ydMOzdyBpdHAuXG4yLiAqKlphc3TEmXBvd2FuaWUgZWxlbWVudMOzdyBrb2R1KiogKHJlcGxhY2VfZWxlbWVudCkgLSBwb2RtaWFuYSBpc3RuaWVqxIVjeWNoIGVsZW1lbnTDs3cgbmEgbm93ZVxuMy4gKipVc3V3YW5pZSBlbGVtZW50w7N3IGtvZHUqKiAocmVtb3ZlX2VsZW1lbnQpIC0gdXN1d2FuaWUgb2tyZcWbbG9ueWNoIGVsZW1lbnTDs3dcbjQuICoqRm9ybWF0b3dhbmllIGtvZHUqKiAtIHphcGV3bmllbmllLCDFvGUgem1vZHlmaWtvd2FueSBrb2QgemFjaG93dWplIG9kcG93aWVkbmllIHdjacSZY2lhIGkgc3R5bFxuXG4jIyMgU3RydWt0dXJhIG1hbmlwdWxhdG9yw7N3XG5cbk1hbmlwdWxhdG9yeSB3IENvZGVIZW0gc8SFIHpvcmdhbml6b3dhbmUgaGllcmFyY2hpY3puaWU6XG5cbjEuICoqTWFuaXB1bGF0b3JCYXNlKiogLSBhYnN0cmFrY3lqbmEga2xhc2EgYmF6b3dhIGRlZmluaXVqxIVjYSBwb2RzdGF3b3d5IGludGVyZmVqc1xuMi4gKipUZW1wbGF0ZU1hbmlwdWxhdG9yKiogLSBpbXBsZW1lbnR1amUgd3pvcnplYyBwcm9qZWt0b3d5IFRlbXBsYXRlIE1ldGhvZCwgemFwZXduaWFqxIVjIHN0YW5kYXJkb3dlIGltcGxlbWVudGFjamUgeiBtb8W8bGl3b8WbY2nEhSBkb3N0b3Nvd2FuaWEgcHJ6ZXoga2xhc3kgcG9jaG9kbmVcbjMuICoqU3BlY2phbGl6b3dhbmUgbWFuaXB1bGF0b3J5KiogLSBrb25rcmV0bmUgaW1wbGVtZW50YWNqZSBkbGEgcsOzxbxueWNoIHR5cMOzdyBlbGVtZW50w7N3IGtvZHUgaSBqxJl6eWvDs3cgcHJvZ3JhbW93YW5pYTpcbiAgIC0gUHl0aG9uQ2xhc3NNYW5pcHVsYXRvciAtIGRvIG1hbmlwdWxhY2ppIGtsYXNhbWkgdyBQeXRob25pZVxuICAgLSBQeXRob25JbXBvcnRNYW5pcHVsYXRvciAtIGRvIG1hbmlwdWxhY2ppIGltcG9ydGFtaSB3IFB5dGhvbmllXG4gICAtIFB5dGhvbk1ldGhvZE1hbmlwdWxhdG9yIC0gZG8gbWFuaXB1bGFjamkgbWV0b2RhbWkgdyBQeXRob25pZVxuICAgLSBpIGlubmVcblxuIyMjIFJlamVzdHJhY2phIG1hbmlwdWxhdG9yw7N3XG5cbk1hbmlwdWxhdG9yeSBzxIUgcmVqZXN0cm93YW5lIHcgY2VudHJhbG55bSByZWplc3RyemUgKFJlZ2lzdHJ5KSB6YSBwb21vY8SFIGRla29yYXRvcmEgYEBtYW5pcHVsYXRvcmAuIEthxbxkeSBtYW5pcHVsYXRvciBqZXN0IGlkZW50eWZpa293YW55IHByemV6IGtvbWJpbmFjasSZOlxuLSBrb2R1IGrEmXp5a2EgKG5wLiAncHl0aG9uJylcbi0gdHlwdSBlbGVtZW50dSBrb2R1IChucC4gQ0xBU1MsIE1FVEhPRCwgSU1QT1JUKVxuXG5gYGBweXRob25cbkBtYW5pcHVsYXRvclxuY2xhc3MgUHl0aG9uQ2xhc3NNYW5pcHVsYXRvcihUZW1wbGF0ZUNsYXNzTWFuaXB1bGF0b3IpOlxuICAgIFwiXCJcIk1hbmlwdWxhdG9yIGZvciBQeXRob24gY2xhc3Nlcy5cIlwiXCJcbiAgICBMQU5HVUFHRV9DT0RFID0gJ3B5dGhvbidcbiAgICBFTEVNRU5UX1RZUEUgPSBDb2RlRWxlbWVudFR5cGUuQ0xBU1NcbiAgICBDT01NRU5UX01BUktFUlMgPSBbJyMnXVxuICAgIERFQ09SQVRPUl9NQVJLRVJTID0gWydAJ11cbmBgYFxuXG4jIyMgSmFrIGR6aWHFgmFqxIUgbWFuaXB1bGF0b3J5XG5cbjEuICoqTG9rYWxpemFjamEgZWxlbWVudHUqKiAtIG1hbmlwdWxhdG9yIHXFvHl3YSB1c8WCdWdpIGVrc3RyYWtjamkgKGV4dHJhY3Rpb25fc2VydmljZSkgZG8gem5hbGV6aWVuaWEgZWxlbWVudHUgdyBrb2R6aWVcbjIuICoqRG9zdG9zb3dhbmllIHdjacSZxIcqKiAtIG9ibGljemVuaWUgb2Rwb3dpZWRuaWVnbyBwb3ppb211IHdjacSZY2lhIGRsYSBub3dlZ28ga29kdVxuMy4gKipGb3JtYXRvd2FuaWUqKiAtIGZvcm1hdG93YW5pZSBub3dlZ28ga29kdSB6Z29kbmllIHoga29ud2VuY2phbWkgasSZenlrYVxuNC4gKipNb2R5ZmlrYWNqYSoqIC0gd3lrb25hbmllIHfFgmHFm2Npd2VqIG9wZXJhY2ppIChkb2RhbmllLCB6YXN0xIVwaWVuaWUsIHVzdW5pxJljaWUpXG41LiAqKk9ic8WCdWdhIHNwZWNqYWxueWNoIHByenlwYWRrw7N3KiogLSB6YWNob3dhbmllIGtvbWVudGFyenksIGRla29yYXRvcsOzdywgZG9jc3RyaW5nw7N3IGl0cC5cblxuIyMjIFByenlrxYJhZCB1xbx5Y2lhIG1hbmlwdWxhdG9yYVxuXG5NYW5pcHVsYXRvcnkgc8SFIHXFvHl3YW5lIHByemV6IGBNYW5pcHVsYXRpb25TZXJ2aWNlYCwga3TDs3J5IHN0YW5vd2kgd3lzb2tvcG96aW9tb3d5IGludGVyZmVqcyBkbyBtb2R5ZmlrYWNqaSBrb2R1OlxuXG5gYGBweXRob25cbmRlZiB1cHNlcnRfZWxlbWVudChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIGVsZW1lbnRfdHlwZTogc3RyLCBuYW1lOiBzdHIsIG5ld19jb2RlOiBzdHIsIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IHN0cjpcbiAgICBcIlwiXCJcbiAgICBBZGQgb3IgcmVwbGFjZSBhIGNvZGUgZWxlbWVudC5cbiAgICBcIlwiXCJcbiAgICBtYW5pcHVsYXRvciA9IHNlbGYubGFuZ3VhZ2Vfc2VydmljZS5nZXRfbWFuaXB1bGF0b3IoZWxlbWVudF90eXBlKVxuICAgIGlmIG1hbmlwdWxhdG9yOlxuICAgICAgICByZXR1cm4gbWFuaXB1bGF0b3IucmVwbGFjZV9lbGVtZW50KG9yaWdpbmFsX2NvZGUsIG5hbWUsIG5ld19jb2RlLCBwYXJlbnRfbmFtZSlcbiAgICByZXR1cm4gb3JpZ2luYWxfY29kZVxuYGBgXG5cbk1hbmlwdWxhdG9yeSBzxIUga2x1Y3pvd3ltIGVsZW1lbnRlbSBDb2RlSGVtLCBrdMOzcnkgdW1vxbxsaXdpYSBpbnRlbGlnZW50bsSFIG1vZHlmaWthY2rEmSBrb2R1IHogemFjaG93YW5pZW0gamVnbyBzdHJ1a3R1cnksIGZvcm1hdG93YW5pYSBpIHNrxYJhZG5pIHNwZWN5Zmljem5laiBkbGEgZGFuZWdvIGrEmXp5a2EgcHJvZ3JhbW93YW5pYS5cbiIsIndvcmtzcGFjZV9maWxlX2NodW5rcyI6W119LHsicmVxdWVzdF9pZCI6ImNmMjc3YmE1LTNjZmEtNDU0Ny05NTA2LTgzYmVhY2Y2ZWZiYyIsInN0YXR1cyI6ImNhbmNlbGxlZCIsImNoYXRJdGVtVHlwZSI6ImFnZW50aWMtdHVybi1kZWxpbWl0ZXIifSx7InN0YXR1cyI6InN1Y2Nlc3MiLCJyZXF1ZXN0X2lkIjoiNGY3YmFkNTAtZTZlMy00MWZmLWE2YTMtZGUxYTEyY2M1NWY3IiwicmVxdWVzdF9tZXNzYWdlIjoibWFtIHdyYcW8ZW5pZSDFvGUgenJvYmnFgiBzacSZIGxla2tpIGJhxYJhZ2FuLiBjenltIGplc3QgcHl0aG9uIGFzdCBtYW5pcHVsYXRvcj8iLCJyaWNoX3RleHRfanNvbl9yZXByIjp7InR5cGUiOiJkb2MiLCJjb250ZW50IjpbeyJ0eXBlIjoicGFyYWdyYXBoIiwiY29udGVudCI6W3sidHlwZSI6InRleHQiLCJ0ZXh0IjoibWFtIHdyYcW8ZW5pZSDFvGUgenJvYmnFgiBzacSZIGxla2tpIGJhxYJhZ2FuLiBjenltIGplc3QgcHl0aG9uIGFzdCBtYW5pcHVsYXRvcj8ifV19XX0sIm1lbnRpb25lZF9pdGVtcyI6W10sInN0cnVjdHVyZWRfb3V0cHV0X25vZGVzIjpbeyJpZCI6MSwidHlwZSI6NSwiY29udGVudCI6IiIsInRvb2xfdXNlIjp7InRvb2xfdXNlX2lkIjoidG9vbHVfdnJ0eF8wMVN5NGVEUWtKRUZMMjViNmRTWVladGMiLCJ0b29sX25hbWUiOiJjb2RlYmFzZS1yZXRyaWV2YWwiLCJpbnB1dF9qc29uIjoie1wiaW5mb3JtYXRpb25fcmVxdWVzdFwiOiBcIkZpbmQgZGV0YWlsZWQgaW5mb3JtYXRpb24gYWJvdXQgcHl0aG9uX2FzdF9tYW5pcHVsYXRvci5weS4gTG9vayBmb3IgdGhlIGZpbGUgY29kZWhlbS9sYW5ndWFnZXMvbGFuZ19weXRob24vcHl0aG9uX2FzdF9tYW5pcHVsYXRvci5weSBhbmQgYW55IHJlbGF0ZWQgZmlsZXMgb3IgaW1wb3J0cyB0aGF0IHJlZmVyZW5jZSBpdC4gRm9jdXMgb24gdW5kZXJzdGFuZGluZyBpdHMgcHVycG9zZSwgaG93IGl0IHdvcmtzLCBhbmQgaG93IGl0IHJlbGF0ZXMgdG8gb3RoZXIgbWFuaXB1bGF0b3JzIGluIHRoZSBzeXN0ZW0uXCJ9In19LHsiaWQiOjAsInR5cGUiOjAsImNvbnRlbnQiOiJQcnplcHJhc3phbSB6YSB6YW1pZXN6YW5pZS4gUHJ6eWpyenlqbXkgc2nEmSBkb2vFgmFkbmllaiwgY3p5bSBqZXN0IFB5dGhvbiBBU1QgTWFuaXB1bGF0b3IgdyBrb250ZWvFm2NpZSBDb2RlSGVtLlxuIn0seyJpZCI6MiwidHlwZSI6MiwiY29udGVudCI6IiJ9LHsiaWQiOjMsInR5cGUiOjMsImNvbnRlbnQiOiIifV0sInNlZW5fc3RhdGUiOiJzZWVuIiwic3RydWN0dXJlZF9yZXF1ZXN0X25vZGVzIjpbeyJpZCI6MSwidHlwZSI6MCwidGV4dF9ub2RlIjp7ImNvbnRlbnQiOiJtYW0gd3JhxbxlbmllIMW8ZSB6cm9iacWCIHNpxJkgbGVra2kgYmHFgmFnYW4uIGN6eW0gamVzdCBweXRob24gYXN0IG1hbmlwdWxhdG9yPyJ9fSx7ImlkIjoyLCJ0eXBlIjo0LCJpZGVfc3RhdGVfbm9kZSI6eyJ3b3Jrc3BhY2VGb2xkZXJzIjpbeyJyZXBvc2l0b3J5Um9vdCI6IkQ6L2NvZGUvQ29kZUhlbSIsImZvbGRlclJvb3QiOiJEOi9jb2RlL0NvZGVIZW0ifV0sIndvcmtzcGFjZUZvbGRlcnNVbmNoYW5nZWQiOmZhbHNlfX1dLCJyZXNwb25zZV90ZXh0IjoiUHJ6ZXByYXN6YW0gemEgemFtaWVzemFuaWUuIFByenlqcnp5am15IHNpxJkgZG9rxYJhZG5pZWosIGN6eW0gamVzdCBQeXRob24gQVNUIE1hbmlwdWxhdG9yIHcga29udGVrxZtjaWUgQ29kZUhlbS5cbiIsIndvcmtzcGFjZV9maWxlX2NodW5rcyI6W119LHsic3RhdHVzIjoic3VjY2VzcyIsInJlcXVlc3RfaWQiOiIwN2U2YzFhZC00NzQ3LTRjNzQtOGNiMS1jZDY5ODE5YWI2YWMiLCJyZXF1ZXN0X21lc3NhZ2UiOiIiLCJzdHJ1Y3R1cmVkX291dHB1dF9ub2RlcyI6W3siaWQiOjEsInR5cGUiOjUsImNvbnRlbnQiOiIiLCJ0b29sX3VzZSI6eyJ0b29sX3VzZV9pZCI6InRvb2x1X3ZydHhfMDFFOE1qamNZb1JQV0dwSE1RWlNVRjFtIiwidG9vbF9uYW1lIjoic3RyLXJlcGxhY2UtZWRpdG9yIiwiaW5wdXRfanNvbiI6IntcImNvbW1hbmRcIjogXCJ2aWV3XCIsIFwicGF0aFwiOiBcImNvZGVoZW0vbGFuZ3VhZ2VzL2xhbmdfcHl0aG9uL3B5dGhvbl9hc3RfbWFuaXB1bGF0b3IucHlcIn0ifX0seyJpZCI6MCwidHlwZSI6MCwiY29udGVudCI6IiJ9LHsiaWQiOjIsInR5cGUiOjIsImNvbnRlbnQiOiIifSx7ImlkIjozLCJ0eXBlIjozLCJjb250ZW50IjoiIn1dLCJzZWVuX3N0YXRlIjoic2VlbiIsInN0cnVjdHVyZWRfcmVxdWVzdF9ub2RlcyI6W3siaWQiOjEsInR5cGUiOjEsInRvb2xfcmVzdWx0X25vZGUiOnsiY29udGVudCI6IlRoZSBmb2xsb3dpbmcgY29kZSBzZWN0aW9ucyB3ZXJlIHJldHJpZXZlZDpcblBhdGg6IGNvZGVoZW0vbGFuZ3VhZ2VzL2xhbmdfcHl0aG9uL3B5dGhvbl9hc3RfbWFuaXB1bGF0b3IucHlcbmltcG9ydCBhc3RcbmltcG9ydCBsb2dnaW5nXG5mcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWwsIExpc3QsIFR1cGxlLCBVbmlvbiwgQW55XG5mcm9tIGNvZGVoZW0uY29yZS5tYW5pcHVsYXRvcnMubWFuaXB1bGF0b3JfYmFzZSBpbXBvcnQgTWFuaXB1bGF0b3JCYXNlXG5mcm9tIGNvZGVoZW0ubW9kZWxzLmVudW1zIGltcG9ydCBDb2RlRWxlbWVudFR5cGVcblxubG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoX19uYW1lX18pXG5cbmNsYXNzIFJlcGxhY2VPckluc2VydFRyYW5zZm9ybWVyKGFzdC5Ob2RlVHJhbnNmb3JtZXIpOlxuICAgIFwiXCJcIlxuICAgIEFTVCBUcmFuc2Zvcm1lciB0byByZXBsYWNlIGEgbm9kZSBhdCBhIHNwZWNpZmljIGxvY2F0aW9uIG9yIGluc2VydCBub2Rlc1xuICAgIGludG8gYSBwYXJlbnQgbm9kZSdzIGJvZHkuIChWZXJzaW9uIDM6IEltcHJvdmVkIHJlcGxhY2VtZW50LCBpbXBvcnQgYmxvY2sgaGFuZGxpbmcpXG4gICAgXCJcIlwiXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsXG4gICAgICAgICAgICAgICAgIHRhcmdldF9zdGFydF9saW5lOiBPcHRpb25hbFtpbnRdLFxuICAgICAgICAgICAgICAgICB0YXJnZXRfZW5kX2xpbmU6IE9wdGlvbmFsW2ludF0sXG4gICAgICAgICAgICAgICAgIG5ld19ub2RlczogTGlzdFthc3QuQVNUXSxcbiAgICAgICAgICAgICAgICAgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl0sXG4gICAgICAgICAgICAgICAgIGVsZW1lbnRfdHlwZTogQ29kZUVsZW1lbnRUeXBlLFxuICAgICAgICAgICAgICAgICB0YXJnZXRfbmFtZTogc3RyKTpcbiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpXG4gICAgICAgIHNlbGYudGFyZ2V0X3N0YXJ0X2xpbmUgPSB0YXJnZXRfc3RhcnRfbGluZVxuICAgICAgICBzZWxmLnRhcmdldF9lbmRfbGluZSA9IHRhcmdldF9lbmRfbGluZVxuICAgICAgICBzZWxmLm5ld19ub2RlcyA9IG5ld19ub2Rlc1xuICAgICAgICBzZWxmLnBhcmVudF9uYW1lID0gcGFyZW50X25hbWVcbiAgICAgICAgc2VsZi5lbGVtZW50X3R5cGUgPSBlbGVtZW50X3R5cGVcbiAgICAgICAgc2VsZi50YXJnZXRfbmFtZSA9IHRhcmdldF9uYW1lICMgTmFtZSBvZiB0aGUgZWxlbWVudCB0byByZXBsYWNlL2luc2VydCAoJ2FsbCcgZm9yIGltcG9ydCBibG9jaylcbiAgICAgICAgc2VsZi5pc19yZXBsYWNpbmcgPSB0YXJnZXRfc3RhcnRfbGluZSBpcyBub3QgTm9uZVxuLi4uXG5cbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJDYWxjdWxhdGVkIGluc2VydGlvbiBwb2ludCBmb3Ige3NlbGYuZWxlbWVudF90eXBlLnZhbHVlfSBhdCBtb2R1bGUgbGV2ZWw6IHtpbnNlcnRfcG9zfVwiKVxuXG4gICAgICAgIHJldHVybiBpbnNlcnRfcG9zXG5cbiAgICBkZWYgdmlzaXQoc2VsZiwgbm9kZSk6XG4gICAgICAgIFwiXCJcIlZpc2l0IG5vZGVzLCBoYW5kbGluZyByZXBsYWNlbWVudCwgdGhlbiB2aXNpdGluZyBjaGlsZHJlbiwgdGhlbiBpbnNlcnRpb24uXCJcIlwiXG4gICAgICAgICMgMS4gSGFuZGxlIFJlcGxhY2VtZW50IChpZiBhcHBsaWNhYmxlIHRvIHRoZSBub2RlIGl0c2VsZilcbiAgICAgICAgaWYgc2VsZi5pc19yZXBsYWNpbmcgYW5kIG5vdCBzZWxmLm9wZXJhdGlvbl9kb25lIGFuZCBzZWxmLl9pc190YXJnZXRfbm9kZShub2RlKTpcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGZcIlJlcGxhY2luZyBub2RlIHt0eXBlKG5vZGUpLl9fbmFtZV9ffSAodGFyZ2V0OiB7c2VsZi50YXJnZXRfbmFtZX0pIGF0IGxpbmUge25vZGUubGluZW5vfSB3aXRoIHtsZW4oc2VsZi5uZXdfbm9kZXMpfSBuZXcgbm9kZShzKS5cIilcbiAgICAgICAgICAgIHNlbGYub3BlcmF0aW9uX2RvbmUgPSBUcnVlXG4gICAgICAgICAgICByZXR1cm4gc2VsZi5uZXdfbm9kZXMgaWYgc2VsZi5uZXdfbm9kZXMgZWxzZSBOb25lICMgUmV0dXJuIGxpc3QvTm9uZSBmb3IgdmlzaXRfbGlzdFxuXG4gICAgICAgICMgMi4gVmlzaXQgQ2hpbGRyZW4gKGdlbmVyaWNfdmlzaXQgaGFuZGxlcyByZWN1cnNpb24pXG4gICAgICAgIG5ld19ub2RlID0gc3VwZXIoKS5nZW5lcmljX3Zpc2l0KG5vZGUpXG5cbiAgICAgICAgIyAzLiBIYW5kbGUgSW5zZXJ0aW9uIChpZiBhcHBsaWNhYmxlIHdpdGhpbiB0aGlzIG5vZGUncyBib2R5KVxuICAgICAgICAjIENoZWNrIG5vZGUgdHlwZSAqYWZ0ZXIqIHZpc2l0aW5nIGNoaWxkcmVuLCBhcyBnZW5lcmljX3Zpc2l0IHJldHVybnMgdGhlIG5vZGVcbiAgICAgICAgaWYgbmV3X25vZGUgaXMgTm9uZTogIyBOb2RlIG1pZ2h0IGhhdmUgYmVlbiBkZWxldGVkIGJ5IGEgY2hpbGQgdmlzaXRvcj8gVW5saWtlbHkgaGVyZSBidXQgc2FmZSBjaGVjay5cbiAgICAgICAgICAgICByZXR1cm4gTm9uZVxuXG4gICAgICAgICMgQ2hlY2sgaWYgaW5zZXJ0aW9uIGlzIGludGVuZGVkIGFuZCBoYXNuJ3QgaGFwcGVuZWQgeWV0XG4gICAgICAgIGlmIG5vdCBzZWxmLmlzX3JlcGxhY2luZyBhbmQgbm90IHNlbGYub3BlcmF0aW9uX2RvbmU6XG4gICAgICAgICAgICBpc19tb2R1bGVfdGFyZ2V0ID0gKHNlbGYucGFyZW50X25hbWUgaXMgTm9uZSBhbmQgaXNpbnN0YW5jZShuZXdfbm9kZSwgYXN0Lk1vZHVsZSkpXG4gICAgICAgICAgICBpc19jbGFzc190YXJnZXQgPSAoc2VsZi5wYXJlbnRfbmFtZSBpcyBub3QgTm9uZSBhbmQgaXNpbnN0YW5jZShuZXdfbm9kZSwgYXN0LkNsYXNzRGVmKSBhbmQgbmV3X25vZGUubmFtZSA9PSBzZWxmLnBhcmVudF9uYW1lKVxuLi4uXG5cbiAgICAgICAgIyBEZWZhdWx0IHByb2Nlc3NpbmcgaWYgbm90IGltcG9ydCBibG9jayByZXBsYWNlbWVudFxuICAgICAgICBub2RlLmJvZHkgPSBzZWxmLnZpc2l0X2xpc3Qobm9kZS5ib2R5KVxuICAgICAgICAjIEFsbG93IGdlbmVyaWNfdmlzaXQgdG8gaGFuZGxlIHBvdGVudGlhbCBpbnNlcnRpb24gaW50byB0aGUgbW9kdWxlIGJvZHlcbiAgICAgICAgcmV0dXJuIHN1cGVyKCkuZ2VuZXJpY192aXNpdChub2RlKVxuXG4gICAgZGVmIHZpc2l0X0NsYXNzRGVmKHNlbGYsIG5vZGU6IGFzdC5DbGFzc0RlZikgLT4gQW55OlxuICAgICAgICBub2RlLmJvZHkgPSBzZWxmLnZpc2l0X2xpc3Qobm9kZS5ib2R5KVxuICAgICAgICAjIEFsbG93IGdlbmVyaWNfdmlzaXQgdG8gaGFuZGxlIHBvdGVudGlhbCBpbnNlcnRpb24gb3IgcmVwbGFjZW1lbnQgb2YgdGhlIGNsYXNzIGl0c2VsZlxuICAgICAgICByZXR1cm4gc3VwZXIoKS5nZW5lcmljX3Zpc2l0KG5vZGUpXG5cbiAgICBkZWYgdmlzaXRfRnVuY3Rpb25EZWYoc2VsZiwgbm9kZTogYXN0LkZ1bmN0aW9uRGVmKSAtPiBBbnk6XG4gICAgICAgIG5vZGUuYm9keSA9IHNlbGYudmlzaXRfbGlzdChub2RlLmJvZHkpXG4gICAgICAgICMgQWxsb3cgZ2VuZXJpY192aXNpdCBmb3IgcmVwbGFjZW1lbnQgY2hlY2sgb2YgdGhlIGZ1bmN0aW9uIGl0c2VsZlxuICAgICAgICByZXR1cm4gc3VwZXIoKS5nZW5lcmljX3Zpc2l0KG5vZGUpXG5cbiAgICBkZWYgdmlzaXRfQXN5bmNGdW5jdGlvbkRlZihzZWxmLCBub2RlOiBhc3QuQXN5bmNGdW5jdGlvbkRlZikgLT4gQW55OlxuICAgICAgICBub2RlLmJvZHkgPSBzZWxmLnZpc2l0X2xpc3Qobm9kZS5ib2R5KVxuICAgICAgICAgIyBBbGxvdyBnZW5lcmljX3Zpc2l0IGZvciByZXBsYWNlbWVudCBjaGVjayBvZiB0aGUgZnVuY3Rpb24gaXRzZWxmXG4gICAgICAgIHJldHVybiBzdXBlcigpLmdlbmVyaWNfdmlzaXQobm9kZSlcblxuY2xhc3MgUHl0aG9uQVNUTWFuaXB1bGF0b3IoTWFuaXB1bGF0b3JCYXNlKTpcbiAgICBcIlwiXCJcbiAgICBBU1QtYmFzZWQgbWFuaXB1bGF0b3IgZm9yIFB5dGhvbiBjb2RlIHVzaW5nIGFzdC5Ob2RlVHJhbnNmb3JtZXIuXG4gICAgU3VwcG9ydHMgcm9idXN0IGluc2VydGlvbiwgcmVwbGFjZW1lbnQgb2YgY2xhc3NlcywgZnVuY3Rpb25zLCBtZXRob2RzLFxuICAgIHByb3BlcnRpZXMsIGFuZCBpbXBvcnRzLiAoVmVyc2lvbiAzKVxuICAgIFwiXCJcIlxuXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsICphcmdzLCAqKmt3YXJncyk6XG4gICAgICAgIHN1cGVyKCkuX19pbml0X18oKmFyZ3MsICoqa3dhcmdzKVxuLi4uXG5cbiAgICBkZWYgdXBzZXJ0X2VsZW1lbnQoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCBlbGVtZW50X3R5cGVfc3RyOiBzdHIsIG5hbWU6IHN0ciwgbmV3X2NvZGU6IHN0ciwgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl0gPSBOb25lKSAtPiBzdHI6XG4gICAgICAgIFwiXCJcIiBBZGQgb3IgcmVwbGFjZSBhIGNvZGUgZWxlbWVudCB1c2luZyBBU1QgdHJhbnNmb3JtYXRpb24uIFwiXCJcIlxuICAgICAgICBsb2dnZXIuaW5mbyhmXCJBU1QgVXBzZXJ0OiB0eXBlPSd7ZWxlbWVudF90eXBlX3N0cn0nLCBuYW1lPSd7bmFtZX0nLCBwYXJlbnQ9J3twYXJlbnRfbmFtZX0nXCIpXG5cbiAgICAgICAgdHJ5OiBlbGVtZW50X3R5cGUgPSBzZWxmLl9nZXRfZWxlbWVudF90eXBlX2Zvcl91cHNlcnQoZWxlbWVudF90eXBlX3N0ciwgbmV3X2NvZGUpXG4gICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yIGFzIGU6IGxvZ2dlci5lcnJvcihmXCJDYW5ub3QgcGVyZm9ybSB1cHNlcnQ6IHtlfVwiKTsgcmV0dXJuIG9yaWdpbmFsX2NvZGVcblxuICAgICAgICAjIFJlZmluZSB0eXBlIGd1ZXNzIGJhc2VkIG9uIGNvbnRleHRcbiAgICAgICAgaWYgZWxlbWVudF90eXBlID09IENvZGVFbGVtZW50VHlwZS5GVU5DVElPTiBhbmQgcGFyZW50X25hbWU6IGVsZW1lbnRfdHlwZSA9IENvZGVFbGVtZW50VHlwZS5NRVRIT0RcbiAgICAgICAgbG9nZ2VyLmluZm8oZlwiUHJvY2Vzc2luZyBhcyBlbGVtZW50IHR5cGU6IHtlbGVtZW50X3R5cGUudmFsdWV9XCIpXG4uLi5cbiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTogbG9nZ2VyLmVycm9yKGZcIkVycm9yIHBhcnNpbmcgbmV3IGNvZGUgc25pcHBldDoge2V9XCIpOyByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgICAgICBlbHNlOiBsb2dnZXIuZGVidWcoXCJQcm9jZWVkaW5nIHdpdGggZGVsZXRpb24gKG5ld19ub2RlcyBpcyBlbXB0eSkuXCIpXG5cbiAgICAgICAgIyBBcHBseSB0cmFuc2Zvcm1hdGlvblxuICAgICAgICBtb2RpZmllZF90cmVlID0gTm9uZVxuICAgICAgICB0cmFuc2Zvcm1lciA9IE5vbmVcbiAgICAgICAgdHJ5OlxuICAgICAgICAgICAgdHJhbnNmb3JtZXIgPSBSZXBsYWNlT3JJbnNlcnRUcmFuc2Zvcm1lcihcbiAgICAgICAgICAgICAgICB0YXJnZXRfc3RhcnRfbGluZT10YXJnZXRfc3RhcnRfbGluZSwgdGFyZ2V0X2VuZF9saW5lPXRhcmdldF9lbmRfbGluZSxcbiAgICAgICAgICAgICAgICBuZXdfbm9kZXM9bmV3X25vZGVzLCBwYXJlbnRfbmFtZT1wYXJlbnRfbmFtZSxcbiAgICAgICAgICAgICAgICBlbGVtZW50X3R5cGU9ZWxlbWVudF90eXBlLCB0YXJnZXRfbmFtZT1uYW1lIGlmIG5hbWUgIT0gJ2FsbCcgZWxzZSBOb25lICMgUGFzcyBOb25lIG5hbWUgZm9yIGJsb2NrIHJlcGxhY2VcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIG1vZGlmaWVkX3RyZWUgPSB0cmFuc2Zvcm1lci52aXNpdChvcmlnaW5hbF90cmVlKVxuICAgICAgICAgICAgaWYgbW9kaWZpZWRfdHJlZSBpcyBOb25lOiBsb2dnZXIuaW5mbyhcIlRyYW5zZm9ybWF0aW9uIHJlc3VsdGVkIGluIGVtcHR5IEFTVC5cIik7IHJldHVybiBcIlxcblwiXG4gICAgICAgICAgICBtb2RpZmllZF90cmVlID0gYXN0LmZpeF9taXNzaW5nX2xvY2F0aW9ucyhtb2RpZmllZF90cmVlKVxuXG4gICAgICAgICAgICBpZiBub3QgdHJhbnNmb3JtZXIub3BlcmF0aW9uX2RvbmU6XG4gICAgICAgICAgICAgICAgIGFjdGlvbiA9IFwicmVwbGFjZS9kZWxldGVcIiBpZiBpc19yZXBsYWNpbmcgZWxzZSBcImluc2VydFwiXG4gICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJUcmFuc2Zvcm1lciBmYWlsZWQgdG8ge2FjdGlvbn0gZWxlbWVudCAne25hbWV9JyBcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZlwie2YnYXQgbGluZXMge3RhcmdldF9zdGFydF9saW5lfS17dGFyZ2V0X2VuZF9saW5lfScgaWYgaXNfcmVwbGFjaW5nIGVsc2UgZidpbnRvIHBhcmVudCB7cGFyZW50X25hbWV9J30uXCIpXG4gICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbF9jb2RlICMgUmV0dXJuIG9yaWdpbmFsIGlmIG9wZXJhdGlvbiBmYWlsZWRcblxuICAgICAgICAgICAgbG9nZ2VyLmluZm8oZlwiVHJhbnNmb3JtZXIgb3BlcmF0aW9uIHN1Y2Nlc3NmdWw6IHsnUmVwbGFjZWQvRGVsZXRlZCcgaWYgaXNfcmVwbGFjaW5nIGVsc2UgJ0luc2VydGVkJ31cIilcbiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGZcIkVycm9yIGR1cmluZyBBU1QgdHJhbnNmb3JtYXRpb246IHtlfVwiLCBleGNfaW5mbz1UcnVlKVxuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbi4uLlxuXG4gICAgZGVmIGFkZF9lbGVtZW50KHNlbGYsIG9yaWdpbmFsX2NvZGU6IHN0ciwgbmV3X2NvZGU6IHN0ciwgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl09Tm9uZSkgLT4gc3RyOlxuICAgICAgICBsb2dnZXIuZGVidWcoZlwiQ2FsbGluZyBhZGRfZWxlbWVudCBmb3IgcGFyZW50ICd7cGFyZW50X25hbWV9J1wiKVxuICAgICAgICB0cnk6XG4gICAgICAgICAgICBuZXdfdHJlZSA9IGFzdC5wYXJzZShuZXdfY29kZS5zdHJpcCgpKVxuICAgICAgICAgICAgaWYgbm90IG5ld190cmVlLmJvZHk6IGxvZ2dlci5lcnJvcihcIkNhbm5vdCBhZGQgZW1wdHkgZWxlbWVudC5cIik7IHJldHVybiBvcmlnaW5hbF9jb2RlXG4gICAgICAgICAgICBub2RlX3RvX2FkZCA9IG5ld190cmVlLmJvZHlbMF1cbiAgICAgICAgICAgIHRlbXBfbmFtZSA9IGdldGF0dHIobm9kZV90b19hZGQsICduYW1lJywgTm9uZSlcbiAgICAgICAgICAgICMgTGV0IHVwc2VydCBoYW5kbGUgdHlwZSBkZWR1Y3Rpb24gYnkgcGFzc2luZyBcInVua25vd25cIlxuICAgICAgICAgICAgdGVtcF90eXBlX3N0ciA9IFwidW5rbm93blwiXG4gICAgICAgICAgICBpZiBpc2luc3RhbmNlKG5vZGVfdG9fYWRkLCAoYXN0LkltcG9ydCwgYXN0LkltcG9ydEZyb20pKTogdGVtcF9uYW1lID0gJ2FsbCdcblxuICAgICAgICAgICAgaWYgdGVtcF9uYW1lIGFuZCB0ZW1wX3R5cGVfc3RyOlxuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnVwc2VydF9lbGVtZW50KG9yaWdpbmFsX2NvZGUsIHRlbXBfdHlwZV9zdHIsIHRlbXBfbmFtZSwgbmV3X2NvZGUsIHBhcmVudF9uYW1lKVxuICAgICAgICAgICAgZWxzZTogbG9nZ2VyLmVycm9yKGZcIkNvdWxkIG5vdCBkZWR1Y2UgbmFtZS90eXBlIGZvciBhZGRfZWxlbWVudDoge25ld19jb2RlWzoxMDBdfS4uLlwiKVxuICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6IGxvZ2dlci5lcnJvcihmXCJFcnJvciBwcmVwYXJpbmcgZm9yIGFkZF9lbGVtZW50OiB7ZX1cIilcbiAgICAgICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcblxuICAgIGRlZiByZXBsYWNlX2VsZW1lbnQoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCBuYW1lOiBzdHIsIG5ld19jb2RlOiBzdHIsIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IHN0cjpcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIkNhbGxpbmcgcmVwbGFjZV9lbGVtZW50IGZvciAne25hbWV9JywgcGFyZW50ICd7cGFyZW50X25hbWV9JyAtIGRlbGVnYXRpbmcgdHlwZSBkZXRlY3Rpb24gdG8gdXBzZXJ0LlwiKVxuICAgICAgICAjIFBhc3MgXCJ1bmtub3duXCIgLSB1cHNlcnQgd2lsbCB0cnkgdG8gZmluZCBleGlzdGluZyBvciBkZWR1Y2UgZnJvbSBuZXdfY29kZVxuICAgICAgICByZXR1cm4gc2VsZi51cHNlcnRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBcInVua25vd25cIiwgbmFtZSwgbmV3X2NvZGUsIHBhcmVudF9uYW1lKVxuXG4gICAgZGVmIHJlbW92ZV9lbGVtZW50KHNlbGYsIG9yaWdpbmFsX2NvZGU6IHN0ciwgbmFtZTogc3RyLCBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXT1Ob25lKSAtPiBzdHI6XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJDYWxsaW5nIHJlbW92ZV9lbGVtZW50IGZvciAne25hbWV9JywgcGFyZW50ICd7cGFyZW50X25hbWV9JyAtIGRlbGVnYXRpbmcgdHlwZSBkZXRlY3Rpb24gdG8gdXBzZXJ0LlwiKVxuICAgICAgICAjIFBhc3MgXCJ1bmtub3duXCIgLSB1cHNlcnQgd2lsbCB0cnkgdG8gZmluZCB0aGUgZWxlbWVudCBmaXJzdCB0byBkZXRlcm1pbmUgdHlwZVxuICAgICAgICByZXR1cm4gc2VsZi51cHNlcnRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBcInVua25vd25cIiwgbmFtZSwgXCJcIiwgcGFyZW50X25hbWUpXG5cbiAgICBkZWYgdXBzZXJ0X2VsZW1lbnRfYnlfeHBhdGgoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCB4cGF0aDogc3RyLCBuZXdfY29kZTogc3RyKSAtPiBzdHI6XG4gICAgICAgIGZyb20gY29kZWhlbS5jb3JlLmVuZ2luZS54cGF0aF9wYXJzZXIgaW1wb3J0IFhQYXRoUGFyc2VyXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJDYWxsaW5nIHVwc2VydF9lbGVtZW50X2J5X3hwYXRoIGZvciAne3hwYXRofSdcIilcbiAgICAgICAgdHJ5OlxuICAgICAgICAgICAgZWxlbWVudF9uYW1lLCBwYXJlbnRfbmFtZSwgZWxlbWVudF90eXBlX3N0cl9mcm9tX3hwYXRoID0gWFBhdGhQYXJzZXIuZ2V0X2VsZW1lbnRfaW5mbyh4cGF0aClcbiAgICAgICAgICAgIG9wX2VsZW1lbnRfdHlwZV9zdHIgPSBlbGVtZW50X3R5cGVfc3RyX2Zyb21feHBhdGggaWYgZWxlbWVudF90eXBlX3N0cl9mcm9tX3hwYXRoIGVsc2UgXCJ1bmtub3duXCJcbiAgICAgICAgICAgIG9wX25hbWUgPSBlbGVtZW50X25hbWVcbiAgICAgICAgICAgIGlmIG5vdCBvcF9uYW1lIGFuZCBvcF9lbGVtZW50X3R5cGVfc3RyID09IENvZGVFbGVtZW50VHlwZS5JTVBPUlQudmFsdWU6IG9wX25hbWUgPSAnYWxsJ1xuICAgICAgICAgICAgZWxpZiBub3Qgb3BfbmFtZTpcbiAgICAgICAgICAgICAgICAgIyBUcnkgZGVkdWNpbmcgbmFtZSBmcm9tIG5ld19jb2RlIGlmIFhQYXRoIHdhcyBsaWtlICdbY2xhc3NdJ1xuICAgICAgICAgICAgICAgICB0cnk6XG4gICAgICAgICAgICAgICAgICAgICAgbmV3X3RyZWUgPSBhc3QucGFyc2UobmV3X2NvZGUuc3RyaXAoKSlcbiAgICAgICAgICAgICAgICAgICAgICBpZiBuZXdfdHJlZS5ib2R5IGFuZCBoYXNhdHRyKG5ld190cmVlLmJvZHlbMF0sICduYW1lJyk6IG9wX25hbWUgPSBuZXdfdHJlZS5ib2R5WzBdLm5hbWVcbi4uLlxuUGF0aDogY29kZWhlbS9sYW5ndWFnZXMvbGFuZ19weXRob24vX19pbml0X18ucHlcblwiXCJcIlxuUHl0aG9uIGxhbmd1YWdlIG1vZHVsZSBmb3IgQ29kZUhlbS5cblwiXCJcIlxuXG5OT0RFX0NPTkZJRyA9IHtcbiAgICAnZnVuY3Rpb24nOiB7XG4gICAgICAgICduYW1lX2ZpZWxkJzogJ25hbWUnLFxuICAgICAgICAncGFyYW1ldGVyc19maWVsZCc6ICdwYXJhbWV0ZXJzJyxcbiAgICAgICAgJ2JvZHlfZmllbGQnOiAnYm9keScsXG4gICAgICAgICdkZWNvcmF0b3JzX2ZpZWxkJzogJ2RlY29yYXRvcnMnLFxuICAgICAgICAncGFyZW50X2NsYXNzX3R5cGUnOiAnY2xhc3NfZGVmaW5pdGlvbicsXG4gICAgfSxcbiAgICAnbWV0aG9kJzoge1xuICAgICAgICAnbmFtZV9maWVsZCc6ICduYW1lJyxcbiAgICAgICAgJ3BhcmFtZXRlcnNfZmllbGQnOiAncGFyYW1ldGVycycsXG4gICAgICAgICdib2R5X2ZpZWxkJzogJ2JvZHknLFxuICAgICAgICAnZGVjb3JhdG9yc19maWVsZCc6ICdkZWNvcmF0b3JzJyxcbiAgICAgICAgJ3BhcmVudF9jbGFzc190eXBlJzogJ2NsYXNzX2RlZmluaXRpb24nLFxuICAgIH0sXG4gICAgJ2NsYXNzJzoge1xuICAgICAgICAnbmFtZV9maWVsZCc6ICduYW1lJyxcbiAgICAgICAgJ2JvZHlfZmllbGQnOiAnYm9keScsXG4gICAgICAgICdkZWNvcmF0b3JzX2ZpZWxkJzogJ2RlY29yYXRvcnMnLFxuICAgICAgICAncGFyZW50X2NsYXNzX3R5cGUnOiBOb25lLFxuICAgIH0sXG4gICAgJ2RlY29yYXRvcic6IHtcbiAgICAgICAgJ25hbWVfZmllbGQnOiAnbmFtZScsXG4gICAgfSxcbiAgICAncHJvcGVydHlfZ2V0dGVyJzoge1xuICAgICAgICAnbmFtZV9maWVsZCc6ICduYW1lJyxcbiAgICAgICAgJ2JvZHlfZmllbGQnOiAnYm9keScsXG4gICAgICAgICdkZWNvcmF0b3JzX2ZpZWxkJzogJ2RlY29yYXRvcnMnLFxuICAgICAgICAncGFyZW50X2NsYXNzX3R5cGUnOiAnY2xhc3NfZGVmaW5pdGlvbicsXG4gICAgfSxcbiAgICAncHJvcGVydHlfc2V0dGVyJzoge1xuICAgICAgICAnbmFtZV9maWVsZCc6ICduYW1lJyxcbiAgICAgICAgJ2JvZHlfZmllbGQnOiAnYm9keScsXG4gICAgICAgICdkZWNvcmF0b3JzX2ZpZWxkJzogJ2RlY29yYXRvcnMnLFxuICAgICAgICAncGFyZW50X2NsYXNzX3R5cGUnOiAnY2xhc3NfZGVmaW5pdGlvbicsXG4gICAgfSxcbiAgICAnc3RhdGljX21ldGhvZCc6IHtcbiAgICAgICAgJ25hbWVfZmllbGQnOiAnbmFtZScsXG4gICAgICAgICdwYXJhbWV0ZXJzX2ZpZWxkJzogJ3BhcmFtZXRlcnMnLFxuICAgICAgICAnYm9keV9maWVsZCc6ICdib2R5JyxcbiAgICAgICAgJ2RlY29yYXRvcnNfZmllbGQnOiAnZGVjb3JhdG9ycycsXG4gICAgICAgICdwYXJlbnRfY2xhc3NfdHlwZSc6ICdjbGFzc19kZWZpbml0aW9uJyxcbiAgICB9LFxuICAgICdpbXBvcnQnOiB7XG4gICAgICAgICduYW1lX2ZpZWxkJzogJ25hbWUnLCAgIyBvciAnbW9kdWxlJyBkZXBlbmRpbmcgb24gQVNUXG4gICAgfSxcbn1cbmZyb20gY29kZWhlbS5jb3JlLnJlZ2lzdHJ5IGltcG9ydCByZWdpc3RyeVxuZnJvbSAuc2VydmljZSBpbXBvcnQgUHl0aG9uTGFuZ3VhZ2VTZXJ2aWNlXG5mcm9tIC5tYW5pcHVsYXRvci5tZXRob2RfaGFuZGxlciBpbXBvcnQgUHl0aG9uTWV0aG9kTWFuaXB1bGF0b3JcbmZyb20gLnB5dGhvbl9hc3RfbWFuaXB1bGF0b3IgaW1wb3J0IFB5dGhvbkFTVE1hbmlwdWxhdG9yXG5mcm9tIGNvZGVoZW0ubW9kZWxzLmVudW1zIGltcG9ydCBDb2RlRWxlbWVudFR5cGVcbmltcG9ydCBsb2dnaW5nXG5cbmRlZiBpbml0aWFsaXplX3B5dGhvbl9sYW5ndWFnZSgpOlxuICAgIFwiXCJcIlxuICAgIEluaXRpYWxpemUgYW5kIHJlZ2lzdGVyIFB5dGhvbiBsYW5ndWFnZSBtYW5pcHVsYXRvcnMgYW5kIHNlcnZpY2VzLlxuICAgIFRoaXMgZnVuY3Rpb24gY2xlYXJzIGV4aXN0aW5nICdweXRob25fJyBtYW5pcHVsYXRvcnMgYW5kIHJlZ2lzdGVycyBwYXRjaGVkIHZlcnNpb25zLlxuICAgIENhbGwgdGhpcyBleHBsaWNpdGx5IGJlZm9yZSB1c2luZyBQeXRob24gbGFuZ3VhZ2UgZmVhdHVyZXMgb3IgcnVubmluZyB0ZXN0cy5cbiAgICBcIlwiXCJcbiAgICAjIENsZWFyIGFsbCBleGlzdGluZyBweXRob24gbWFuaXB1bGF0b3JzXG4gICAga2V5c190b19yZW1vdmUgPSBbayBmb3IgayBpbiBsaXN0KHJlZ2lzdHJ5LmFsbF9tYW5pcHVsYXRvcnMua2V5cygpKSBpZiBrLnN0YXJ0c3dpdGgoJ3B5dGhvbl8nKV1cbiAgICBmb3IgayBpbiBrZXlzX3RvX3JlbW92ZTpcbiAgICAgICAgcmVnaXN0cnkuYWxsX21hbmlwdWxhdG9ycy5wb3AoaywgTm9uZSlcbiAgICBsb2dnaW5nLmRlYnVnKGZcIkNsZWFyZWQge2xlbihrZXlzX3RvX3JlbW92ZSl9IGV4aXN0aW5nIHB5dGhvbiBtYW5pcHVsYXRvcnMuXCIpXG5cbiAgICAjIFJlZ2lzdGVyIEFTVCBtYW5pcHVsYXRvcnMgZm9yIGZ1bmN0aW9uLCBjbGFzcywgaW1wb3J0XG4gICAgZm9yIGVsZW1lbnRfdHlwZV9lbnVtIGluIFtcbiAgICAgICAgQ29kZUVsZW1lbnRUeXBlLkZVTkNUSU9OLFxuICAgICAgICBDb2RlRWxlbWVudFR5cGUuQ0xBU1MsXG4gICAgICAgIENvZGVFbGVtZW50VHlwZS5JTVBPUlQsXG4gICAgXTpcbiAgICAgICAgZWxlbWVudF90eXBlX25hbWUgPSBlbGVtZW50X3R5cGVfZW51bS52YWx1ZS5sb3dlcigpXG4gICAgICAgIFdyYXBwZXIgPSB0eXBlKFxuICAgICAgICAgICAgZlwiUHl0aG9ue2VsZW1lbnRfdHlwZV9uYW1lLmNhcGl0YWxpemUoKX1BU1RNYW5pcHVsYXRvclwiLFxuICAgICAgICAgICAgKFB5dGhvbkFTVE1hbmlwdWxhdG9yLCksXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJ0xBTkdVQUdFX0NPREUnOiAncHl0aG9uJyxcbiAgICAgICAgICAgICAgICAnRUxFTUVOVF9UWVBFJzogZWxlbWVudF90eXBlX2VudW1cbiAgICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgICByZWdpc3RyeS5yZWdpc3Rlcl9tYW5pcHVsYXRvcihXcmFwcGVyKVxuICAgICAgICBsb2dnaW5nLmRlYnVnKGZcIlJlZ2lzdGVyZWQgQVNUTWFuaXB1bGF0b3I6IFB5dGhvbntlbGVtZW50X3R5cGVfbmFtZS5jYXBpdGFsaXplKCl9QVNUTWFuaXB1bGF0b3IgZm9yIGVsZW1lbnRfdHlwZToge2VsZW1lbnRfdHlwZV9lbnVtfVwiKVxuXG4gICAgIyBSZWdpc3RlciBQeXRob25BU1RNYW5pcHVsYXRvciBmb3Igb3RoZXIgZWxlbWVudCB0eXBlc1xuICAgIGZvciBlbGVtZW50X3R5cGVfZW51bSBpbiBbXG4gICAgICAgIENvZGVFbGVtZW50VHlwZS5NRVRIT0QsXG4gICAgICAgIENvZGVFbGVtZW50VHlwZS5QUk9QRVJUWV9HRVRURVIsXG4gICAgICAgIENvZGVFbGVtZW50VHlwZS5QUk9QRVJUWV9TRVRURVIsXG4gICAgICAgIENvZGVFbGVtZW50VHlwZS5TVEFUSUNfUFJPUEVSVFksXG4gICAgXTpcbiAgICAgICAgZWxlbWVudF90eXBlX25hbWUgPSBlbGVtZW50X3R5cGVfZW51bS52YWx1ZS5sb3dlcigpXG4gICAgICAgIFdyYXBwZXIgPSB0eXBlKFxuICAgICAgICAgICAgZlwiUHl0aG9ue2VsZW1lbnRfdHlwZV9uYW1lLmNhcGl0YWxpemUoKX1BU1RNYW5pcHVsYXRvclwiLFxuICAgICAgICAgICAgKFB5dGhvbkFTVE1hbmlwdWxhdG9yLCksXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJ0xBTkdVQUdFX0NPREUnOiAncHl0aG9uJyxcbiAgICAgICAgICAgICAgICAnRUxFTUVOVF9UWVBFJzogZWxlbWVudF90eXBlX2VudW1cbiAgICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgICByZWdpc3RyeS5yZWdpc3Rlcl9tYW5pcHVsYXRvcihXcmFwcGVyKVxuICAgICAgICBsb2dnaW5nLmRlYnVnKGZcIlJlZ2lzdGVyZWQgQVNUTWFuaXB1bGF0b3I6IFB5dGhvbntlbGVtZW50X3R5cGVfbmFtZS5jYXBpdGFsaXplKCl9QVNUTWFuaXB1bGF0b3IgZm9yIGVsZW1lbnRfdHlwZToge2VsZW1lbnRfdHlwZV9lbnVtfVwiKVxuXG4gICAgIyBSZWdpc3RlciB0aGUgUHl0aG9uIGxhbmd1YWdlIHNlcnZpY2UgKGlmIG5lZWRlZCBlbHNld2hlcmUpXG4gICAgIyBUaGlzIGltcG9ydCBlbnN1cmVzIHRoZSBzZXJ2aWNlIGlzIGF2YWlsYWJsZVxuICAgIGxvZ2dpbmcuZGVidWcoXCJQeXRob24gbGFuZ3VhZ2UgaW5pdGlhbGl6YXRpb24gY29tcGxldGUuXCIpXG4uLi5cblBhdGg6IGNvZGVoZW0vY29yZS9tYW5pcHVsYXRvcnMvbWFuaXB1bGF0b3JfYmFzZS5weVxuLi4uXG5cbmNsYXNzIE1hbmlwdWxhdG9yQmFzZShBQkMpOlxuICAgIFwiXCJcIkJhc2UgY2xhc3MgZm9yIGFsbCBsYW5ndWFnZS1zcGVjaWZpYyBtYW5pcHVsYXRvcnMuXCJcIlwiXG4gICAgTEFOR1VBR0VfQ09ERTogc3RyID0gJydcbiAgICBFTEVNRU5UX1RZUEU6IE9wdGlvbmFsW0NvZGVFbGVtZW50VHlwZV0gPSBOb25lXG4gICAgQ09NTUVOVF9NQVJLRVJTOiBMaXN0W3N0cl0gPSBbXVxuICAgIERFQ09SQVRPUl9NQVJLRVJTOiBMaXN0W3N0cl0gPSBbXVxuXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsIGxhbmd1YWdlX2NvZGU6IHN0cj1Ob25lLCBlbGVtZW50X3R5cGU6IENvZGVFbGVtZW50VHlwZT1Ob25lLCBmb3JtYXR0ZXI6IEJhc2VGb3JtYXR0ZXI9Tm9uZSwgZXh0cmFjdGlvbl9zZXJ2aWNlPU5vbmUpOlxuICAgICAgICBcIlwiXCJJbml0aWFsaXplIHRoZSBtYW5pcHVsYXRvci5cIlwiXCJcbiAgICAgICAgc2VsZi5sYW5ndWFnZV9jb2RlID0gbGFuZ3VhZ2VfY29kZSBvciBzZWxmLkxBTkdVQUdFX0NPREVcbiAgICAgICAgc2VsZi5lbGVtZW50X3R5cGUgPSBlbGVtZW50X3R5cGUgb3Igc2VsZi5FTEVNRU5UX1RZUEVcbiAgICAgICAgc2VsZi5fZXh0cmFjdGlvbl9zZXJ2aWNlID0gZXh0cmFjdGlvbl9zZXJ2aWNlXG4gICAgICAgIHNlbGYuZm9ybWF0dGVyID0gZm9ybWF0dGVyIG9yIEJhc2VGb3JtYXR0ZXIoKVxuICAgICAgICBpZiBub3Qgc2VsZi5sYW5ndWFnZV9jb2RlOlxuICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcignTWFuaXB1bGF0b3IgcmVxdWlyZXMgYSBsYW5ndWFnZV9jb2RlLicpXG5cbiAgICBAcHJvcGVydHlcbiAgICBkZWYgZXh0cmFjdGlvbl9zZXJ2aWNlKHNlbGYpOlxuICAgICAgICBcIlwiXCJHZXQgZXh0cmFjdGlvbiBzZXJ2aWNlLCBjcmVhdGluZyBpdCBvbiBkZW1hbmQuXCJcIlwiXG4gICAgICAgIGlmIHNlbGYuX2V4dHJhY3Rpb25fc2VydmljZSBpcyBOb25lOlxuICAgICAgICAgICAgZnJvbSBjb2RlaGVtLmNvcmUuZXh0cmFjdGlvbl9zZXJ2aWNlIGltcG9ydCBFeHRyYWN0aW9uU2VydmljZVxuICAgICAgICAgICAgdHJ5OlxuICAgICAgICAgICAgICAgIHNlbGYuX2V4dHJhY3Rpb25fc2VydmljZSA9IEV4dHJhY3Rpb25TZXJ2aWNlKHNlbGYubGFuZ3VhZ2VfY29kZSlcbiAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yIGFzIGU6XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGNyZWF0ZSBFeHRyYWN0aW9uU2VydmljZSBmb3Ige3NlbGYubGFuZ3VhZ2VfY29kZX06IHtlfScpXG4gICAgICAgICAgICAgICAgcmFpc2VcbiAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3Rpb25fc2VydmljZVxuXG4gICAgQGFic3RyYWN0bWV0aG9kXG4gICAgZGVmIGFkZF9lbGVtZW50KHNlbGYsIG9yaWdpbmFsX2NvZGU6IHN0ciwgbmV3X2VsZW1lbnQ6IHN0ciwgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl09Tm9uZSkgLT4gc3RyOlxuICAgICAgICBcIlwiXCJBZGQgYW4gZWxlbWVudCB0byB0aGUgY29kZS4gTXVzdCBiZSBpbXBsZW1lbnRlZCBieSBzdWJjbGFzc2VzLlwiXCJcIlxuICAgICAgICByYWlzZSBOb3RJbXBsZW1lbnRlZEVycm9yKCdTdWJjbGFzc2VzIG11c3QgaW1wbGVtZW50IGFkZF9lbGVtZW50Jylcbi4uLlxuXG4gICAgZGVmIGZvcm1hdF9lbGVtZW50KHNlbGYsIGVsZW1lbnRfY29kZTogc3RyLCBpbmRlbnRfbGV2ZWw6IGludD0wKSAtPiBzdHI6XG4gICAgICAgIFwiXCJcIkZvcm1hdCBhIGNvZGUgZWxlbWVudCB1c2luZyB0aGUgbGFuZ3VhZ2Utc3BlY2lmaWMgZm9ybWF0dGVyLlwiXCJcIlxuICAgICAgICBpZiBoYXNhdHRyKHNlbGYuZm9ybWF0dGVyLCAnZm9ybWF0X2VsZW1lbnQnKSBhbmQgc2VsZi5lbGVtZW50X3R5cGU6XG4gICAgICAgICAgICBkZWRlbnRlZF9jb2RlID0gc2VsZi5mb3JtYXR0ZXIuZGVkZW50KGVsZW1lbnRfY29kZSlcbiAgICAgICAgICAgIGZvcm1hdHRlZF9ub19iYXNlX2luZGVudCA9IHNlbGYuZm9ybWF0dGVyLmZvcm1hdF9lbGVtZW50KHNlbGYuZWxlbWVudF90eXBlLnZhbHVlLCBkZWRlbnRlZF9jb2RlKVxuICAgICAgICAgICAgYmFzZV9pbmRlbnQgPSBzZWxmLmZvcm1hdHRlci5pbmRlbnRfc3RyaW5nICogaW5kZW50X2xldmVsXG4gICAgICAgICAgICByZXR1cm4gc2VsZi5hcHBseV9pbmRlbnRhdGlvbihmb3JtYXR0ZWRfbm9fYmFzZV9pbmRlbnQsIGJhc2VfaW5kZW50KVxuICAgICAgICBpbmRlbnQgPSAnICcgKiAoc2VsZi5mb3JtYXR0ZXIuaW5kZW50X3NpemUgaWYgaGFzYXR0cihzZWxmLmZvcm1hdHRlciwgJ2luZGVudF9zaXplJykgZWxzZSA0KSAqIGluZGVudF9sZXZlbFxuICAgICAgICByZXR1cm4gc2VsZi5hcHBseV9pbmRlbnRhdGlvbihlbGVtZW50X2NvZGUuc3RyaXAoKSwgaW5kZW50KVxuXG4gICAgZGVmIHJlcGxhY2VfZWxlbWVudChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIGVsZW1lbnRfbmFtZTogc3RyLCBuZXdfZWxlbWVudDogc3RyLCBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXT1Ob25lKSAtPiBzdHI6XG4gICAgICAgIFwiXCJcIlJlcGxhY2UgYW4gZWxlbWVudCBpbiB0aGUgY29kZSwgaGFuZGxpbmcgZGVjb3JhdG9ycy9jb21tZW50cy5cIlwiXCJcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIlJlcGxhY2luZyB7c2VsZi5lbGVtZW50X3R5cGV9ICd7ZWxlbWVudF9uYW1lfScgKHBhcmVudDoge3BhcmVudF9uYW1lfSlcIilcbiAgICAgICAgc3RhcnRfbGluZSwgZW5kX2xpbmUgPSBzZWxmLmZpbmRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBlbGVtZW50X25hbWUsIHBhcmVudF9uYW1lKVxuICAgICAgICBpZiBzdGFydF9saW5lID09IDAgYW5kIGVuZF9saW5lID09IDA6XG4gICAgICAgICAgICBsb2dnZXIuaW5mbyhmXCJ7c2VsZi5lbGVtZW50X3R5cGV9ICd7ZWxlbWVudF9uYW1lfScgbm90IGZvdW5kLiBBdHRlbXB0aW5nIHRvIGFkZC5cIilcbiAgICAgICAgICAgIGNhbl9hZGQgPSBwYXJlbnRfbmFtZSBvciBzZWxmLmVsZW1lbnRfdHlwZSBpbiBbQ29kZUVsZW1lbnRUeXBlLkZVTkNUSU9OLCBDb2RlRWxlbWVudFR5cGUuQ0xBU1MsIENvZGVFbGVtZW50VHlwZS5JTVBPUlRdXG4gICAgICAgICAgICBpZiBjYW5fYWRkOlxuICAgICAgICAgICAgICAgIHRyeTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuYWRkX2VsZW1lbnQob3JpZ2luYWxfY29kZSwgbmV3X2VsZW1lbnQsIHBhcmVudF9uYW1lKVxuICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcbi4uLlxuXG4gICAgZGVmIHJlbW92ZV9lbGVtZW50KHNlbGYsIG9yaWdpbmFsX2NvZGU6IHN0ciwgZWxlbWVudF9uYW1lOiBzdHIsIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IHN0cjpcbiAgICAgICAgXCJcIlwiUmVtb3ZlIGFuIGVsZW1lbnQgZnJvbSB0aGUgY29kZSwgaGFuZGxpbmcgZGVjb3JhdG9ycy9jb21tZW50cy5cIlwiXCJcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIlJlbW92aW5nIHtzZWxmLmVsZW1lbnRfdHlwZX0gJ3tlbGVtZW50X25hbWV9JyAocGFyZW50OiB7cGFyZW50X25hbWV9KVwiKVxuICAgICAgICBzdGFydF9saW5lLCBlbmRfbGluZSA9IHNlbGYuZmluZF9lbGVtZW50KG9yaWdpbmFsX2NvZGUsIGVsZW1lbnRfbmFtZSwgcGFyZW50X25hbWUpXG4gICAgICAgIGlmIHN0YXJ0X2xpbmUgPT0gMCBhbmQgZW5kX2xpbmUgPT0gMDpcbiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGZcIkVsZW1lbnQgJ3tlbGVtZW50X25hbWV9JyBub3QgZm91bmQuIENhbm5vdCByZW1vdmUuXCIpXG4gICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgICAgICBsaW5lcyA9IG9yaWdpbmFsX2NvZGUuc3BsaXRsaW5lcygpXG4gICAgICAgIGFkanVzdGVkX3N0YXJ0ID0gc2VsZi5fYWRqdXN0X3N0YXJ0X2xpbmUobGluZXMsIHN0YXJ0X2xpbmUpXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0ZvdW5kIGVsZW1lbnQgZm9yIHJlbW92YWwgYXQgbGluZXMge3N0YXJ0X2xpbmV9LXtlbmRfbGluZX0uIEFkanVzdGVkOiB7YWRqdXN0ZWRfc3RhcnR9JylcbiAgICAgICAgcmV0dXJuIHNlbGYucmVwbGFjZV9saW5lcyhvcmlnaW5hbF9jb2RlLCBhZGp1c3RlZF9zdGFydCwgZW5kX2xpbmUsICcnKVxuLi4uXG4iLCJpc19lcnJvciI6ZmFsc2UsInJlcXVlc3RfaWQiOiIiLCJ0b29sX3VzZV9pZCI6InRvb2x1X3ZydHhfMDFTeTRlRFFrSkVGTDI1YjZkU1lZWnRjIn19LHsiaWQiOjIsInR5cGUiOjQsImlkZV9zdGF0ZV9ub2RlIjp7IndvcmtzcGFjZUZvbGRlcnMiOlt7InJlcG9zaXRvcnlSb290IjoiRDovY29kZS9Db2RlSGVtIiwiZm9sZGVyUm9vdCI6IkQ6L2NvZGUvQ29kZUhlbSJ9XSwid29ya3NwYWNlRm9sZGVyc1VuY2hhbmdlZCI6ZmFsc2V9fV0sInJlc3BvbnNlX3RleHQiOiIiLCJ3b3Jrc3BhY2VfZmlsZV9jaHVua3MiOltdfSx7InN0YXR1cyI6InN1Y2Nlc3MiLCJyZXF1ZXN0X2lkIjoiNjgwMWY4M2YtZjgzYi00MmU4LTg3MzQtOWViOTg5NTZlZDA4IiwicmVxdWVzdF9tZXNzYWdlIjoiIiwic3RydWN0dXJlZF9vdXRwdXRfbm9kZXMiOlt7ImlkIjowLCJ0eXBlIjowLCJjb250ZW50IjoiIyMgUHl0aG9uIEFTVCBNYW5pcHVsYXRvciAtIFd5amHFm25pZW5pZVxuXG5QeXRob24gQVNUIE1hbmlwdWxhdG9yIHRvIHphYXdhbnNvd2FueSBrb21wb25lbnQgdyBDb2RlSGVtLCBrdMOzcnkgc8WCdcW8eSBkbyBtYW5pcHVsYWNqaSBrb2RlbSBQeXRob24gcHJ6eSB1xbx5Y2l1IEFic3RyYWN0IFN5bnRheCBUcmVlIChBU1QpLiBPdG8gc3pjemVnw7PFgm93ZSB3eWphxZtuaWVuaWU6XG5cbiMjIyBDenltIGplc3QgUHl0aG9uIEFTVCBNYW5pcHVsYXRvclxuXG5QeXRob24gQVNUIE1hbmlwdWxhdG9yIHRvIHNwZWNqYWxpc3R5Y3pueSBtYW5pcHVsYXRvciwga3TDs3J5IHd5a29yenlzdHVqZSBtb2R1xYIgYGFzdGAgeiBiaWJsaW90ZWtpIHN0YW5kYXJkb3dlaiBQeXRob25hIGRvIGFuYWxpenkgaSBtb2R5ZmlrYWNqaSBrb2R1IMW6csOzZMWCb3dlZ28gbmEgcG96aW9taWUgZHJ6ZXdhIHNrxYJhZG5pb3dlZ28uIFcgcHJ6ZWNpd2llxYRzdHdpZSBkbyBwcm9zdHN6eWNoIG1hbmlwdWxhdG9yw7N3IG9wYXJ0eWNoIG5hIHRla8WbY2llLCBBU1QgTWFuaXB1bGF0b3I6XG5cbjEuICoqUGFyc3VqZSBrb2QgZG8gZHJ6ZXdhIEFTVCoqIC0ga29ud2VydHVqZSBrb2Qgxbpyw7NkxYJvd3kgbmEgc3RydWt0dXLEmSBkcnpld2EsIGt0w7NyYSByZXByZXplbnR1amUgamVnbyBza8WCYWRuacSZXG4yLiAqKk1vZHlmaWt1amUgZHJ6ZXdvIEFTVCoqIC0gZG9kYWplLCB1c3V3YSBsdWIgem1pZW5pYSB3xJl6xYJ5IHcgZHJ6ZXdpZVxuMy4gKipLb253ZXJ0dWplIHptb2R5Zmlrb3dhbmUgZHJ6ZXdvIHogcG93cm90ZW0gbmEga29kKiogLSB1xbx5d2FqxIVjIGZ1bmtjamkgYGFzdC51bnBhcnNlKClgXG5cbiMjIyBHxYLDs3duZSBrb21wb25lbnR5XG5cbjEuICoqUmVwbGFjZU9ySW5zZXJ0VHJhbnNmb3JtZXIqKiAobGluaWUgOS0yODUpOlxuICAgLSBLbGFzYSBkemllZHppY3rEhWNhIHBvIGBhc3QuTm9kZVRyYW5zZm9ybWVyYFxuICAgLSBPZHBvd2lhZGEgemEgcHJ6ZWNob2R6ZW5pZSBwcnpleiBkcnpld28gQVNUIGkgd3lrb255d2FuaWUgb3BlcmFjamkgemFzdMSZcG93YW5pYSBsdWIgd3N0YXdpYW5pYSB3xJl6xYLDs3dcbiAgIC0gWmF3aWVyYSBsb2dpa8SZIGRvIGlkZW50eWZpa2Fjamkgd8SZesWCw7N3IGRvY2Vsb3d5Y2ggaSBva3JlxZtsYW5pYSBwdW5rdMOzdyB3c3Rhd2lhbmlhXG5cbjIuICoqUHl0aG9uQVNUTWFuaXB1bGF0b3IqKiAobGluaWUgMjg3LTQ4OCk6XG4gICAtIEltcGxlbWVudGFjamEgYE1hbmlwdWxhdG9yQmFzZWAgdcW8eXdhasSFY2EgQVNUXG4gICAtIFphcGV3bmlhIG1ldG9keSB3eXNva2llZ28gcG96aW9tdSBkbyBtYW5pcHVsYWNqaSBrb2RlbTpcbiAgICAgLSBgdXBzZXJ0X2VsZW1lbnRgIC0gZG9kYWplIGx1YiB6YXN0xJlwdWplIGVsZW1lbnQga29kdVxuICAgICAtIGBhZGRfZWxlbWVudGAgLSBkb2RhamUgbm93eSBlbGVtZW50XG4gICAgIC0gYHJlcGxhY2VfZWxlbWVudGAgLSB6YXN0xJlwdWplIGlzdG5pZWrEhWN5IGVsZW1lbnRcbiAgICAgLSBgcmVtb3ZlX2VsZW1lbnRgIC0gdXN1d2EgZWxlbWVudFxuICAgICAtIGB1cHNlcnRfZWxlbWVudF9ieV94cGF0aGAgLSBkb2RhamUgbHViIHphc3TEmXB1amUgZWxlbWVudCB1xbx5d2FqxIVjIHd5cmHFvGVuaWEgWFBhdGhcblxuIyMjIEphayBkemlhxYJhXG5cbjEuICoqQW5hbGl6YSBrb2R1IMW6csOzZMWCb3dlZ28qKjpcbiAgIGBgYHB5dGhvblxuICAgb3JpZ2luYWxfdHJlZSA9IGFzdC5maXhfbWlzc2luZ19sb2NhdGlvbnMoYXN0LnBhcnNlKG9yaWdpbmFsX2NvZGUpKVxuICAgYGBgXG5cbjIuICoqSWRlbnR5ZmlrYWNqYSBlbGVtZW50dSBkbyBtb2R5ZmlrYWNqaSoqOlxuICAgLSBabmFqZHVqZSBlbGVtZW50IHcga29kemllIHXFvHl3YWrEhWMgdXPFgnVnaSBla3N0cmFrY2ppXG4gICAtIE9rcmXFm2xhIGplZ28gcG96eWNqxJkgKG51bWVyeSBsaW5paSlcbiAgIC0gSWRlbnR5ZmlrdWplIHR5cCBlbGVtZW50dSAoZnVua2NqYSwga2xhc2EsIG1ldG9kYSwgaW1wb3J0KVxuXG4zLiAqKlRyYW5zZm9ybWFjamEgQVNUKio6XG4gICBgYGBweXRob25cbiAgIHRyYW5zZm9ybWVyID0gUmVwbGFjZU9ySW5zZXJ0VHJhbnNmb3JtZXIoLi4uKVxuICAgbW9kaWZpZWRfdHJlZSA9IHRyYW5zZm9ybWVyLnZpc2l0KG9yaWdpbmFsX3RyZWUpXG4gICBgYGBcblxuNC4gKipLb253ZXJzamEgeiBwb3dyb3RlbSBuYSBrb2QqKjpcbiAgIGBgYHB5dGhvblxuICAgbmV3X3NvdXJjZSA9IGFzdC51bnBhcnNlKG1vZGlmaWVkX3RyZWUpXG4gICBgYGBcblxuIyMjIFphbGV0eSBwb2RlasWbY2lhIEFTVFxuXG4xLiAqKsWad2lhZG9tb8WbxIcgc2vFgmFkbmkqKiAtIG1hbmlwdWxhY2plIHPEhSB3eWtvbnl3YW5lIHogcGXFgm55bSB6cm96dW1pZW5pZW0gc3RydWt0dXJ5IGtvZHVcbjIuICoqT2Rwb3Jub8WbxIcgbmEgYsWCxJlkeSoqIC0gbW5pZWpzemUgcnl6eWtvIHVzemtvZHplbmlhIGtvZHVcbjMuICoqT2JzxYJ1Z2EgesWCb8W8b255Y2ggcHJ6eXBhZGvDs3cqKiAtIG5wLiBibG9raSBpbXBvcnTDs3csIGRla29yYXRvcnksIHfFgmHFm2Npd2/Fm2NpXG40LiAqKlphY2hvd2FuaWUgZm9ybWF0b3dhbmlhKiogLSBsZXBzemUgemFjaG93YW5pZSBzdHJ1a3R1cnkga29kdVxuXG4jIyMgSW50ZWdyYWNqYSB6IHN5c3RlbWVtXG5cblcgcGxpa3UgYGNvZGVoZW0vbGFuZ3VhZ2VzL2xhbmdfcHl0aG9uL19faW5pdF9fLnB5YCB3aWRhxIcsIMW8ZSBQeXRob24gQVNUIE1hbmlwdWxhdG9yIGplc3QgcmVqZXN0cm93YW55IGRsYSByw7PFvG55Y2ggdHlww7N3IGVsZW1lbnTDs3cga29kdTpcblxuYGBgcHl0aG9uXG4jIFJlZ2lzdGVyIEFTVCBtYW5pcHVsYXRvcnMgZm9yIGZ1bmN0aW9uLCBjbGFzcywgaW1wb3J0XG5mb3IgZWxlbWVudF90eXBlX2VudW0gaW4gW1xuICAgIENvZGVFbGVtZW50VHlwZS5GVU5DVElPTixcbiAgICBDb2RlRWxlbWVudFR5cGUuQ0xBU1MsXG4gICAgQ29kZUVsZW1lbnRUeXBlLklNUE9SVCxcbl06XG4gICAgIyAuLi5cbiAgICByZWdpc3RyeS5yZWdpc3Rlcl9tYW5pcHVsYXRvcihXcmFwcGVyKVxuYGBgXG5cblB5dGhvbiBBU1QgTWFuaXB1bGF0b3Igc3Rhbm93aSB3acSZYyB6YWF3YW5zb3dhbsSFIGFsdGVybmF0eXfEmSBkbGEgcHJvc3RzenljaCBtYW5pcHVsYXRvcsOzdyBvcGFydHljaCBuYSB0ZWvFm2NpZSwgemFwZXduaWFqxIVjIGJhcmR6aWVqIG5pZXphd29kbmUgaSBwcmVjeXp5am5lIG1vZHlmaWthY2plIGtvZHUgUHl0aG9uLlxuIn0seyJpZCI6MiwidHlwZSI6MiwiY29udGVudCI6IiJ9LHsiaWQiOjMsInR5cGUiOjMsImNvbnRlbnQiOiIifV0sInNlZW5fc3RhdGUiOiJzZWVuIiwic3RydWN0dXJlZF9yZXF1ZXN0X25vZGVzIjpbeyJpZCI6MSwidHlwZSI6MSwidG9vbF9yZXN1bHRfbm9kZSI6eyJjb250ZW50IjoiSGVyZSdzIHRoZSByZXN1bHQgb2YgcnVubmluZyBgY2F0IC1uYCBvbiBjb2RlaGVtL2xhbmd1YWdlcy9sYW5nX3B5dGhvbi9weXRob25fYXN0X21hbmlwdWxhdG9yLnB5OlxuICAgICAxXHRpbXBvcnQgYXN0XG4gICAgIDJcdGltcG9ydCBsb2dnaW5nXG4gICAgIDNcdGZyb20gdHlwaW5nIGltcG9ydCBPcHRpb25hbCwgTGlzdCwgVHVwbGUsIFVuaW9uLCBBbnlcbiAgICAgNFx0ZnJvbSBjb2RlaGVtLmNvcmUubWFuaXB1bGF0b3JzLm1hbmlwdWxhdG9yX2Jhc2UgaW1wb3J0IE1hbmlwdWxhdG9yQmFzZVxuICAgICA1XHRmcm9tIGNvZGVoZW0ubW9kZWxzLmVudW1zIGltcG9ydCBDb2RlRWxlbWVudFR5cGVcbiAgICAgNlx0XG4gICAgIDdcdGxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKVxuICAgICA4XHRcbiAgICAgOVx0Y2xhc3MgUmVwbGFjZU9ySW5zZXJ0VHJhbnNmb3JtZXIoYXN0Lk5vZGVUcmFuc2Zvcm1lcik6XG4gICAgMTBcdCAgICBcIlwiXCJcbiAgICAxMVx0ICAgIEFTVCBUcmFuc2Zvcm1lciB0byByZXBsYWNlIGEgbm9kZSBhdCBhIHNwZWNpZmljIGxvY2F0aW9uIG9yIGluc2VydCBub2Rlc1xuICAgIDEyXHQgICAgaW50byBhIHBhcmVudCBub2RlJ3MgYm9keS4gKFZlcnNpb24gMzogSW1wcm92ZWQgcmVwbGFjZW1lbnQsIGltcG9ydCBibG9jayBoYW5kbGluZylcbiAgICAxM1x0ICAgIFwiXCJcIlxuICAgIDE0XHQgICAgZGVmIF9faW5pdF9fKHNlbGYsXG4gICAgMTVcdCAgICAgICAgICAgICAgICAgdGFyZ2V0X3N0YXJ0X2xpbmU6IE9wdGlvbmFsW2ludF0sXG4gICAgMTZcdCAgICAgICAgICAgICAgICAgdGFyZ2V0X2VuZF9saW5lOiBPcHRpb25hbFtpbnRdLFxuICAgIDE3XHQgICAgICAgICAgICAgICAgIG5ld19ub2RlczogTGlzdFthc3QuQVNUXSxcbiAgICAxOFx0ICAgICAgICAgICAgICAgICBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXSxcbiAgICAxOVx0ICAgICAgICAgICAgICAgICBlbGVtZW50X3R5cGU6IENvZGVFbGVtZW50VHlwZSxcbiAgICAyMFx0ICAgICAgICAgICAgICAgICB0YXJnZXRfbmFtZTogc3RyKTpcbiAgICAyMVx0ICAgICAgICBzdXBlcigpLl9faW5pdF9fKClcbiAgICAyMlx0ICAgICAgICBzZWxmLnRhcmdldF9zdGFydF9saW5lID0gdGFyZ2V0X3N0YXJ0X2xpbmVcbiAgICAyM1x0ICAgICAgICBzZWxmLnRhcmdldF9lbmRfbGluZSA9IHRhcmdldF9lbmRfbGluZVxuICAgIDI0XHQgICAgICAgIHNlbGYubmV3X25vZGVzID0gbmV3X25vZGVzXG4gICAgMjVcdCAgICAgICAgc2VsZi5wYXJlbnRfbmFtZSA9IHBhcmVudF9uYW1lXG4gICAgMjZcdCAgICAgICAgc2VsZi5lbGVtZW50X3R5cGUgPSBlbGVtZW50X3R5cGVcbiAgICAyN1x0ICAgICAgICBzZWxmLnRhcmdldF9uYW1lID0gdGFyZ2V0X25hbWUgIyBOYW1lIG9mIHRoZSBlbGVtZW50IHRvIHJlcGxhY2UvaW5zZXJ0ICgnYWxsJyBmb3IgaW1wb3J0IGJsb2NrKVxuICAgIDI4XHQgICAgICAgIHNlbGYuaXNfcmVwbGFjaW5nID0gdGFyZ2V0X3N0YXJ0X2xpbmUgaXMgbm90IE5vbmVcbiAgICAyOVx0ICAgICAgICBzZWxmLmlzX2ltcG9ydF9ibG9ja19yZXBsYWNlID0gKHNlbGYuaXNfcmVwbGFjaW5nIGFuZFxuICAgIDMwXHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5lbGVtZW50X3R5cGUgPT0gQ29kZUVsZW1lbnRUeXBlLklNUE9SVCBhbmRcbiAgICAzMVx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGFyZ2V0X25hbWUgPT0gJ2FsbCcpICMgU3BlY2lmaWMgZmxhZyBmb3IgaW1wb3J0IGJsb2NrXG4gICAgMzJcdCAgICAgICAgc2VsZi5vcGVyYXRpb25fZG9uZSA9IEZhbHNlICMgVHJhY2sgaWYgcmVwbGFjZW1lbnQgb3IgaW5zZXJ0aW9uIHdhcyBwZXJmb3JtZWRcbiAgICAzM1x0XG4gICAgMzRcdCAgICBkZWYgX2NoZWNrX3Byb3BlcnR5X2RlY29yYXRvcihzZWxmLCBub2RlOiBVbmlvblthc3QuRnVuY3Rpb25EZWYsIGFzdC5Bc3luY0Z1bmN0aW9uRGVmXSwgZGVjb3JhdG9yX3R5cGU6IHN0cikgLT4gYm9vbDpcbiAgICAzNVx0ICAgICAgICBcIlwiXCJDaGVja3MgZm9yIHNwZWNpZmljIHByb3BlcnR5IGRlY29yYXRvcnMgKEBwcm9wZXJ0eSwgQG5hbWUuc2V0dGVyKS5cIlwiXCJcbiAgICAzNlx0ICAgICAgICBpZiBub3QgaGFzYXR0cihub2RlLCAnZGVjb3JhdG9yX2xpc3QnKTpcbiAgICAzN1x0ICAgICAgICAgICAgcmV0dXJuIEZhbHNlXG4gICAgMzhcdCAgICAgICAgZm9yIGQgaW4gbm9kZS5kZWNvcmF0b3JfbGlzdDpcbiAgICAzOVx0ICAgICAgICAgICAgaWYgZGVjb3JhdG9yX3R5cGUgPT0gJ2dldHRlcic6XG4gICAgNDBcdCAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGQsIGFzdC5OYW1lKSBhbmQgZC5pZCA9PSAncHJvcGVydHknOlxuICAgIDQxXHQgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlXG4gICAgNDJcdCAgICAgICAgICAgIGVsaWYgZGVjb3JhdG9yX3R5cGUgPT0gJ3NldHRlcic6XG4gICAgNDNcdCAgICAgICAgICAgICAgICAgIyBNYXRjaCBAPHRhcmdldF9uYW1lPi5zZXR0ZXIgLSBlbnN1cmUgdGFyZ2V0X25hbWUgaXMgdmFsaWQgZm9yIHRoaXMgY2hlY2tcbiAgICA0NFx0ICAgICAgICAgICAgICAgIGlmIHNlbGYudGFyZ2V0X25hbWUgYW5kIGlzaW5zdGFuY2UoZCwgYXN0LkF0dHJpYnV0ZSkgYW5kIGQuYXR0ciA9PSAnc2V0dGVyJzpcbiAgICA0NVx0ICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGQudmFsdWUsIGFzdC5OYW1lKSBhbmQgZC52YWx1ZS5pZCA9PSBzZWxmLnRhcmdldF9uYW1lOlxuICAgIDQ2XHQgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWVcbiAgICA0N1x0ICAgICAgICByZXR1cm4gRmFsc2VcbiAgICA0OFx0XG4gICAgNDlcdCAgICBkZWYgX2lzX3RhcmdldF9ub2RlKHNlbGYsIG5vZGU6IGFzdC5BU1QpIC0+IGJvb2w6XG4gICAgNTBcdCAgICAgICAgXCJcIlwiQ2hlY2sgaWYgdGhlIG5vZGUgbWF0Y2hlcyB0aGUgdGFyZ2V0IGZvciByZXBsYWNlbWVudCAoZXhjbHVkaW5nIGltcG9ydCBibG9ja3MpLlwiXCJcIlxuICAgIDUxXHQgICAgICAgICMgVGhpcyBtZXRob2Qgc2hvdWxkIE5PVCBiZSB1c2VkIGZvciBpbXBvcnQgYmxvY2sgcmVwbGFjZW1lbnQgbG9naWMuXG4gICAgNTJcdCAgICAgICAgaWYgbm90IHNlbGYuaXNfcmVwbGFjaW5nIG9yIHNlbGYuaXNfaW1wb3J0X2Jsb2NrX3JlcGxhY2U6XG4gICAgNTNcdCAgICAgICAgICAgIHJldHVybiBGYWxzZVxuICAgIDU0XHQgICAgICAgIGlmIG5vdCBoYXNhdHRyKG5vZGUsICdsaW5lbm8nKTogcmV0dXJuIEZhbHNlXG4gICAgNTVcdFxuICAgIDU2XHQgICAgICAgICMgLS0tIFByaW1hcnkgQ2hlY2s6IFN0YXJ0IExpbmUgLS0tXG4gICAgNTdcdCAgICAgICAgIyBBbGxvdyBzbGlnaHQgZGlmZiBpZiBkZWNvcmF0b3JzIG1pZ2h0IGFmZmVjdCB0aGUgRnVuY3Rpb25EZWYvQ2xhc3NEZWYgbGluZW5vXG4gICAgNThcdCAgICAgICAgbGluZV9tYXRjaCA9IEZhbHNlXG4gICAgNTlcdCAgICAgICAgaWYgbm9kZS5saW5lbm8gPT0gc2VsZi50YXJnZXRfc3RhcnRfbGluZTpcbiAgICA2MFx0ICAgICAgICAgICAgbGluZV9tYXRjaCA9IFRydWVcbiAgICA2MVx0ICAgICAgICBlbGlmIGhhc2F0dHIobm9kZSwgJ2RlY29yYXRvcl9saXN0JykgYW5kIG5vZGUuZGVjb3JhdG9yX2xpc3Q6XG4gICAgNjJcdCAgICAgICAgICAgICAjIENoZWNrIGlmIG5vZGUgc3RhcnRzIHNob3J0bHkgYWZ0ZXIgdGFyZ2V0IGlmIGRlY29yYXRvcnMgYXJlIHByZXNlbnRcbiAgICA2M1x0ICAgICAgICAgICAgIGlmIG5vZGUubGluZW5vID4gc2VsZi50YXJnZXRfc3RhcnRfbGluZSBhbmQgKG5vZGUubGluZW5vIC0gc2VsZi50YXJnZXRfc3RhcnRfbGluZSkgPD0gbGVuKG5vZGUuZGVjb3JhdG9yX2xpc3QpOlxuICAgIDY0XHQgICAgICAgICAgICAgICAgICAgbGluZV9tYXRjaCA9IFRydWVcbiAgICA2NVx0ICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJBY2NlcHRpbmcgbm9kZSB7Z2V0YXR0cihub2RlLCAnbmFtZScsIHR5cGUobm9kZSkuX19uYW1lX18pfSBhdCBsaW5lIHtub2RlLmxpbmVub30gZm9yIHRhcmdldCBsaW5lIHtzZWxmLnRhcmdldF9zdGFydF9saW5lfSBkdWUgdG8gZGVjb3JhdG9ycy5cIilcbiAgICA2Nlx0XG4gICAgNjdcdCAgICAgICAgaWYgbm90IGxpbmVfbWF0Y2g6IHJldHVybiBGYWxzZVxuICAgIDY4XHRcbiAgICA2OVx0ICAgICAgICAjIC0tLSBTZWNvbmRhcnkgQ2hlY2s6IFR5cGUgYW5kIE5hbWUgLS0tXG4gICAgNzBcdCAgICAgICAgbm9kZV9uYW1lID0gZ2V0YXR0cihub2RlLCAnbmFtZScsIE5vbmUpXG4gICAgNzFcdFxuICAgIDcyXHQgICAgICAgIGlmIGlzaW5zdGFuY2Uobm9kZSwgKGFzdC5GdW5jdGlvbkRlZiwgYXN0LkFzeW5jRnVuY3Rpb25EZWYpKTpcbiAgICA3M1x0ICAgICAgICAgICAgaWYgbm9kZV9uYW1lICE9IHNlbGYudGFyZ2V0X25hbWU6IHJldHVybiBGYWxzZVxuICAgIDc0XHQgICAgICAgICAgICBpZiBzZWxmLmVsZW1lbnRfdHlwZSA9PSBDb2RlRWxlbWVudFR5cGUuUFJPUEVSVFlfR0VUVEVSOlxuICAgIDc1XHQgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NoZWNrX3Byb3BlcnR5X2RlY29yYXRvcihub2RlLCAnZ2V0dGVyJylcbiAgICA3Nlx0ICAgICAgICAgICAgZWxpZiBzZWxmLmVsZW1lbnRfdHlwZSA9PSBDb2RlRWxlbWVudFR5cGUuUFJPUEVSVFlfU0VUVEVSOlxuICAgIDc3XHQgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NoZWNrX3Byb3BlcnR5X2RlY29yYXRvcihub2RlLCAnc2V0dGVyJylcbiAgICA3OFx0ICAgICAgICAgICAgZWxpZiBzZWxmLmVsZW1lbnRfdHlwZSBpbiAoQ29kZUVsZW1lbnRUeXBlLkZVTkNUSU9OLCBDb2RlRWxlbWVudFR5cGUuTUVUSE9EKTpcbiAgICA3OVx0ICAgICAgICAgICAgICAgICBpc19wcm9wID0gc2VsZi5fY2hlY2tfcHJvcGVydHlfZGVjb3JhdG9yKG5vZGUsICdnZXR0ZXInKSBvciBzZWxmLl9jaGVja19wcm9wZXJ0eV9kZWNvcmF0b3Iobm9kZSwgJ3NldHRlcicpXG4gICAgODBcdCAgICAgICAgICAgICAgICAgcmV0dXJuIG5vdCBpc19wcm9wXG4gICAgODFcdCAgICAgICAgICAgIGVsc2U6IHJldHVybiBGYWxzZVxuICAgIDgyXHRcbiAgICA4M1x0ICAgICAgICBlbGlmIGlzaW5zdGFuY2Uobm9kZSwgYXN0LkNsYXNzRGVmKTpcbiAgICA4NFx0ICAgICAgICAgICAgcmV0dXJuIHNlbGYuZWxlbWVudF90eXBlID09IENvZGVFbGVtZW50VHlwZS5DTEFTUyBhbmQgbm9kZV9uYW1lID09IHNlbGYudGFyZ2V0X25hbWVcbiAgICA4NVx0XG4gICAgODZcdCAgICAgICAgZWxpZiBpc2luc3RhbmNlKG5vZGUsIGFzdC5Bc3NpZ24pOlxuICAgIDg3XHQgICAgICAgICAgICAgdGFyZ2V0cyA9IGdldGF0dHIobm9kZSwgJ3RhcmdldHMnLCBbXSlcbiAgICA4OFx0ICAgICAgICAgICAgIGlzX3N0YXRpY19wcm9wX21hdGNoID0gYW55KGlzaW5zdGFuY2UodCwgYXN0Lk5hbWUpIGFuZCB0LmlkID09IHNlbGYudGFyZ2V0X25hbWUgZm9yIHQgaW4gdGFyZ2V0cylcbiAgICA4OVx0ICAgICAgICAgICAgIHJldHVybiBzZWxmLmVsZW1lbnRfdHlwZSA9PSBDb2RlRWxlbWVudFR5cGUuU1RBVElDX1BST1BFUlRZIGFuZCBpc19zdGF0aWNfcHJvcF9tYXRjaFxuICAgIDkwXHRcbiAgICA5MVx0ICAgICAgICAjIEltcG9ydHMgYXJlIGhhbmRsZWQgYnkgdmlzaXRfTW9kdWxlL3Zpc2l0X2xpc3QgZm9yIGJsb2Nrc1xuICAgIDkyXHQgICAgICAgIGVsaWYgaXNpbnN0YW5jZShub2RlLCAoYXN0LkltcG9ydCwgYXN0LkltcG9ydEZyb20pKTpcbiAgICA5M1x0ICAgICAgICAgICAgIHJldHVybiBzZWxmLmVsZW1lbnRfdHlwZSA9PSBDb2RlRWxlbWVudFR5cGUuSU1QT1JUIGFuZCBub3Qgc2VsZi5pc19pbXBvcnRfYmxvY2tfcmVwbGFjZVxuICAgIDk0XHRcbiAgICA5NVx0ICAgICAgICBsb2dnZXIuZGVidWcoZlwiTm9kZSB0eXBlIHt0eXBlKG5vZGUpLl9fbmFtZV9ffSBhdCBsaW5lIHtub2RlLmxpbmVub30gZGlkIG5vdCBtYXRjaCBleHBlY3RlZCBsb2dpYyBmb3IgdGFyZ2V0IHtzZWxmLnRhcmdldF9uYW1lfSAoe3NlbGYuZWxlbWVudF90eXBlLnZhbHVlfSlcIilcbiAgICA5Nlx0ICAgICAgICByZXR1cm4gRmFsc2VcbiAgICA5N1x0XG4gICAgOThcdCAgICBkZWYgX2ZpbmRfaW5zZXJ0aW9uX3BvaW50KHNlbGYsIGJvZHk6IExpc3RbYXN0LkFTVF0pIC0+IGludDpcbiAgICA5OVx0ICAgICAgICBcIlwiXCJEZXRlcm1pbmUgd2hlcmUgdG8gaW5zZXJ0IHRoZSBuZXcgbm9kZShzKS4gKEltcHJvdmVkIHBsYWNlbWVudClcIlwiXCJcbiAgIDEwMFx0ICAgICAgICBpbnNlcnRfcG9zID0gbGVuKGJvZHkpICMgRGVmYXVsdDogYXBwZW5kIGF0IHRoZSBlbmRcbiAgIDEwMVx0XG4gICAxMDJcdCAgICAgICAgZGVmIGZpbmRfYWZ0ZXJfbGFzdChub2RlX3R5cGVzOiB0dXBsZSkgLT4gaW50OlxuICAgMTAzXHQgICAgICAgICAgICBsYXN0X3BvcyA9IC0xXG4gICAxMDRcdCAgICAgICAgICAgIGZvciBpLCBub2RlIGluIGVudW1lcmF0ZShib2R5KTpcbiAgIDEwNVx0ICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uobm9kZSwgbm9kZV90eXBlcyk6XG4gICAxMDZcdCAgICAgICAgICAgICAgICAgICAgbGFzdF9wb3MgPSBpXG4gICAxMDdcdCAgICAgICAgICAgIHJldHVybiBsYXN0X3BvcyArIDFcbiAgIDEwOFx0XG4gICAxMDlcdCAgICAgICAgaWYgc2VsZi5lbGVtZW50X3R5cGUgPT0gQ29kZUVsZW1lbnRUeXBlLklNUE9SVDpcbiAgIDExMFx0ICAgICAgICAgICAgaW5zZXJ0X3BvcyA9IDBcbiAgIDExMVx0ICAgICAgICAgICAgaWYgYm9keSBhbmQgaXNpbnN0YW5jZShib2R5WzBdLCBhc3QuRXhwcikgYW5kIGlzaW5zdGFuY2UoYm9keVswXS52YWx1ZSwgYXN0LkNvbnN0YW50KSBhbmQgaXNpbnN0YW5jZShib2R5WzBdLnZhbHVlLnZhbHVlLCBzdHIpOlxuICAgMTEyXHQgICAgICAgICAgICAgICAgaW5zZXJ0X3BvcyA9IDFcbiAgIDExM1x0ICAgICAgICAgICAgd2hpbGUgaW5zZXJ0X3BvcyA8IGxlbihib2R5KSBhbmQgaXNpbnN0YW5jZShib2R5W2luc2VydF9wb3NdLCAoYXN0LkltcG9ydCwgYXN0LkltcG9ydEZyb20pKTpcbiAgIDExNFx0ICAgICAgICAgICAgICAgIGluc2VydF9wb3MgKz0gMVxuICAgMTE1XHQgICAgICAgICAgICBsb2dnZXIuZGVidWcoZlwiQ2FsY3VsYXRlZCBpbnNlcnRpb24gcG9pbnQgZm9yIElNUE9SVDoge2luc2VydF9wb3N9XCIpXG4gICAxMTZcdFxuICAgMTE3XHQgICAgICAgIGVsaWYgc2VsZi5wYXJlbnRfbmFtZSBpcyBub3QgTm9uZTogIyBJbnNlcnRpbmcgaW50byBhIGNsYXNzXG4gICAxMThcdCAgICAgICAgICAgIGluc2VydF9wb3MgPSAwXG4gICAxMTlcdCAgICAgICAgICAgIGlmIGJvZHkgYW5kIGlzaW5zdGFuY2UoYm9keVswXSwgYXN0LkV4cHIpIGFuZCBpc2luc3RhbmNlKGJvZHlbMF0udmFsdWUsIGFzdC5Db25zdGFudCkgYW5kIGlzaW5zdGFuY2UoYm9keVswXS52YWx1ZS52YWx1ZSwgc3RyKTpcbiAgIDEyMFx0ICAgICAgICAgICAgICAgIGluc2VydF9wb3MgPSAxXG4gICAxMjFcdCAgICAgICAgICAgICMgU3RhdGljIHByb3BlcnRpZXMgcmlnaHQgYWZ0ZXIgZG9jc3RyaW5nXG4gICAxMjJcdCAgICAgICAgICAgIHdoaWxlIGluc2VydF9wb3MgPCBsZW4oYm9keSkgYW5kIGlzaW5zdGFuY2UoYm9keVtpbnNlcnRfcG9zXSwgYXN0LkFzc2lnbik6XG4gICAxMjNcdCAgICAgICAgICAgICAgICBpbnNlcnRfcG9zICs9IDFcbiAgIDEyNFx0ICAgICAgICAgICAgaWYgc2VsZi5lbGVtZW50X3R5cGUgPT0gQ29kZUVsZW1lbnRUeXBlLlNUQVRJQ19QUk9QRVJUWTpcbiAgIDEyNVx0ICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZlwiQ2FsY3VsYXRlZCBpbnNlcnRpb24gcG9pbnQgZm9yIFNUQVRJQ19QUk9QRVJUWSBpbiBjbGFzczoge2luc2VydF9wb3N9XCIpXG4gICAxMjZcdCAgICAgICAgICAgICAgICAgcmV0dXJuIGluc2VydF9wb3NcbiAgIDEyN1x0XG4gICAxMjhcdCAgICAgICAgICAgICMgTWV0aG9kcy9Qcm9wZXJ0aWVzIHVzdWFsbHkgZ28gYXQgdGhlIGVuZCwgYnV0IGJlZm9yZSBpbm5lciBjbGFzc2VzIGlmIGFueT8gS2VlcCBpdCBzaW1wbGU6IGVuZC5cbiAgIDEyOVx0ICAgICAgICAgICAgaW5zZXJ0X3BvcyA9IGxlbihib2R5KVxuICAgMTMwXHQgICAgICAgICAgICBsb2dnZXIuZGVidWcoZlwiQ2FsY3VsYXRlZCBpbnNlcnRpb24gcG9pbnQgZm9yIHtzZWxmLmVsZW1lbnRfdHlwZS52YWx1ZX0gaW4gY2xhc3M6IHtpbnNlcnRfcG9zfVwiKVxuICAgMTMxXHRcbiAgIDEzMlx0ICAgICAgICBlbGlmIHNlbGYuZWxlbWVudF90eXBlID09IENvZGVFbGVtZW50VHlwZS5GVU5DVElPTiBvciBzZWxmLmVsZW1lbnRfdHlwZSA9PSBDb2RlRWxlbWVudFR5cGUuQ0xBU1M6XG4gICAxMzNcdCAgICAgICAgICAgIGluc2VydF9wb3MgPSBmaW5kX2FmdGVyX2xhc3QoKGFzdC5JbXBvcnQsIGFzdC5JbXBvcnRGcm9tKSlcbiAgIDEzNFx0ICAgICAgICAgICAgaWYgYm9keSBhbmQgaXNpbnN0YW5jZShib2R5WzBdLCBhc3QuRXhwcikgYW5kIGlzaW5zdGFuY2UoYm9keVswXS52YWx1ZSwgYXN0LkNvbnN0YW50KSBhbmQgaXNpbnN0YW5jZShib2R5WzBdLnZhbHVlLnZhbHVlLCBzdHIpOlxuICAgMTM1XHQgICAgICAgICAgICAgICAgIGluc2VydF9wb3MgPSBtYXgoMSwgaW5zZXJ0X3BvcykgIyBFbnN1cmUgYWZ0ZXIgZG9jc3RyaW5nXG4gICAxMzZcdFxuICAgMTM3XHQgICAgICAgICAgICBsYXN0X2RlZl9wb3MgPSAtMVxuICAgMTM4XHQgICAgICAgICAgICBmb3IgaSwgbm9kZSBpbiBlbnVtZXJhdGUoYm9keSk6XG4gICAxMzlcdCAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShub2RlLCAoYXN0LkZ1bmN0aW9uRGVmLCBhc3QuQXN5bmNGdW5jdGlvbkRlZiwgYXN0LkNsYXNzRGVmKSk6XG4gICAxNDBcdCAgICAgICAgICAgICAgICAgICAgIGxhc3RfZGVmX3BvcyA9IGlcbiAgIDE0MVx0ICAgICAgICAgICAgaWYgbGFzdF9kZWZfcG9zICE9IC0xOlxuICAgMTQyXHQgICAgICAgICAgICAgICAgICAjIEZpbmQgdGhlIGFjdHVhbCBpbmRleCAqYWZ0ZXIqIHRoZSBsYXN0IGRlZmluaXRpb24gYmxvY2tcbiAgIDE0M1x0ICAgICAgICAgICAgICAgICAgcG90ZW50aWFsX3BvcyA9IGxhc3RfZGVmX3BvcyArIDFcbiAgIDE0NFx0ICAgICAgICAgICAgICAgICAgIyBTaW1wbGUgYXBwZW5kIGFmdGVyIGxhc3Qgc2VlbXMgc3VmZmljaWVudCBtb3N0IHRpbWVzXG4gICAxNDVcdCAgICAgICAgICAgICAgICAgIGluc2VydF9wb3MgPSBtYXgoaW5zZXJ0X3BvcywgcG90ZW50aWFsX3BvcylcbiAgIDE0Nlx0XG4gICAxNDdcdCAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJDYWxjdWxhdGVkIGluc2VydGlvbiBwb2ludCBmb3Ige3NlbGYuZWxlbWVudF90eXBlLnZhbHVlfSBhdCBtb2R1bGUgbGV2ZWw6IHtpbnNlcnRfcG9zfVwiKVxuICAgMTQ4XHRcbiAgIDE0OVx0ICAgICAgICByZXR1cm4gaW5zZXJ0X3Bvc1xuICAgMTUwXHRcbiAgIDE1MVx0ICAgIGRlZiB2aXNpdChzZWxmLCBub2RlKTpcbiAgIDE1Mlx0ICAgICAgICBcIlwiXCJWaXNpdCBub2RlcywgaGFuZGxpbmcgcmVwbGFjZW1lbnQsIHRoZW4gdmlzaXRpbmcgY2hpbGRyZW4sIHRoZW4gaW5zZXJ0aW9uLlwiXCJcIlxuICAgMTUzXHQgICAgICAgICMgMS4gSGFuZGxlIFJlcGxhY2VtZW50IChpZiBhcHBsaWNhYmxlIHRvIHRoZSBub2RlIGl0c2VsZilcbiAgIDE1NFx0ICAgICAgICBpZiBzZWxmLmlzX3JlcGxhY2luZyBhbmQgbm90IHNlbGYub3BlcmF0aW9uX2RvbmUgYW5kIHNlbGYuX2lzX3RhcmdldF9ub2RlKG5vZGUpOlxuICAgMTU1XHQgICAgICAgICAgICBsb2dnZXIuaW5mbyhmXCJSZXBsYWNpbmcgbm9kZSB7dHlwZShub2RlKS5fX25hbWVfX30gKHRhcmdldDoge3NlbGYudGFyZ2V0X25hbWV9KSBhdCBsaW5lIHtub2RlLmxpbmVub30gd2l0aCB7bGVuKHNlbGYubmV3X25vZGVzKX0gbmV3IG5vZGUocykuXCIpXG4gICAxNTZcdCAgICAgICAgICAgIHNlbGYub3BlcmF0aW9uX2RvbmUgPSBUcnVlXG4gICAxNTdcdCAgICAgICAgICAgIHJldHVybiBzZWxmLm5ld19ub2RlcyBpZiBzZWxmLm5ld19ub2RlcyBlbHNlIE5vbmUgIyBSZXR1cm4gbGlzdC9Ob25lIGZvciB2aXNpdF9saXN0XG4gICAxNThcdFxuICAgMTU5XHQgICAgICAgICMgMi4gVmlzaXQgQ2hpbGRyZW4gKGdlbmVyaWNfdmlzaXQgaGFuZGxlcyByZWN1cnNpb24pXG4gICAxNjBcdCAgICAgICAgbmV3X25vZGUgPSBzdXBlcigpLmdlbmVyaWNfdmlzaXQobm9kZSlcbiAgIDE2MVx0XG4gICAxNjJcdCAgICAgICAgIyAzLiBIYW5kbGUgSW5zZXJ0aW9uIChpZiBhcHBsaWNhYmxlIHdpdGhpbiB0aGlzIG5vZGUncyBib2R5KVxuICAgMTYzXHQgICAgICAgICMgQ2hlY2sgbm9kZSB0eXBlICphZnRlciogdmlzaXRpbmcgY2hpbGRyZW4sIGFzIGdlbmVyaWNfdmlzaXQgcmV0dXJucyB0aGUgbm9kZVxuICAgMTY0XHQgICAgICAgIGlmIG5ld19ub2RlIGlzIE5vbmU6ICMgTm9kZSBtaWdodCBoYXZlIGJlZW4gZGVsZXRlZCBieSBhIGNoaWxkIHZpc2l0b3I/IFVubGlrZWx5IGhlcmUgYnV0IHNhZmUgY2hlY2suXG4gICAxNjVcdCAgICAgICAgICAgICByZXR1cm4gTm9uZVxuICAgMTY2XHRcbiAgIDE2N1x0ICAgICAgICAjIENoZWNrIGlmIGluc2VydGlvbiBpcyBpbnRlbmRlZCBhbmQgaGFzbid0IGhhcHBlbmVkIHlldFxuICAgMTY4XHQgICAgICAgIGlmIG5vdCBzZWxmLmlzX3JlcGxhY2luZyBhbmQgbm90IHNlbGYub3BlcmF0aW9uX2RvbmU6XG4gICAxNjlcdCAgICAgICAgICAgIGlzX21vZHVsZV90YXJnZXQgPSAoc2VsZi5wYXJlbnRfbmFtZSBpcyBOb25lIGFuZCBpc2luc3RhbmNlKG5ld19ub2RlLCBhc3QuTW9kdWxlKSlcbiAgIDE3MFx0ICAgICAgICAgICAgaXNfY2xhc3NfdGFyZ2V0ID0gKHNlbGYucGFyZW50X25hbWUgaXMgbm90IE5vbmUgYW5kIGlzaW5zdGFuY2UobmV3X25vZGUsIGFzdC5DbGFzc0RlZikgYW5kIG5ld19ub2RlLm5hbWUgPT0gc2VsZi5wYXJlbnRfbmFtZSlcbiAgIDE3MVx0XG4gICAxNzJcdCAgICAgICAgICAgIGlmIGlzX21vZHVsZV90YXJnZXQgb3IgaXNfY2xhc3NfdGFyZ2V0OlxuICAgMTczXHQgICAgICAgICAgICAgICAgaWYgaGFzYXR0cihuZXdfbm9kZSwgJ2JvZHknKSBhbmQgaXNpbnN0YW5jZShuZXdfbm9kZS5ib2R5LCBsaXN0KTpcbiAgIDE3NFx0ICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmXCJBdHRlbXB0aW5nIHRvIGluc2VydCBuZXcgbm9kZXMgaW50byB7J01vZHVsZScgaWYgaXNfbW9kdWxlX3RhcmdldCBlbHNlIGYnQ2xhc3Mge3NlbGYucGFyZW50X25hbWV9J31cIilcbiAgIDE3NVx0ICAgICAgICAgICAgICAgICAgICBpbnNlcnRfcG9zID0gc2VsZi5fZmluZF9pbnNlcnRpb25fcG9pbnQobmV3X25vZGUuYm9keSlcbiAgIDE3Nlx0XG4gICAxNzdcdCAgICAgICAgICAgICAgICAgICAgIyBBZGp1c3QgbGluZSBudW1iZXJzIChzaW1wbGUgaGV1cmlzdGljKVxuICAgMTc4XHQgICAgICAgICAgICAgICAgICAgIGJhc2VfbGluZW5vID0gMVxuICAgMTc5XHQgICAgICAgICAgICAgICAgICAgIGlmIGluc2VydF9wb3MgPiAwIGFuZCBoYXNhdHRyKG5ld19ub2RlLmJvZHlbaW5zZXJ0X3Bvcy0xXSwgJ2VuZF9saW5lbm8nKSBhbmQgbmV3X25vZGUuYm9keVtpbnNlcnRfcG9zLTFdLmVuZF9saW5lbm8gaXMgbm90IE5vbmU6XG4gICAxODBcdCAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlX2xpbmVubyA9IG5ld19ub2RlLmJvZHlbaW5zZXJ0X3Bvcy0xXS5lbmRfbGluZW5vICsgMVxuICAgMTgxXHQgICAgICAgICAgICAgICAgICAgIGVsaWYgaW5zZXJ0X3BvcyA8IGxlbihuZXdfbm9kZS5ib2R5KSBhbmQgaGFzYXR0cihuZXdfbm9kZS5ib2R5W2luc2VydF9wb3NdLCAnbGluZW5vJykgYW5kIG5ld19ub2RlLmJvZHlbaW5zZXJ0X3Bvc10ubGluZW5vIGlzIG5vdCBOb25lOlxuICAgMTgyXHQgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZV9saW5lbm8gPSBuZXdfbm9kZS5ib2R5W2luc2VydF9wb3NdLmxpbmVub1xuICAgMTgzXHQgICAgICAgICAgICAgICAgICAgIGVsaWYgaGFzYXR0cihuZXdfbm9kZSwnbGluZW5vJykgYW5kIG5ld19ub2RlLmxpbmVubyBpcyBub3QgTm9uZTpcbiAgIDE4NFx0ICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VfbGluZW5vID0gbmV3X25vZGUubGluZW5vICsgMVxuICAgMTg1XHRcbiAgIDE4Nlx0ICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZlwiQWRqdXN0aW5nIGxpbmVubyBmb3IgbmV3IG5vZGVzLCBzdGFydGluZyBmcm9tIH57YmFzZV9saW5lbm99XCIpXG4gICAxODdcdCAgICAgICAgICAgICAgICAgICAgY3VycmVudF9saW5lbm8gPSBiYXNlX2xpbmVub1xuICAgMTg4XHQgICAgICAgICAgICAgICAgICAgIGZvciBpLCBuX25vZGUgaW4gZW51bWVyYXRlKHNlbGYubmV3X25vZGVzKTpcbiAgIDE4OVx0ICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBjaGlsZF9ub2RlIGluIGFzdC53YWxrKG5fbm9kZSk6XG4gICAxOTBcdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGhhc2F0dHIoY2hpbGRfbm9kZSwgJ2xpbmVubycpOiBjaGlsZF9ub2RlLmxpbmVubyA9IGN1cnJlbnRfbGluZW5vXG4gICAxOTFcdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGhhc2F0dHIoY2hpbGRfbm9kZSwgJ2NvbF9vZmZzZXQnKTogY2hpbGRfbm9kZS5jb2xfb2Zmc2V0ID0gMCAjIFJlc2V0IGNvbCBvZmZzZXRcbiAgIDE5Mlx0ICAgICAgICAgICAgICAgICAgICAgICAgICMgSW5jcmVtZW50IGxpbmUgbnVtYmVyIGZvciBuZXh0IG5vZGUgYmFzZWQgb24gdW5wYXJzZWQgbGluZXNcbiAgIDE5M1x0ICAgICAgICAgICAgICAgICAgICAgICAgIHRyeTpcbiAgIDE5NFx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1fbGluZXMgPSBsZW4oYXN0LnVucGFyc2Uobl9ub2RlKS5zcGxpdGxpbmVzKCkpXG4gICAxOTVcdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9saW5lbm8gKz0gbnVtX2xpbmVzXG4gICAxOTZcdCAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IGN1cnJlbnRfbGluZW5vICs9MSAjIEZhbGxiYWNrXG4gICAxOTdcdFxuICAgMTk4XHQgICAgICAgICAgICAgICAgICAgICMgUGVyZm9ybSBpbnNlcnRpb25cbiAgIDE5OVx0ICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbF9ib2R5X2xlbiA9IGxlbihuZXdfbm9kZS5ib2R5KVxuICAgMjAwXHQgICAgICAgICAgICAgICAgICAgIG5ld19ub2RlLmJvZHkgPSBuZXdfbm9kZS5ib2R5WzppbnNlcnRfcG9zXSArIHNlbGYubmV3X25vZGVzICsgbmV3X25vZGUuYm9keVtpbnNlcnRfcG9zOl1cbiAgIDIwMVx0ICAgICAgICAgICAgICAgICAgICBpZiBsZW4obmV3X25vZGUuYm9keSkgPiBvcmlnaW5hbF9ib2R5X2xlbjpcbiAgIDIwMlx0ICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGZcIkluc2VydGVkIHtsZW4oc2VsZi5uZXdfbm9kZXMpfSBub2RlKHMpIGF0IGluZGV4IHtpbnNlcnRfcG9zfS5cIilcbiAgIDIwM1x0ICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3BlcmF0aW9uX2RvbmUgPSBUcnVlXG4gICAyMDRcdCAgICAgICAgICAgICAgICAgICAgZWxzZTpcbiAgIDIwNVx0ICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGZcIkluc2VydGlvbiBhdHRlbXB0IGF0IGluZGV4IHtpbnNlcnRfcG9zfSBkaWQgbm90IGNoYW5nZSBib2R5IGxlbmd0aC5cIilcbiAgIDIwNlx0ICAgICAgICAgICAgICAgIGVsc2U6XG4gICAyMDdcdCAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJUYXJnZXQgbm9kZSB7dHlwZShuZXdfbm9kZSkuX19uYW1lX199IGZvciBpbnNlcnRpb24gZG9lcyBub3QgaGF2ZSBhIGxpc3QgJ2JvZHknLlwiKVxuICAgMjA4XHRcbiAgIDIwOVx0ICAgICAgICByZXR1cm4gbmV3X25vZGVcbiAgIDIxMFx0XG4gICAyMTFcdCAgICAjIHZpc2l0X2xpc3QgaXMgY3J1Y2lhbCBmb3IgaGFuZGxpbmcgcmVwbGFjZW1lbnRzIGNvcnJlY3RseVxuICAgMjEyXHQgICAgZGVmIHZpc2l0X2xpc3Qoc2VsZiwgbm9kZXM6IExpc3RbQW55XSkgLT4gTGlzdFtBbnldOlxuICAgMjEzXHQgICAgICAgIG5ld19saXN0ID0gW11cbiAgIDIxNFx0ICAgICAgICBmb3Igbm9kZSBpbiBub2RlczpcbiAgIDIxNVx0ICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi52aXNpdChub2RlKSAjIHZpc2l0IGhhbmRsZXMgcmVwbGFjZW1lbnQgY2hlY2sgZmlyc3RcbiAgIDIxNlx0ICAgICAgICAgICAgaWYgcmVzdWx0IGlzIE5vbmU6ICMgTm9kZSBkZWxldGVkXG4gICAyMTdcdCAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgMjE4XHQgICAgICAgICAgICBlbGlmIGlzaW5zdGFuY2UocmVzdWx0LCBsaXN0KTogIyBOb2RlIHJlcGxhY2VkIGJ5IG11bHRpcGxlIG5vZGVzXG4gICAyMTlcdCAgICAgICAgICAgICAgICBuZXdfbGlzdC5leHRlbmQocmVzdWx0KVxuICAgMjIwXHQgICAgICAgICAgICBlbHNlOiAjIFNpbmdsZSBub2RlIHJldHVybmVkIChvcmlnaW5hbCBvciByZXBsYWNlZClcbiAgIDIyMVx0ICAgICAgICAgICAgICAgIG5ld19saXN0LmFwcGVuZChyZXN1bHQpXG4gICAyMjJcdCAgICAgICAgcmV0dXJuIG5ld19saXN0XG4gICAyMjNcdFxuICAgMjI0XHQgICAgIyBPdmVycmlkZSB2aXNpdG9ycyBmb3IgY29tbW9uIG5vZGUgdHlwZXMgd2l0aCAnYm9keScgbGlzdHNcbiAgIDIyNVx0ICAgIGRlZiB2aXNpdF9Nb2R1bGUoc2VsZiwgbm9kZTogYXN0Lk1vZHVsZSkgLT4gQW55OlxuICAgMjI2XHQgICAgICAgICMgU3BlY2lhbCBoYW5kbGluZyBmb3IgaW1wb3J0IGJsb2NrIHJlcGxhY2VtZW50XG4gICAyMjdcdCAgICAgICAgaWYgc2VsZi5pc19pbXBvcnRfYmxvY2tfcmVwbGFjZSBhbmQgbm90IHNlbGYub3BlcmF0aW9uX2RvbmU6XG4gICAyMjhcdCAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmXCJQZXJmb3JtaW5nIGltcG9ydCBibG9jayByZXBsYWNlbWVudCAoTGluZXMge3NlbGYudGFyZ2V0X3N0YXJ0X2xpbmV9LXtzZWxmLnRhcmdldF9lbmRfbGluZX0pXCIpXG4gICAyMjlcdCAgICAgICAgICAgICBuZXdfYm9keSA9IFtdXG4gICAyMzBcdCAgICAgICAgICAgICBwcm9jZXNzZWRfaW1wb3J0X2Jsb2NrID0gRmFsc2VcbiAgIDIzMVx0ICAgICAgICAgICAgICMgQ29weSBub2RlcyBiZWZvcmUgdGhlIGltcG9ydCBibG9ja1xuICAgMjMyXHQgICAgICAgICAgICAgZm9yIGksIGl0ZW0gaW4gZW51bWVyYXRlKG5vZGUuYm9keSk6XG4gICAyMzNcdCAgICAgICAgICAgICAgICAgaWYgaXRlbS5saW5lbm8gPCBzZWxmLnRhcmdldF9zdGFydF9saW5lOlxuICAgMjM0XHQgICAgICAgICAgICAgICAgICAgICAgbmV3X2JvZHkuYXBwZW5kKGl0ZW0pICMgS2VlcCBub2RlcyBiZWZvcmUgdGhlIGJsb2NrIHN0YXJ0XG4gICAyMzVcdCAgICAgICAgICAgICAgICAgZWxzZTpcbiAgIDIzNlx0ICAgICAgICAgICAgICAgICAgICAgIGJyZWFrICMgUmVhY2hlZCB0aGUgYmxvY2tcbiAgIDIzN1x0XG4gICAyMzhcdCAgICAgICAgICAgICAjIEluc2VydCBuZXcgaW1wb3J0IG5vZGVzXG4gICAyMzlcdCAgICAgICAgICAgICBpZiBzZWxmLm5ld19ub2RlczpcbiAgIDI0MFx0ICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIkluc2VydGluZyB7bGVuKHNlbGYubmV3X25vZGVzKX0gbmV3IGltcG9ydCBub2Rlcy5cIilcbiAgIDI0MVx0ICAgICAgICAgICAgICAgICAgIyBBZGp1c3QgbGluZW5vIGhldXJpc3RpY2FsbHlcbiAgIDI0Mlx0ICAgICAgICAgICAgICAgICAgYmFzZV9saW5lbm8gPSBuZXdfYm9keVstMV0uZW5kX2xpbmVubyArIDEgaWYgbmV3X2JvZHkgYW5kIGhhc2F0dHIobmV3X2JvZHlbLTFdLCdlbmRfbGluZW5vJykgZWxzZSAxXG4gICAyNDNcdCAgICAgICAgICAgICAgICAgIGN1cnJlbnRfbGluZW5vID0gYmFzZV9saW5lbm9cbiAgIDI0NFx0ICAgICAgICAgICAgICAgICAgZm9yIGksIG5fbm9kZSBpbiBlbnVtZXJhdGUoc2VsZi5uZXdfbm9kZXMpOlxuICAgMjQ1XHQgICAgICAgICAgICAgICAgICAgICAgIGZvciBjaGlsZF9ub2RlIGluIGFzdC53YWxrKG5fbm9kZSk6XG4gICAyNDZcdCAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBoYXNhdHRyKGNoaWxkX25vZGUsICdsaW5lbm8nKTogY2hpbGRfbm9kZS5saW5lbm8gPSBjdXJyZW50X2xpbmVub1xuICAgMjQ3XHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGFzYXR0cihjaGlsZF9ub2RlLCAnY29sX29mZnNldCcpOiBjaGlsZF9ub2RlLmNvbF9vZmZzZXQgPSAwXG4gICAyNDhcdCAgICAgICAgICAgICAgICAgICAgICAgdHJ5OiBudW1fbGluZXMgPSBsZW4oYXN0LnVucGFyc2Uobl9ub2RlKS5zcGxpdGxpbmVzKCkpOyBjdXJyZW50X2xpbmVubyArPSBudW1fbGluZXNcbiAgIDI0OVx0ICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IGN1cnJlbnRfbGluZW5vICs9IDFcbiAgIDI1MFx0ICAgICAgICAgICAgICAgICAgbmV3X2JvZHkuZXh0ZW5kKHNlbGYubmV3X25vZGVzKVxuICAgMjUxXHRcbiAgIDI1Mlx0ICAgICAgICAgICAgICMgU2tpcCBvcmlnaW5hbCBub2RlcyB3aXRoaW4gdGhlIHJlcGxhY2VkIGJsb2NrIHJhbmdlXG4gICAyNTNcdCAgICAgICAgICAgICBmb3IgaSwgaXRlbSBpbiBlbnVtZXJhdGUobm9kZS5ib2R5KTpcbiAgIDI1NFx0ICAgICAgICAgICAgICAgICBpZiBpdGVtLmxpbmVubyA+PSBzZWxmLnRhcmdldF9zdGFydF9saW5lIGFuZCBoYXNhdHRyKGl0ZW0sICdlbmRfbGluZW5vJykgYW5kIGl0ZW0uZW5kX2xpbmVubyA8PSBzZWxmLnRhcmdldF9lbmRfbGluZTpcbiAgIDI1NVx0ICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlICMgU2tpcCBub2RlcyB3aXRoaW4gdGhlIGJsb2NrXG4gICAyNTZcdCAgICAgICAgICAgICAgICAgIyBTcGVjaWFsIGNhc2U6IG5vZGUgc3RhcnRzIHdpdGhpbiBibG9jayBidXQgZW5kcyBhZnRlciAodW5saWtlbHkgZm9yIGltcG9ydHMpXG4gICAyNTdcdCAgICAgICAgICAgICAgICAgZWxpZiBpdGVtLmxpbmVubyA+PSBzZWxmLnRhcmdldF9zdGFydF9saW5lIGFuZCBpdGVtLmxpbmVubyA8PSBzZWxmLnRhcmdldF9lbmRfbGluZTpcbiAgIDI1OFx0ICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlXG4gICAyNTlcdCAgICAgICAgICAgICAgICAgIyBLZWVwIG5vZGVzIGFmdGVyIHRoZSBibG9ja1xuICAgMjYwXHQgICAgICAgICAgICAgICAgIGVsaWYgaXRlbS5saW5lbm8gPiBzZWxmLnRhcmdldF9lbmRfbGluZTpcbiAgIDI2MVx0ICAgICAgICAgICAgICAgICAgICAgIG5ld19ib2R5LmFwcGVuZChpdGVtKVxuICAgMjYyXHRcbiAgIDI2M1x0ICAgICAgICAgICAgIG5vZGUuYm9keSA9IHNlbGYudmlzaXRfbGlzdChuZXdfYm9keSkgIyBWaXNpdCB0aGUgbmV3bHkgY29uc3RydWN0ZWQgYm9keVxuICAgMjY0XHQgICAgICAgICAgICAgc2VsZi5vcGVyYXRpb25fZG9uZSA9IFRydWUgIyBNYXJrIG9wZXJhdGlvbiBhcyBkb25lXG4gICAyNjVcdCAgICAgICAgICAgICByZXR1cm4gbm9kZSAjIFJldHVybiB0aGUgbW9kaWZpZWQgbm9kZVxuICAgMjY2XHRcbiAgIDI2N1x0ICAgICAgICAjIERlZmF1bHQgcHJvY2Vzc2luZyBpZiBub3QgaW1wb3J0IGJsb2NrIHJlcGxhY2VtZW50XG4gICAyNjhcdCAgICAgICAgbm9kZS5ib2R5ID0gc2VsZi52aXNpdF9saXN0KG5vZGUuYm9keSlcbiAgIDI2OVx0ICAgICAgICAjIEFsbG93IGdlbmVyaWNfdmlzaXQgdG8gaGFuZGxlIHBvdGVudGlhbCBpbnNlcnRpb24gaW50byB0aGUgbW9kdWxlIGJvZHlcbiAgIDI3MFx0ICAgICAgICByZXR1cm4gc3VwZXIoKS5nZW5lcmljX3Zpc2l0KG5vZGUpXG4gICAyNzFcdFxuICAgMjcyXHQgICAgZGVmIHZpc2l0X0NsYXNzRGVmKHNlbGYsIG5vZGU6IGFzdC5DbGFzc0RlZikgLT4gQW55OlxuICAgMjczXHQgICAgICAgIG5vZGUuYm9keSA9IHNlbGYudmlzaXRfbGlzdChub2RlLmJvZHkpXG4gICAyNzRcdCAgICAgICAgIyBBbGxvdyBnZW5lcmljX3Zpc2l0IHRvIGhhbmRsZSBwb3RlbnRpYWwgaW5zZXJ0aW9uIG9yIHJlcGxhY2VtZW50IG9mIHRoZSBjbGFzcyBpdHNlbGZcbiAgIDI3NVx0ICAgICAgICByZXR1cm4gc3VwZXIoKS5nZW5lcmljX3Zpc2l0KG5vZGUpXG4gICAyNzZcdFxuICAgMjc3XHQgICAgZGVmIHZpc2l0X0Z1bmN0aW9uRGVmKHNlbGYsIG5vZGU6IGFzdC5GdW5jdGlvbkRlZikgLT4gQW55OlxuICAgMjc4XHQgICAgICAgIG5vZGUuYm9keSA9IHNlbGYudmlzaXRfbGlzdChub2RlLmJvZHkpXG4gICAyNzlcdCAgICAgICAgIyBBbGxvdyBnZW5lcmljX3Zpc2l0IGZvciByZXBsYWNlbWVudCBjaGVjayBvZiB0aGUgZnVuY3Rpb24gaXRzZWxmXG4gICAyODBcdCAgICAgICAgcmV0dXJuIHN1cGVyKCkuZ2VuZXJpY192aXNpdChub2RlKVxuICAgMjgxXHRcbiAgIDI4Mlx0ICAgIGRlZiB2aXNpdF9Bc3luY0Z1bmN0aW9uRGVmKHNlbGYsIG5vZGU6IGFzdC5Bc3luY0Z1bmN0aW9uRGVmKSAtPiBBbnk6XG4gICAyODNcdCAgICAgICAgbm9kZS5ib2R5ID0gc2VsZi52aXNpdF9saXN0KG5vZGUuYm9keSlcbiAgIDI4NFx0ICAgICAgICAgIyBBbGxvdyBnZW5lcmljX3Zpc2l0IGZvciByZXBsYWNlbWVudCBjaGVjayBvZiB0aGUgZnVuY3Rpb24gaXRzZWxmXG4gICAyODVcdCAgICAgICAgcmV0dXJuIHN1cGVyKCkuZ2VuZXJpY192aXNpdChub2RlKVxuICAgMjg2XHRcbiAgIDI4N1x0Y2xhc3MgUHl0aG9uQVNUTWFuaXB1bGF0b3IoTWFuaXB1bGF0b3JCYXNlKTpcbiAgIDI4OFx0ICAgIFwiXCJcIlxuICAgMjg5XHQgICAgQVNULWJhc2VkIG1hbmlwdWxhdG9yIGZvciBQeXRob24gY29kZSB1c2luZyBhc3QuTm9kZVRyYW5zZm9ybWVyLlxuICAgMjkwXHQgICAgU3VwcG9ydHMgcm9idXN0IGluc2VydGlvbiwgcmVwbGFjZW1lbnQgb2YgY2xhc3NlcywgZnVuY3Rpb25zLCBtZXRob2RzLFxuICAgMjkxXHQgICAgcHJvcGVydGllcywgYW5kIGltcG9ydHMuIChWZXJzaW9uIDMpXG4gICAyOTJcdCAgICBcIlwiXCJcbiAgIDI5M1x0XG4gICAyOTRcdCAgICBkZWYgX19pbml0X18oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKTpcbiAgIDI5NVx0ICAgICAgICBzdXBlcigpLl9faW5pdF9fKCphcmdzLCAqKmt3YXJncylcbiAgIDI5Nlx0XG4gICAyOTdcdCAgICBkZWYgX2dldF9lbGVtZW50X3R5cGVfZm9yX3Vwc2VydChzZWxmLCBlbGVtZW50X3R5cGVfc3RyOiBzdHIsIG5ld19jb2RlOiBzdHIpIC0+IENvZGVFbGVtZW50VHlwZTpcbiAgIDI5OFx0ICAgICAgICBcIlwiXCJEZXRlcm1pbmUgdGhlIENvZGVFbGVtZW50VHlwZSBlbnVtLlwiXCJcIlxuICAgMjk5XHQgICAgICAgIGlmIGVsZW1lbnRfdHlwZV9zdHIgYW5kIGVsZW1lbnRfdHlwZV9zdHIgIT0gJ3Vua25vd24nOlxuICAgMzAwXHQgICAgICAgICAgICAgdHJ5OiByZXR1cm4gQ29kZUVsZW1lbnRUeXBlKGVsZW1lbnRfdHlwZV9zdHIpXG4gICAzMDFcdCAgICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjogbG9nZ2VyLndhcm5pbmcoZlwiSW52YWxpZCBlbGVtZW50X3R5cGUgc3RyaW5nICd7ZWxlbWVudF90eXBlX3N0cn0nLiBBdHRlbXB0aW5nIGRldGVjdGlvbi5cIilcbiAgIDMwMlx0XG4gICAzMDNcdCAgICAgICAgc3RyaXBwZWRfY29kZSA9IG5ld19jb2RlLnN0cmlwKClcbiAgIDMwNFx0ICAgICAgICBpZiBub3Qgc3RyaXBwZWRfY29kZTpcbiAgIDMwNVx0ICAgICAgICAgICAgIGlmIGVsZW1lbnRfdHlwZV9zdHIgYW5kIGVsZW1lbnRfdHlwZV9zdHIgIT0gJ3Vua25vd24nOlxuICAgMzA2XHQgICAgICAgICAgICAgICAgICB0cnk6IHJldHVybiBDb2RlRWxlbWVudFR5cGUoZWxlbWVudF90eXBlX3N0cikgIyBVc2UgcHJvdmlkZWQgdHlwZSBpZiBkZWxldGluZ1xuICAgMzA3XHQgICAgICAgICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjogcGFzc1xuICAgMzA4XHQgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihcIkNhbm5vdCBkZXRlcm1pbmUgZWxlbWVudCB0eXBlIGZvciBkZWxldGlvbiB3aXRob3V0IGV4cGxpY2l0IHR5cGUgb3IgcGFyc2FibGUgbmV3X2NvZGUuXCIpXG4gICAzMDlcdFxuICAgMzEwXHQgICAgICAgIGlmIHN0cmlwcGVkX2NvZGUuc3RhcnRzd2l0aCgoJ2RlZiAnLCAnYXN5bmMgZGVmJykpOlxuICAgMzExXHQgICAgICAgICAgICAgIyBOZWVkcyBjb250ZXh0IChwYXJlbnRfbmFtZSkgdG8gYmUgTUVUSE9EIHZzIEZVTkNUSU9OLiBEZWZhdWx0IHRvIEZVTkNUSU9OLlxuICAgMzEyXHQgICAgICAgICAgICAgcmV0dXJuIENvZGVFbGVtZW50VHlwZS5GVU5DVElPTlxuICAgMzEzXHQgICAgICAgIGVsaWYgc3RyaXBwZWRfY29kZS5zdGFydHN3aXRoKCdjbGFzcyAnKTogcmV0dXJuIENvZGVFbGVtZW50VHlwZS5DTEFTU1xuICAgMzE0XHQgICAgICAgIGVsaWYgc3RyaXBwZWRfY29kZS5zdGFydHN3aXRoKCgnaW1wb3J0ICcsICdmcm9tICcpKTogcmV0dXJuIENvZGVFbGVtZW50VHlwZS5JTVBPUlRcbiAgIDMxNVx0ICAgICAgICBlbGlmICc9JyBpbiBzdHJpcHBlZF9jb2RlLnNwbGl0bGluZXMoKVswXTogcmV0dXJuIENvZGVFbGVtZW50VHlwZS5TVEFUSUNfUFJPUEVSVFlcbiAgIDMxNlx0XG4gICAzMTdcdCAgICAgICAgbG9nZ2VyLmVycm9yKGZcIkNvdWxkIG5vdCBkZXRlcm1pbmUgZWxlbWVudCB0eXBlIGZvciB1cHNlcnQgZnJvbSAne2VsZW1lbnRfdHlwZV9zdHJ9JyBvciBjb2RlIHNuaXBwZXQuXCIpXG4gICAzMThcdCAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmXCJJbnZhbGlkIG9yIHVuZGV0ZWN0YWJsZSBlbGVtZW50IHR5cGU6IHtlbGVtZW50X3R5cGVfc3RyfVwiKVxuICAgMzE5XHRcbiAgIDMyMFx0ICAgIGRlZiB1cHNlcnRfZWxlbWVudChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIGVsZW1lbnRfdHlwZV9zdHI6IHN0ciwgbmFtZTogc3RyLCBuZXdfY29kZTogc3RyLCBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXSA9IE5vbmUpIC0+IHN0cjpcbiAgIDMyMVx0ICAgICAgICBcIlwiXCIgQWRkIG9yIHJlcGxhY2UgYSBjb2RlIGVsZW1lbnQgdXNpbmcgQVNUIHRyYW5zZm9ybWF0aW9uLiBcIlwiXCJcbiAgIDMyMlx0ICAgICAgICBsb2dnZXIuaW5mbyhmXCJBU1QgVXBzZXJ0OiB0eXBlPSd7ZWxlbWVudF90eXBlX3N0cn0nLCBuYW1lPSd7bmFtZX0nLCBwYXJlbnQ9J3twYXJlbnRfbmFtZX0nXCIpXG4gICAzMjNcdFxuICAgMzI0XHQgICAgICAgIHRyeTogZWxlbWVudF90eXBlID0gc2VsZi5fZ2V0X2VsZW1lbnRfdHlwZV9mb3JfdXBzZXJ0KGVsZW1lbnRfdHlwZV9zdHIsIG5ld19jb2RlKVxuICAgMzI1XHQgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yIGFzIGU6IGxvZ2dlci5lcnJvcihmXCJDYW5ub3QgcGVyZm9ybSB1cHNlcnQ6IHtlfVwiKTsgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgIDMyNlx0XG4gICAzMjdcdCAgICAgICAgIyBSZWZpbmUgdHlwZSBndWVzcyBiYXNlZCBvbiBjb250ZXh0XG4gICAzMjhcdCAgICAgICAgaWYgZWxlbWVudF90eXBlID09IENvZGVFbGVtZW50VHlwZS5GVU5DVElPTiBhbmQgcGFyZW50X25hbWU6IGVsZW1lbnRfdHlwZSA9IENvZGVFbGVtZW50VHlwZS5NRVRIT0RcbiAgIDMyOVx0ICAgICAgICBsb2dnZXIuaW5mbyhmXCJQcm9jZXNzaW5nIGFzIGVsZW1lbnQgdHlwZToge2VsZW1lbnRfdHlwZS52YWx1ZX1cIilcbiAgIDMzMFx0XG4gICAzMzFcdCAgICAgICAgdGFyZ2V0X3N0YXJ0X2xpbmUsIHRhcmdldF9lbmRfbGluZSA9IE5vbmUsIE5vbmVcbiAgIDMzMlx0ICAgICAgICBpc19yZXBsYWNpbmcgPSBGYWxzZVxuICAgMzMzXHQgICAgICAgIGlzX2RlbGV0aW5nID0gbm90IG5ld19jb2RlLnN0cmlwKClcbiAgIDMzNFx0XG4gICAzMzVcdCAgICAgICAgIyBGaW5kIGV4aXN0aW5nIGVsZW1lbnQgcmFuZ2VcbiAgIDMzNlx0ICAgICAgICBpZiBuYW1lIGFuZCBuYW1lICE9ICdhbGwnOlxuICAgMzM3XHQgICAgICAgICAgICB0cnk6XG4gICAzMzhcdCAgICAgICAgICAgICAgICAgc2VhcmNoX3R5cGVzID0gW2VsZW1lbnRfdHlwZV1cbiAgIDMzOVx0ICAgICAgICAgICAgICAgICAjIEFkZCBhbHRlcm5hdGl2ZXMgaWYgaW5pdGlhbCB0eXBlIG1pZ2h0IGJlIGFtYmlndW91c1xuICAgMzQwXHQgICAgICAgICAgICAgICAgIGlmIGVsZW1lbnRfdHlwZSA9PSBDb2RlRWxlbWVudFR5cGUuTUVUSE9EOiBzZWFyY2hfdHlwZXMuZXh0ZW5kKFtDb2RlRWxlbWVudFR5cGUuUFJPUEVSVFlfR0VUVEVSLCBDb2RlRWxlbWVudFR5cGUuUFJPUEVSVFlfU0VUVEVSXSlcbiAgIDM0MVx0ICAgICAgICAgICAgICAgICBlbGlmIGVsZW1lbnRfdHlwZSA9PSBDb2RlRWxlbWVudFR5cGUuRlVOQ1RJT04gYW5kIHBhcmVudF9uYW1lOiBzZWFyY2hfdHlwZXMuYXBwZW5kKENvZGVFbGVtZW50VHlwZS5NRVRIT0QpXG4gICAzNDJcdFxuICAgMzQzXHQgICAgICAgICAgICAgICAgIGZvciBzZWFyY2hfdHlwZSBpbiBzZWFyY2hfdHlwZXM6XG4gICAzNDRcdCAgICAgICAgICAgICAgICAgICAgICBzdGFydCwgZW5kID0gc2VsZi5leHRyYWN0aW9uX3NlcnZpY2UuZmluZF9lbGVtZW50KG9yaWdpbmFsX2NvZGUsIHNlYXJjaF90eXBlLnZhbHVlLCBuYW1lLCBwYXJlbnRfbmFtZSlcbiAgIDM0NVx0ICAgICAgICAgICAgICAgICAgICAgIGlmIHN0YXJ0ID4gMDpcbiAgIDM0Nlx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3N0YXJ0X2xpbmUsIHRhcmdldF9lbmRfbGluZSA9IHN0YXJ0LCBlbmRcbiAgIDM0N1x0ICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VhcmNoX3R5cGUgIT0gZWxlbWVudF90eXBlOlxuICAgMzQ4XHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGZcIkFkanVzdGluZyB0eXBlIHRvIGZvdW5kIHR5cGU6IHtzZWFyY2hfdHlwZS52YWx1ZX1cIilcbiAgIDM0OVx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50X3R5cGUgPSBzZWFyY2hfdHlwZSAjIENvcnJlY3QgdHlwZSBiYXNlZCBvbiBmaW5kaW5nXG4gICAzNTBcdCAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAzNTFcdCAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0X3N0YXJ0X2xpbmUgaXMgbm90IE5vbmU6XG4gICAzNTJcdCAgICAgICAgICAgICAgICAgICAgIGlzX3JlcGxhY2luZyA9IFRydWVcbiAgIDM1M1x0ICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gXCJERUxFVEVcIiBpZiBpc19kZWxldGluZyBlbHNlIFwiUkVQTEFDRVwiXG4gICAzNTRcdCAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGZcIlBsYW5uaW5nIHRvIHthY3Rpb259IGV4aXN0aW5nIGVsZW1lbnQgJ3tuYW1lfScgKHR5cGUge2VsZW1lbnRfdHlwZS52YWx1ZX0pIGF0IGxpbmVzIHt0YXJnZXRfc3RhcnRfbGluZX0te3RhcmdldF9lbmRfbGluZX1cIilcbiAgIDM1NVx0ICAgICAgICAgICAgICAgICBlbHNlOlxuICAgMzU2XHQgICAgICAgICAgICAgICAgICAgICBpZiBpc19kZWxldGluZzogbG9nZ2VyLmVycm9yKGZcIkNhbm5vdCBkZWxldGUgZWxlbWVudCAne25hbWV9JzogTm90IGZvdW5kLlwiKTsgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgIDM1N1x0ICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZlwiRWxlbWVudCAne25hbWV9JyBub3QgZm91bmQuIFBsYW5uaW5nIHRvIElOU0VSVC5cIilcbiAgIDM1OFx0ICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxuICAgMzU5XHQgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJFcnJvciBmaW5kaW5nIGVsZW1lbnQgJ3tuYW1lfSc6IHtlfS4gQXNzdW1pbmcgaW5zZXJ0aW9uLlwiKVxuICAgMzYwXHQgICAgICAgICAgICAgICAgIGlmIGlzX2RlbGV0aW5nOiByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgMzYxXHQgICAgICAgIGVsaWYgZWxlbWVudF90eXBlID09IENvZGVFbGVtZW50VHlwZS5JTVBPUlQ6XG4gICAzNjJcdCAgICAgICAgICAgICB0cnk6XG4gICAzNjNcdCAgICAgICAgICAgICAgICAgdGFyZ2V0X3N0YXJ0X2xpbmUsIHRhcmdldF9lbmRfbGluZSA9IHNlbGYuZXh0cmFjdGlvbl9zZXJ2aWNlLl9maW5kX2ltcG9ydF9ibG9ja19yYW5nZShvcmlnaW5hbF9jb2RlKVxuICAgMzY0XHQgICAgICAgICAgICAgICAgIGlmIHRhcmdldF9zdGFydF9saW5lID09IDA6IHRhcmdldF9zdGFydF9saW5lLCB0YXJnZXRfZW5kX2xpbmUgPSBOb25lLCBOb25lXG4gICAzNjVcdCAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0X3N0YXJ0X2xpbmUgaXMgbm90IE5vbmU6XG4gICAzNjZcdCAgICAgICAgICAgICAgICAgICAgIGlzX3JlcGxhY2luZyA9IFRydWVcbiAgIDM2N1x0ICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gXCJERUxFVEVcIiBpZiBpc19kZWxldGluZyBlbHNlIFwiUkVQTEFDRVwiXG4gICAzNjhcdCAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGZcIlBsYW5uaW5nIHRvIHthY3Rpb259IGltcG9ydCBibG9jayBhdCBsaW5lcyB7dGFyZ2V0X3N0YXJ0X2xpbmV9LXt0YXJnZXRfZW5kX2xpbmV9XCIpXG4gICAzNjlcdCAgICAgICAgICAgICAgICAgZWxpZiBpc19kZWxldGluZzogbG9nZ2VyLndhcm5pbmcoXCJDYW5ub3QgZGVsZXRlIGltcG9ydCBibG9jazogTm90IGZvdW5kLlwiKTsgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgIDM3MFx0ICAgICAgICAgICAgICAgICBlbHNlOiBsb2dnZXIuaW5mbyhcIkltcG9ydCBibG9jayBub3QgZm91bmQuIFBsYW5uaW5nIHRvIElOU0VSVCBpbXBvcnQocykuXCIpXG4gICAzNzFcdCAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XG4gICAzNzJcdCAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGZcIkVycm9yIGZpbmRpbmcgaW1wb3J0IGJsb2NrIHJhbmdlOiB7ZX0uIEFzc3VtaW5nIGluc2VydGlvbi5cIilcbiAgIDM3M1x0ICAgICAgICAgICAgICAgICBpZiBpc19kZWxldGluZzogcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgIDM3NFx0ICAgICAgICBlbHNlOiAjIE5vIG5hbWUgLyBub3QgaW1wb3J0IGJsb2NrXG4gICAzNzVcdCAgICAgICAgICAgICBpZiBpc19kZWxldGluZzogbG9nZ2VyLmVycm9yKGZcIkNhbm5vdCBkZWxldGUgZWxlbWVudDogTm8gbmFtZSBzcGVjaWZpZWQuXCIpOyByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgMzc2XHQgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZlwiTm8gdmFsaWQgbmFtZSBmb3IgcmVwbGFjZW1lbnQuIFBsYW5uaW5nIHRvIElOU0VSVC5cIilcbiAgIDM3N1x0XG4gICAzNzhcdCAgICAgICAgIyBQYXJzZSBvcmlnaW5hbCBjb2RlXG4gICAzNzlcdCAgICAgICAgdHJ5OiBvcmlnaW5hbF90cmVlID0gYXN0LmZpeF9taXNzaW5nX2xvY2F0aW9ucyhhc3QucGFyc2Uob3JpZ2luYWxfY29kZSkpXG4gICAzODBcdCAgICAgICAgZXhjZXB0IFN5bnRheEVycm9yIGFzIGU6IGxvZ2dlci5lcnJvcihmXCJTeW50YXggZXJyb3IgaW4gb3JpZ2luYWwgY29kZToge2V9XCIpOyByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgMzgxXHRcbiAgIDM4Mlx0ICAgICAgICAjIFBhcnNlIG5ldyBjb2RlIHNuaXBwZXQgKG9yIGhhbmRsZSBkZWxldGlvbilcbiAgIDM4M1x0ICAgICAgICBuZXdfbm9kZXM6IExpc3RbYXN0LkFTVF0gPSBbXVxuICAgMzg0XHQgICAgICAgIGlmIG5vdCBpc19kZWxldGluZzpcbiAgIDM4NVx0ICAgICAgICAgICAgdHJ5OlxuICAgMzg2XHQgICAgICAgICAgICAgICAgbmV3X2NvZGVfc3RyaXBwZWQgPSBuZXdfY29kZS5zdHJpcCgpXG4gICAzODdcdCAgICAgICAgICAgICAgICBpZiBub3QgbmV3X2NvZGVfc3RyaXBwZWQ6IHJhaXNlIFZhbHVlRXJyb3IoXCJDYW5ub3QgdXBzZXJ0IGVtcHR5IGNvZGUgc25pcHBldCB1bmxlc3MgZGVsZXRpbmcuXCIpXG4gICAzODhcdCAgICAgICAgICAgICAgICBuZXdfdHJlZSA9IGFzdC5wYXJzZShuZXdfY29kZV9zdHJpcHBlZCk7IG5ld19ub2RlcyA9IG5ld190cmVlLmJvZHlcbiAgIDM4OVx0ICAgICAgICAgICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG5ld19ub2RlcywgbGlzdCk6IG5ld19ub2RlcyA9IFtuZXdfbm9kZXNdXG4gICAzOTBcdCAgICAgICAgICAgICAgICBpZiBub3QgbmV3X25vZGVzOiBsb2dnZXIud2FybmluZyhcIk5ldyBjb2RlIHNuaXBwZXQgcGFyc2VkIGludG8gYW4gZW1wdHkgbGlzdCBvZiBub2Rlcy4gVHJlYXRpbmcgYXMgZGVsZXRpb24gaWYgcmVwbGFjaW5nLlwiKVxuICAgMzkxXHQgICAgICAgICAgICAgICAgaWYgbm90IG5ld19ub2RlcyBhbmQgaXNfcmVwbGFjaW5nOiBpc19kZWxldGluZyA9IFRydWVcbiAgIDM5Mlx0ICAgICAgICAgICAgICAgIGVsaWYgbm90IG5ld19ub2RlcyBhbmQgbm90IGlzX3JlcGxhY2luZzogcmFpc2UgVmFsdWVFcnJvcihcIkNhbm5vdCBpbnNlcnQgZW1wdHkgcGFyc2VkIG5vZGVzLlwiKVxuICAgMzkzXHQgICAgICAgICAgICBleGNlcHQgU3ludGF4RXJyb3IgYXMgZTogbG9nZ2VyLmVycm9yKGZcIlN5bnRheCBlcnJvciBpbiBuZXcgY29kZSBzbmlwcGV0OiB7ZX1cIik7IHJldHVybiBvcmlnaW5hbF9jb2RlXG4gICAzOTRcdCAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTogbG9nZ2VyLmVycm9yKGZcIkVycm9yIHBhcnNpbmcgbmV3IGNvZGUgc25pcHBldDoge2V9XCIpOyByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgMzk1XHQgICAgICAgIGVsc2U6IGxvZ2dlci5kZWJ1ZyhcIlByb2NlZWRpbmcgd2l0aCBkZWxldGlvbiAobmV3X25vZGVzIGlzIGVtcHR5KS5cIilcbiAgIDM5Nlx0XG4gICAzOTdcdCAgICAgICAgIyBBcHBseSB0cmFuc2Zvcm1hdGlvblxuICAgMzk4XHQgICAgICAgIG1vZGlmaWVkX3RyZWUgPSBOb25lXG4gICAzOTlcdCAgICAgICAgdHJhbnNmb3JtZXIgPSBOb25lXG4gICA0MDBcdCAgICAgICAgdHJ5OlxuICAgNDAxXHQgICAgICAgICAgICB0cmFuc2Zvcm1lciA9IFJlcGxhY2VPckluc2VydFRyYW5zZm9ybWVyKFxuICAgNDAyXHQgICAgICAgICAgICAgICAgdGFyZ2V0X3N0YXJ0X2xpbmU9dGFyZ2V0X3N0YXJ0X2xpbmUsIHRhcmdldF9lbmRfbGluZT10YXJnZXRfZW5kX2xpbmUsXG4gICA0MDNcdCAgICAgICAgICAgICAgICBuZXdfbm9kZXM9bmV3X25vZGVzLCBwYXJlbnRfbmFtZT1wYXJlbnRfbmFtZSxcbiAgIDQwNFx0ICAgICAgICAgICAgICAgIGVsZW1lbnRfdHlwZT1lbGVtZW50X3R5cGUsIHRhcmdldF9uYW1lPW5hbWUgaWYgbmFtZSAhPSAnYWxsJyBlbHNlIE5vbmUgIyBQYXNzIE5vbmUgbmFtZSBmb3IgYmxvY2sgcmVwbGFjZVxuICAgNDA1XHQgICAgICAgICAgICApXG4gICA0MDZcdCAgICAgICAgICAgIG1vZGlmaWVkX3RyZWUgPSB0cmFuc2Zvcm1lci52aXNpdChvcmlnaW5hbF90cmVlKVxuICAgNDA3XHQgICAgICAgICAgICBpZiBtb2RpZmllZF90cmVlIGlzIE5vbmU6IGxvZ2dlci5pbmZvKFwiVHJhbnNmb3JtYXRpb24gcmVzdWx0ZWQgaW4gZW1wdHkgQVNULlwiKTsgcmV0dXJuIFwiXFxuXCJcbiAgIDQwOFx0ICAgICAgICAgICAgbW9kaWZpZWRfdHJlZSA9IGFzdC5maXhfbWlzc2luZ19sb2NhdGlvbnMobW9kaWZpZWRfdHJlZSlcbiAgIDQwOVx0XG4gICA0MTBcdCAgICAgICAgICAgIGlmIG5vdCB0cmFuc2Zvcm1lci5vcGVyYXRpb25fZG9uZTpcbiAgIDQxMVx0ICAgICAgICAgICAgICAgICBhY3Rpb24gPSBcInJlcGxhY2UvZGVsZXRlXCIgaWYgaXNfcmVwbGFjaW5nIGVsc2UgXCJpbnNlcnRcIlxuICAgNDEyXHQgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJUcmFuc2Zvcm1lciBmYWlsZWQgdG8ge2FjdGlvbn0gZWxlbWVudCAne25hbWV9JyBcIlxuICAgNDEzXHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmXCJ7ZidhdCBsaW5lcyB7dGFyZ2V0X3N0YXJ0X2xpbmV9LXt0YXJnZXRfZW5kX2xpbmV9JyBpZiBpc19yZXBsYWNpbmcgZWxzZSBmJ2ludG8gcGFyZW50IHtwYXJlbnRfbmFtZX0nfS5cIilcbiAgIDQxNFx0ICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxfY29kZSAjIFJldHVybiBvcmlnaW5hbCBpZiBvcGVyYXRpb24gZmFpbGVkXG4gICA0MTVcdFxuICAgNDE2XHQgICAgICAgICAgICBsb2dnZXIuaW5mbyhmXCJUcmFuc2Zvcm1lciBvcGVyYXRpb24gc3VjY2Vzc2Z1bDogeydSZXBsYWNlZC9EZWxldGVkJyBpZiBpc19yZXBsYWNpbmcgZWxzZSAnSW5zZXJ0ZWQnfVwiKVxuICAgNDE3XHQgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcbiAgIDQxOFx0ICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGZcIkVycm9yIGR1cmluZyBBU1QgdHJhbnNmb3JtYXRpb246IHtlfVwiLCBleGNfaW5mbz1UcnVlKVxuICAgNDE5XHQgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgNDIwXHRcbiAgIDQyMVx0ICAgICAgICAjIFVucGFyc2UgdGhlIG1vZGlmaWVkIHRyZWVcbiAgIDQyMlx0ICAgICAgICB0cnk6XG4gICA0MjNcdCAgICAgICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG1vZGlmaWVkX3RyZWUsIGFzdC5BU1QpOlxuICAgNDI0XHQgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJUcmFuc2Zvcm1hdGlvbiByZXN1bHRlZCBpbiBub24tQVNUIHR5cGU6IHt0eXBlKG1vZGlmaWVkX3RyZWUpfS4gQ2Fubm90IHVucGFyc2UuXCIpXG4gICA0MjVcdCAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgIDQyNlx0ICAgICAgICAgICAgbmV3X3NvdXJjZSA9IGFzdC51bnBhcnNlKG1vZGlmaWVkX3RyZWUpXG4gICA0MjdcdCAgICAgICAgICAgIGlmIG5ld19zb3VyY2UgYW5kIG5vdCBuZXdfc291cmNlLmVuZHN3aXRoKCdcXG4nKTogbmV3X3NvdXJjZSArPSAnXFxuJ1xuICAgNDI4XHQgICAgICAgICAgICBsb2dnZXIuaW5mbyhcIlVucGFyc2luZyBzdWNjZXNzZnVsLlwiKVxuICAgNDI5XHQgICAgICAgICAgICAjIC0tLSBEZWJ1ZyBjb21wYXJpc29uIC0tLVxuICAgNDMwXHQgICAgICAgICAgICAjIGlmIG5ld19zb3VyY2UgPT0gb3JpZ2luYWxfY29kZTpcbiAgIDQzMVx0ICAgICAgICAgICAgIyAgICAgIGxvZ2dlci53YXJuaW5nKFwiQ29kZSBzZWVtcyB1bmNoYW5nZWQgYWZ0ZXIgdXBzZXJ0IG9wZXJhdGlvbi5cIilcbiAgIDQzMlx0ICAgICAgICAgICAgIyBlbHNlOlxuICAgNDMzXHQgICAgICAgICAgICAjICAgICAgbG9nZ2VyLmluZm8oXCJDb2RlIG1vZGlmaWVkLlwiKVxuICAgNDM0XHQgICAgICAgICAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgIDQzNVx0ICAgICAgICAgICAgcmV0dXJuIG5ld19zb3VyY2VcbiAgIDQzNlx0ICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XG4gICA0MzdcdCAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJFcnJvciB1bnBhcnNpbmcgbW9kaWZpZWQgQVNUOiB7ZX1cIiwgZXhjX2luZm89VHJ1ZSlcbiAgIDQzOFx0ICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgIDQzOVx0XG4gICA0NDBcdCAgICBkZWYgYWRkX2VsZW1lbnQoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCBuZXdfY29kZTogc3RyLCBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXT1Ob25lKSAtPiBzdHI6XG4gICA0NDFcdCAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIkNhbGxpbmcgYWRkX2VsZW1lbnQgZm9yIHBhcmVudCAne3BhcmVudF9uYW1lfSdcIilcbiAgIDQ0Mlx0ICAgICAgICB0cnk6XG4gICA0NDNcdCAgICAgICAgICAgIG5ld190cmVlID0gYXN0LnBhcnNlKG5ld19jb2RlLnN0cmlwKCkpXG4gICA0NDRcdCAgICAgICAgICAgIGlmIG5vdCBuZXdfdHJlZS5ib2R5OiBsb2dnZXIuZXJyb3IoXCJDYW5ub3QgYWRkIGVtcHR5IGVsZW1lbnQuXCIpOyByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgNDQ1XHQgICAgICAgICAgICBub2RlX3RvX2FkZCA9IG5ld190cmVlLmJvZHlbMF1cbiAgIDQ0Nlx0ICAgICAgICAgICAgdGVtcF9uYW1lID0gZ2V0YXR0cihub2RlX3RvX2FkZCwgJ25hbWUnLCBOb25lKVxuICAgNDQ3XHQgICAgICAgICAgICAjIExldCB1cHNlcnQgaGFuZGxlIHR5cGUgZGVkdWN0aW9uIGJ5IHBhc3NpbmcgXCJ1bmtub3duXCJcbiAgIDQ0OFx0ICAgICAgICAgICAgdGVtcF90eXBlX3N0ciA9IFwidW5rbm93blwiXG4gICA0NDlcdCAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uobm9kZV90b19hZGQsIChhc3QuSW1wb3J0LCBhc3QuSW1wb3J0RnJvbSkpOiB0ZW1wX25hbWUgPSAnYWxsJ1xuICAgNDUwXHRcbiAgIDQ1MVx0ICAgICAgICAgICAgaWYgdGVtcF9uYW1lIGFuZCB0ZW1wX3R5cGVfc3RyOlxuICAgNDUyXHQgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYudXBzZXJ0X2VsZW1lbnQob3JpZ2luYWxfY29kZSwgdGVtcF90eXBlX3N0ciwgdGVtcF9uYW1lLCBuZXdfY29kZSwgcGFyZW50X25hbWUpXG4gICA0NTNcdCAgICAgICAgICAgIGVsc2U6IGxvZ2dlci5lcnJvcihmXCJDb3VsZCBub3QgZGVkdWNlIG5hbWUvdHlwZSBmb3IgYWRkX2VsZW1lbnQ6IHtuZXdfY29kZVs6MTAwXX0uLi5cIilcbiAgIDQ1NFx0ICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6IGxvZ2dlci5lcnJvcihmXCJFcnJvciBwcmVwYXJpbmcgZm9yIGFkZF9lbGVtZW50OiB7ZX1cIilcbiAgIDQ1NVx0ICAgICAgICByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgNDU2XHRcbiAgIDQ1N1x0ICAgIGRlZiByZXBsYWNlX2VsZW1lbnQoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCBuYW1lOiBzdHIsIG5ld19jb2RlOiBzdHIsIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IHN0cjpcbiAgIDQ1OFx0ICAgICAgICBsb2dnZXIuZGVidWcoZlwiQ2FsbGluZyByZXBsYWNlX2VsZW1lbnQgZm9yICd7bmFtZX0nLCBwYXJlbnQgJ3twYXJlbnRfbmFtZX0nIC0gZGVsZWdhdGluZyB0eXBlIGRldGVjdGlvbiB0byB1cHNlcnQuXCIpXG4gICA0NTlcdCAgICAgICAgIyBQYXNzIFwidW5rbm93blwiIC0gdXBzZXJ0IHdpbGwgdHJ5IHRvIGZpbmQgZXhpc3Rpbmcgb3IgZGVkdWNlIGZyb20gbmV3X2NvZGVcbiAgIDQ2MFx0ICAgICAgICByZXR1cm4gc2VsZi51cHNlcnRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBcInVua25vd25cIiwgbmFtZSwgbmV3X2NvZGUsIHBhcmVudF9uYW1lKVxuICAgNDYxXHRcbiAgIDQ2Mlx0ICAgIGRlZiByZW1vdmVfZWxlbWVudChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIG5hbWU6IHN0ciwgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl09Tm9uZSkgLT4gc3RyOlxuICAgNDYzXHQgICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJDYWxsaW5nIHJlbW92ZV9lbGVtZW50IGZvciAne25hbWV9JywgcGFyZW50ICd7cGFyZW50X25hbWV9JyAtIGRlbGVnYXRpbmcgdHlwZSBkZXRlY3Rpb24gdG8gdXBzZXJ0LlwiKVxuICAgNDY0XHQgICAgICAgICMgUGFzcyBcInVua25vd25cIiAtIHVwc2VydCB3aWxsIHRyeSB0byBmaW5kIHRoZSBlbGVtZW50IGZpcnN0IHRvIGRldGVybWluZSB0eXBlXG4gICA0NjVcdCAgICAgICAgcmV0dXJuIHNlbGYudXBzZXJ0X2VsZW1lbnQob3JpZ2luYWxfY29kZSwgXCJ1bmtub3duXCIsIG5hbWUsIFwiXCIsIHBhcmVudF9uYW1lKVxuICAgNDY2XHRcbiAgIDQ2N1x0ICAgIGRlZiB1cHNlcnRfZWxlbWVudF9ieV94cGF0aChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIHhwYXRoOiBzdHIsIG5ld19jb2RlOiBzdHIpIC0+IHN0cjpcbiAgIDQ2OFx0ICAgICAgICBmcm9tIGNvZGVoZW0uY29yZS5lbmdpbmUueHBhdGhfcGFyc2VyIGltcG9ydCBYUGF0aFBhcnNlclxuICAgNDY5XHQgICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJDYWxsaW5nIHVwc2VydF9lbGVtZW50X2J5X3hwYXRoIGZvciAne3hwYXRofSdcIilcbiAgIDQ3MFx0ICAgICAgICB0cnk6XG4gICA0NzFcdCAgICAgICAgICAgIGVsZW1lbnRfbmFtZSwgcGFyZW50X25hbWUsIGVsZW1lbnRfdHlwZV9zdHJfZnJvbV94cGF0aCA9IFhQYXRoUGFyc2VyLmdldF9lbGVtZW50X2luZm8oeHBhdGgpXG4gICA0NzJcdCAgICAgICAgICAgIG9wX2VsZW1lbnRfdHlwZV9zdHIgPSBlbGVtZW50X3R5cGVfc3RyX2Zyb21feHBhdGggaWYgZWxlbWVudF90eXBlX3N0cl9mcm9tX3hwYXRoIGVsc2UgXCJ1bmtub3duXCJcbiAgIDQ3M1x0ICAgICAgICAgICAgb3BfbmFtZSA9IGVsZW1lbnRfbmFtZVxuICAgNDc0XHQgICAgICAgICAgICBpZiBub3Qgb3BfbmFtZSBhbmQgb3BfZWxlbWVudF90eXBlX3N0ciA9PSBDb2RlRWxlbWVudFR5cGUuSU1QT1JULnZhbHVlOiBvcF9uYW1lID0gJ2FsbCdcbiAgIDQ3NVx0ICAgICAgICAgICAgZWxpZiBub3Qgb3BfbmFtZTpcbiAgIDQ3Nlx0ICAgICAgICAgICAgICAgICAjIFRyeSBkZWR1Y2luZyBuYW1lIGZyb20gbmV3X2NvZGUgaWYgWFBhdGggd2FzIGxpa2UgJ1tjbGFzc10nXG4gICA0NzdcdCAgICAgICAgICAgICAgICAgdHJ5OlxuICAgNDc4XHQgICAgICAgICAgICAgICAgICAgICAgbmV3X3RyZWUgPSBhc3QucGFyc2UobmV3X2NvZGUuc3RyaXAoKSlcbiAgIDQ3OVx0ICAgICAgICAgICAgICAgICAgICAgIGlmIG5ld190cmVlLmJvZHkgYW5kIGhhc2F0dHIobmV3X3RyZWUuYm9keVswXSwgJ25hbWUnKTogb3BfbmFtZSA9IG5ld190cmVlLmJvZHlbMF0ubmFtZVxuICAgNDgwXHQgICAgICAgICAgICAgICAgICAgICAgZWxzZTogcmFpc2UgVmFsdWVFcnJvcihcIkNhbm5vdCBkZXRlcm1pbmUgbmFtZSBmb3IgWFBhdGggdXBzZXJ0LlwiKVxuICAgNDgxXHQgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgcGFyc2VfZXJyOlxuICAgNDgyXHQgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGZcIkNvdWxkIG5vdCBkZWR1Y2UgbmFtZSBmcm9tIG5ldyBjb2RlIGZvciBYUGF0aCAne3hwYXRofSc6IHtwYXJzZV9lcnJ9XCIpXG4gICA0ODNcdCAgICAgICAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGZcIkNhbm5vdCB1cHNlcnQgdmlhIFhQYXRoICd7eHBhdGh9JyB3aXRob3V0IG5hbWUuXCIpXG4gICA0ODRcdFxuICAgNDg1XHQgICAgICAgICAgICByZXR1cm4gc2VsZi51cHNlcnRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBvcF9lbGVtZW50X3R5cGVfc3RyLCBvcF9uYW1lLCBuZXdfY29kZSwgcGFyZW50X25hbWUpXG4gICA0ODZcdCAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxuICAgNDg3XHQgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGZcIkVycm9yIHByb2Nlc3NpbmcgWFBhdGggdXBzZXJ0IGZvciAne3hwYXRofSc6IHtlfVwiLCBleGNfaW5mbz1UcnVlKVxuICAgNDg4XHQgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcblRvdGFsIGxpbmVzIGluIGZpbGU6IDQ4OFxuIiwiaXNfZXJyb3IiOmZhbHNlLCJyZXF1ZXN0X2lkIjoiIiwidG9vbF91c2VfaWQiOiJ0b29sdV92cnR4XzAxRThNampjWW9SUFdHcEhNUVpTVUYxbSJ9fSx7ImlkIjoyLCJ0eXBlIjo0LCJpZGVfc3RhdGVfbm9kZSI6eyJ3b3Jrc3BhY2VGb2xkZXJzIjpbeyJyZXBvc2l0b3J5Um9vdCI6IkQ6L2NvZGUvQ29kZUhlbSIsImZvbGRlclJvb3QiOiJEOi9jb2RlL0NvZGVIZW0ifV0sIndvcmtzcGFjZUZvbGRlcnNVbmNoYW5nZWQiOmZhbHNlfX1dLCJyZXNwb25zZV90ZXh0IjoiIyMgUHl0aG9uIEFTVCBNYW5pcHVsYXRvciAtIFd5amHFm25pZW5pZVxuXG5QeXRob24gQVNUIE1hbmlwdWxhdG9yIHRvIHphYXdhbnNvd2FueSBrb21wb25lbnQgdyBDb2RlSGVtLCBrdMOzcnkgc8WCdcW8eSBkbyBtYW5pcHVsYWNqaSBrb2RlbSBQeXRob24gcHJ6eSB1xbx5Y2l1IEFic3RyYWN0IFN5bnRheCBUcmVlIChBU1QpLiBPdG8gc3pjemVnw7PFgm93ZSB3eWphxZtuaWVuaWU6XG5cbiMjIyBDenltIGplc3QgUHl0aG9uIEFTVCBNYW5pcHVsYXRvclxuXG5QeXRob24gQVNUIE1hbmlwdWxhdG9yIHRvIHNwZWNqYWxpc3R5Y3pueSBtYW5pcHVsYXRvciwga3TDs3J5IHd5a29yenlzdHVqZSBtb2R1xYIgYGFzdGAgeiBiaWJsaW90ZWtpIHN0YW5kYXJkb3dlaiBQeXRob25hIGRvIGFuYWxpenkgaSBtb2R5ZmlrYWNqaSBrb2R1IMW6csOzZMWCb3dlZ28gbmEgcG96aW9taWUgZHJ6ZXdhIHNrxYJhZG5pb3dlZ28uIFcgcHJ6ZWNpd2llxYRzdHdpZSBkbyBwcm9zdHN6eWNoIG1hbmlwdWxhdG9yw7N3IG9wYXJ0eWNoIG5hIHRla8WbY2llLCBBU1QgTWFuaXB1bGF0b3I6XG5cbjEuICoqUGFyc3VqZSBrb2QgZG8gZHJ6ZXdhIEFTVCoqIC0ga29ud2VydHVqZSBrb2Qgxbpyw7NkxYJvd3kgbmEgc3RydWt0dXLEmSBkcnpld2EsIGt0w7NyYSByZXByZXplbnR1amUgamVnbyBza8WCYWRuacSZXG4yLiAqKk1vZHlmaWt1amUgZHJ6ZXdvIEFTVCoqIC0gZG9kYWplLCB1c3V3YSBsdWIgem1pZW5pYSB3xJl6xYJ5IHcgZHJ6ZXdpZVxuMy4gKipLb253ZXJ0dWplIHptb2R5Zmlrb3dhbmUgZHJ6ZXdvIHogcG93cm90ZW0gbmEga29kKiogLSB1xbx5d2FqxIVjIGZ1bmtjamkgYGFzdC51bnBhcnNlKClgXG5cbiMjIyBHxYLDs3duZSBrb21wb25lbnR5XG5cbjEuICoqUmVwbGFjZU9ySW5zZXJ0VHJhbnNmb3JtZXIqKiAobGluaWUgOS0yODUpOlxuICAgLSBLbGFzYSBkemllZHppY3rEhWNhIHBvIGBhc3QuTm9kZVRyYW5zZm9ybWVyYFxuICAgLSBPZHBvd2lhZGEgemEgcHJ6ZWNob2R6ZW5pZSBwcnpleiBkcnpld28gQVNUIGkgd3lrb255d2FuaWUgb3BlcmFjamkgemFzdMSZcG93YW5pYSBsdWIgd3N0YXdpYW5pYSB3xJl6xYLDs3dcbiAgIC0gWmF3aWVyYSBsb2dpa8SZIGRvIGlkZW50eWZpa2Fjamkgd8SZesWCw7N3IGRvY2Vsb3d5Y2ggaSBva3JlxZtsYW5pYSBwdW5rdMOzdyB3c3Rhd2lhbmlhXG5cbjIuICoqUHl0aG9uQVNUTWFuaXB1bGF0b3IqKiAobGluaWUgMjg3LTQ4OCk6XG4gICAtIEltcGxlbWVudGFjamEgYE1hbmlwdWxhdG9yQmFzZWAgdcW8eXdhasSFY2EgQVNUXG4gICAtIFphcGV3bmlhIG1ldG9keSB3eXNva2llZ28gcG96aW9tdSBkbyBtYW5pcHVsYWNqaSBrb2RlbTpcbiAgICAgLSBgdXBzZXJ0X2VsZW1lbnRgIC0gZG9kYWplIGx1YiB6YXN0xJlwdWplIGVsZW1lbnQga29kdVxuICAgICAtIGBhZGRfZWxlbWVudGAgLSBkb2RhamUgbm93eSBlbGVtZW50XG4gICAgIC0gYHJlcGxhY2VfZWxlbWVudGAgLSB6YXN0xJlwdWplIGlzdG5pZWrEhWN5IGVsZW1lbnRcbiAgICAgLSBgcmVtb3ZlX2VsZW1lbnRgIC0gdXN1d2EgZWxlbWVudFxuICAgICAtIGB1cHNlcnRfZWxlbWVudF9ieV94cGF0aGAgLSBkb2RhamUgbHViIHphc3TEmXB1amUgZWxlbWVudCB1xbx5d2FqxIVjIHd5cmHFvGVuaWEgWFBhdGhcblxuIyMjIEphayBkemlhxYJhXG5cbjEuICoqQW5hbGl6YSBrb2R1IMW6csOzZMWCb3dlZ28qKjpcbiAgIGBgYHB5dGhvblxuICAgb3JpZ2luYWxfdHJlZSA9IGFzdC5maXhfbWlzc2luZ19sb2NhdGlvbnMoYXN0LnBhcnNlKG9yaWdpbmFsX2NvZGUpKVxuICAgYGBgXG5cbjIuICoqSWRlbnR5ZmlrYWNqYSBlbGVtZW50dSBkbyBtb2R5ZmlrYWNqaSoqOlxuICAgLSBabmFqZHVqZSBlbGVtZW50IHcga29kemllIHXFvHl3YWrEhWMgdXPFgnVnaSBla3N0cmFrY2ppXG4gICAtIE9rcmXFm2xhIGplZ28gcG96eWNqxJkgKG51bWVyeSBsaW5paSlcbiAgIC0gSWRlbnR5ZmlrdWplIHR5cCBlbGVtZW50dSAoZnVua2NqYSwga2xhc2EsIG1ldG9kYSwgaW1wb3J0KVxuXG4zLiAqKlRyYW5zZm9ybWFjamEgQVNUKio6XG4gICBgYGBweXRob25cbiAgIHRyYW5zZm9ybWVyID0gUmVwbGFjZU9ySW5zZXJ0VHJhbnNmb3JtZXIoLi4uKVxuICAgbW9kaWZpZWRfdHJlZSA9IHRyYW5zZm9ybWVyLnZpc2l0KG9yaWdpbmFsX3RyZWUpXG4gICBgYGBcblxuNC4gKipLb253ZXJzamEgeiBwb3dyb3RlbSBuYSBrb2QqKjpcbiAgIGBgYHB5dGhvblxuICAgbmV3X3NvdXJjZSA9IGFzdC51bnBhcnNlKG1vZGlmaWVkX3RyZWUpXG4gICBgYGBcblxuIyMjIFphbGV0eSBwb2RlasWbY2lhIEFTVFxuXG4xLiAqKsWad2lhZG9tb8WbxIcgc2vFgmFkbmkqKiAtIG1hbmlwdWxhY2plIHPEhSB3eWtvbnl3YW5lIHogcGXFgm55bSB6cm96dW1pZW5pZW0gc3RydWt0dXJ5IGtvZHVcbjIuICoqT2Rwb3Jub8WbxIcgbmEgYsWCxJlkeSoqIC0gbW5pZWpzemUgcnl6eWtvIHVzemtvZHplbmlhIGtvZHVcbjMuICoqT2JzxYJ1Z2EgesWCb8W8b255Y2ggcHJ6eXBhZGvDs3cqKiAtIG5wLiBibG9raSBpbXBvcnTDs3csIGRla29yYXRvcnksIHfFgmHFm2Npd2/Fm2NpXG40LiAqKlphY2hvd2FuaWUgZm9ybWF0b3dhbmlhKiogLSBsZXBzemUgemFjaG93YW5pZSBzdHJ1a3R1cnkga29kdVxuXG4jIyMgSW50ZWdyYWNqYSB6IHN5c3RlbWVtXG5cblcgcGxpa3UgYGNvZGVoZW0vbGFuZ3VhZ2VzL2xhbmdfcHl0aG9uL19faW5pdF9fLnB5YCB3aWRhxIcsIMW8ZSBQeXRob24gQVNUIE1hbmlwdWxhdG9yIGplc3QgcmVqZXN0cm93YW55IGRsYSByw7PFvG55Y2ggdHlww7N3IGVsZW1lbnTDs3cga29kdTpcblxuYGBgcHl0aG9uXG4jIFJlZ2lzdGVyIEFTVCBtYW5pcHVsYXRvcnMgZm9yIGZ1bmN0aW9uLCBjbGFzcywgaW1wb3J0XG5mb3IgZWxlbWVudF90eXBlX2VudW0gaW4gW1xuICAgIENvZGVFbGVtZW50VHlwZS5GVU5DVElPTixcbiAgICBDb2RlRWxlbWVudFR5cGUuQ0xBU1MsXG4gICAgQ29kZUVsZW1lbnRUeXBlLklNUE9SVCxcbl06XG4gICAgIyAuLi5cbiAgICByZWdpc3RyeS5yZWdpc3Rlcl9tYW5pcHVsYXRvcihXcmFwcGVyKVxuYGBgXG5cblB5dGhvbiBBU1QgTWFuaXB1bGF0b3Igc3Rhbm93aSB3acSZYyB6YWF3YW5zb3dhbsSFIGFsdGVybmF0eXfEmSBkbGEgcHJvc3RzenljaCBtYW5pcHVsYXRvcsOzdyBvcGFydHljaCBuYSB0ZWvFm2NpZSwgemFwZXduaWFqxIVjIGJhcmR6aWVqIG5pZXphd29kbmUgaSBwcmVjeXp5am5lIG1vZHlmaWthY2plIGtvZHUgUHl0aG9uLlxuIiwid29ya3NwYWNlX2ZpbGVfY2h1bmtzIjpbXX1dLCJmZWVkYmFja1N0YXRlcyI6eyJ0ZW1wLWZlLWNlYTExZjA4LTVjNGItNGQ0Zi1iM2ExLWIwNDBlZTE2ZmRiNSI6eyJzZWxlY3RlZFJhdGluZyI6MCwiZmVlZGJhY2tOb3RlIjoiIn0sInRlbXAtZmUtNThhY2Q2YmUtNjYwYS00MmJmLWI2ZDQtNmE0NjMwMmQ4YzU3Ijp7InNlbGVjdGVkUmF0aW5nIjowLCJmZWVkYmFja05vdGUiOiIifSwidGVtcC1mZS00MTE5ODA1Yi01MTRmLTQzMWMtOTYxYi1hNjFkMzkzNTAyOGMiOnsic2VsZWN0ZWRSYXRpbmciOjAsImZlZWRiYWNrTm90ZSI6IiJ9LCJ0ZW1wLWZlLWQ3NDE3ODlkLWRhNTMtNGUxZi04NWUxLTJjM2Y5ODFhMjZmYyI6eyJzZWxlY3RlZFJhdGluZyI6MCwiZmVlZGJhY2tOb3RlIjoiIn0sInRlbXAtZmUtYTVjMTEyYWItMDliMi00M2UwLWJlYWEtOTY0ZjJhMzIxOTZhIjp7InNlbGVjdGVkUmF0aW5nIjowLCJmZWVkYmFja05vdGUiOiIifSwidGVtcC1mZS1jYjcwNzE1OC02YWVlLTRmODMtODNmNC1iZDZkODkxMTkwMTIiOnsic2VsZWN0ZWRSYXRpbmciOjAsImZlZWRiYWNrTm90ZSI6IiJ9LCJ0ZW1wLWZlLTdhMzNlMzdjLWRlMjAtNDNmZS1hZDZiLWM5ZGExZTg3NmY0MCI6eyJzZWxlY3RlZFJhdGluZyI6MCwiZmVlZGJhY2tOb3RlIjoiIn19LCJ0b29sVXNlU3RhdGVzIjp7IjcxMGUwMWE3LTllMzgtNDI5MC05ZmFjLTY1MDFiMWM0YzhmMjt0b29sdV92cnR4XzAxVXd2YVI1cnJqZDN4Q0RDb1lLOVZucCI6eyJwaGFzZSI6NSwicmVzdWx0Ijp7InRleHQiOiJUaGUgZm9sbG93aW5nIGNvZGUgc2VjdGlvbnMgd2VyZSByZXRyaWV2ZWQ6XG5QYXRoOiBjb2RlaGVtL21haW4ucHlcbmltcG9ydCBvc1xuaW1wb3J0IGxvZ2dpbmdcbmZyb20gdHlwaW5nIGltcG9ydCBMaXN0LCBPcHRpb25hbCwgVHVwbGVcblxuZnJvbSAuY29yZS5lbmdpbmUueHBhdGhfcGFyc2VyIGltcG9ydCBYUGF0aFBhcnNlclxuZnJvbSAuY29yZS5leHRyYWN0aW9uX3NlcnZpY2UgaW1wb3J0IEV4dHJhY3Rpb25TZXJ2aWNlXG5mcm9tIC5jb3JlLm1hbmlwdWxhdGlvbl9zZXJ2aWNlIGltcG9ydCBNYW5pcHVsYXRpb25TZXJ2aWNlXG5mcm9tIC5sYW5ndWFnZXMgaW1wb3J0IChcbiAgICBnZXRfbGFuZ3VhZ2Vfc2VydmljZSxcbiAgICBnZXRfbGFuZ3VhZ2Vfc2VydmljZV9mb3JfY29kZSxcbiAgICBnZXRfbGFuZ3VhZ2Vfc2VydmljZV9mb3JfZmlsZSxcbiAgICBnZXRfc3VwcG9ydGVkX2xhbmd1YWdlcyxcbilcbmZyb20gLm1vZGVscy5jb2RlX2VsZW1lbnQgaW1wb3J0IENvZGVFbGVtZW50LCBDb2RlRWxlbWVudHNSZXN1bHRcbmZyb20gLm1vZGVscy5lbnVtcyBpbXBvcnQgQ29kZUVsZW1lbnRUeXBlXG5mcm9tIC5tb2RlbHMueHBhdGggaW1wb3J0IENvZGVFbGVtZW50WFBhdGhOb2RlXG5cbmxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKVxuXG5jbGFzcyBDb2RlSGVtOlxuICAgIFwiXCJcIlxuICAgIE1haW4gZW50cnkgcG9pbnQgZm9yIENvZGVIZW0uXG4gICAgUHJvdmlkZXMgbGFuZ3VhZ2UtYWdub3N0aWMgaW50ZXJmYWNlIGZvciBjb2RlIG1hbmlwdWxhdGlvbi5cbiAgICBcIlwiXCJcblxuICAgIGRlZiBfX2luaXRfXyhzZWxmLCBsYW5ndWFnZV9jb2RlOiBzdHIpOlxuICAgICAgICBcIlwiXCJcbiAgICAgICAgSW5pdGlhbGl6ZSBDb2RlSGVtIGZvciBhIHNwZWNpZmljIGxhbmd1YWdlLlxuXG4gICAgICAgIEFyZ3M6XG4gICAgICAgICAgICBsYW5ndWFnZV9jb2RlOiBMYW5ndWFnZSBjb2RlIChlLmcuLCAncHl0aG9uJywgJ3R5cGVzY3JpcHQnKVxuXG4gICAgICAgIFJhaXNlczpcbiAgICAgICAgICAgIFZhbHVlRXJyb3I6IElmIHRoZSBsYW5ndWFnZSBpcyBub3Qgc3VwcG9ydGVkXG4gICAgICAgIFwiXCJcIlxuICAgICAgICBzZWxmLmxhbmd1YWdlX3NlcnZpY2UgPSBnZXRfbGFuZ3VhZ2Vfc2VydmljZShsYW5ndWFnZV9jb2RlKVxuICAgICAgICBpZiBub3Qgc2VsZi5sYW5ndWFnZV9zZXJ2aWNlOlxuICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmXCJVbnN1cHBvcnRlZCBsYW5ndWFnZToge2xhbmd1YWdlX2NvZGV9XCIpXG4uLi5cblxuICAgIEBjbGFzc21ldGhvZFxuICAgIGRlZiBmcm9tX3Jhd19jb2RlKGNscywgY29kZTogc3RyKSAtPiBcIkNvZGVIZW1cIjpcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIENyZWF0ZSBhIENvZGVIZW0gaW5zdGFuY2UgYnkgZGV0ZWN0aW5nIGxhbmd1YWdlIGZyb20gY29kZS5cblxuICAgICAgICBBcmdzOlxuICAgICAgICAgICAgY29kZTogU291cmNlIGNvZGUgYXMgc3RyaW5nXG5cbiAgICAgICAgUmV0dXJuczpcbiAgICAgICAgICAgIENvZGVIZW0gaW5zdGFuY2VcblxuICAgICAgICBSYWlzZXM6XG4gICAgICAgICAgICBWYWx1ZUVycm9yOiBJZiB0aGUgbGFuZ3VhZ2UgY291bGQgbm90IGJlIGRldGVjdGVkXG4gICAgICAgIFwiXCJcIlxuICAgICAgICBsYW5ndWFnZV9zZXJ2aWNlID0gZ2V0X2xhbmd1YWdlX3NlcnZpY2VfZm9yX2NvZGUoY29kZSlcbiAgICAgICAgaWYgbm90IGxhbmd1YWdlX3NlcnZpY2U6XG4gICAgICAgICAgICAjIFJhaXNlIGVycm9yIGluc3RlYWQgb2YgZGVmYXVsdGluZyB0byBQeXRob25cbiAgICAgICAgICAgIHJhaXNlIFZhbHVlRXJyb3IoXCJDb3VsZCBub3QgZGV0ZWN0IGxhbmd1YWdlIGZyb20gY29kZVwiKVxuICAgICAgICAgICAgIyByZXR1cm4gY2xzKCdweXRob24nKSAjIE9sZCBiZWhhdmlvclxuICAgICAgICByZXR1cm4gY2xzKGxhbmd1YWdlX3NlcnZpY2UubGFuZ3VhZ2VfY29kZSlcblxuICAgIEBzdGF0aWNtZXRob2RcbiAgICBkZWYgc3VwcG9ydGVkX2xhbmd1YWdlcygpIC0+IExpc3Rbc3RyXTpcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIEdldCBhIGxpc3Qgb2Ygc3VwcG9ydGVkIGxhbmd1YWdlIGNvZGVzLlxuXG4gICAgICAgIFJldHVybnM6XG4gICAgICAgICAgICBMaXN0IG9mIHN1cHBvcnRlZCBsYW5ndWFnZSBjb2Rlc1xuICAgICAgICBcIlwiXCJcbiAgICAgICAgcmV0dXJuIGdldF9zdXBwb3J0ZWRfbGFuZ3VhZ2VzKClcbi4uLlxuXG4gICAgZGVmIHVwc2VydF9lbGVtZW50KFxuICAgICAgICBzZWxmLFxuICAgICAgICBvcmlnaW5hbF9jb2RlOiBzdHIsXG4gICAgICAgIGVsZW1lbnRfdHlwZTogc3RyLFxuICAgICAgICBuYW1lOiBzdHIsXG4gICAgICAgIG5ld19jb2RlOiBzdHIsXG4gICAgICAgIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdID0gTm9uZSxcbiAgICApIC0+IHN0cjpcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIEFkZCBvciByZXBsYWNlIGFuIGVsZW1lbnQgaW4gdGhlIGNvZGUuXG5cbiAgICAgICAgQXJnczpcbiAgICAgICAgICAgIG9yaWdpbmFsX2NvZGU6IE9yaWdpbmFsIHNvdXJjZSBjb2RlXG4gICAgICAgICAgICBlbGVtZW50X3R5cGU6IFR5cGUgb2YgZWxlbWVudCB0byBhZGQvcmVwbGFjZSAoZnJvbSBDb2RlRWxlbWVudFR5cGUpXG4gICAgICAgICAgICBuYW1lOiBOYW1lIG9mIHRoZSBlbGVtZW50XG4gICAgICAgICAgICBuZXdfY29kZTogTmV3IGNvbnRlbnQgZm9yIHRoZSBlbGVtZW50XG4gICAgICAgICAgICBwYXJlbnRfbmFtZTogTmFtZSBvZiBwYXJlbnQgZWxlbWVudCAoZS5nLiwgY2xhc3MgbmFtZSBmb3IgbWV0aG9kcylcblxuICAgICAgICBSZXR1cm5zOlxuICAgICAgICAgICAgTW9kaWZpZWQgY29kZVxuICAgICAgICBcIlwiXCJcbiAgICAgICAgaWYgbm90IHNlbGYubWFuaXB1bGF0aW9uOlxuICAgICAgICAgICAgIHJhaXNlIFJ1bnRpbWVFcnJvcihcIk1hbmlwdWxhdGlvbiBzZXJ2aWNlIG5vdCBpbml0aWFsaXplZC5cIilcbiAgICAgICAgcmV0dXJuIHNlbGYubWFuaXB1bGF0aW9uLnVwc2VydF9lbGVtZW50KFxuICAgICAgICAgICAgb3JpZ2luYWxfY29kZSwgZWxlbWVudF90eXBlLCBuYW1lLCBuZXdfY29kZSwgcGFyZW50X25hbWVcbiAgICAgICAgKVxuLi4uXG5cbiAgICBkZWYgdXBzZXJ0X2VsZW1lbnRfYnlfeHBhdGgoXG4gICAgICAgIHNlbGYsIG9yaWdpbmFsX2NvZGU6IHN0ciwgeHBhdGg6IHN0ciwgbmV3X2NvZGU6IHN0clxuICAgICkgLT4gc3RyOlxuICAgICAgICBcIlwiXCJcbiAgICAgICAgQWRkIG9yIHJlcGxhY2UgYW4gZWxlbWVudCBpbiB0aGUgY29kZSB1c2luZyBYUGF0aCBleHByZXNzaW9uLlxuICAgICAgICBBdXRvbWF0aWNhbGx5IHByZXBlbmRzIFwiRklMRS5cIiBpZiBtaXNzaW5nLlxuXG4gICAgICAgIEFyZ3M6XG4gICAgICAgICAgICBvcmlnaW5hbF9jb2RlOiBPcmlnaW5hbCBzb3VyY2UgY29kZVxuICAgICAgICAgICAgeHBhdGg6IFhQYXRoIGV4cHJlc3Npb24gKGUuZy4sICdDbGFzc05hbWUubWV0aG9kX25hbWUnLCAnQ2xhc3NOYW1lW2ludGVyZmFjZV0ubWV0aG9kX25hbWVbcHJvcGVydHlfZ2V0dGVyXScpXG4gICAgICAgICAgICBuZXdfY29kZTogTmV3IGNvbnRlbnQgZm9yIHRoZSBlbGVtZW50XG5cbiAgICAgICAgUmV0dXJuczpcbiAgICAgICAgICAgIE1vZGlmaWVkIGNvZGVcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIGlmIG5vdCBzZWxmLm1hbmlwdWxhdGlvbjpcbiAgICAgICAgICAgIHJhaXNlIFJ1bnRpbWVFcnJvcihcIk1hbmlwdWxhdGlvbiBzZXJ2aWNlIG5vdCBpbml0aWFsaXplZC5cIilcbiAgICAgICAgIyBFbnN1cmUgeHBhdGggc3RhcnRzIHdpdGggRklMRS4gYmVmb3JlIHBhc3NpbmcgdG8gbWFuaXB1bGF0aW9uIHNlcnZpY2VcbiAgICAgICAgcHJvY2Vzc2VkX3hwYXRoID0gc2VsZi5fZW5zdXJlX2ZpbGVfcHJlZml4KHhwYXRoKVxuICAgICAgICByZXR1cm4gc2VsZi5tYW5pcHVsYXRpb24udXBzZXJ0X2VsZW1lbnRfYnlfeHBhdGgoXG4gICAgICAgICAgICBvcmlnaW5hbF9jb2RlLCBwcm9jZXNzZWRfeHBhdGgsIG5ld19jb2RlXG4gICAgICAgIClcblxuICAgICMgLS0tIFpNSUFOQTogV3lrb3J6eXN0YW5pZSBfZW5zdXJlX2ZpbGVfcHJlZml4IC0tLVxuICAgIGRlZiBmaW5kX2J5X3hwYXRoKHNlbGYsIGNvZGU6IHN0ciwgeHBhdGg6IHN0cikgLT4gVHVwbGVbaW50LCBpbnRdOlxuICAgICAgICBcIlwiXCJcbiAgICAgICAgRmluZCBhbiBlbGVtZW50J3MgbG9jYXRpb24gdXNpbmcgYW4gWFBhdGggZXhwcmVzc2lvbi5cbiAgICAgICAgQXV0b21hdGljYWxseSBwcmVwZW5kcyBcIkZJTEUuXCIgaWYgbWlzc2luZy5cblxuICAgICAgICBBcmdzOlxuICAgICAgICAgICAgY29kZTogU291cmNlIGNvZGUgYXMgc3RyaW5nXG4gICAgICAgICAgICB4cGF0aDogWFBhdGggZXhwcmVzc2lvbiAoZS5nLiwgJ0NsYXNzTmFtZS5tZXRob2RfbmFtZScsICdDbGFzc05hbWVbaW50ZXJmYWNlXS5tZXRob2RfbmFtZVtwcm9wZXJ0eV9nZXR0ZXJdJylcblxuICAgICAgICBSZXR1cm5zOlxuICAgICAgICAgICAgVHVwbGUgb2YgKHN0YXJ0X2xpbmUsIGVuZF9saW5lKSBvciAoMCwgMCkgaWYgbm90IGZvdW5kXG4gICAgICAgIFwiXCJcIlxuICAgICAgICBpZiBub3Qgc2VsZi5leHRyYWN0aW9uOlxuICAgICAgICAgICAgIHJhaXNlIFJ1bnRpbWVFcnJvcihcIkV4dHJhY3Rpb24gc2VydmljZSBub3QgaW5pdGlhbGl6ZWQuXCIpXG4gICAgICAgIHByb2Nlc3NlZF94cGF0aCA9IHNlbGYuX2Vuc3VyZV9maWxlX3ByZWZpeCh4cGF0aClcbiAgICAgICAgcmV0dXJuIHNlbGYuZXh0cmFjdGlvbi5maW5kX2J5X3hwYXRoKGNvZGUsIHByb2Nlc3NlZF94cGF0aClcbi4uLlxuXG4gICAgICAgIFJldHVybnM6XG4gICAgICAgICAgICBUZXh0IGNvbnRlbnQgb2YgdGhlIGVsZW1lbnQsIG9yIE5vbmUgaWYgbm90IGZvdW5kXG4gICAgICAgIFwiXCJcIlxuICAgICAgICBpZiBub3Qgc2VsZi5sYW5ndWFnZV9zZXJ2aWNlOlxuICAgICAgICAgICAgcmFpc2UgUnVudGltZUVycm9yKFwiTGFuZ3VhZ2Ugc2VydmljZSBub3QgaW5pdGlhbGl6ZWQuXCIpXG4gICAgICAgICMgRW5zdXJlIHhwYXRoIHN0YXJ0cyB3aXRoIEZJTEUuIGJlZm9yZSBwYXJzaW5nXG4gICAgICAgIHByb2Nlc3NlZF94cGF0aCA9IHNlbGYuX2Vuc3VyZV9maWxlX3ByZWZpeCh4cGF0aClcbiAgICAgICAgdHJ5OlxuICAgICAgICAgICAgIyBQYXJzZSB0aGUgcG90ZW50aWFsbHkgbW9kaWZpZWQgeHBhdGhcbiAgICAgICAgICAgIHhwYXRoX25vZGVzID0gWFBhdGhQYXJzZXIucGFyc2UocHJvY2Vzc2VkX3hwYXRoKVxuICAgICAgICAgICAgaWYgbm90IHhwYXRoX25vZGVzOlxuICAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmXCJDb3VsZCBub3QgcGFyc2UgWFBhdGg6ICd7cHJvY2Vzc2VkX3hwYXRofSdcIilcbiAgICAgICAgICAgICAgICAgcmV0dXJuIE5vbmVcbiAgICAgICAgICAgICMgQ2FsbCBpbnRlcm5hbCBtZXRob2Qgd2l0aCBwYXJzZWQgbm9kZXNcbiAgICAgICAgICAgIHJldHVybiBzZWxmLmxhbmd1YWdlX3NlcnZpY2UuZ2V0X3RleHRfYnlfeHBhdGhfaW50ZXJuYWwoY29kZSwgeHBhdGhfbm9kZXMpXG4gICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcbiAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZlwiRXJyb3IgZ2V0dGluZyB0ZXh0IGJ5IFhQYXRoICd7eHBhdGh9JyAocHJvY2Vzc2VkOiAne3Byb2Nlc3NlZF94cGF0aH0nKToge2V9XCIsIGV4Y19pbmZvPVRydWUpXG4gICAgICAgICAgICAgcmV0dXJuIE5vbmVcblxuICAgIGRlZiBleHRyYWN0KHNlbGYsIGNvZGU6IHN0cikgLT4gQ29kZUVsZW1lbnRzUmVzdWx0OlxuICAgICAgICBcIlwiXCJcbiAgICAgICAgRXh0cmFjdCBjb2RlIGVsZW1lbnRzIGZyb20gdGhlIHNvdXJjZSBjb2RlLlxuXG4gICAgICAgIEFyZ3M6XG4gICAgICAgICAgICBjb2RlOiBTb3VyY2UgY29kZSBhcyBzdHJpbmdcblxuICAgICAgICBSZXR1cm5zOlxuICAgICAgICAgICAgQ29kZUVsZW1lbnRzUmVzdWx0IGNvbnRhaW5pbmcgZXh0cmFjdGVkIGVsZW1lbnRzXG4gICAgICAgIFwiXCJcIlxuICAgICAgICBpZiBub3Qgc2VsZi5leHRyYWN0aW9uOlxuICAgICAgICAgICAgIHJhaXNlIFJ1bnRpbWVFcnJvcihcIkV4dHJhY3Rpb24gc2VydmljZSBub3QgaW5pdGlhbGl6ZWQuXCIpXG4gICAgICAgIHJldHVybiBzZWxmLmV4dHJhY3Rpb24uZXh0cmFjdF9hbGwoY29kZSlcblxuICAgIEBzdGF0aWNtZXRob2RcbiAgICBkZWYgX2Vuc3VyZV9maWxlX3ByZWZpeF9zdGF0aWMoeHBhdGg6IHN0cikgLT4gc3RyOlxuICAgICAgICBcIlwiXCJTdGF0aWMgaGVscGVyIHRvIGVuc3VyZSBYUGF0aCBzdGFydHMgd2l0aCBGSUxFLlwiXCJcIlxuICAgICAgICByb290X3ByZWZpeCA9IFhQYXRoUGFyc2VyLlJPT1RfRUxFTUVOVCArIFwiLlwiXG4gICAgICAgIGlmIG5vdCB4cGF0aC5zdGFydHN3aXRoKHJvb3RfcHJlZml4KSBhbmQgbm90IHhwYXRoLnN0YXJ0c3dpdGgoXCJbXCIpOlxuICAgICAgICAgICAgIyBOb3RlOiBTdGF0aWMgbWV0aG9kIGRvZXNuJ3QgaGF2ZSBsb2dnZXIgaW5zdGFuY2UgZWFzaWx5XG4gICAgICAgICAgICAjIHByaW50KGZcIkRFQlVHOiBYUGF0aCAne3hwYXRofScgZG9lcyBub3Qgc3RhcnQgd2l0aCAne3Jvb3RfcHJlZml4fScuIFByZXBlbmRpbmcgaXQuXCIpXG4gICAgICAgICAgICB4cGF0aCA9IHJvb3RfcHJlZml4ICsgeHBhdGhcbiAgICAgICAgcmV0dXJuIHhwYXRoXG5cbiAgICBAc3RhdGljbWV0aG9kXG4gICAgZGVmIGZpbHRlcihlbGVtZW50czogQ29kZUVsZW1lbnRzUmVzdWx0LCB4cGF0aDogc3RyID0gXCJcIikgLT4gT3B0aW9uYWxbQ29kZUVsZW1lbnRdOlxuICAgICAgICBcIlwiXCJcbiAgICAgICAgRmlsdGVyIGNvZGUgZWxlbWVudHMgYmFzZWQgb24gWFBhdGggZXhwcmVzc2lvbi5cbiAgICAgICAgQXV0b21hdGljYWxseSBwcmVwZW5kcyBcIkZJTEUuXCIgaWYgbWlzc2luZy5cblxuICAgICAgICBBcmdzOlxuICAgICAgICAgICAgZWxlbWVudHM6IENvZGVFbGVtZW50c1Jlc3VsdCBjb250YWluaW5nIGVsZW1lbnRzXG4gICAgICAgICAgICB4cGF0aDogWFBhdGggZXhwcmVzc2lvbiAoZS5nLiwgJ0NsYXNzTmFtZS5tZXRob2RfbmFtZScsICdDbGFzc05hbWVbaW50ZXJmYWNlXS5tZXRob2RfbmFtZVtwcm9wZXJ0eV9nZXR0ZXJdJylcblxuICAgICAgICBSZXR1cm5zOlxuICAgICAgICAgICAgTWF0Y2hpbmcgQ29kZUVsZW1lbnQgb3IgTm9uZSBpZiBub3QgZm91bmRcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIGlmIG5vdCB4cGF0aCBvciBub3QgZWxlbWVudHMgb3Igbm90IGhhc2F0dHIoZWxlbWVudHMsICdlbGVtZW50cycpIG9yIG5vdCBlbGVtZW50cy5lbGVtZW50czpcbiAgICAgICAgICAgIHJldHVybiBOb25lXG5cbiAgICAgICAgIyBFbnN1cmUgeHBhdGggc3RhcnRzIHdpdGggRklMRS4gYmVmb3JlIHBhcnNpbmdcbiAgICAgICAgcHJvY2Vzc2VkX3hwYXRoID0gQ29kZUhlbS5fZW5zdXJlX2ZpbGVfcHJlZml4X3N0YXRpYyh4cGF0aClcblxuICAgICAgICB0cnk6XG4gICAgICAgICAgICAjIFBhcnNlIHRoZSBwb3RlbnRpYWxseSBtb2RpZmllZCB4cGF0aFxuICAgICAgICAgICAgZWxlbWVudF9uYW1lLCBwYXJlbnRfbmFtZSwgZWxlbWVudF90eXBlID0gWFBhdGhQYXJzZXIuZ2V0X2VsZW1lbnRfaW5mbyhwcm9jZXNzZWRfeHBhdGgpXG4uLi5cblBhdGg6IFJFQURNRS5tZFxuIyBDb2RlSGVtXG5cbkNvZGVIZW0gaXMgYSBsYW5ndWFnZS1hZ25vc3RpYyBsaWJyYXJ5IGRlc2lnbmVkIGZvciBzb3BoaXN0aWNhdGVkIHF1ZXJ5aW5nIGFuZCBtYW5pcHVsYXRpb24gb2Ygc291cmNlIGNvZGUuIFxuSXQgcHJvdmlkZXMgYSBoaWdoLWxldmVsIGludGVyZmFjZSB0byBlZmZvcnRsZXNzbHkgbmF2aWdhdGUsIGFuYWx5emUsIGFuZCBtb2RpZnkgY29kZSBlbGVtZW50cyBzdWNoIGFzIGZ1bmN0aW9ucywgXG5jbGFzc2VzLCBtZXRob2RzLCBhbmQgcHJvcGVydGllcyBhY3Jvc3MgbXVsdGlwbGUgcHJvZ3JhbW1pbmcgbGFuZ3VhZ2VzLCBpbmNsdWRpbmcgUHl0aG9uLCBKYXZhU2NyaXB0LCBhbmQgVHlwZVNjcmlwdC5cblxuIyMgS2V5IEZlYXR1cmVzXG5cbi0gKipBZHZhbmNlZCBDb2RlIFF1ZXJ5aW5nKio6IEVhc2lseSBsb2NhdGUgZnVuY3Rpb25zLCBjbGFzc2VzLCBtZXRob2RzLCBwcm9wZXJ0aWVzLCBpbXBvcnRzLCBhbmQgbW9yZSB3aXRoaW4geW91ciBzb3VyY2UgY29kZSwgdXNpbmcgYSB1bmlmb3JtLCBpbnR1aXRpdmUgQVBJLlxuLSAqKlBvd2VyZnVsIENvZGUgTWFuaXB1bGF0aW9uKio6IFJlcGxhY2UsIGFkZCwgb3IgcmVtb3ZlIGZ1bmN0aW9ucywgbWV0aG9kcywgY2xhc3NlcywgcHJvcGVydGllcywgb3IgZW50aXJlIGNvZGUgc2VjdGlvbnMgd2l0aCBtaW5pbWFsIGVmZm9ydC5cbi0gKipTeW50YXgtYXdhcmUgT3BlcmF0aW9ucyoqOiBFbnN1cmVzIGFjY3VyYXRlIG1hbmlwdWxhdGlvbiBwcmVzZXJ2aW5nIHN5bnRheCBpbnRlZ3JpdHkgdGhyb3VnaCB0aGUgYHRyZWUtc2l0dGVyYCBwYXJzZXIuXG4tICoqTGFuZ3VhZ2UgRGV0ZWN0aW9uKio6IEF1dG9tYXRpY2FsbHkgaWRlbnRpZmllcyB0aGUgcHJvZ3JhbW1pbmcgbGFuZ3VhZ2UgYmFzZWQgb24gZmlsZSBleHRlbnNpb25zIG9yIGNvZGUgYW5hbHlzaXMuXG4tICoqRXh0ZW5zaWJsZSBBcmNoaXRlY3R1cmUqKjogRWFzaWx5IGFkZCBzdXBwb3J0IGZvciBuZXcgcHJvZ3JhbW1pbmcgbGFuZ3VhZ2VzIHRocm91Z2ggdGhlIHN0cmF0ZWd5IHBhdHRlcm4uXG5cbiMjIFN1cHBvcnRlZCBMYW5ndWFnZXNcblxuLSBQeXRob25cbi0gSmF2YVNjcmlwdCAvIFR5cGVTY3JpcHQgKGluY2x1ZGluZyBUU1gpXG5cbiMjIEluc3RhbGxhdGlvblxuXG4jIyMgVXNpbmcgcGlwIC8gcGlweFxuXG5UaGUgc2ltcGxlc3Qgd2F5IHRvIGluc3RhbGwgQ29kZUhlbTpcblxuYGBgYmFzaFxucGlwIGluc3RhbGwgY29kZWhlbVxuYGBgYFxub3JcblxuYGBgYmFzaFxucGlweCBpbnN0YWxsIGNvZGVoZW1cbmBgYGBcblxuIyMgUHJvamVjdCBTdHJ1Y3R1cmVcblxuYGBgXG5Db2RlSGVtL1xu4pSc4pSA4pSAIGFzdF9oYW5kbGVyLnB5ICAgICAgICAgICAgIyBVbmlmaWVkIGludGVyZmFjZSBmb3IgQVNUIG9wZXJhdGlvbnNcbuKUnOKUgOKUgCBjYWNoaW5nLyAgICAgICAgICAgICAgICAgICMgUGVyZm9ybWFuY2Ugb3B0aW1pemF0aW9uIHRocm91Z2ggY2FjaGluZ1xu4pSCICAg4pSc4pSA4pSAIF9faW5pdF9fLnB5XG7ilIIgICDilJTilIDilIAgY2FjaGVfbWFuYWdlci5weVxu4pSCXG7ilJzilIDilIAgZmluZGVyLyAgICAgICAgICAgICAgICAgICAjIENvZGUgZWxlbWVudCBsb2NhdGlvblxu4pSCICAg4pSc4pSA4pSAIGJhc2UucHkgICAgICAgICAgICAgICAjIEFic3RyYWN0IGJhc2UgY2xhc3MgZm9yIHF1ZXJ5aW5nIGNvZGUgZWxlbWVudHNcbuKUgiAgIOKUnOKUgOKUgCBmYWN0b3J5LnB5ICAgICAgICAgICAgIyBGYWN0b3J5IGZvciBjcmVhdGluZyBjb2RlIGZpbmRlcnNcbuKUgiAgIOKUlOKUgOKUgCBsYW5nL1xu4pSCICAgICAgIOKUnOKUgOKUgCBweXRob25fY29kZV9maW5kZXIucHlcbuKUgiAgICAgICDilJTilIDilIAgdHlwZXNjcmlwdF9jb2RlX2ZpbmRlci5weVxu4pSCXG7ilJzilIDilIAgZm9ybWF0dGluZy8gICAgICAgICAgICAgICAjIENvZGUgZm9ybWF0dGluZyBzeXN0ZW1cbuKUgiAgIOKUnOKUgOKUgCBfX2luaXRfXy5weVxu4pSCICAg4pSc4pSA4pSAIGZvcm1hdHRlci5weSAgICAgICAgICAjIEJhc2UgZm9ybWF0dGVyIGNsYXNzXG7ilIIgICDilJzilIDilIAgcHl0aG9uX2Zvcm1hdHRlci5weSAgICMgUHl0aG9uLXNwZWNpZmljIGZvcm1hdHRlclxu4pSCICAg4pSU4pSA4pSAIHR5cGVzY3JpcHRfZm9ybWF0dGVyLnB5ICMgVHlwZVNjcmlwdC1zcGVjaWZpYyBmb3JtYXR0ZXJcbuKUglxu4pSc4pSA4pSAIGxhbmd1YWdlX2hhbmRsZXIucHkgICAgICAgIyBIaWdoLWxldmVsIGxhbmd1YWdlIGhhbmRsaW5nIGludGVyZmFjZSAoTGFuZ0hlbSlcbuKUnOKUgOKUgCBsYW5ndWFnZXMucHkgICAgICAgICAgICAgICMgTGFuZ3VhZ2UgZGVmaW5pdGlvbnMgYW5kIHBhcnNlcnNcbuKUglxu4pSc4pSA4pSAIG1hbmlwdWxhdG9yLyAgICAgICAgICAgICAgIyBDb2RlIG1hbmlwdWxhdGlvblxu4pSCICAg4pSc4pSA4pSAIGFic3RyYWN0LnB5ICAgICAgICAgICAjIEFic3RyYWN0IGludGVyZmFjZSBmb3IgY29kZSBtYW5pcHVsYXRvcnNcbuKUgiAgIOKUnOKUgOKUgCBiYXNlLnB5ICAgICAgICAgICAgICAgIyBCYXNlIGltcGxlbWVudGF0aW9uXG7ilIIgICDilJzilIDilIAgZmFjdG9yeS5weSAgICAgICAgICAgICMgRmFjdG9yeSBmb3IgbWFuaXB1bGF0b3JzXG7ilIIgICDilJTilIDilIAgbGFuZy9cbuKUgiAgICAgICDilJzilIDilIAgcHl0aG9uX21hbmlwdWxhdG9yLnB5XG7ilIIgICAgICAg4pSU4pSA4pSAIHR5cGVzY3JpcHRfbWFuaXB1bGF0b3IucHlcbuKUglxu4pSc4pSA4pSAIHF1ZXJ5X2J1aWxkZXIucHkgICAgICAgICAgIyBVbmlmaWVkIHF1ZXJ5IGNvbnN0cnVjdGlvblxu4pSCXG7ilJzilIDilIAgc3RyYXRlZ2llcy8gICAgICAgICAgICAgICAjIFN0cmF0ZWd5IHBhdHRlcm4gZm9yIGxhbmd1YWdlLXNwZWNpZmljIG9wZXJhdGlvbnNcbuKUgiAgIOKUnOKUgOKUgCBfX2luaXRfXy5weVxu4pSCICAg4pSc4pSA4pSAIGxhbmd1YWdlX3N0cmF0ZWd5LnB5ICAjIEFic3RyYWN0IHN0cmF0ZWd5IGludGVyZmFjZVxu4pSCICAg4pSc4pSA4pSAIHB5dGhvbl9zdHJhdGVneS5weSAgICAjIFB5dGhvbi1zcGVjaWZpYyBzdHJhdGVneVxu4pSCICAg4pSU4pSA4pSAIHR5cGVzY3JpcHRfc3RyYXRlZ3kucHkgIyBUeXBlU2NyaXB0LXNwZWNpZmljIHN0cmF0ZWd5XG7ilIJcbuKUnOKUgOKUgCB0ZW1wbGF0ZXMvICAgICAgICAgICAgICAgICMgVGVtcGxhdGVzIGZvciBhZGRpbmcgbmV3IGxhbmd1YWdlc1xu4pSCICAg4pSU4pSA4pSAIG5ld19sYW5ndWFnZV90ZW1wbGF0ZS5weVxu4pSCXG7ilJTilIDilIAgdXRpbHMvXG4gICAg4pSU4pSA4pSAIGxvZ3MucHkgICAgICAgICAgICAgICAjIExvZ2dpbmcgdXRpbGl0aWVzXG4jIyBVc2FnZSBFeGFtcGxlXG5cbiMjIyBRdWVyeWluZyBDb2RlXG5cbmhhbmRsZXIgPSBDb2RlSGVtKCdweXRob24nKVxuXG5jb2RlID0gJycnXG5jbGFzcyBFeGFtcGxlOlxuICAgIGRlZiBncmVldChzZWxmKTpcbiAgICAgICAgcHJpbnQoXCJIZWxsb1wiKVxuJycnXG5cbiMgRmluZCBtZXRob2QgbG9jYXRpb25cbnN0YXJ0LCBlbmQgPSBoYW5kbGVyLmZpbmRlci5maW5kX21ldGhvZChjb2RlLCAnRXhhbXBsZScsICdncmVldCcpXG5wcmludChmJ01ldGhvZCBmb3VuZCBmcm9tIGxpbmUge3N0YXJ0fSB0byB7ZW5kfScpXG4jIyMgTWFuaXB1bGF0aW5nIENvZGVcblxuXG5vcmlnaW5hbF9jb2RlID0gJycnXG5kZWYgZ3JlZXQoKTpcbiAgICBwcmludChcIkhlbGxvXCIpXG4nJydcblxubmV3X2Z1bmN0aW9uID0gJycnXG5kZWYgZ3JlZXQoKTpcbiAgICBwcmludChcIkhlbGxvLCBXb3JsZCFcIilcbicnJ1xuXG5tb2RpZmllZF9jb2RlID0gaGFuZGxlci5tYW5pcHVsYXRvci5yZXBsYWNlX2Z1bmN0aW9uKG9yaWdpbmFsX2NvZGUsICdncmVldCcsIG5ld19mdW5jdGlvbilcbmBgYFxuXG4jIyBDb250cmlidXRpbmdcblxuV2Ugd2FybWx5IHdlbGNvbWUgY29udHJpYnV0aW9ucywgd2hldGhlciBpdCdzIHRocm91Z2ggcmVwb3J0aW5nIGlzc3Vlcywgc3VnZ2VzdGluZyBlbmhhbmNlbWVudHMsIG9yIHN1Ym1pdHRpbmcgcHVsbCByZXF1ZXN0cy4gRmVlbCBmcmVlIHRvIHBhcnRpY2lwYXRlIVxuXG4jIyBMaWNlbnNlXG5cblRoaXMgcHJvamVjdCBpcyBsaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UuIFNlZSBgTElDRU5TRWAgZm9yIGRldGFpbHMuLi4uXG5QYXRoOiBjb2RlaGVtMi9sYW5ndWFnZXMvZGV0ZWN0aW9uLnB5XG4uLi5cblxuICAgICAgICAjIEJvb3N0IGNvbmZpZGVuY2UgZm9yIHNob3J0IHNuaXBwZXRzIHdpdGggc3Ryb25nIGluZGljYXRvcnNcbiAgICAgICAgaWYgbnVtX2xpbmVzIDwgMTAgYW5kIHNjb3JlID4gMzA6XG4gICAgICAgICAgICBjb25maWRlbmNlID0gbWF4KGNvbmZpZGVuY2UsIDAuNylcbiAgICAgICAgaWYgbnVtX2xpbmVzIDwgNSBhbmQgc2NvcmUgPiAxNTpcbiAgICAgICAgICAgICBjb25maWRlbmNlID0gbWF4KGNvbmZpZGVuY2UsIDAuNilcblxuICAgICAgICBsb2dnZXIuZGVidWcoZlwiUHl0aG9uIGRldGVjdGlvbiBjb25maWRlbmNlOiB7Y29uZmlkZW5jZTouMmZ9IChTY29yZToge3Njb3JlfSwgTGluZXM6IHtudW1fbGluZXN9KVwiKVxuICAgICAgICByZXR1cm4gY29uZmlkZW5jZVxuXG4jIFRPRE86IEFkZCBkZXRlY3RvcnMgZm9yIFR5cGVTY3JpcHQsIEphdmFTY3JpcHQgZXRjLlxuIyBjbGFzcyBUeXBlU2NyaXB0TGFuZ3VhZ2VEZXRlY3RvcihCYXNlTGFuZ3VhZ2VEZXRlY3Rvcik6IC4uLlxuXG4jIC0tLSBEZXRlY3Rpb24gRnVuY3Rpb24gLS0tXG5cbl9ERVRFQ1RPUlM6IExpc3RbQmFzZUxhbmd1YWdlRGV0ZWN0b3JdID0gW1xuICAgIFB5dGhvbkxhbmd1YWdlRGV0ZWN0b3IoKSxcbiAgICAjIEFkZCBvdGhlciBkZXRlY3RvciBpbnN0YW5jZXMgaGVyZVxuICAgICMgVHlwZVNjcmlwdExhbmd1YWdlRGV0ZWN0b3IoKSxcbl1cbi4uLlxuXG4gICAgYmVzdF9tYXRjaDogT3B0aW9uYWxbc3RyXSA9IE5vbmVcbiAgICBoaWdoZXN0X2NvbmZpZGVuY2U6IGZsb2F0ID0gMC4wXG4gICAgbWluX2NvbmZpZGVuY2VfdGhyZXNob2xkID0gMC4zICMgTWluaW11bSBjb25maWRlbmNlIHRvIGNvbnNpZGVyIGEgbWF0Y2hcblxuICAgIGxvZ2dlci5kZWJ1ZyhmXCJBdHRlbXB0aW5nIGxhbmd1YWdlIGRldGVjdGlvbiBmb3IgY29kZSBzbmlwcGV0IChsZW5ndGg6IHtsZW4oY29kZSl9KS5cIilcblxuICAgIGZvciBkZXRlY3RvciBpbiBfREVURUNUT1JTOlxuICAgICAgICB0cnk6XG4gICAgICAgICAgICBjb25maWRlbmNlID0gZGV0ZWN0b3IuZGV0ZWN0X2NvbmZpZGVuY2UoY29kZSlcbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCIgIERldGVjdG9yICd7ZGV0ZWN0b3IubGFuZ3VhZ2VfY29kZX0nIGNvbmZpZGVuY2U6IHtjb25maWRlbmNlOi4zZn1cIilcbiAgICAgICAgICAgIGlmIGNvbmZpZGVuY2UgPiBoaWdoZXN0X2NvbmZpZGVuY2UgYW5kIGNvbmZpZGVuY2UgPj0gbWluX2NvbmZpZGVuY2VfdGhyZXNob2xkOlxuICAgICAgICAgICAgICAgIGhpZ2hlc3RfY29uZmlkZW5jZSA9IGNvbmZpZGVuY2VcbiAgICAgICAgICAgICAgICBiZXN0X21hdGNoID0gZGV0ZWN0b3IubGFuZ3VhZ2VfY29kZVxuICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZlwiRXJyb3IgcnVubmluZyBkZXRlY3RvciB7ZGV0ZWN0b3IubGFuZ3VhZ2VfY29kZX06IHtlfVwiLCBleGNfaW5mbz1GYWxzZSlcbi4uLlxuUGF0aDogY29kZWhlbS9sYW5ndWFnZXMvX19pbml0X18ucHlcbi4uLlxuXG5kZWYgZ2V0X2xhbmd1YWdlX3NlcnZpY2VfZm9yX2NvZGUoY29kZTogc3RyKSAtPiBPcHRpb25hbFtMYW5ndWFnZVNlcnZpY2VdOlxuICAgIFwiXCJcIlxuICAgIEF0dGVtcHQgdG8gZGV0ZWN0IGxhbmd1YWdlIGZyb20gY29kZSBjb250ZW50LlxuICAgIFRoaXMgaXMgYSBoZXVyaXN0aWMgYXBwcm9hY2ggYW5kIG5vdCAxMDAlIHJlbGlhYmxlLlxuICAgIFwiXCJcIlxuICAgIGlmIG5vdCBjb2RlLnN0cmlwKCk6XG4gICAgICAgIHJldHVybiBOb25lXG4gICAgXG4gICAgcmVzdWx0cyA9IFtdXG4gICAgIyBVc2UgYWxsIGF2YWlsYWJsZSBkZXRlY3RvcnNcbiAgICBmb3IgbGFuZ3VhZ2VfY29kZSBpbiByZWdpc3RyeS5nZXRfc3VwcG9ydGVkX2xhbmd1YWdlcygpOlxuICAgICAgICBkZXRlY3RvciA9IHJlZ2lzdHJ5LmdldF9sYW5ndWFnZV9kZXRlY3RvcihsYW5ndWFnZV9jb2RlKVxuICAgICAgICBpZiBkZXRlY3RvcjpcbiAgICAgICAgICAgIGNvbmZpZGVuY2UgPSBkZXRlY3Rvci5kZXRlY3RfY29uZmlkZW5jZShjb2RlKVxuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIkxhbmd1YWdlIGRldGVjdGlvbiBjb25maWRlbmNlIGZvciB7bGFuZ3VhZ2VfY29kZX06IHtjb25maWRlbmNlfVwiKVxuICAgICAgICAgICAgaWYgY29uZmlkZW5jZSA+IDA6XG4gICAgICAgICAgICAgICAgcmVzdWx0cy5hcHBlbmQoKGxhbmd1YWdlX2NvZGUsIGNvbmZpZGVuY2UpKVxuICAgIFxuICAgIGlmIG5vdCByZXN1bHRzOlxuICAgICAgICBsb2dnZXIuZGVidWcoXCJObyBsYW5ndWFnZSBkZXRlY3RlZFwiKVxuICAgICAgICByZXR1cm4gTm9uZVxuICAgIFxuICAgICMgU29ydCBieSBjb25maWRlbmNlIHNjb3JlXG4gICAgcmVzdWx0cy5zb3J0KGtleT1sYW1iZGEgeDogeFsxXSwgcmV2ZXJzZT1UcnVlKVxuICAgIGxvZ2dlci5kZWJ1ZyhmXCJCZXN0IGxhbmd1YWdlIG1hdGNoOiB7cmVzdWx0c1swXVswXX0gd2l0aCBjb25maWRlbmNlIHtyZXN1bHRzWzBdWzFdfVwiKVxuICAgIFxuICAgICMgVXNlIHRoZSBsYW5ndWFnZSB3aXRoIHRoZSBoaWdoZXN0IGNvbmZpZGVuY2UgaWYgaXQncyBhYm92ZSBhIHRocmVzaG9sZFxuICAgIGlmIHJlc3VsdHNbMF1bMV0gPiAwLjU6XG4gICAgICAgIHJldHVybiBnZXRfbGFuZ3VhZ2Vfc2VydmljZShyZXN1bHRzWzBdWzBdKVxuICAgIFxuICAgICMgRmFsbGJhY2sgdG8gYmFzaWMgcGF0dGVybiBtYXRjaGluZ1xuICAgIGlmIHJlLnNlYXJjaCgnZGVmXFxcXHMrXFxcXHcrXFxcXHMqXFxcXCgnLCBjb2RlKSBhbmQgcmUuc2VhcmNoKCc6XFxcXHMqXFxcXG4nLCBjb2RlKTpcbiAgICAgICAgcmV0dXJuIGdldF9sYW5ndWFnZV9zZXJ2aWNlKCdweXRob24nKVxuICAgIGVsaWYgcmUuc2VhcmNoKCdmdW5jdGlvblxcXFxzK1xcXFx3K1xcXFxzKlxcXFwoJywgY29kZSkgb3IgcmUuc2VhcmNoKCc6XFxcXHMqXFxcXHcrJywgY29kZSk6XG4gICAgICAgIHJldHVybiBnZXRfbGFuZ3VhZ2Vfc2VydmljZSgndHlwZXNjcmlwdCcpXG4gICAgXG4gICAgcmV0dXJuIE5vbmVcblxuZGVmIGdldF9zdXBwb3J0ZWRfbGFuZ3VhZ2VzKCkgLT4gTGlzdFtzdHJdOlxuICAgIFwiXCJcIkdldCBhIGxpc3Qgb2YgYWxsIHN1cHBvcnRlZCBsYW5ndWFnZSBjb2Rlcy5cIlwiXCJcbiAgICByZXR1cm4gcmVnaXN0cnkuZ2V0X3N1cHBvcnRlZF9sYW5ndWFnZXMoKS4uLlxuUGF0aDogY29kZWhlbS9jb3JlL3JlZ2lzdHJ5LnB5XG4uLi5cblxuY2xhc3MgUmVnaXN0cnk6XG4gICAgXCJcIlwiQ2VudHJhbCByZWdpc3RyeSBmb3IgQ29kZUhlbSBjb21wb25lbnRzLlwiXCJcIlxuICAgIF9pbnN0YW5jZSA9IE5vbmVcblxuICAgIGRlZiBfX2luaXRfXyhzZWxmKTpcbiAgICAgICAgc2VsZi5faW5pdGlhbGl6ZWQgPSBGYWxzZVxuICAgICAgICBzZWxmLl9pbml0aWFsaXplKClcblxuICAgIGRlZiBfX25ld19fKGNscyk6XG4gICAgICAgIGlmIGNscy5faW5zdGFuY2UgaXMgTm9uZTpcbiAgICAgICAgICAgIGNscy5faW5zdGFuY2UgPSBzdXBlcihSZWdpc3RyeSwgY2xzKS5fX25ld19fKGNscylcbiAgICAgICAgcmV0dXJuIGNscy5faW5zdGFuY2VcblxuICAgIGRlZiBfaW5pdGlhbGl6ZShzZWxmKTpcbiAgICAgICAgXCJcIlwiSW5pdGlhbGl6ZXMgZW1wdHkgcmVnaXN0cmllcy5cIlwiXCJcbiAgICAgICAgaWYgaGFzYXR0cihzZWxmLCAnX2luaXRpYWxpemVkJykgYW5kIHNlbGYuX2luaXRpYWxpemVkOlxuICAgICAgICAgICAgcmV0dXJuXG4gICAgICAgIHNlbGYubGFuZ3VhZ2VfZGV0ZWN0b3JzID0ge31cbiAgICAgICAgc2VsZi5sYW5ndWFnZV9zZXJ2aWNlcyA9IHt9XG4gICAgICAgIHNlbGYuYWxsX2Rlc2NyaXB0b3JzID0ge31cbiAgICAgICAgc2VsZi5hbGxfZXh0cmFjdG9ycyA9IHt9XG4gICAgICAgIHNlbGYuYWxsX21hbmlwdWxhdG9ycyA9IHt9XG4gICAgICAgIHNlbGYuZGlzY292ZXJlZF9tb2R1bGVzID0gc2V0KClcbiAgICAgICAgc2VsZi5sYW5ndWFnZV9zZXJ2aWNlX2luc3RhbmNlcyA9IHt9XG4gICAgICAgIHNlbGYuX2luaXRpYWxpemVkID0gRmFsc2VcbiAgICAgICAgbG9nZ2VyLmRlYnVnKCdSZWdpc3RyeSBfaW5pdGlhbGl6ZSBjb21wbGV0ZWQuJylcbi4uLlxuXG4gICAgZGVmIHJlZ2lzdGVyX2xhbmd1YWdlX3NlcnZpY2Uoc2VsZiwgY2xzOiBUeXBlW0xhbmd1YWdlU2VydmljZV0pOlxuICAgICAgICBcIlwiXCJSZWdpc3RlcnMgYSBsYW5ndWFnZSBzZXJ2aWNlIGNsYXNzLlwiXCJcIlxuICAgICAgICB0cnk6XG4gICAgICAgICAgICBsYW5ndWFnZV9jb2RlID0gY2xzLkxBTkdVQUdFX0NPREUubG93ZXIoKVxuICAgICAgICAgICAgaWYgbGFuZ3VhZ2VfY29kZSBpbiBzZWxmLmxhbmd1YWdlX3NlcnZpY2VzOlxuICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGZcIkxhbmd1YWdlIHNlcnZpY2UgZm9yICd7bGFuZ3VhZ2VfY29kZX0nIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCAoe3NlbGYubGFuZ3VhZ2Vfc2VydmljZXNbbGFuZ3VhZ2VfY29kZV0uX19uYW1lX199KS4gT3ZlcndyaXRpbmcgd2l0aCB7Y2xzLl9fbmFtZV9ffS5cIilcbiAgICAgICAgICAgIHNlbGYubGFuZ3VhZ2Vfc2VydmljZXNbbGFuZ3VhZ2VfY29kZV0gPSBjbHNcbiAgICAgICAgICAgIHJpY2gucHJpbnQoZidSZWdpc3RlcmVkIGxhbmd1YWdlIHNlcnZpY2U6IHtjbHMuX19uYW1lX199IGZvciB7bGFuZ3VhZ2VfY29kZX0nKVxuICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XG4gICAgICAgICAgICBsb2dnZXIuZXJyb3IoZidFcnJvciBkdXJpbmcgcmVnaXN0cmF0aW9uIG9mIGxhbmd1YWdlIHNlcnZpY2Uge2Nscy5fX25hbWVfX306IHtlfScsIGV4Y19pbmZvPVRydWUpXG4gICAgICAgIHJldHVybiBjbHNcblxuICAgIGRlZiByZWdpc3Rlcl9leHRyYWN0b3Ioc2VsZiwgY2xzOiBUeXBlW0Jhc2VFeHRyYWN0b3JdKTpcbiAgICAgICAgXCJcIlwiUmVnaXN0ZXJzIGFuIGV4dHJhY3RvciBjbGFzcy5cIlwiXCJcbiAgICAgICAgdHJ5OlxuICAgICAgICAgICAgbGFuZ3VhZ2VfY29kZSA9IGNscy5MQU5HVUFHRV9DT0RFLmxvd2VyKClcbiAgICAgICAgICAgIGVsZW1lbnRfdHlwZSA9IGNscy5FTEVNRU5UX1RZUEUudmFsdWUubG93ZXIoKVxuICAgICAgICAgICAgZXh0cmFjdG9yX2tleSA9IGYne2xhbmd1YWdlX2NvZGV9L3tlbGVtZW50X3R5cGV9J1xuICAgICAgICAgICAgaWYgZXh0cmFjdG9yX2tleSBpbiBzZWxmLmFsbF9leHRyYWN0b3JzOlxuICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGZcIkV4dHJhY3RvciBmb3IgJ3tleHRyYWN0b3Jfa2V5fScgaXMgYWxyZWFkeSByZWdpc3RlcmVkICh7c2VsZi5hbGxfZXh0cmFjdG9yc1tleHRyYWN0b3Jfa2V5XS5fX25hbWVfX30pLiBPdmVyd3JpdGluZyB3aXRoIHtjbHMuX19uYW1lX199LlwiKVxuICAgICAgICAgICAgc2VsZi5hbGxfZXh0cmFjdG9yc1tleHRyYWN0b3Jfa2V5XSA9IGNsc1xuICAgICAgICAgICAgcmljaC5wcmludChmJ1JlZ2lzdGVyZWQgZXh0cmFjdG9yOiB7Y2xzLl9fbmFtZV9ffSBmb3Ige2V4dHJhY3Rvcl9rZXl9JylcbiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZHVyaW5nIHJlZ2lzdHJhdGlvbiBvZiBleHRyYWN0b3Ige2Nscy5fX25hbWVfX306IHtlfScsIGV4Y19pbmZvPVRydWUpXG4gICAgICAgIHJldHVybiBjbHNcbi4uLlxuXG4gICAgZGVmIGluaXRpYWxpemVfY29tcG9uZW50cyhzZWxmKTpcbiAgICAgICAgXCJcIlwiRGlzY292ZXJzIGFuZCBpbml0aWFsaXplcyBhbGwgY29tcG9uZW50cy4gQ2FsbGVkIG9uY2UuXCJcIlwiXG4gICAgICAgIGlmIHNlbGYuX2luaXRpYWxpemVkOlxuICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKCdDb21wb25lbnRzIGFscmVhZHkgaW5pdGlhbGl6ZWQuJylcbiAgICAgICAgICAgIHJldHVyblxuXG4gICAgICAgIGxvZ2dlci5pbmZvKCdTdGFydGluZyBDb2RlSGVtIGNvbXBvbmVudCBpbml0aWFsaXphdGlvbi4uLicpXG4gICAgICAgIHNlbGYuZGlzY292ZXJfbW9kdWxlcygpICMgRGlzY292ZXIgY29tcG9uZW50cyBpbiB0aGUgbWFpbiBwYWNrYWdlIGFuZCBzdWJwYWNrYWdlc1xuICAgICAgICBzZWxmLl9pbml0aWFsaXplZCA9IFRydWVcbiAgICAgICAgcmljaC5wcmludChmJ0NvbXBvbmVudHMgaW5pdGlhbGl6ZWQ6IHtsZW4oc2VsZi5sYW5ndWFnZV9kZXRlY3RvcnMpfSBkZXRlY3RvcnMsIHtsZW4oc2VsZi5sYW5ndWFnZV9zZXJ2aWNlcyl9IHNlcnZpY2VzLCB7bGVuKHNlbGYuYWxsX2V4dHJhY3RvcnMpfSBleHRyYWN0b3JzLCB7bGVuKHNlbGYuYWxsX21hbmlwdWxhdG9ycyl9IG1hbmlwdWxhdG9ycyByZWdpc3RlcmVkLicpXG4gICAgICAgIGxvZ2dlci5pbmZvKCdDb21wb25lbnQgaW5pdGlhbGl6YXRpb24gZmluaXNoZWQuJylcblxuIyBHbG9iYWwgcmVnaXN0cnkgaW5zdGFuY2VcbnJlZ2lzdHJ5ID0gUmVnaXN0cnkoKVxuXG4jIERlY29yYXRvcnMgZm9yIHJlZ2lzdHJhdGlvblxuZGVmIGxhbmd1YWdlX2RldGVjdG9yKGNscyk6XG4gICAgXCJcIlwiRGVjb3JhdG9yIGZvciByZWdpc3RlcmluZyBhIGxhbmd1YWdlIGRldGVjdG9yLlwiXCJcIlxuICAgIHJldHVybiByZWdpc3RyeS5yZWdpc3Rlcl9sYW5ndWFnZV9kZXRlY3RvcihjbHMpXG5cbmRlZiBsYW5ndWFnZV9zZXJ2aWNlKGNscyk6XG4gICAgXCJcIlwiRGVjb3JhdG9yIGZvciByZWdpc3RlcmluZyBhIGxhbmd1YWdlIHNlcnZpY2UuXCJcIlwiXG4gICAgcmV0dXJuIHJlZ2lzdHJ5LnJlZ2lzdGVyX2xhbmd1YWdlX3NlcnZpY2UoY2xzKVxuXG5kZWYgZXh0cmFjdG9yKGNscyk6XG4gICAgXCJcIlwiRGVjb3JhdG9yIGZvciByZWdpc3RlcmluZyBhbiBleHRyYWN0b3IuXCJcIlwiXG4gICAgcmV0dXJuIHJlZ2lzdHJ5LnJlZ2lzdGVyX2V4dHJhY3RvcihjbHMpXG5cbmRlZiBtYW5pcHVsYXRvcihjbHMpOlxuICAgIFwiXCJcIkRlY29yYXRvciBmb3IgcmVnaXN0ZXJpbmcgYSBtYW5pcHVsYXRvci5cIlwiXCJcbiAgICByZXR1cm4gcmVnaXN0cnkucmVnaXN0ZXJfbWFuaXB1bGF0b3IoY2xzKVxuXG5kZWYgZWxlbWVudF90eXBlX2Rlc2NyaXB0b3IoY2xzKTpcbiAgICBcIlwiXCJEZWNvcmF0b3IgZm9yIHJlZ2lzdGVyaW5nIGFuIGVsZW1lbnQgdHlwZSBkZXNjcmlwdG9yLlwiXCJcIlxuICAgIHJldHVybiByZWdpc3RyeS5yZWdpc3Rlcl9lbGVtZW50X3R5cGVfZGVzY3JpcHRvcihjbHMpLi4uXG4iLCJpc0Vycm9yIjpmYWxzZSwicmVxdWVzdElkIjoiIn19LCJjMWNjZTNjNy0xMGE1LTQ3NzItODM2YS04MzFhMGUxNzA0MGU7dG9vbHVfdnJ0eF8wMTZETkg3SGNDcWRheENIR2Vkc3lSRloiOnsicGhhc2UiOjUsInJlc3VsdCI6eyJ0ZXh0IjoiVGhlIGZvbGxvd2luZyBjb2RlIHNlY3Rpb25zIHdlcmUgcmV0cmlldmVkOlxuUGF0aDogY29kZWhlbS9jb3JlL21hbmlwdWxhdG9ycy9tYW5pcHVsYXRvcl9iYXNlLnB5XG4uLi5cblxuY2xhc3MgTWFuaXB1bGF0b3JCYXNlKEFCQyk6XG4gICAgXCJcIlwiQmFzZSBjbGFzcyBmb3IgYWxsIGxhbmd1YWdlLXNwZWNpZmljIG1hbmlwdWxhdG9ycy5cIlwiXCJcbiAgICBMQU5HVUFHRV9DT0RFOiBzdHIgPSAnJ1xuICAgIEVMRU1FTlRfVFlQRTogT3B0aW9uYWxbQ29kZUVsZW1lbnRUeXBlXSA9IE5vbmVcbiAgICBDT01NRU5UX01BUktFUlM6IExpc3Rbc3RyXSA9IFtdXG4gICAgREVDT1JBVE9SX01BUktFUlM6IExpc3Rbc3RyXSA9IFtdXG5cbiAgICBkZWYgX19pbml0X18oc2VsZiwgbGFuZ3VhZ2VfY29kZTogc3RyPU5vbmUsIGVsZW1lbnRfdHlwZTogQ29kZUVsZW1lbnRUeXBlPU5vbmUsIGZvcm1hdHRlcjogQmFzZUZvcm1hdHRlcj1Ob25lLCBleHRyYWN0aW9uX3NlcnZpY2U9Tm9uZSk6XG4gICAgICAgIFwiXCJcIkluaXRpYWxpemUgdGhlIG1hbmlwdWxhdG9yLlwiXCJcIlxuICAgICAgICBzZWxmLmxhbmd1YWdlX2NvZGUgPSBsYW5ndWFnZV9jb2RlIG9yIHNlbGYuTEFOR1VBR0VfQ09ERVxuICAgICAgICBzZWxmLmVsZW1lbnRfdHlwZSA9IGVsZW1lbnRfdHlwZSBvciBzZWxmLkVMRU1FTlRfVFlQRVxuICAgICAgICBzZWxmLl9leHRyYWN0aW9uX3NlcnZpY2UgPSBleHRyYWN0aW9uX3NlcnZpY2VcbiAgICAgICAgc2VsZi5mb3JtYXR0ZXIgPSBmb3JtYXR0ZXIgb3IgQmFzZUZvcm1hdHRlcigpXG4gICAgICAgIGlmIG5vdCBzZWxmLmxhbmd1YWdlX2NvZGU6XG4gICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKCdNYW5pcHVsYXRvciByZXF1aXJlcyBhIGxhbmd1YWdlX2NvZGUuJylcblxuICAgIEBwcm9wZXJ0eVxuICAgIGRlZiBleHRyYWN0aW9uX3NlcnZpY2Uoc2VsZik6XG4gICAgICAgIFwiXCJcIkdldCBleHRyYWN0aW9uIHNlcnZpY2UsIGNyZWF0aW5nIGl0IG9uIGRlbWFuZC5cIlwiXCJcbiAgICAgICAgaWYgc2VsZi5fZXh0cmFjdGlvbl9zZXJ2aWNlIGlzIE5vbmU6XG4gICAgICAgICAgICBmcm9tIGNvZGVoZW0uY29yZS5leHRyYWN0aW9uX3NlcnZpY2UgaW1wb3J0IEV4dHJhY3Rpb25TZXJ2aWNlXG4gICAgICAgICAgICB0cnk6XG4gICAgICAgICAgICAgICAgc2VsZi5fZXh0cmFjdGlvbl9zZXJ2aWNlID0gRXh0cmFjdGlvblNlcnZpY2Uoc2VsZi5sYW5ndWFnZV9jb2RlKVxuICAgICAgICAgICAgZXhjZXB0IFZhbHVlRXJyb3IgYXMgZTpcbiAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZidGYWlsZWQgdG8gY3JlYXRlIEV4dHJhY3Rpb25TZXJ2aWNlIGZvciB7c2VsZi5sYW5ndWFnZV9jb2RlfToge2V9JylcbiAgICAgICAgICAgICAgICByYWlzZVxuICAgICAgICByZXR1cm4gc2VsZi5fZXh0cmFjdGlvbl9zZXJ2aWNlXG5cbiAgICBAYWJzdHJhY3RtZXRob2RcbiAgICBkZWYgYWRkX2VsZW1lbnQoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCBuZXdfZWxlbWVudDogc3RyLCBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXT1Ob25lKSAtPiBzdHI6XG4gICAgICAgIFwiXCJcIkFkZCBhbiBlbGVtZW50IHRvIHRoZSBjb2RlLiBNdXN0IGJlIGltcGxlbWVudGVkIGJ5IHN1YmNsYXNzZXMuXCJcIlwiXG4gICAgICAgIHJhaXNlIE5vdEltcGxlbWVudGVkRXJyb3IoJ1N1YmNsYXNzZXMgbXVzdCBpbXBsZW1lbnQgYWRkX2VsZW1lbnQnKVxuXG4gICAgZGVmIGZpbmRfZWxlbWVudChzZWxmLCBjb2RlOiBzdHIsIGVsZW1lbnRfbmFtZTogc3RyLCBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXT1Ob25lKSAtPiBUdXBsZVtpbnQsIGludF06XG4gICAgICAgIFwiXCJcIkZpbmQgYW4gZWxlbWVudCBpbiB0aGUgY29kZSB1c2luZyB0aGUgRXh0cmFjdGlvbiBTZXJ2aWNlLlwiXCJcIlxuICAgICAgICBpZiBub3Qgc2VsZi5lbGVtZW50X3R5cGU6XG4gICAgICAgICAgICBsb2dnZXIud2FybmluZygnZmluZF9lbGVtZW50IGNhbGxlZCB3aXRob3V0IEVMRU1FTlRfVFlQRSBzZXQuJylcbiAgICAgICAgICAgIHJldHVybiAoMCwgMClcbiAgICAgICAgdHJ5OlxuICAgICAgICAgICAgcmV0dXJuIHNlbGYuZXh0cmFjdGlvbl9zZXJ2aWNlLmZpbmRfZWxlbWVudChjb2RlLCBzZWxmLmVsZW1lbnRfdHlwZS52YWx1ZSwgZWxlbWVudF9uYW1lLCBwYXJlbnRfbmFtZSlcbiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZmluZGluZyBlbGVtZW50ICh7c2VsZi5lbGVtZW50X3R5cGUudmFsdWV9LCB7ZWxlbWVudF9uYW1lfSwge3BhcmVudF9uYW1lfSk6IHtlfScpXG4gICAgICAgICAgICByZXR1cm4gKDAsIDApXG5cbiAgICBkZWYgZm9ybWF0X2VsZW1lbnQoc2VsZiwgZWxlbWVudF9jb2RlOiBzdHIsIGluZGVudF9sZXZlbDogaW50PTApIC0+IHN0cjpcbiAgICAgICAgXCJcIlwiRm9ybWF0IGEgY29kZSBlbGVtZW50IHVzaW5nIHRoZSBsYW5ndWFnZS1zcGVjaWZpYyBmb3JtYXR0ZXIuXCJcIlwiXG4gICAgICAgIGlmIGhhc2F0dHIoc2VsZi5mb3JtYXR0ZXIsICdmb3JtYXRfZWxlbWVudCcpIGFuZCBzZWxmLmVsZW1lbnRfdHlwZTpcbiAgICAgICAgICAgIGRlZGVudGVkX2NvZGUgPSBzZWxmLmZvcm1hdHRlci5kZWRlbnQoZWxlbWVudF9jb2RlKVxuICAgICAgICAgICAgZm9ybWF0dGVkX25vX2Jhc2VfaW5kZW50ID0gc2VsZi5mb3JtYXR0ZXIuZm9ybWF0X2VsZW1lbnQoc2VsZi5lbGVtZW50X3R5cGUudmFsdWUsIGRlZGVudGVkX2NvZGUpXG4gICAgICAgICAgICBiYXNlX2luZGVudCA9IHNlbGYuZm9ybWF0dGVyLmluZGVudF9zdHJpbmcgKiBpbmRlbnRfbGV2ZWxcbiAgICAgICAgICAgIHJldHVybiBzZWxmLmFwcGx5X2luZGVudGF0aW9uKGZvcm1hdHRlZF9ub19iYXNlX2luZGVudCwgYmFzZV9pbmRlbnQpXG4gICAgICAgIGluZGVudCA9ICcgJyAqIChzZWxmLmZvcm1hdHRlci5pbmRlbnRfc2l6ZSBpZiBoYXNhdHRyKHNlbGYuZm9ybWF0dGVyLCAnaW5kZW50X3NpemUnKSBlbHNlIDQpICogaW5kZW50X2xldmVsXG4gICAgICAgIHJldHVybiBzZWxmLmFwcGx5X2luZGVudGF0aW9uKGVsZW1lbnRfY29kZS5zdHJpcCgpLCBpbmRlbnQpXG5cbiAgICBkZWYgcmVwbGFjZV9lbGVtZW50KHNlbGYsIG9yaWdpbmFsX2NvZGU6IHN0ciwgZWxlbWVudF9uYW1lOiBzdHIsIG5ld19lbGVtZW50OiBzdHIsIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IHN0cjpcbiAgICAgICAgXCJcIlwiUmVwbGFjZSBhbiBlbGVtZW50IGluIHRoZSBjb2RlLCBoYW5kbGluZyBkZWNvcmF0b3JzL2NvbW1lbnRzLlwiXCJcIlxuICAgICAgICBsb2dnZXIuZGVidWcoZlwiUmVwbGFjaW5nIHtzZWxmLmVsZW1lbnRfdHlwZX0gJ3tlbGVtZW50X25hbWV9JyAocGFyZW50OiB7cGFyZW50X25hbWV9KVwiKVxuICAgICAgICBzdGFydF9saW5lLCBlbmRfbGluZSA9IHNlbGYuZmluZF9lbGVtZW50KG9yaWdpbmFsX2NvZGUsIGVsZW1lbnRfbmFtZSwgcGFyZW50X25hbWUpXG4gICAgICAgIGlmIHN0YXJ0X2xpbmUgPT0gMCBhbmQgZW5kX2xpbmUgPT0gMDpcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGZcIntzZWxmLmVsZW1lbnRfdHlwZX0gJ3tlbGVtZW50X25hbWV9JyBub3QgZm91bmQuIEF0dGVtcHRpbmcgdG8gYWRkLlwiKVxuICAgICAgICAgICAgY2FuX2FkZCA9IHBhcmVudF9uYW1lIG9yIHNlbGYuZWxlbWVudF90eXBlIGluIFtDb2RlRWxlbWVudFR5cGUuRlVOQ1RJT04sIENvZGVFbGVtZW50VHlwZS5DTEFTUywgQ29kZUVsZW1lbnRUeXBlLklNUE9SVF1cbiAgICAgICAgICAgIGlmIGNhbl9hZGQ6XG4gICAgICAgICAgICAgICAgdHJ5OlxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2VsZi5hZGRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBuZXdfZWxlbWVudCwgcGFyZW50X25hbWUpXG4gICAgICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxuICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZXJyb3IoZlwiRXJyb3IgYWRkaW5nIG1pc3NpbmcgZWxlbWVudCAne2VsZW1lbnRfbmFtZX0nOiB7ZX1cIilcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgICAgICAgICAgIGVsc2U6XG4gICAgICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZlwiRWxlbWVudCAne2VsZW1lbnRfbmFtZX0nIG5vdCBmb3VuZCBhbmQgY2Fubm90IGJlIGFkZGVkIHdpdGhvdXQgcGFyZW50IGNvbnRleHQuXCIpXG4gICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgICAgICAgbGluZXMgPSBvcmlnaW5hbF9jb2RlLnNwbGl0bGluZXMoKVxuICAgICAgICBhZGp1c3RlZF9zdGFydCA9IHNlbGYuX2FkanVzdF9zdGFydF9saW5lKGxpbmVzLCBzdGFydF9saW5lKVxuICAgICAgICBsb2dnZXIuZGVidWcoZidGb3VuZCBlbGVtZW50IGF0IGxpbmVzIHtzdGFydF9saW5lfS17ZW5kX2xpbmV9LiBBZGp1c3RlZCBzdGFydDoge2FkanVzdGVkX3N0YXJ0fScpXG4gICAgICAgIGluZGVudF9sZXZlbCA9IHNlbGYuZ2V0X2VsZW1lbnRfaW5kZW50X2xldmVsKG9yaWdpbmFsX2NvZGUsIGFkanVzdGVkX3N0YXJ0LCBwYXJlbnRfbmFtZSlcbiAgICAgICAgZm9ybWF0dGVkX2VsZW1lbnQgPSBzZWxmLmZvcm1hdF9lbGVtZW50KG5ld19lbGVtZW50LCBpbmRlbnRfbGV2ZWwpXG4gICAgICAgIHJldHVybiBzZWxmLnJlcGxhY2VfbGluZXMob3JpZ2luYWxfY29kZSwgYWRqdXN0ZWRfc3RhcnQsIGVuZF9saW5lLCBmb3JtYXR0ZWRfZWxlbWVudClcblxuICAgIGRlZiByZW1vdmVfZWxlbWVudChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIGVsZW1lbnRfbmFtZTogc3RyLCBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXT1Ob25lKSAtPiBzdHI6XG4gICAgICAgIFwiXCJcIlJlbW92ZSBhbiBlbGVtZW50IGZyb20gdGhlIGNvZGUsIGhhbmRsaW5nIGRlY29yYXRvcnMvY29tbWVudHMuXCJcIlwiXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJSZW1vdmluZyB7c2VsZi5lbGVtZW50X3R5cGV9ICd7ZWxlbWVudF9uYW1lfScgKHBhcmVudDoge3BhcmVudF9uYW1lfSlcIilcbiAgICAgICAgc3RhcnRfbGluZSwgZW5kX2xpbmUgPSBzZWxmLmZpbmRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBlbGVtZW50X25hbWUsIHBhcmVudF9uYW1lKVxuICAgICAgICBpZiBzdGFydF9saW5lID09IDAgYW5kIGVuZF9saW5lID09IDA6XG4gICAgICAgICAgICBsb2dnZXIud2FybmluZyhmXCJFbGVtZW50ICd7ZWxlbWVudF9uYW1lfScgbm90IGZvdW5kLiBDYW5ub3QgcmVtb3ZlLlwiKVxuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgICAgICAgbGluZXMgPSBvcmlnaW5hbF9jb2RlLnNwbGl0bGluZXMoKVxuICAgICAgICBhZGp1c3RlZF9zdGFydCA9IHNlbGYuX2FkanVzdF9zdGFydF9saW5lKGxpbmVzLCBzdGFydF9saW5lKVxuICAgICAgICBsb2dnZXIuZGVidWcoZidGb3VuZCBlbGVtZW50IGZvciByZW1vdmFsIGF0IGxpbmVzIHtzdGFydF9saW5lfS17ZW5kX2xpbmV9LiBBZGp1c3RlZDoge2FkanVzdGVkX3N0YXJ0fScpXG4gICAgICAgIHJldHVybiBzZWxmLnJlcGxhY2VfbGluZXMob3JpZ2luYWxfY29kZSwgYWRqdXN0ZWRfc3RhcnQsIGVuZF9saW5lLCAnJylcblxuICAgIGRlZiBnZXRfZWxlbWVudF9pbmRlbnRfbGV2ZWwoc2VsZiwgY29kZTogc3RyLCBlbGVtZW50X3N0YXJ0X2xpbmU6IGludCwgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl09Tm9uZSkgLT4gaW50OlxuICAgICAgICBcIlwiXCJDYWxjdWxhdGUgaW5kZW50YXRpb24gbGV2ZWwgZm9yIGFuIGVsZW1lbnQuXCJcIlwiXG4gICAgICAgIGlmIGVsZW1lbnRfc3RhcnRfbGluZSA8PSAwOlxuICAgICAgICAgICAgcmV0dXJuIDBcbiAgICAgICAgbGluZXMgPSBjb2RlLnNwbGl0bGluZXMoKVxuICAgICAgICBpZiBlbGVtZW50X3N0YXJ0X2xpbmUgPiBsZW4obGluZXMpOlxuICAgICAgICAgICAgcmV0dXJuIDBcbiAgICAgICAgbGluZV9pbmRleCA9IGVsZW1lbnRfc3RhcnRfbGluZSAtIDFcbiAgICAgICAgaW5kZW50X3N0ciA9IHNlbGYuZ2V0X2luZGVudGF0aW9uKGxpbmVzW2xpbmVfaW5kZXhdKVxuICAgICAgICBpbmRlbnRfc2l6ZSA9IHNlbGYuZm9ybWF0dGVyLmluZGVudF9zaXplIGlmIGhhc2F0dHIoc2VsZi5mb3JtYXR0ZXIsICdpbmRlbnRfc2l6ZScpIGVsc2UgNFxuICAgICAgICByZXR1cm4gbGVuKGluZGVudF9zdHIpIC8vIGluZGVudF9zaXplIGlmIGluZGVudF9zaXplID4gMCBlbHNlIDBcbi4uLlxuUGF0aDogY29kZWhlbS9sYW5ndWFnZXMvbGFuZ19weXRob24vbWFuaXB1bGF0b3IvaW1wb3J0X2hhbmRsZXIucHlcblwiXCJcIlxuUHl0aG9uIGltcG9ydCBtYW5pcHVsYXRvciBpbXBsZW1lbnRhdGlvbi5cblwiXCJcIlxuaW1wb3J0IHJlXG5pbXBvcnQgbG9nZ2luZ1xuZnJvbSB0eXBpbmcgaW1wb3J0IE9wdGlvbmFsLCBUdXBsZSwgTGlzdFxuZnJvbSBjb2RlaGVtLm1vZGVscy5lbnVtcyBpbXBvcnQgQ29kZUVsZW1lbnRUeXBlXG5mcm9tIGNvZGVoZW0uY29yZS5yZWdpc3RyeSBpbXBvcnQgbWFuaXB1bGF0b3JcbmZyb20gY29kZWhlbS5jb3JlLm1hbmlwdWxhdG9ycy50ZW1wbGF0ZV9pbXBvcnRfbWFuaXB1bGF0b3IgaW1wb3J0IFRlbXBsYXRlSW1wb3J0TWFuaXB1bGF0b3JcblxubG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoX19uYW1lX18pXG5cbkBtYW5pcHVsYXRvclxuY2xhc3MgUHl0aG9uSW1wb3J0TWFuaXB1bGF0b3IoVGVtcGxhdGVJbXBvcnRNYW5pcHVsYXRvcik6XG4gICAgXCJcIlwiTWFuaXB1bGF0b3IgZm9yIFB5dGhvbiBpbXBvcnRzLlwiXCJcIlxuICAgIExBTkdVQUdFX0NPREUgPSAncHl0aG9uJ1xuICAgIEVMRU1FTlRfVFlQRSA9IENvZGVFbGVtZW50VHlwZS5JTVBPUlRcbiAgICBDT01NRU5UX01BUktFUlMgPSBbJyMnXVxuICAgIFxuICAgIGRlZiBfcGVyZm9ybV9pbnNlcnRpb24oc2VsZiwgY29kZTogc3RyLCBmb3JtYXR0ZWRfZWxlbWVudDogc3RyLCBpbnNlcnRpb25fcG9pbnQ6IGludCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IHN0cjpcbiAgICAgICAgXCJcIlwiQWRkIGFuIGltcG9ydCB0byBQeXRob24gY29kZSB3aXRoIHByb3BlciBzcGFjaW5nLlwiXCJcIlxuICAgICAgICBsaW5lcyA9IGNvZGUuc3BsaXRsaW5lcygpIGlmIGNvZGUgZWxzZSBbXVxuLi4uXG5QYXRoOiBjb2RlaGVtL2xhbmd1YWdlcy9sYW5nX3B5dGhvbi9tYW5pcHVsYXRvci9jbGFzc19oYW5kbGVyLnB5XG4uLi5cblxuQG1hbmlwdWxhdG9yXG5jbGFzcyBQeXRob25DbGFzc01hbmlwdWxhdG9yKFRlbXBsYXRlQ2xhc3NNYW5pcHVsYXRvcik6XG4gICAgXCJcIlwiTWFuaXB1bGF0b3IgZm9yIFB5dGhvbiBjbGFzc2VzLlwiXCJcIlxuICAgIExBTkdVQUdFX0NPREUgPSAncHl0aG9uJ1xuICAgIEVMRU1FTlRfVFlQRSA9IENvZGVFbGVtZW50VHlwZS5DTEFTU1xuICAgIENPTU1FTlRfTUFSS0VSUyA9IFsnIyddXG4gICAgREVDT1JBVE9SX01BUktFUlMgPSBbJ0AnXVxuICAgIFxuICAgIGRlZiBfcGVyZm9ybV9pbnNlcnRpb24oc2VsZiwgY29kZTogc3RyLCBmb3JtYXR0ZWRfZWxlbWVudDogc3RyLCBpbnNlcnRpb25fcG9pbnQ6IGludCwgXG4gICAgICAgICAgICAgICAgICAgICAgICAgIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IHN0cjpcbiAgICAgICAgXCJcIlwiQWRkIGEgY2xhc3MgdG8gUHl0aG9uIGNvZGUgd2l0aCBhcHByb3ByaWF0ZSBzcGFjaW5nLlwiXCJcIlxuICAgICAgICBpZiBub3QgY29kZTpcbiAgICAgICAgICAgIHJldHVybiBmb3JtYXR0ZWRfZWxlbWVudCArICdcXG4nXG4gICAgICAgICAgICBcbiAgICAgICAgcmVzdWx0ID0gc3VwZXIoKS5fcGVyZm9ybV9pbnNlcnRpb24oY29kZSwgZm9ybWF0dGVkX2VsZW1lbnQsIGluc2VydGlvbl9wb2ludCwgcGFyZW50X25hbWUpXG4gICAgICAgIFxuICAgICAgICAjIEVuc3VyZSBwcm9wZXIgc3BhY2luZyBhbmQgbmV3bGluZSBhdCBlbmRcbiAgICAgICAgaWYgbm90IHJlc3VsdC5lbmRzd2l0aCgnXFxuJyk6XG4gICAgICAgICAgICByZXN1bHQgKz0gJ1xcbidcbiAgICAgICAgICAgIFxuICAgICAgICByZXR1cm4gcmVzdWx0Li4uXG5QYXRoOiBjb2RlaGVtL2xhbmd1YWdlcy9sYW5nX3B5dGhvbi9tYW5pcHVsYXRvci9tZXRob2RfaGFuZGxlci5weVxuXCJcIlwiXG5QeXRob24gbWV0aG9kIG1hbmlwdWxhdG9yIGltcGxlbWVudGF0aW9uLlxuXCJcIlwiXG5pbXBvcnQgbG9nZ2luZ1xuZnJvbSB0eXBpbmcgaW1wb3J0IE9wdGlvbmFsXG5mcm9tIGNvZGVoZW0ubW9kZWxzLmVudW1zIGltcG9ydCBDb2RlRWxlbWVudFR5cGVcbmZyb20gY29kZWhlbS5jb3JlLnJlZ2lzdHJ5IGltcG9ydCBtYW5pcHVsYXRvclxuZnJvbSBjb2RlaGVtLmNvcmUubWFuaXB1bGF0b3JzLnRlbXBsYXRlX21ldGhvZF9tYW5pcHVsYXRvciBpbXBvcnQgVGVtcGxhdGVNZXRob2RNYW5pcHVsYXRvclxuXG5sb2dnZXIgPSBsb2dnaW5nLmdldExvZ2dlcihfX25hbWVfXylcblxuIyBAbWFuaXB1bGF0b3IgIyBEaXNhYmxlZDogVXNpbmcgUHl0aG9uQVNUTWFuaXB1bGF0b3IgdmlhIF9faW5pdF9fLnB5IHJlZ2lzdHJhdGlvblxuY2xhc3MgUHl0aG9uTWV0aG9kTWFuaXB1bGF0b3IoVGVtcGxhdGVNZXRob2RNYW5pcHVsYXRvcik6XG4gICAgXCJcIlwiTWFuaXB1bGF0b3IgZm9yIFB5dGhvbiBtZXRob2RzLlwiXCJcIlxuICAgIExBTkdVQUdFX0NPREUgPSAncHl0aG9uJ1xuICAgIEVMRU1FTlRfVFlQRSA9IENvZGVFbGVtZW50VHlwZS5NRVRIT0RcbiAgICBDT01NRU5UX01BUktFUlMgPSBbJyMnXVxuICAgIERFQ09SQVRPUl9NQVJLRVJTID0gWydAJ11cbi4uLlxuUGF0aDogY29kZWhlbS9sYW5ndWFnZXMvbGFuZ19weXRob24vbWFuaXB1bGF0b3IvYmFzZS5weVxuLi4uXG5cbiAgICBkZWYgX19pbml0X18oc2VsZiwgZWxlbWVudF90eXBlOiBDb2RlRWxlbWVudFR5cGUgPSBOb25lLCBmb3JtYXR0ZXI6IEJhc2VGb3JtYXR0ZXIgPSBOb25lLCBcbiAgICAgICAgICAgICAgICAgZXh0cmFjdGlvbl9zZXJ2aWNlID0gTm9uZSk6XG4gICAgICAgIFwiXCJcIkluaXRpYWxpemUgUHl0aG9uIG1hbmlwdWxhdG9yIHdpdGggYXBwcm9wcmlhdGUgZm9ybWF0dGVyLlwiXCJcIlxuICAgICAgICBpZiBmb3JtYXR0ZXIgaXMgTm9uZTpcbiAgICAgICAgICAgIHRyeTpcbiAgICAgICAgICAgICAgICBsYW5nX3NlcnZpY2UgPSByZWdpc3RyeS5nZXRfbGFuZ3VhZ2Vfc2VydmljZSgncHl0aG9uJylcbiAgICAgICAgICAgICAgICBpZiBsYW5nX3NlcnZpY2UgYW5kIGhhc2F0dHIobGFuZ19zZXJ2aWNlLCAnZm9ybWF0dGVyJyk6XG4gICAgICAgICAgICAgICAgICAgICBmb3JtYXR0ZXIgPSBsYW5nX3NlcnZpY2UuZm9ybWF0dGVyXG4gICAgICAgICAgICAgICAgZWxzZTpcblxuICAgICAgICAgICAgICAgICAgICAgZm9ybWF0dGVyID0gUHl0aG9uRm9ybWF0dGVyKClcbiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcbiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmXCJDb3VsZCBub3QgZ2V0IFB5dGhvbkZvcm1hdHRlcjoge2V9XCIpXG5cbiAgICAgICAgc3VwZXIoKS5fX2luaXRfXyhcbiAgICAgICAgICAgIGxhbmd1YWdlX2NvZGU9XCJweXRob25cIixcbiAgICAgICAgICAgIGVsZW1lbnRfdHlwZT1lbGVtZW50X3R5cGUsXG4gICAgICAgICAgICBmb3JtYXR0ZXI9Zm9ybWF0dGVyLFxuICAgICAgICAgICAgZXh0cmFjdGlvbl9zZXJ2aWNlPWV4dHJhY3Rpb25fc2VydmljZSxcbiAgICAgICAgKVxuLi4uXG5QYXRoOiBjb2RlaGVtL2NvcmUvbWFuaXB1bGF0b3JzL3RlbXBsYXRlX21hbmlwdWxhdG9yLnB5XG5cIlwiXCJcblRlbXBsYXRlIHBhdHRlcm4gZm9yIG1hbmlwdWxhdG9ycyB0byBzdGFuZGFyZGl6ZSBsYW5ndWFnZS1zcGVjaWZpYyBpbXBsZW1lbnRhdGlvbnMuXG5cIlwiXCJcbmltcG9ydCBsb2dnaW5nXG5mcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWxcbmZyb20gY29kZWhlbS5jb3JlLm1hbmlwdWxhdG9ycy5tYW5pcHVsYXRvcl9iYXNlIGltcG9ydCBNYW5pcHVsYXRvckJhc2VcblxubG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoX19uYW1lX18pXG5cbmNsYXNzIFRlbXBsYXRlTWFuaXB1bGF0b3IoTWFuaXB1bGF0b3JCYXNlKTpcbiAgICBcIlwiXCJcbiAgICBUZW1wbGF0ZSBtZXRob2QgcGF0dGVybiBmb3IgbWFuaXB1bGF0b3JzLlxuICAgIFByb3ZpZGVzIHN0YW5kYXJkaXplZCBpbXBsZW1lbnRhdGlvbnMgd2l0aCBob29rcyBmb3IgbGFuZ3VhZ2Utc3BlY2lmaWMgY3VzdG9taXphdGlvbi5cbiAgICBcIlwiXCJcblxuICAgIGRlZiBfX2luaXRfXyhzZWxmLCAqYXJncywgKiprd2FyZ3MpOlxuICAgICAgICBzdXBlcigpLl9faW5pdF9fKCphcmdzLCAqKmt3YXJncylcblxuICAgIGRlZiByZXBsYWNlX2VsZW1lbnQoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCBuYW1lOiBzdHIsIG5ld19jb2RlOiBzdHIsIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdID0gTm9uZSkgLT4gc3RyOlxuICAgICAgICBcIlwiXCJcbiAgICAgICAgUmVwbGFjZSBhbiBleGlzdGluZyBlbGVtZW50IChmdW5jdGlvbiwgbWV0aG9kLCBjbGFzcywgaW1wb3J0KSBieSBuYW1lLlxuICAgICAgICBJZiBub3QgZm91bmQsIGluc2VydCB0aGUgbmV3IGVsZW1lbnQuXG5cbiAgICAgICAgQXJnczpcbiAgICAgICAgICAgIG9yaWdpbmFsX2NvZGU6IE9yaWdpbmFsIHNvdXJjZSBjb2RlXG4gICAgICAgICAgICBuYW1lOiBOYW1lIG9mIHRoZSBlbGVtZW50IHRvIHJlcGxhY2VcbiAgICAgICAgICAgIG5ld19jb2RlOiBOZXcgY29udGVudCBmb3IgdGhlIGVsZW1lbnRcbiAgICAgICAgICAgIHBhcmVudF9uYW1lOiBPcHRpb25hbCBwYXJlbnQgZWxlbWVudCBuYW1lIChlLmcuLCBjbGFzcyBuYW1lIGZvciBtZXRob2RzKVxuLi4uXG4gICAgICAgICAgICAgICAgICAgICAgICBlbmRfaWR4ID0gbGVuKGNvZGVfbGluZXMpXG5cbiAgICAgICAgaWYgc3RhcnRfaWR4IGlzIG5vdCBOb25lIGFuZCBlbmRfaWR4IGlzIG5vdCBOb25lOlxuICAgICAgICAgICAgYmVmb3JlID0gY29kZV9saW5lc1s6c3RhcnRfaWR4XVxuICAgICAgICAgICAgYWZ0ZXIgPSBjb2RlX2xpbmVzW2VuZF9pZHg6XVxuICAgICAgICAgICAgbmV3X2NvZGVfbGluZXMgPSBuZXdfY29kZS5zdHJpcCgnXFxuJykuc3BsaXRsaW5lcygpXG4gICAgICAgICAgICAjIEFkanVzdCBpbmRlbnRhdGlvbiB0byBtYXRjaCBleGlzdGluZyBlbGVtZW50XG4gICAgICAgICAgICBpbmRlbnQgPSAnJ1xuICAgICAgICAgICAgaWYgYmVmb3JlIGFuZCBiZWZvcmVbLTFdLnN0YXJ0c3dpdGgoJyAnKTpcbiAgICAgICAgICAgICAgICBpbmRlbnQgPSByZS5tYXRjaChyJ14oXFxzKiknLCBiZWZvcmVbLTFdKS5ncm91cCgxKVxuICAgICAgICAgICAgZWxpZiBzdGFydF9pZHggPCBsZW4oY29kZV9saW5lcyk6XG4gICAgICAgICAgICAgICAgaW5kZW50ID0gcmUubWF0Y2gocideKFxccyopJywgY29kZV9saW5lc1tzdGFydF9pZHhdKS5ncm91cCgxKVxuICAgICAgICAgICAgbmV3X2NvZGVfbGluZXMgPSBbaW5kZW50ICsgbGluZSBpZiBsaW5lLnN0cmlwKCkgZWxzZSBsaW5lIGZvciBsaW5lIGluIG5ld19jb2RlX2xpbmVzXVxuICAgICAgICAgICAgcmVzdWx0X2xpbmVzID0gYmVmb3JlICsgbmV3X2NvZGVfbGluZXMgKyBhZnRlclxuICAgICAgICAgICAgcmV0dXJuICdcXG4nLmpvaW4ocmVzdWx0X2xpbmVzKVxuICAgICAgICBlbHNlOlxuICAgICAgICAgICAgIyBFbGVtZW50IG5vdCBmb3VuZCwgZmFsbGJhY2sgdG8gYWRkXG4gICAgICAgICAgICByZXR1cm4gc2VsZi5hZGRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBuZXdfY29kZSwgcGFyZW50X25hbWUpXG5cbiAgICBkZWYgX19pbml0X18oc2VsZiwgaW5zZXJ0X2JsYW5rX2xpbmVfYmVmb3JlX2VsZW1lbnQ6IGJvb2wgPSBUcnVlLCBpbnNlcnRfYmxhbmtfbGluZV9hZnRlcl9lbGVtZW50OiBib29sID0gRmFsc2UsIGhhbmRsZV9kb2NzdHJpbmdzX3NwZWNpYWw6IGJvb2wgPSBGYWxzZSk6XG4gICAgICAgIHNlbGYuaW5zZXJ0X2JsYW5rX2xpbmVfYmVmb3JlX2VsZW1lbnQgPSBpbnNlcnRfYmxhbmtfbGluZV9iZWZvcmVfZWxlbWVudFxuICAgICAgICBzZWxmLmluc2VydF9ibGFua19saW5lX2FmdGVyX2VsZW1lbnQgPSBpbnNlcnRfYmxhbmtfbGluZV9hZnRlcl9lbGVtZW50XG4gICAgICAgIHNlbGYuaGFuZGxlX2RvY3N0cmluZ3Nfc3BlY2lhbCA9IGhhbmRsZV9kb2NzdHJpbmdzX3NwZWNpYWxcblxuICAgIGRlZiBhZGRfZWxlbWVudChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIG5ld19lbGVtZW50OiBzdHIsIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IHN0cjpcbiAgICAgICAgaW1wb3J0IHJlXG5cbiAgICAgICAgbGluZXMgPSBvcmlnaW5hbF9jb2RlLnNwbGl0bGluZXMoKVxuICAgICAgICBpbmRlbnRfbGV2ZWwgPSAwXG4gICAgICAgIGluc2VydGlvbl9pZHggPSBsZW4obGluZXMpXG4uLi5cblBhdGg6IGNvZGVoZW0vY29yZS9tYW5pcHVsYXRpb25fc2VydmljZS5weVxuLi4uXG5cbiAgICBkZWYgdXBzZXJ0X2VsZW1lbnQoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCBlbGVtZW50X3R5cGU6IHN0ciwgbmFtZTogc3RyLCBuZXdfY29kZTogc3RyLCBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXT1Ob25lKSAtPiBzdHI6XG4gICAgICAgIFwiXCJcIlxuICAgICAgICBBZGQgb3IgcmVwbGFjZSBhIGNvZGUgZWxlbWVudC5cblxuICAgICAgICBBcmdzOlxuICAgICAgICBvcmlnaW5hbF9jb2RlOiBPcmlnaW5hbCBzb3VyY2UgY29kZVxuICAgICAgICBlbGVtZW50X3R5cGU6IFR5cGUgb2YgZWxlbWVudCB0byBhZGQvcmVwbGFjZSAoZnJvbSBDb2RlRWxlbWVudFR5cGUpXG4gICAgICAgIG5hbWU6IE5hbWUgb2YgdGhlIGVsZW1lbnRcbiAgICAgICAgbmV3X2NvZGU6IE5ldyBjb250ZW50IGZvciB0aGUgZWxlbWVudFxuICAgICAgICBwYXJlbnRfbmFtZTogTmFtZSBvZiBwYXJlbnQgZWxlbWVudCAoZS5nLiwgY2xhc3MgbmFtZSBmb3IgbWV0aG9kcylcblxuICAgICAgICBSZXR1cm5zOlxuICAgICAgICBNb2RpZmllZCBjb2RlXG4gICAgICAgIFwiXCJcIlxuICAgICAgICBsb2dnZXIuZGVidWcoZlwiVXBzZXJ0aW5nIGVsZW1lbnQgb2YgdHlwZSAne2VsZW1lbnRfdHlwZX0nLCBuYW1lICd7bmFtZX0nLCBwYXJlbnQgJ3twYXJlbnRfbmFtZX0nXCIpXG4gICAgICAgIG1hbmlwdWxhdG9yID0gc2VsZi5sYW5ndWFnZV9zZXJ2aWNlLmdldF9tYW5pcHVsYXRvcihlbGVtZW50X3R5cGUpXG4uLi5cblxuICAgIGRlZiB1cHNlcnRfZWxlbWVudF9ieV94cGF0aChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIHhwYXRoOiBzdHIsIG5ld19jb2RlOiBzdHIpIC0+IHN0cjpcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIEFkZCBvciByZXBsYWNlIGFuIGVsZW1lbnQgaW4gdGhlIGNvZGUgdXNpbmcgWFBhdGggZXhwcmVzc2lvbi5cbiAgICAgICAgXG4gICAgICAgIEFyZ3M6XG4gICAgICAgICAgICBvcmlnaW5hbF9jb2RlOiBPcmlnaW5hbCBzb3VyY2UgY29kZVxuICAgICAgICAgICAgeHBhdGg6IFhQYXRoIGV4cHJlc3Npb24gKGUuZy4sICdDbGFzc05hbWUubWV0aG9kX25hbWUnLCAnQ2xhc3NOYW1lW2ludGVyZmFjZV0ubWV0aG9kX25hbWVbcHJvcGVydHlfZ2V0dGVyXScpXG4gICAgICAgICAgICBuZXdfY29kZTogTmV3IGNvbnRlbnQgZm9yIHRoZSBlbGVtZW50XG4gICAgICAgICAgICBcbiAgICAgICAgUmV0dXJuczpcbiAgICAgICAgICAgIE1vZGlmaWVkIGNvZGVcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIChlbGVtZW50X25hbWUsIHBhcmVudF9uYW1lLCBlbGVtZW50X3R5cGUpID0gWFBhdGhQYXJzZXIuZ2V0X2VsZW1lbnRfaW5mbyh4cGF0aClcbiAgICAgICAgaWYgbm90IGVsZW1lbnRfdHlwZTpcbiAgICAgICAgICAgIGVsZW1lbnRfdHlwZSA9IHNlbGYubGFuZ3VhZ2Vfc2VydmljZS5kZXRlY3RfZWxlbWVudF90eXBlKG5ld19jb2RlKVxuICAgICAgICByZXR1cm4gc2VsZi51cHNlcnRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBlbGVtZW50X3R5cGUsIGVsZW1lbnRfbmFtZSwgbmV3X2NvZGUsIHBhcmVudF9uYW1lKVxuLi4uXG4gICAgICAgICAgICBcbiAgICAgICAgUmV0dXJuczpcbiAgICAgICAgICAgIE1vZGlmaWVkIGNvZGVcbiAgICAgICAgXCJcIlwiXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJBZGRpbmcgZWxlbWVudCBvZiB0eXBlICd7ZWxlbWVudF90eXBlfScsIHBhcmVudCAne3BhcmVudF9uYW1lfSdcIilcbiAgICAgICAgbWFuaXB1bGF0b3IgPSBzZWxmLmxhbmd1YWdlX3NlcnZpY2UuZ2V0X21hbmlwdWxhdG9yKGVsZW1lbnRfdHlwZSlcbiAgICAgICAgaWYgbWFuaXB1bGF0b3I6XG4gICAgICAgICAgICBpZiBoYXNhdHRyKG1hbmlwdWxhdG9yLCAnYWRkX2VsZW1lbnQnKTpcbiAgICAgICAgICAgICAgICByZXR1cm4gbWFuaXB1bGF0b3IuYWRkX2VsZW1lbnQob3JpZ2luYWxfY29kZSwgbmV3X2NvZGUsIHBhcmVudF9uYW1lKVxuICAgICAgICAgICAgbG9nZ2VyLndhcm5pbmcoZlwiTWFuaXB1bGF0b3IgZm9yIHtlbGVtZW50X3R5cGV9IGRvZXMgbm90IGltcGxlbWVudCBhZGRfZWxlbWVudCBtZXRob2RcIilcbiAgICAgICAgZWxzZTpcbiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGZcIk5vIG1hbmlwdWxhdG9yIGZvdW5kIGZvciBlbGVtZW50IHR5cGU6IHtlbGVtZW50X3R5cGV9XCIpXG4gICAgICAgIHJldHVybiBvcmlnaW5hbF9jb2RlXG4uLi5cbiAgICAgICAgICAgIFxuICAgICAgICBSZXR1cm5zOlxuICAgICAgICAgICAgTW9kaWZpZWQgY29kZVxuICAgICAgICBcIlwiXCJcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIlJlbW92aW5nIGVsZW1lbnQgb2YgdHlwZSAne2VsZW1lbnRfdHlwZX0nLCBuYW1lICd7ZWxlbWVudF9uYW1lfScsIHBhcmVudCAne3BhcmVudF9uYW1lfSdcIilcbiAgICAgICAgbWFuaXB1bGF0b3IgPSBzZWxmLmxhbmd1YWdlX3NlcnZpY2UuZ2V0X21hbmlwdWxhdG9yKGVsZW1lbnRfdHlwZSlcbiAgICAgICAgaWYgbWFuaXB1bGF0b3I6XG4gICAgICAgICAgICBpZiBoYXNhdHRyKG1hbmlwdWxhdG9yLCAncmVtb3ZlX2VsZW1lbnQnKTpcbiAgICAgICAgICAgICAgICByZXR1cm4gbWFuaXB1bGF0b3IucmVtb3ZlX2VsZW1lbnQob3JpZ2luYWxfY29kZSwgZWxlbWVudF9uYW1lLCBwYXJlbnRfbmFtZSlcbiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGZcIk1hbmlwdWxhdG9yIGZvciB7ZWxlbWVudF90eXBlfSBkb2VzIG5vdCBpbXBsZW1lbnQgcmVtb3ZlX2VsZW1lbnQgbWV0aG9kXCIpXG4gICAgICAgIGVsc2U6XG4gICAgICAgICAgICBsb2dnZXIud2FybmluZyhmXCJObyBtYW5pcHVsYXRvciBmb3VuZCBmb3IgZWxlbWVudCB0eXBlOiB7ZWxlbWVudF90eXBlfVwiKVxuICAgICAgICByZXR1cm4gb3JpZ2luYWxfY29kZVxuLi4uXG5QYXRoOiBjb2RlaGVtL2NvcmUvcmVnaXN0cnkucHlcbi4uLlxuXG5jbGFzcyBSZWdpc3RyeTpcbiAgICBcIlwiXCJDZW50cmFsIHJlZ2lzdHJ5IGZvciBDb2RlSGVtIGNvbXBvbmVudHMuXCJcIlwiXG4gICAgX2luc3RhbmNlID0gTm9uZVxuXG4gICAgZGVmIF9faW5pdF9fKHNlbGYpOlxuICAgICAgICBzZWxmLl9pbml0aWFsaXplZCA9IEZhbHNlXG4gICAgICAgIHNlbGYuX2luaXRpYWxpemUoKVxuXG4gICAgZGVmIF9fbmV3X18oY2xzKTpcbiAgICAgICAgaWYgY2xzLl9pbnN0YW5jZSBpcyBOb25lOlxuICAgICAgICAgICAgY2xzLl9pbnN0YW5jZSA9IHN1cGVyKFJlZ2lzdHJ5LCBjbHMpLl9fbmV3X18oY2xzKVxuICAgICAgICByZXR1cm4gY2xzLl9pbnN0YW5jZVxuXG4gICAgZGVmIF9pbml0aWFsaXplKHNlbGYpOlxuICAgICAgICBcIlwiXCJJbml0aWFsaXplcyBlbXB0eSByZWdpc3RyaWVzLlwiXCJcIlxuICAgICAgICBpZiBoYXNhdHRyKHNlbGYsICdfaW5pdGlhbGl6ZWQnKSBhbmQgc2VsZi5faW5pdGlhbGl6ZWQ6XG4gICAgICAgICAgICByZXR1cm5cbiAgICAgICAgc2VsZi5sYW5ndWFnZV9kZXRlY3RvcnMgPSB7fVxuICAgICAgICBzZWxmLmxhbmd1YWdlX3NlcnZpY2VzID0ge31cbiAgICAgICAgc2VsZi5hbGxfZGVzY3JpcHRvcnMgPSB7fVxuICAgICAgICBzZWxmLmFsbF9leHRyYWN0b3JzID0ge31cbiAgICAgICAgc2VsZi5hbGxfbWFuaXB1bGF0b3JzID0ge31cbiAgICAgICAgc2VsZi5kaXNjb3ZlcmVkX21vZHVsZXMgPSBzZXQoKVxuICAgICAgICBzZWxmLmxhbmd1YWdlX3NlcnZpY2VfaW5zdGFuY2VzID0ge31cbiAgICAgICAgc2VsZi5faW5pdGlhbGl6ZWQgPSBGYWxzZVxuICAgICAgICBsb2dnZXIuZGVidWcoJ1JlZ2lzdHJ5IF9pbml0aWFsaXplIGNvbXBsZXRlZC4nKVxuLi4uXG5cbiAgICBkZWYgcmVnaXN0ZXJfZXh0cmFjdG9yKHNlbGYsIGNsczogVHlwZVtCYXNlRXh0cmFjdG9yXSk6XG4gICAgICAgIFwiXCJcIlJlZ2lzdGVycyBhbiBleHRyYWN0b3IgY2xhc3MuXCJcIlwiXG4gICAgICAgIHRyeTpcbiAgICAgICAgICAgIGxhbmd1YWdlX2NvZGUgPSBjbHMuTEFOR1VBR0VfQ09ERS5sb3dlcigpXG4gICAgICAgICAgICBlbGVtZW50X3R5cGUgPSBjbHMuRUxFTUVOVF9UWVBFLnZhbHVlLmxvd2VyKClcbiAgICAgICAgICAgIGV4dHJhY3Rvcl9rZXkgPSBmJ3tsYW5ndWFnZV9jb2RlfS97ZWxlbWVudF90eXBlfSdcbiAgICAgICAgICAgIGlmIGV4dHJhY3Rvcl9rZXkgaW4gc2VsZi5hbGxfZXh0cmFjdG9yczpcbiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmXCJFeHRyYWN0b3IgZm9yICd7ZXh0cmFjdG9yX2tleX0nIGlzIGFscmVhZHkgcmVnaXN0ZXJlZCAoe3NlbGYuYWxsX2V4dHJhY3RvcnNbZXh0cmFjdG9yX2tleV0uX19uYW1lX199KS4gT3ZlcndyaXRpbmcgd2l0aCB7Y2xzLl9fbmFtZV9ffS5cIilcbiAgICAgICAgICAgIHNlbGYuYWxsX2V4dHJhY3RvcnNbZXh0cmFjdG9yX2tleV0gPSBjbHNcbiAgICAgICAgICAgIHJpY2gucHJpbnQoZidSZWdpc3RlcmVkIGV4dHJhY3Rvcjoge2Nscy5fX25hbWVfX30gZm9yIHtleHRyYWN0b3Jfa2V5fScpXG4gICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcbiAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmJ0Vycm9yIGR1cmluZyByZWdpc3RyYXRpb24gb2YgZXh0cmFjdG9yIHtjbHMuX19uYW1lX199OiB7ZX0nLCBleGNfaW5mbz1UcnVlKVxuICAgICAgICByZXR1cm4gY2xzXG5cbiAgICBkZWYgcmVnaXN0ZXJfbWFuaXB1bGF0b3Ioc2VsZiwgY2xzKTpcbiAgICAgICAgXCJcIlwiUmVnaXN0ZXJzIGEgbWFuaXB1bGF0b3IgY2xhc3MuXCJcIlwiXG4gICAgICAgIHRyeTpcbiAgICAgICAgICAgIGxhbmd1YWdlX2NvZGUgPSBjbHMuTEFOR1VBR0VfQ09ERS5sb3dlcigpXG4gICAgICAgICAgICBlbGVtZW50X3R5cGUgPSBjbHMuRUxFTUVOVF9UWVBFLnZhbHVlLmxvd2VyKClcbiAgICAgICAgICAgIGtleSA9IGYne2xhbmd1YWdlX2NvZGV9X3tlbGVtZW50X3R5cGV9J1xuICAgICAgICAgICAgaWYga2V5IGluIHNlbGYuYWxsX21hbmlwdWxhdG9yczpcbiAgICAgICAgICAgICAgICBsb2dnZXIud2FybmluZyhmXCJNYW5pcHVsYXRvciBmb3IgJ3trZXl9JyBpcyBhbHJlYWR5IHJlZ2lzdGVyZWQgKHtzZWxmLmFsbF9tYW5pcHVsYXRvcnNba2V5XS5fX25hbWVfX30pLiBPdmVyd3JpdGluZyB3aXRoIHtjbHMuX19uYW1lX199LlwiKVxuICAgICAgICAgICAgc2VsZi5hbGxfbWFuaXB1bGF0b3JzW2tleV0gPSBjbHNcbiAgICAgICAgICAgIHJpY2gucHJpbnQoZidSZWdpc3RlcmVkIG1hbmlwdWxhdG9yOiB7Y2xzLl9fbmFtZV9ffSBmb3Ige2xhbmd1YWdlX2NvZGV9L3tlbGVtZW50X3R5cGV9JylcbiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYnRXJyb3IgZHVyaW5nIHJlZ2lzdHJhdGlvbiBvZiBtYW5pcHVsYXRvciB7Y2xzLl9fbmFtZV9ffToge2V9JywgZXhjX2luZm89VHJ1ZSlcbiAgICAgICAgcmV0dXJuIGNsc1xuLi4uXG5cbiMgR2xvYmFsIHJlZ2lzdHJ5IGluc3RhbmNlXG5yZWdpc3RyeSA9IFJlZ2lzdHJ5KClcblxuIyBEZWNvcmF0b3JzIGZvciByZWdpc3RyYXRpb25cbmRlZiBsYW5ndWFnZV9kZXRlY3RvcihjbHMpOlxuICAgIFwiXCJcIkRlY29yYXRvciBmb3IgcmVnaXN0ZXJpbmcgYSBsYW5ndWFnZSBkZXRlY3Rvci5cIlwiXCJcbiAgICByZXR1cm4gcmVnaXN0cnkucmVnaXN0ZXJfbGFuZ3VhZ2VfZGV0ZWN0b3IoY2xzKVxuXG5kZWYgbGFuZ3VhZ2Vfc2VydmljZShjbHMpOlxuICAgIFwiXCJcIkRlY29yYXRvciBmb3IgcmVnaXN0ZXJpbmcgYSBsYW5ndWFnZSBzZXJ2aWNlLlwiXCJcIlxuICAgIHJldHVybiByZWdpc3RyeS5yZWdpc3Rlcl9sYW5ndWFnZV9zZXJ2aWNlKGNscylcblxuZGVmIGV4dHJhY3RvcihjbHMpOlxuICAgIFwiXCJcIkRlY29yYXRvciBmb3IgcmVnaXN0ZXJpbmcgYW4gZXh0cmFjdG9yLlwiXCJcIlxuICAgIHJldHVybiByZWdpc3RyeS5yZWdpc3Rlcl9leHRyYWN0b3IoY2xzKVxuXG5kZWYgbWFuaXB1bGF0b3IoY2xzKTpcbiAgICBcIlwiXCJEZWNvcmF0b3IgZm9yIHJlZ2lzdGVyaW5nIGEgbWFuaXB1bGF0b3IuXCJcIlwiXG4gICAgcmV0dXJuIHJlZ2lzdHJ5LnJlZ2lzdGVyX21hbmlwdWxhdG9yKGNscylcblxuZGVmIGVsZW1lbnRfdHlwZV9kZXNjcmlwdG9yKGNscyk6XG4gICAgXCJcIlwiRGVjb3JhdG9yIGZvciByZWdpc3RlcmluZyBhbiBlbGVtZW50IHR5cGUgZGVzY3JpcHRvci5cIlwiXCJcbiAgICByZXR1cm4gcmVnaXN0cnkucmVnaXN0ZXJfZWxlbWVudF90eXBlX2Rlc2NyaXB0b3IoY2xzKS4uLlxuIiwiaXNFcnJvciI6ZmFsc2UsInJlcXVlc3RJZCI6IiJ9fSwiNGY3YmFkNTAtZTZlMy00MWZmLWE2YTMtZGUxYTEyY2M1NWY3O3Rvb2x1X3ZydHhfMDFTeTRlRFFrSkVGTDI1YjZkU1lZWnRjIjp7InBoYXNlIjo1LCJyZXN1bHQiOnsidGV4dCI6IlRoZSBmb2xsb3dpbmcgY29kZSBzZWN0aW9ucyB3ZXJlIHJldHJpZXZlZDpcblBhdGg6IGNvZGVoZW0vbGFuZ3VhZ2VzL2xhbmdfcHl0aG9uL3B5dGhvbl9hc3RfbWFuaXB1bGF0b3IucHlcbmltcG9ydCBhc3RcbmltcG9ydCBsb2dnaW5nXG5mcm9tIHR5cGluZyBpbXBvcnQgT3B0aW9uYWwsIExpc3QsIFR1cGxlLCBVbmlvbiwgQW55XG5mcm9tIGNvZGVoZW0uY29yZS5tYW5pcHVsYXRvcnMubWFuaXB1bGF0b3JfYmFzZSBpbXBvcnQgTWFuaXB1bGF0b3JCYXNlXG5mcm9tIGNvZGVoZW0ubW9kZWxzLmVudW1zIGltcG9ydCBDb2RlRWxlbWVudFR5cGVcblxubG9nZ2VyID0gbG9nZ2luZy5nZXRMb2dnZXIoX19uYW1lX18pXG5cbmNsYXNzIFJlcGxhY2VPckluc2VydFRyYW5zZm9ybWVyKGFzdC5Ob2RlVHJhbnNmb3JtZXIpOlxuICAgIFwiXCJcIlxuICAgIEFTVCBUcmFuc2Zvcm1lciB0byByZXBsYWNlIGEgbm9kZSBhdCBhIHNwZWNpZmljIGxvY2F0aW9uIG9yIGluc2VydCBub2Rlc1xuICAgIGludG8gYSBwYXJlbnQgbm9kZSdzIGJvZHkuIChWZXJzaW9uIDM6IEltcHJvdmVkIHJlcGxhY2VtZW50LCBpbXBvcnQgYmxvY2sgaGFuZGxpbmcpXG4gICAgXCJcIlwiXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsXG4gICAgICAgICAgICAgICAgIHRhcmdldF9zdGFydF9saW5lOiBPcHRpb25hbFtpbnRdLFxuICAgICAgICAgICAgICAgICB0YXJnZXRfZW5kX2xpbmU6IE9wdGlvbmFsW2ludF0sXG4gICAgICAgICAgICAgICAgIG5ld19ub2RlczogTGlzdFthc3QuQVNUXSxcbiAgICAgICAgICAgICAgICAgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl0sXG4gICAgICAgICAgICAgICAgIGVsZW1lbnRfdHlwZTogQ29kZUVsZW1lbnRUeXBlLFxuICAgICAgICAgICAgICAgICB0YXJnZXRfbmFtZTogc3RyKTpcbiAgICAgICAgc3VwZXIoKS5fX2luaXRfXygpXG4gICAgICAgIHNlbGYudGFyZ2V0X3N0YXJ0X2xpbmUgPSB0YXJnZXRfc3RhcnRfbGluZVxuICAgICAgICBzZWxmLnRhcmdldF9lbmRfbGluZSA9IHRhcmdldF9lbmRfbGluZVxuICAgICAgICBzZWxmLm5ld19ub2RlcyA9IG5ld19ub2Rlc1xuICAgICAgICBzZWxmLnBhcmVudF9uYW1lID0gcGFyZW50X25hbWVcbiAgICAgICAgc2VsZi5lbGVtZW50X3R5cGUgPSBlbGVtZW50X3R5cGVcbiAgICAgICAgc2VsZi50YXJnZXRfbmFtZSA9IHRhcmdldF9uYW1lICMgTmFtZSBvZiB0aGUgZWxlbWVudCB0byByZXBsYWNlL2luc2VydCAoJ2FsbCcgZm9yIGltcG9ydCBibG9jaylcbiAgICAgICAgc2VsZi5pc19yZXBsYWNpbmcgPSB0YXJnZXRfc3RhcnRfbGluZSBpcyBub3QgTm9uZVxuLi4uXG5cbiAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJDYWxjdWxhdGVkIGluc2VydGlvbiBwb2ludCBmb3Ige3NlbGYuZWxlbWVudF90eXBlLnZhbHVlfSBhdCBtb2R1bGUgbGV2ZWw6IHtpbnNlcnRfcG9zfVwiKVxuXG4gICAgICAgIHJldHVybiBpbnNlcnRfcG9zXG5cbiAgICBkZWYgdmlzaXQoc2VsZiwgbm9kZSk6XG4gICAgICAgIFwiXCJcIlZpc2l0IG5vZGVzLCBoYW5kbGluZyByZXBsYWNlbWVudCwgdGhlbiB2aXNpdGluZyBjaGlsZHJlbiwgdGhlbiBpbnNlcnRpb24uXCJcIlwiXG4gICAgICAgICMgMS4gSGFuZGxlIFJlcGxhY2VtZW50IChpZiBhcHBsaWNhYmxlIHRvIHRoZSBub2RlIGl0c2VsZilcbiAgICAgICAgaWYgc2VsZi5pc19yZXBsYWNpbmcgYW5kIG5vdCBzZWxmLm9wZXJhdGlvbl9kb25lIGFuZCBzZWxmLl9pc190YXJnZXRfbm9kZShub2RlKTpcbiAgICAgICAgICAgIGxvZ2dlci5pbmZvKGZcIlJlcGxhY2luZyBub2RlIHt0eXBlKG5vZGUpLl9fbmFtZV9ffSAodGFyZ2V0OiB7c2VsZi50YXJnZXRfbmFtZX0pIGF0IGxpbmUge25vZGUubGluZW5vfSB3aXRoIHtsZW4oc2VsZi5uZXdfbm9kZXMpfSBuZXcgbm9kZShzKS5cIilcbiAgICAgICAgICAgIHNlbGYub3BlcmF0aW9uX2RvbmUgPSBUcnVlXG4gICAgICAgICAgICByZXR1cm4gc2VsZi5uZXdfbm9kZXMgaWYgc2VsZi5uZXdfbm9kZXMgZWxzZSBOb25lICMgUmV0dXJuIGxpc3QvTm9uZSBmb3IgdmlzaXRfbGlzdFxuXG4gICAgICAgICMgMi4gVmlzaXQgQ2hpbGRyZW4gKGdlbmVyaWNfdmlzaXQgaGFuZGxlcyByZWN1cnNpb24pXG4gICAgICAgIG5ld19ub2RlID0gc3VwZXIoKS5nZW5lcmljX3Zpc2l0KG5vZGUpXG5cbiAgICAgICAgIyAzLiBIYW5kbGUgSW5zZXJ0aW9uIChpZiBhcHBsaWNhYmxlIHdpdGhpbiB0aGlzIG5vZGUncyBib2R5KVxuICAgICAgICAjIENoZWNrIG5vZGUgdHlwZSAqYWZ0ZXIqIHZpc2l0aW5nIGNoaWxkcmVuLCBhcyBnZW5lcmljX3Zpc2l0IHJldHVybnMgdGhlIG5vZGVcbiAgICAgICAgaWYgbmV3X25vZGUgaXMgTm9uZTogIyBOb2RlIG1pZ2h0IGhhdmUgYmVlbiBkZWxldGVkIGJ5IGEgY2hpbGQgdmlzaXRvcj8gVW5saWtlbHkgaGVyZSBidXQgc2FmZSBjaGVjay5cbiAgICAgICAgICAgICByZXR1cm4gTm9uZVxuXG4gICAgICAgICMgQ2hlY2sgaWYgaW5zZXJ0aW9uIGlzIGludGVuZGVkIGFuZCBoYXNuJ3QgaGFwcGVuZWQgeWV0XG4gICAgICAgIGlmIG5vdCBzZWxmLmlzX3JlcGxhY2luZyBhbmQgbm90IHNlbGYub3BlcmF0aW9uX2RvbmU6XG4gICAgICAgICAgICBpc19tb2R1bGVfdGFyZ2V0ID0gKHNlbGYucGFyZW50X25hbWUgaXMgTm9uZSBhbmQgaXNpbnN0YW5jZShuZXdfbm9kZSwgYXN0Lk1vZHVsZSkpXG4gICAgICAgICAgICBpc19jbGFzc190YXJnZXQgPSAoc2VsZi5wYXJlbnRfbmFtZSBpcyBub3QgTm9uZSBhbmQgaXNpbnN0YW5jZShuZXdfbm9kZSwgYXN0LkNsYXNzRGVmKSBhbmQgbmV3X25vZGUubmFtZSA9PSBzZWxmLnBhcmVudF9uYW1lKVxuLi4uXG5cbiAgICAgICAgIyBEZWZhdWx0IHByb2Nlc3NpbmcgaWYgbm90IGltcG9ydCBibG9jayByZXBsYWNlbWVudFxuICAgICAgICBub2RlLmJvZHkgPSBzZWxmLnZpc2l0X2xpc3Qobm9kZS5ib2R5KVxuICAgICAgICAjIEFsbG93IGdlbmVyaWNfdmlzaXQgdG8gaGFuZGxlIHBvdGVudGlhbCBpbnNlcnRpb24gaW50byB0aGUgbW9kdWxlIGJvZHlcbiAgICAgICAgcmV0dXJuIHN1cGVyKCkuZ2VuZXJpY192aXNpdChub2RlKVxuXG4gICAgZGVmIHZpc2l0X0NsYXNzRGVmKHNlbGYsIG5vZGU6IGFzdC5DbGFzc0RlZikgLT4gQW55OlxuICAgICAgICBub2RlLmJvZHkgPSBzZWxmLnZpc2l0X2xpc3Qobm9kZS5ib2R5KVxuICAgICAgICAjIEFsbG93IGdlbmVyaWNfdmlzaXQgdG8gaGFuZGxlIHBvdGVudGlhbCBpbnNlcnRpb24gb3IgcmVwbGFjZW1lbnQgb2YgdGhlIGNsYXNzIGl0c2VsZlxuICAgICAgICByZXR1cm4gc3VwZXIoKS5nZW5lcmljX3Zpc2l0KG5vZGUpXG5cbiAgICBkZWYgdmlzaXRfRnVuY3Rpb25EZWYoc2VsZiwgbm9kZTogYXN0LkZ1bmN0aW9uRGVmKSAtPiBBbnk6XG4gICAgICAgIG5vZGUuYm9keSA9IHNlbGYudmlzaXRfbGlzdChub2RlLmJvZHkpXG4gICAgICAgICMgQWxsb3cgZ2VuZXJpY192aXNpdCBmb3IgcmVwbGFjZW1lbnQgY2hlY2sgb2YgdGhlIGZ1bmN0aW9uIGl0c2VsZlxuICAgICAgICByZXR1cm4gc3VwZXIoKS5nZW5lcmljX3Zpc2l0KG5vZGUpXG5cbiAgICBkZWYgdmlzaXRfQXN5bmNGdW5jdGlvbkRlZihzZWxmLCBub2RlOiBhc3QuQXN5bmNGdW5jdGlvbkRlZikgLT4gQW55OlxuICAgICAgICBub2RlLmJvZHkgPSBzZWxmLnZpc2l0X2xpc3Qobm9kZS5ib2R5KVxuICAgICAgICAgIyBBbGxvdyBnZW5lcmljX3Zpc2l0IGZvciByZXBsYWNlbWVudCBjaGVjayBvZiB0aGUgZnVuY3Rpb24gaXRzZWxmXG4gICAgICAgIHJldHVybiBzdXBlcigpLmdlbmVyaWNfdmlzaXQobm9kZSlcblxuY2xhc3MgUHl0aG9uQVNUTWFuaXB1bGF0b3IoTWFuaXB1bGF0b3JCYXNlKTpcbiAgICBcIlwiXCJcbiAgICBBU1QtYmFzZWQgbWFuaXB1bGF0b3IgZm9yIFB5dGhvbiBjb2RlIHVzaW5nIGFzdC5Ob2RlVHJhbnNmb3JtZXIuXG4gICAgU3VwcG9ydHMgcm9idXN0IGluc2VydGlvbiwgcmVwbGFjZW1lbnQgb2YgY2xhc3NlcywgZnVuY3Rpb25zLCBtZXRob2RzLFxuICAgIHByb3BlcnRpZXMsIGFuZCBpbXBvcnRzLiAoVmVyc2lvbiAzKVxuICAgIFwiXCJcIlxuXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsICphcmdzLCAqKmt3YXJncyk6XG4gICAgICAgIHN1cGVyKCkuX19pbml0X18oKmFyZ3MsICoqa3dhcmdzKVxuLi4uXG5cbiAgICBkZWYgdXBzZXJ0X2VsZW1lbnQoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCBlbGVtZW50X3R5cGVfc3RyOiBzdHIsIG5hbWU6IHN0ciwgbmV3X2NvZGU6IHN0ciwgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl0gPSBOb25lKSAtPiBzdHI6XG4gICAgICAgIFwiXCJcIiBBZGQgb3IgcmVwbGFjZSBhIGNvZGUgZWxlbWVudCB1c2luZyBBU1QgdHJhbnNmb3JtYXRpb24uIFwiXCJcIlxuICAgICAgICBsb2dnZXIuaW5mbyhmXCJBU1QgVXBzZXJ0OiB0eXBlPSd7ZWxlbWVudF90eXBlX3N0cn0nLCBuYW1lPSd7bmFtZX0nLCBwYXJlbnQ9J3twYXJlbnRfbmFtZX0nXCIpXG5cbiAgICAgICAgdHJ5OiBlbGVtZW50X3R5cGUgPSBzZWxmLl9nZXRfZWxlbWVudF90eXBlX2Zvcl91cHNlcnQoZWxlbWVudF90eXBlX3N0ciwgbmV3X2NvZGUpXG4gICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yIGFzIGU6IGxvZ2dlci5lcnJvcihmXCJDYW5ub3QgcGVyZm9ybSB1cHNlcnQ6IHtlfVwiKTsgcmV0dXJuIG9yaWdpbmFsX2NvZGVcblxuICAgICAgICAjIFJlZmluZSB0eXBlIGd1ZXNzIGJhc2VkIG9uIGNvbnRleHRcbiAgICAgICAgaWYgZWxlbWVudF90eXBlID09IENvZGVFbGVtZW50VHlwZS5GVU5DVElPTiBhbmQgcGFyZW50X25hbWU6IGVsZW1lbnRfdHlwZSA9IENvZGVFbGVtZW50VHlwZS5NRVRIT0RcbiAgICAgICAgbG9nZ2VyLmluZm8oZlwiUHJvY2Vzc2luZyBhcyBlbGVtZW50IHR5cGU6IHtlbGVtZW50X3R5cGUudmFsdWV9XCIpXG4uLi5cbiAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTogbG9nZ2VyLmVycm9yKGZcIkVycm9yIHBhcnNpbmcgbmV3IGNvZGUgc25pcHBldDoge2V9XCIpOyByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgICAgICBlbHNlOiBsb2dnZXIuZGVidWcoXCJQcm9jZWVkaW5nIHdpdGggZGVsZXRpb24gKG5ld19ub2RlcyBpcyBlbXB0eSkuXCIpXG5cbiAgICAgICAgIyBBcHBseSB0cmFuc2Zvcm1hdGlvblxuICAgICAgICBtb2RpZmllZF90cmVlID0gTm9uZVxuICAgICAgICB0cmFuc2Zvcm1lciA9IE5vbmVcbiAgICAgICAgdHJ5OlxuICAgICAgICAgICAgdHJhbnNmb3JtZXIgPSBSZXBsYWNlT3JJbnNlcnRUcmFuc2Zvcm1lcihcbiAgICAgICAgICAgICAgICB0YXJnZXRfc3RhcnRfbGluZT10YXJnZXRfc3RhcnRfbGluZSwgdGFyZ2V0X2VuZF9saW5lPXRhcmdldF9lbmRfbGluZSxcbiAgICAgICAgICAgICAgICBuZXdfbm9kZXM9bmV3X25vZGVzLCBwYXJlbnRfbmFtZT1wYXJlbnRfbmFtZSxcbiAgICAgICAgICAgICAgICBlbGVtZW50X3R5cGU9ZWxlbWVudF90eXBlLCB0YXJnZXRfbmFtZT1uYW1lIGlmIG5hbWUgIT0gJ2FsbCcgZWxzZSBOb25lICMgUGFzcyBOb25lIG5hbWUgZm9yIGJsb2NrIHJlcGxhY2VcbiAgICAgICAgICAgIClcbiAgICAgICAgICAgIG1vZGlmaWVkX3RyZWUgPSB0cmFuc2Zvcm1lci52aXNpdChvcmlnaW5hbF90cmVlKVxuICAgICAgICAgICAgaWYgbW9kaWZpZWRfdHJlZSBpcyBOb25lOiBsb2dnZXIuaW5mbyhcIlRyYW5zZm9ybWF0aW9uIHJlc3VsdGVkIGluIGVtcHR5IEFTVC5cIik7IHJldHVybiBcIlxcblwiXG4gICAgICAgICAgICBtb2RpZmllZF90cmVlID0gYXN0LmZpeF9taXNzaW5nX2xvY2F0aW9ucyhtb2RpZmllZF90cmVlKVxuXG4gICAgICAgICAgICBpZiBub3QgdHJhbnNmb3JtZXIub3BlcmF0aW9uX2RvbmU6XG4gICAgICAgICAgICAgICAgIGFjdGlvbiA9IFwicmVwbGFjZS9kZWxldGVcIiBpZiBpc19yZXBsYWNpbmcgZWxzZSBcImluc2VydFwiXG4gICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJUcmFuc2Zvcm1lciBmYWlsZWQgdG8ge2FjdGlvbn0gZWxlbWVudCAne25hbWV9JyBcIlxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgZlwie2YnYXQgbGluZXMge3RhcmdldF9zdGFydF9saW5lfS17dGFyZ2V0X2VuZF9saW5lfScgaWYgaXNfcmVwbGFjaW5nIGVsc2UgZidpbnRvIHBhcmVudCB7cGFyZW50X25hbWV9J30uXCIpXG4gICAgICAgICAgICAgICAgIHJldHVybiBvcmlnaW5hbF9jb2RlICMgUmV0dXJuIG9yaWdpbmFsIGlmIG9wZXJhdGlvbiBmYWlsZWRcblxuICAgICAgICAgICAgbG9nZ2VyLmluZm8oZlwiVHJhbnNmb3JtZXIgb3BlcmF0aW9uIHN1Y2Nlc3NmdWw6IHsnUmVwbGFjZWQvRGVsZXRlZCcgaWYgaXNfcmVwbGFjaW5nIGVsc2UgJ0luc2VydGVkJ31cIilcbiAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxuICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGZcIkVycm9yIGR1cmluZyBBU1QgdHJhbnNmb3JtYXRpb246IHtlfVwiLCBleGNfaW5mbz1UcnVlKVxuICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbi4uLlxuXG4gICAgZGVmIGFkZF9lbGVtZW50KHNlbGYsIG9yaWdpbmFsX2NvZGU6IHN0ciwgbmV3X2NvZGU6IHN0ciwgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl09Tm9uZSkgLT4gc3RyOlxuICAgICAgICBsb2dnZXIuZGVidWcoZlwiQ2FsbGluZyBhZGRfZWxlbWVudCBmb3IgcGFyZW50ICd7cGFyZW50X25hbWV9J1wiKVxuICAgICAgICB0cnk6XG4gICAgICAgICAgICBuZXdfdHJlZSA9IGFzdC5wYXJzZShuZXdfY29kZS5zdHJpcCgpKVxuICAgICAgICAgICAgaWYgbm90IG5ld190cmVlLmJvZHk6IGxvZ2dlci5lcnJvcihcIkNhbm5vdCBhZGQgZW1wdHkgZWxlbWVudC5cIik7IHJldHVybiBvcmlnaW5hbF9jb2RlXG4gICAgICAgICAgICBub2RlX3RvX2FkZCA9IG5ld190cmVlLmJvZHlbMF1cbiAgICAgICAgICAgIHRlbXBfbmFtZSA9IGdldGF0dHIobm9kZV90b19hZGQsICduYW1lJywgTm9uZSlcbiAgICAgICAgICAgICMgTGV0IHVwc2VydCBoYW5kbGUgdHlwZSBkZWR1Y3Rpb24gYnkgcGFzc2luZyBcInVua25vd25cIlxuICAgICAgICAgICAgdGVtcF90eXBlX3N0ciA9IFwidW5rbm93blwiXG4gICAgICAgICAgICBpZiBpc2luc3RhbmNlKG5vZGVfdG9fYWRkLCAoYXN0LkltcG9ydCwgYXN0LkltcG9ydEZyb20pKTogdGVtcF9uYW1lID0gJ2FsbCdcblxuICAgICAgICAgICAgaWYgdGVtcF9uYW1lIGFuZCB0ZW1wX3R5cGVfc3RyOlxuICAgICAgICAgICAgICAgIHJldHVybiBzZWxmLnVwc2VydF9lbGVtZW50KG9yaWdpbmFsX2NvZGUsIHRlbXBfdHlwZV9zdHIsIHRlbXBfbmFtZSwgbmV3X2NvZGUsIHBhcmVudF9uYW1lKVxuICAgICAgICAgICAgZWxzZTogbG9nZ2VyLmVycm9yKGZcIkNvdWxkIG5vdCBkZWR1Y2UgbmFtZS90eXBlIGZvciBhZGRfZWxlbWVudDoge25ld19jb2RlWzoxMDBdfS4uLlwiKVxuICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6IGxvZ2dlci5lcnJvcihmXCJFcnJvciBwcmVwYXJpbmcgZm9yIGFkZF9lbGVtZW50OiB7ZX1cIilcbiAgICAgICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcblxuICAgIGRlZiByZXBsYWNlX2VsZW1lbnQoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCBuYW1lOiBzdHIsIG5ld19jb2RlOiBzdHIsIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IHN0cjpcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIkNhbGxpbmcgcmVwbGFjZV9lbGVtZW50IGZvciAne25hbWV9JywgcGFyZW50ICd7cGFyZW50X25hbWV9JyAtIGRlbGVnYXRpbmcgdHlwZSBkZXRlY3Rpb24gdG8gdXBzZXJ0LlwiKVxuICAgICAgICAjIFBhc3MgXCJ1bmtub3duXCIgLSB1cHNlcnQgd2lsbCB0cnkgdG8gZmluZCBleGlzdGluZyBvciBkZWR1Y2UgZnJvbSBuZXdfY29kZVxuICAgICAgICByZXR1cm4gc2VsZi51cHNlcnRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBcInVua25vd25cIiwgbmFtZSwgbmV3X2NvZGUsIHBhcmVudF9uYW1lKVxuXG4gICAgZGVmIHJlbW92ZV9lbGVtZW50KHNlbGYsIG9yaWdpbmFsX2NvZGU6IHN0ciwgbmFtZTogc3RyLCBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXT1Ob25lKSAtPiBzdHI6XG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJDYWxsaW5nIHJlbW92ZV9lbGVtZW50IGZvciAne25hbWV9JywgcGFyZW50ICd7cGFyZW50X25hbWV9JyAtIGRlbGVnYXRpbmcgdHlwZSBkZXRlY3Rpb24gdG8gdXBzZXJ0LlwiKVxuICAgICAgICAjIFBhc3MgXCJ1bmtub3duXCIgLSB1cHNlcnQgd2lsbCB0cnkgdG8gZmluZCB0aGUgZWxlbWVudCBmaXJzdCB0byBkZXRlcm1pbmUgdHlwZVxuICAgICAgICByZXR1cm4gc2VsZi51cHNlcnRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBcInVua25vd25cIiwgbmFtZSwgXCJcIiwgcGFyZW50X25hbWUpXG5cbiAgICBkZWYgdXBzZXJ0X2VsZW1lbnRfYnlfeHBhdGgoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCB4cGF0aDogc3RyLCBuZXdfY29kZTogc3RyKSAtPiBzdHI6XG4gICAgICAgIGZyb20gY29kZWhlbS5jb3JlLmVuZ2luZS54cGF0aF9wYXJzZXIgaW1wb3J0IFhQYXRoUGFyc2VyXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJDYWxsaW5nIHVwc2VydF9lbGVtZW50X2J5X3hwYXRoIGZvciAne3hwYXRofSdcIilcbiAgICAgICAgdHJ5OlxuICAgICAgICAgICAgZWxlbWVudF9uYW1lLCBwYXJlbnRfbmFtZSwgZWxlbWVudF90eXBlX3N0cl9mcm9tX3hwYXRoID0gWFBhdGhQYXJzZXIuZ2V0X2VsZW1lbnRfaW5mbyh4cGF0aClcbiAgICAgICAgICAgIG9wX2VsZW1lbnRfdHlwZV9zdHIgPSBlbGVtZW50X3R5cGVfc3RyX2Zyb21feHBhdGggaWYgZWxlbWVudF90eXBlX3N0cl9mcm9tX3hwYXRoIGVsc2UgXCJ1bmtub3duXCJcbiAgICAgICAgICAgIG9wX25hbWUgPSBlbGVtZW50X25hbWVcbiAgICAgICAgICAgIGlmIG5vdCBvcF9uYW1lIGFuZCBvcF9lbGVtZW50X3R5cGVfc3RyID09IENvZGVFbGVtZW50VHlwZS5JTVBPUlQudmFsdWU6IG9wX25hbWUgPSAnYWxsJ1xuICAgICAgICAgICAgZWxpZiBub3Qgb3BfbmFtZTpcbiAgICAgICAgICAgICAgICAgIyBUcnkgZGVkdWNpbmcgbmFtZSBmcm9tIG5ld19jb2RlIGlmIFhQYXRoIHdhcyBsaWtlICdbY2xhc3NdJ1xuICAgICAgICAgICAgICAgICB0cnk6XG4gICAgICAgICAgICAgICAgICAgICAgbmV3X3RyZWUgPSBhc3QucGFyc2UobmV3X2NvZGUuc3RyaXAoKSlcbiAgICAgICAgICAgICAgICAgICAgICBpZiBuZXdfdHJlZS5ib2R5IGFuZCBoYXNhdHRyKG5ld190cmVlLmJvZHlbMF0sICduYW1lJyk6IG9wX25hbWUgPSBuZXdfdHJlZS5ib2R5WzBdLm5hbWVcbi4uLlxuUGF0aDogY29kZWhlbS9sYW5ndWFnZXMvbGFuZ19weXRob24vX19pbml0X18ucHlcblwiXCJcIlxuUHl0aG9uIGxhbmd1YWdlIG1vZHVsZSBmb3IgQ29kZUhlbS5cblwiXCJcIlxuXG5OT0RFX0NPTkZJRyA9IHtcbiAgICAnZnVuY3Rpb24nOiB7XG4gICAgICAgICduYW1lX2ZpZWxkJzogJ25hbWUnLFxuICAgICAgICAncGFyYW1ldGVyc19maWVsZCc6ICdwYXJhbWV0ZXJzJyxcbiAgICAgICAgJ2JvZHlfZmllbGQnOiAnYm9keScsXG4gICAgICAgICdkZWNvcmF0b3JzX2ZpZWxkJzogJ2RlY29yYXRvcnMnLFxuICAgICAgICAncGFyZW50X2NsYXNzX3R5cGUnOiAnY2xhc3NfZGVmaW5pdGlvbicsXG4gICAgfSxcbiAgICAnbWV0aG9kJzoge1xuICAgICAgICAnbmFtZV9maWVsZCc6ICduYW1lJyxcbiAgICAgICAgJ3BhcmFtZXRlcnNfZmllbGQnOiAncGFyYW1ldGVycycsXG4gICAgICAgICdib2R5X2ZpZWxkJzogJ2JvZHknLFxuICAgICAgICAnZGVjb3JhdG9yc19maWVsZCc6ICdkZWNvcmF0b3JzJyxcbiAgICAgICAgJ3BhcmVudF9jbGFzc190eXBlJzogJ2NsYXNzX2RlZmluaXRpb24nLFxuICAgIH0sXG4gICAgJ2NsYXNzJzoge1xuICAgICAgICAnbmFtZV9maWVsZCc6ICduYW1lJyxcbiAgICAgICAgJ2JvZHlfZmllbGQnOiAnYm9keScsXG4gICAgICAgICdkZWNvcmF0b3JzX2ZpZWxkJzogJ2RlY29yYXRvcnMnLFxuICAgICAgICAncGFyZW50X2NsYXNzX3R5cGUnOiBOb25lLFxuICAgIH0sXG4gICAgJ2RlY29yYXRvcic6IHtcbiAgICAgICAgJ25hbWVfZmllbGQnOiAnbmFtZScsXG4gICAgfSxcbiAgICAncHJvcGVydHlfZ2V0dGVyJzoge1xuICAgICAgICAnbmFtZV9maWVsZCc6ICduYW1lJyxcbiAgICAgICAgJ2JvZHlfZmllbGQnOiAnYm9keScsXG4gICAgICAgICdkZWNvcmF0b3JzX2ZpZWxkJzogJ2RlY29yYXRvcnMnLFxuICAgICAgICAncGFyZW50X2NsYXNzX3R5cGUnOiAnY2xhc3NfZGVmaW5pdGlvbicsXG4gICAgfSxcbiAgICAncHJvcGVydHlfc2V0dGVyJzoge1xuICAgICAgICAnbmFtZV9maWVsZCc6ICduYW1lJyxcbiAgICAgICAgJ2JvZHlfZmllbGQnOiAnYm9keScsXG4gICAgICAgICdkZWNvcmF0b3JzX2ZpZWxkJzogJ2RlY29yYXRvcnMnLFxuICAgICAgICAncGFyZW50X2NsYXNzX3R5cGUnOiAnY2xhc3NfZGVmaW5pdGlvbicsXG4gICAgfSxcbiAgICAnc3RhdGljX21ldGhvZCc6IHtcbiAgICAgICAgJ25hbWVfZmllbGQnOiAnbmFtZScsXG4gICAgICAgICdwYXJhbWV0ZXJzX2ZpZWxkJzogJ3BhcmFtZXRlcnMnLFxuICAgICAgICAnYm9keV9maWVsZCc6ICdib2R5JyxcbiAgICAgICAgJ2RlY29yYXRvcnNfZmllbGQnOiAnZGVjb3JhdG9ycycsXG4gICAgICAgICdwYXJlbnRfY2xhc3NfdHlwZSc6ICdjbGFzc19kZWZpbml0aW9uJyxcbiAgICB9LFxuICAgICdpbXBvcnQnOiB7XG4gICAgICAgICduYW1lX2ZpZWxkJzogJ25hbWUnLCAgIyBvciAnbW9kdWxlJyBkZXBlbmRpbmcgb24gQVNUXG4gICAgfSxcbn1cbmZyb20gY29kZWhlbS5jb3JlLnJlZ2lzdHJ5IGltcG9ydCByZWdpc3RyeVxuZnJvbSAuc2VydmljZSBpbXBvcnQgUHl0aG9uTGFuZ3VhZ2VTZXJ2aWNlXG5mcm9tIC5tYW5pcHVsYXRvci5tZXRob2RfaGFuZGxlciBpbXBvcnQgUHl0aG9uTWV0aG9kTWFuaXB1bGF0b3JcbmZyb20gLnB5dGhvbl9hc3RfbWFuaXB1bGF0b3IgaW1wb3J0IFB5dGhvbkFTVE1hbmlwdWxhdG9yXG5mcm9tIGNvZGVoZW0ubW9kZWxzLmVudW1zIGltcG9ydCBDb2RlRWxlbWVudFR5cGVcbmltcG9ydCBsb2dnaW5nXG5cbmRlZiBpbml0aWFsaXplX3B5dGhvbl9sYW5ndWFnZSgpOlxuICAgIFwiXCJcIlxuICAgIEluaXRpYWxpemUgYW5kIHJlZ2lzdGVyIFB5dGhvbiBsYW5ndWFnZSBtYW5pcHVsYXRvcnMgYW5kIHNlcnZpY2VzLlxuICAgIFRoaXMgZnVuY3Rpb24gY2xlYXJzIGV4aXN0aW5nICdweXRob25fJyBtYW5pcHVsYXRvcnMgYW5kIHJlZ2lzdGVycyBwYXRjaGVkIHZlcnNpb25zLlxuICAgIENhbGwgdGhpcyBleHBsaWNpdGx5IGJlZm9yZSB1c2luZyBQeXRob24gbGFuZ3VhZ2UgZmVhdHVyZXMgb3IgcnVubmluZyB0ZXN0cy5cbiAgICBcIlwiXCJcbiAgICAjIENsZWFyIGFsbCBleGlzdGluZyBweXRob24gbWFuaXB1bGF0b3JzXG4gICAga2V5c190b19yZW1vdmUgPSBbayBmb3IgayBpbiBsaXN0KHJlZ2lzdHJ5LmFsbF9tYW5pcHVsYXRvcnMua2V5cygpKSBpZiBrLnN0YXJ0c3dpdGgoJ3B5dGhvbl8nKV1cbiAgICBmb3IgayBpbiBrZXlzX3RvX3JlbW92ZTpcbiAgICAgICAgcmVnaXN0cnkuYWxsX21hbmlwdWxhdG9ycy5wb3AoaywgTm9uZSlcbiAgICBsb2dnaW5nLmRlYnVnKGZcIkNsZWFyZWQge2xlbihrZXlzX3RvX3JlbW92ZSl9IGV4aXN0aW5nIHB5dGhvbiBtYW5pcHVsYXRvcnMuXCIpXG5cbiAgICAjIFJlZ2lzdGVyIEFTVCBtYW5pcHVsYXRvcnMgZm9yIGZ1bmN0aW9uLCBjbGFzcywgaW1wb3J0XG4gICAgZm9yIGVsZW1lbnRfdHlwZV9lbnVtIGluIFtcbiAgICAgICAgQ29kZUVsZW1lbnRUeXBlLkZVTkNUSU9OLFxuICAgICAgICBDb2RlRWxlbWVudFR5cGUuQ0xBU1MsXG4gICAgICAgIENvZGVFbGVtZW50VHlwZS5JTVBPUlQsXG4gICAgXTpcbiAgICAgICAgZWxlbWVudF90eXBlX25hbWUgPSBlbGVtZW50X3R5cGVfZW51bS52YWx1ZS5sb3dlcigpXG4gICAgICAgIFdyYXBwZXIgPSB0eXBlKFxuICAgICAgICAgICAgZlwiUHl0aG9ue2VsZW1lbnRfdHlwZV9uYW1lLmNhcGl0YWxpemUoKX1BU1RNYW5pcHVsYXRvclwiLFxuICAgICAgICAgICAgKFB5dGhvbkFTVE1hbmlwdWxhdG9yLCksXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJ0xBTkdVQUdFX0NPREUnOiAncHl0aG9uJyxcbiAgICAgICAgICAgICAgICAnRUxFTUVOVF9UWVBFJzogZWxlbWVudF90eXBlX2VudW1cbiAgICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgICByZWdpc3RyeS5yZWdpc3Rlcl9tYW5pcHVsYXRvcihXcmFwcGVyKVxuICAgICAgICBsb2dnaW5nLmRlYnVnKGZcIlJlZ2lzdGVyZWQgQVNUTWFuaXB1bGF0b3I6IFB5dGhvbntlbGVtZW50X3R5cGVfbmFtZS5jYXBpdGFsaXplKCl9QVNUTWFuaXB1bGF0b3IgZm9yIGVsZW1lbnRfdHlwZToge2VsZW1lbnRfdHlwZV9lbnVtfVwiKVxuXG4gICAgIyBSZWdpc3RlciBQeXRob25BU1RNYW5pcHVsYXRvciBmb3Igb3RoZXIgZWxlbWVudCB0eXBlc1xuICAgIGZvciBlbGVtZW50X3R5cGVfZW51bSBpbiBbXG4gICAgICAgIENvZGVFbGVtZW50VHlwZS5NRVRIT0QsXG4gICAgICAgIENvZGVFbGVtZW50VHlwZS5QUk9QRVJUWV9HRVRURVIsXG4gICAgICAgIENvZGVFbGVtZW50VHlwZS5QUk9QRVJUWV9TRVRURVIsXG4gICAgICAgIENvZGVFbGVtZW50VHlwZS5TVEFUSUNfUFJPUEVSVFksXG4gICAgXTpcbiAgICAgICAgZWxlbWVudF90eXBlX25hbWUgPSBlbGVtZW50X3R5cGVfZW51bS52YWx1ZS5sb3dlcigpXG4gICAgICAgIFdyYXBwZXIgPSB0eXBlKFxuICAgICAgICAgICAgZlwiUHl0aG9ue2VsZW1lbnRfdHlwZV9uYW1lLmNhcGl0YWxpemUoKX1BU1RNYW5pcHVsYXRvclwiLFxuICAgICAgICAgICAgKFB5dGhvbkFTVE1hbmlwdWxhdG9yLCksXG4gICAgICAgICAgICB7XG4gICAgICAgICAgICAgICAgJ0xBTkdVQUdFX0NPREUnOiAncHl0aG9uJyxcbiAgICAgICAgICAgICAgICAnRUxFTUVOVF9UWVBFJzogZWxlbWVudF90eXBlX2VudW1cbiAgICAgICAgICAgIH1cbiAgICAgICAgKVxuICAgICAgICByZWdpc3RyeS5yZWdpc3Rlcl9tYW5pcHVsYXRvcihXcmFwcGVyKVxuICAgICAgICBsb2dnaW5nLmRlYnVnKGZcIlJlZ2lzdGVyZWQgQVNUTWFuaXB1bGF0b3I6IFB5dGhvbntlbGVtZW50X3R5cGVfbmFtZS5jYXBpdGFsaXplKCl9QVNUTWFuaXB1bGF0b3IgZm9yIGVsZW1lbnRfdHlwZToge2VsZW1lbnRfdHlwZV9lbnVtfVwiKVxuXG4gICAgIyBSZWdpc3RlciB0aGUgUHl0aG9uIGxhbmd1YWdlIHNlcnZpY2UgKGlmIG5lZWRlZCBlbHNld2hlcmUpXG4gICAgIyBUaGlzIGltcG9ydCBlbnN1cmVzIHRoZSBzZXJ2aWNlIGlzIGF2YWlsYWJsZVxuICAgIGxvZ2dpbmcuZGVidWcoXCJQeXRob24gbGFuZ3VhZ2UgaW5pdGlhbGl6YXRpb24gY29tcGxldGUuXCIpXG4uLi5cblBhdGg6IGNvZGVoZW0vY29yZS9tYW5pcHVsYXRvcnMvbWFuaXB1bGF0b3JfYmFzZS5weVxuLi4uXG5cbmNsYXNzIE1hbmlwdWxhdG9yQmFzZShBQkMpOlxuICAgIFwiXCJcIkJhc2UgY2xhc3MgZm9yIGFsbCBsYW5ndWFnZS1zcGVjaWZpYyBtYW5pcHVsYXRvcnMuXCJcIlwiXG4gICAgTEFOR1VBR0VfQ09ERTogc3RyID0gJydcbiAgICBFTEVNRU5UX1RZUEU6IE9wdGlvbmFsW0NvZGVFbGVtZW50VHlwZV0gPSBOb25lXG4gICAgQ09NTUVOVF9NQVJLRVJTOiBMaXN0W3N0cl0gPSBbXVxuICAgIERFQ09SQVRPUl9NQVJLRVJTOiBMaXN0W3N0cl0gPSBbXVxuXG4gICAgZGVmIF9faW5pdF9fKHNlbGYsIGxhbmd1YWdlX2NvZGU6IHN0cj1Ob25lLCBlbGVtZW50X3R5cGU6IENvZGVFbGVtZW50VHlwZT1Ob25lLCBmb3JtYXR0ZXI6IEJhc2VGb3JtYXR0ZXI9Tm9uZSwgZXh0cmFjdGlvbl9zZXJ2aWNlPU5vbmUpOlxuICAgICAgICBcIlwiXCJJbml0aWFsaXplIHRoZSBtYW5pcHVsYXRvci5cIlwiXCJcbiAgICAgICAgc2VsZi5sYW5ndWFnZV9jb2RlID0gbGFuZ3VhZ2VfY29kZSBvciBzZWxmLkxBTkdVQUdFX0NPREVcbiAgICAgICAgc2VsZi5lbGVtZW50X3R5cGUgPSBlbGVtZW50X3R5cGUgb3Igc2VsZi5FTEVNRU5UX1RZUEVcbiAgICAgICAgc2VsZi5fZXh0cmFjdGlvbl9zZXJ2aWNlID0gZXh0cmFjdGlvbl9zZXJ2aWNlXG4gICAgICAgIHNlbGYuZm9ybWF0dGVyID0gZm9ybWF0dGVyIG9yIEJhc2VGb3JtYXR0ZXIoKVxuICAgICAgICBpZiBub3Qgc2VsZi5sYW5ndWFnZV9jb2RlOlxuICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcignTWFuaXB1bGF0b3IgcmVxdWlyZXMgYSBsYW5ndWFnZV9jb2RlLicpXG5cbiAgICBAcHJvcGVydHlcbiAgICBkZWYgZXh0cmFjdGlvbl9zZXJ2aWNlKHNlbGYpOlxuICAgICAgICBcIlwiXCJHZXQgZXh0cmFjdGlvbiBzZXJ2aWNlLCBjcmVhdGluZyBpdCBvbiBkZW1hbmQuXCJcIlwiXG4gICAgICAgIGlmIHNlbGYuX2V4dHJhY3Rpb25fc2VydmljZSBpcyBOb25lOlxuICAgICAgICAgICAgZnJvbSBjb2RlaGVtLmNvcmUuZXh0cmFjdGlvbl9zZXJ2aWNlIGltcG9ydCBFeHRyYWN0aW9uU2VydmljZVxuICAgICAgICAgICAgdHJ5OlxuICAgICAgICAgICAgICAgIHNlbGYuX2V4dHJhY3Rpb25fc2VydmljZSA9IEV4dHJhY3Rpb25TZXJ2aWNlKHNlbGYubGFuZ3VhZ2VfY29kZSlcbiAgICAgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yIGFzIGU6XG4gICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGYnRmFpbGVkIHRvIGNyZWF0ZSBFeHRyYWN0aW9uU2VydmljZSBmb3Ige3NlbGYubGFuZ3VhZ2VfY29kZX06IHtlfScpXG4gICAgICAgICAgICAgICAgcmFpc2VcbiAgICAgICAgcmV0dXJuIHNlbGYuX2V4dHJhY3Rpb25fc2VydmljZVxuXG4gICAgQGFic3RyYWN0bWV0aG9kXG4gICAgZGVmIGFkZF9lbGVtZW50KHNlbGYsIG9yaWdpbmFsX2NvZGU6IHN0ciwgbmV3X2VsZW1lbnQ6IHN0ciwgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl09Tm9uZSkgLT4gc3RyOlxuICAgICAgICBcIlwiXCJBZGQgYW4gZWxlbWVudCB0byB0aGUgY29kZS4gTXVzdCBiZSBpbXBsZW1lbnRlZCBieSBzdWJjbGFzc2VzLlwiXCJcIlxuICAgICAgICByYWlzZSBOb3RJbXBsZW1lbnRlZEVycm9yKCdTdWJjbGFzc2VzIG11c3QgaW1wbGVtZW50IGFkZF9lbGVtZW50Jylcbi4uLlxuXG4gICAgZGVmIGZvcm1hdF9lbGVtZW50KHNlbGYsIGVsZW1lbnRfY29kZTogc3RyLCBpbmRlbnRfbGV2ZWw6IGludD0wKSAtPiBzdHI6XG4gICAgICAgIFwiXCJcIkZvcm1hdCBhIGNvZGUgZWxlbWVudCB1c2luZyB0aGUgbGFuZ3VhZ2Utc3BlY2lmaWMgZm9ybWF0dGVyLlwiXCJcIlxuICAgICAgICBpZiBoYXNhdHRyKHNlbGYuZm9ybWF0dGVyLCAnZm9ybWF0X2VsZW1lbnQnKSBhbmQgc2VsZi5lbGVtZW50X3R5cGU6XG4gICAgICAgICAgICBkZWRlbnRlZF9jb2RlID0gc2VsZi5mb3JtYXR0ZXIuZGVkZW50KGVsZW1lbnRfY29kZSlcbiAgICAgICAgICAgIGZvcm1hdHRlZF9ub19iYXNlX2luZGVudCA9IHNlbGYuZm9ybWF0dGVyLmZvcm1hdF9lbGVtZW50KHNlbGYuZWxlbWVudF90eXBlLnZhbHVlLCBkZWRlbnRlZF9jb2RlKVxuICAgICAgICAgICAgYmFzZV9pbmRlbnQgPSBzZWxmLmZvcm1hdHRlci5pbmRlbnRfc3RyaW5nICogaW5kZW50X2xldmVsXG4gICAgICAgICAgICByZXR1cm4gc2VsZi5hcHBseV9pbmRlbnRhdGlvbihmb3JtYXR0ZWRfbm9fYmFzZV9pbmRlbnQsIGJhc2VfaW5kZW50KVxuICAgICAgICBpbmRlbnQgPSAnICcgKiAoc2VsZi5mb3JtYXR0ZXIuaW5kZW50X3NpemUgaWYgaGFzYXR0cihzZWxmLmZvcm1hdHRlciwgJ2luZGVudF9zaXplJykgZWxzZSA0KSAqIGluZGVudF9sZXZlbFxuICAgICAgICByZXR1cm4gc2VsZi5hcHBseV9pbmRlbnRhdGlvbihlbGVtZW50X2NvZGUuc3RyaXAoKSwgaW5kZW50KVxuXG4gICAgZGVmIHJlcGxhY2VfZWxlbWVudChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIGVsZW1lbnRfbmFtZTogc3RyLCBuZXdfZWxlbWVudDogc3RyLCBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXT1Ob25lKSAtPiBzdHI6XG4gICAgICAgIFwiXCJcIlJlcGxhY2UgYW4gZWxlbWVudCBpbiB0aGUgY29kZSwgaGFuZGxpbmcgZGVjb3JhdG9ycy9jb21tZW50cy5cIlwiXCJcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIlJlcGxhY2luZyB7c2VsZi5lbGVtZW50X3R5cGV9ICd7ZWxlbWVudF9uYW1lfScgKHBhcmVudDoge3BhcmVudF9uYW1lfSlcIilcbiAgICAgICAgc3RhcnRfbGluZSwgZW5kX2xpbmUgPSBzZWxmLmZpbmRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBlbGVtZW50X25hbWUsIHBhcmVudF9uYW1lKVxuICAgICAgICBpZiBzdGFydF9saW5lID09IDAgYW5kIGVuZF9saW5lID09IDA6XG4gICAgICAgICAgICBsb2dnZXIuaW5mbyhmXCJ7c2VsZi5lbGVtZW50X3R5cGV9ICd7ZWxlbWVudF9uYW1lfScgbm90IGZvdW5kLiBBdHRlbXB0aW5nIHRvIGFkZC5cIilcbiAgICAgICAgICAgIGNhbl9hZGQgPSBwYXJlbnRfbmFtZSBvciBzZWxmLmVsZW1lbnRfdHlwZSBpbiBbQ29kZUVsZW1lbnRUeXBlLkZVTkNUSU9OLCBDb2RlRWxlbWVudFR5cGUuQ0xBU1MsIENvZGVFbGVtZW50VHlwZS5JTVBPUlRdXG4gICAgICAgICAgICBpZiBjYW5fYWRkOlxuICAgICAgICAgICAgICAgIHRyeTpcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuYWRkX2VsZW1lbnQob3JpZ2luYWxfY29kZSwgbmV3X2VsZW1lbnQsIHBhcmVudF9uYW1lKVxuICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcbi4uLlxuXG4gICAgZGVmIHJlbW92ZV9lbGVtZW50KHNlbGYsIG9yaWdpbmFsX2NvZGU6IHN0ciwgZWxlbWVudF9uYW1lOiBzdHIsIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IHN0cjpcbiAgICAgICAgXCJcIlwiUmVtb3ZlIGFuIGVsZW1lbnQgZnJvbSB0aGUgY29kZSwgaGFuZGxpbmcgZGVjb3JhdG9ycy9jb21tZW50cy5cIlwiXCJcbiAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIlJlbW92aW5nIHtzZWxmLmVsZW1lbnRfdHlwZX0gJ3tlbGVtZW50X25hbWV9JyAocGFyZW50OiB7cGFyZW50X25hbWV9KVwiKVxuICAgICAgICBzdGFydF9saW5lLCBlbmRfbGluZSA9IHNlbGYuZmluZF9lbGVtZW50KG9yaWdpbmFsX2NvZGUsIGVsZW1lbnRfbmFtZSwgcGFyZW50X25hbWUpXG4gICAgICAgIGlmIHN0YXJ0X2xpbmUgPT0gMCBhbmQgZW5kX2xpbmUgPT0gMDpcbiAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGZcIkVsZW1lbnQgJ3tlbGVtZW50X25hbWV9JyBub3QgZm91bmQuIENhbm5vdCByZW1vdmUuXCIpXG4gICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgICAgICBsaW5lcyA9IG9yaWdpbmFsX2NvZGUuc3BsaXRsaW5lcygpXG4gICAgICAgIGFkanVzdGVkX3N0YXJ0ID0gc2VsZi5fYWRqdXN0X3N0YXJ0X2xpbmUobGluZXMsIHN0YXJ0X2xpbmUpXG4gICAgICAgIGxvZ2dlci5kZWJ1ZyhmJ0ZvdW5kIGVsZW1lbnQgZm9yIHJlbW92YWwgYXQgbGluZXMge3N0YXJ0X2xpbmV9LXtlbmRfbGluZX0uIEFkanVzdGVkOiB7YWRqdXN0ZWRfc3RhcnR9JylcbiAgICAgICAgcmV0dXJuIHNlbGYucmVwbGFjZV9saW5lcyhvcmlnaW5hbF9jb2RlLCBhZGp1c3RlZF9zdGFydCwgZW5kX2xpbmUsICcnKVxuLi4uXG4iLCJpc0Vycm9yIjpmYWxzZSwicmVxdWVzdElkIjoiIn19LCIwN2U2YzFhZC00NzQ3LTRjNzQtOGNiMS1jZDY5ODE5YWI2YWM7dG9vbHVfdnJ0eF8wMUU4TWpqY1lvUlBXR3BITVFaU1VGMW0iOnsicGhhc2UiOjUsInJlc3VsdCI6eyJ0ZXh0IjoiSGVyZSdzIHRoZSByZXN1bHQgb2YgcnVubmluZyBgY2F0IC1uYCBvbiBjb2RlaGVtL2xhbmd1YWdlcy9sYW5nX3B5dGhvbi9weXRob25fYXN0X21hbmlwdWxhdG9yLnB5OlxuICAgICAxXHRpbXBvcnQgYXN0XG4gICAgIDJcdGltcG9ydCBsb2dnaW5nXG4gICAgIDNcdGZyb20gdHlwaW5nIGltcG9ydCBPcHRpb25hbCwgTGlzdCwgVHVwbGUsIFVuaW9uLCBBbnlcbiAgICAgNFx0ZnJvbSBjb2RlaGVtLmNvcmUubWFuaXB1bGF0b3JzLm1hbmlwdWxhdG9yX2Jhc2UgaW1wb3J0IE1hbmlwdWxhdG9yQmFzZVxuICAgICA1XHRmcm9tIGNvZGVoZW0ubW9kZWxzLmVudW1zIGltcG9ydCBDb2RlRWxlbWVudFR5cGVcbiAgICAgNlx0XG4gICAgIDdcdGxvZ2dlciA9IGxvZ2dpbmcuZ2V0TG9nZ2VyKF9fbmFtZV9fKVxuICAgICA4XHRcbiAgICAgOVx0Y2xhc3MgUmVwbGFjZU9ySW5zZXJ0VHJhbnNmb3JtZXIoYXN0Lk5vZGVUcmFuc2Zvcm1lcik6XG4gICAgMTBcdCAgICBcIlwiXCJcbiAgICAxMVx0ICAgIEFTVCBUcmFuc2Zvcm1lciB0byByZXBsYWNlIGEgbm9kZSBhdCBhIHNwZWNpZmljIGxvY2F0aW9uIG9yIGluc2VydCBub2Rlc1xuICAgIDEyXHQgICAgaW50byBhIHBhcmVudCBub2RlJ3MgYm9keS4gKFZlcnNpb24gMzogSW1wcm92ZWQgcmVwbGFjZW1lbnQsIGltcG9ydCBibG9jayBoYW5kbGluZylcbiAgICAxM1x0ICAgIFwiXCJcIlxuICAgIDE0XHQgICAgZGVmIF9faW5pdF9fKHNlbGYsXG4gICAgMTVcdCAgICAgICAgICAgICAgICAgdGFyZ2V0X3N0YXJ0X2xpbmU6IE9wdGlvbmFsW2ludF0sXG4gICAgMTZcdCAgICAgICAgICAgICAgICAgdGFyZ2V0X2VuZF9saW5lOiBPcHRpb25hbFtpbnRdLFxuICAgIDE3XHQgICAgICAgICAgICAgICAgIG5ld19ub2RlczogTGlzdFthc3QuQVNUXSxcbiAgICAxOFx0ICAgICAgICAgICAgICAgICBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXSxcbiAgICAxOVx0ICAgICAgICAgICAgICAgICBlbGVtZW50X3R5cGU6IENvZGVFbGVtZW50VHlwZSxcbiAgICAyMFx0ICAgICAgICAgICAgICAgICB0YXJnZXRfbmFtZTogc3RyKTpcbiAgICAyMVx0ICAgICAgICBzdXBlcigpLl9faW5pdF9fKClcbiAgICAyMlx0ICAgICAgICBzZWxmLnRhcmdldF9zdGFydF9saW5lID0gdGFyZ2V0X3N0YXJ0X2xpbmVcbiAgICAyM1x0ICAgICAgICBzZWxmLnRhcmdldF9lbmRfbGluZSA9IHRhcmdldF9lbmRfbGluZVxuICAgIDI0XHQgICAgICAgIHNlbGYubmV3X25vZGVzID0gbmV3X25vZGVzXG4gICAgMjVcdCAgICAgICAgc2VsZi5wYXJlbnRfbmFtZSA9IHBhcmVudF9uYW1lXG4gICAgMjZcdCAgICAgICAgc2VsZi5lbGVtZW50X3R5cGUgPSBlbGVtZW50X3R5cGVcbiAgICAyN1x0ICAgICAgICBzZWxmLnRhcmdldF9uYW1lID0gdGFyZ2V0X25hbWUgIyBOYW1lIG9mIHRoZSBlbGVtZW50IHRvIHJlcGxhY2UvaW5zZXJ0ICgnYWxsJyBmb3IgaW1wb3J0IGJsb2NrKVxuICAgIDI4XHQgICAgICAgIHNlbGYuaXNfcmVwbGFjaW5nID0gdGFyZ2V0X3N0YXJ0X2xpbmUgaXMgbm90IE5vbmVcbiAgICAyOVx0ICAgICAgICBzZWxmLmlzX2ltcG9ydF9ibG9ja19yZXBsYWNlID0gKHNlbGYuaXNfcmVwbGFjaW5nIGFuZFxuICAgIDMwXHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5lbGVtZW50X3R5cGUgPT0gQ29kZUVsZW1lbnRUeXBlLklNUE9SVCBhbmRcbiAgICAzMVx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYudGFyZ2V0X25hbWUgPT0gJ2FsbCcpICMgU3BlY2lmaWMgZmxhZyBmb3IgaW1wb3J0IGJsb2NrXG4gICAgMzJcdCAgICAgICAgc2VsZi5vcGVyYXRpb25fZG9uZSA9IEZhbHNlICMgVHJhY2sgaWYgcmVwbGFjZW1lbnQgb3IgaW5zZXJ0aW9uIHdhcyBwZXJmb3JtZWRcbiAgICAzM1x0XG4gICAgMzRcdCAgICBkZWYgX2NoZWNrX3Byb3BlcnR5X2RlY29yYXRvcihzZWxmLCBub2RlOiBVbmlvblthc3QuRnVuY3Rpb25EZWYsIGFzdC5Bc3luY0Z1bmN0aW9uRGVmXSwgZGVjb3JhdG9yX3R5cGU6IHN0cikgLT4gYm9vbDpcbiAgICAzNVx0ICAgICAgICBcIlwiXCJDaGVja3MgZm9yIHNwZWNpZmljIHByb3BlcnR5IGRlY29yYXRvcnMgKEBwcm9wZXJ0eSwgQG5hbWUuc2V0dGVyKS5cIlwiXCJcbiAgICAzNlx0ICAgICAgICBpZiBub3QgaGFzYXR0cihub2RlLCAnZGVjb3JhdG9yX2xpc3QnKTpcbiAgICAzN1x0ICAgICAgICAgICAgcmV0dXJuIEZhbHNlXG4gICAgMzhcdCAgICAgICAgZm9yIGQgaW4gbm9kZS5kZWNvcmF0b3JfbGlzdDpcbiAgICAzOVx0ICAgICAgICAgICAgaWYgZGVjb3JhdG9yX3R5cGUgPT0gJ2dldHRlcic6XG4gICAgNDBcdCAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGQsIGFzdC5OYW1lKSBhbmQgZC5pZCA9PSAncHJvcGVydHknOlxuICAgIDQxXHQgICAgICAgICAgICAgICAgICAgIHJldHVybiBUcnVlXG4gICAgNDJcdCAgICAgICAgICAgIGVsaWYgZGVjb3JhdG9yX3R5cGUgPT0gJ3NldHRlcic6XG4gICAgNDNcdCAgICAgICAgICAgICAgICAgIyBNYXRjaCBAPHRhcmdldF9uYW1lPi5zZXR0ZXIgLSBlbnN1cmUgdGFyZ2V0X25hbWUgaXMgdmFsaWQgZm9yIHRoaXMgY2hlY2tcbiAgICA0NFx0ICAgICAgICAgICAgICAgIGlmIHNlbGYudGFyZ2V0X25hbWUgYW5kIGlzaW5zdGFuY2UoZCwgYXN0LkF0dHJpYnV0ZSkgYW5kIGQuYXR0ciA9PSAnc2V0dGVyJzpcbiAgICA0NVx0ICAgICAgICAgICAgICAgICAgICBpZiBpc2luc3RhbmNlKGQudmFsdWUsIGFzdC5OYW1lKSBhbmQgZC52YWx1ZS5pZCA9PSBzZWxmLnRhcmdldF9uYW1lOlxuICAgIDQ2XHQgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIFRydWVcbiAgICA0N1x0ICAgICAgICByZXR1cm4gRmFsc2VcbiAgICA0OFx0XG4gICAgNDlcdCAgICBkZWYgX2lzX3RhcmdldF9ub2RlKHNlbGYsIG5vZGU6IGFzdC5BU1QpIC0+IGJvb2w6XG4gICAgNTBcdCAgICAgICAgXCJcIlwiQ2hlY2sgaWYgdGhlIG5vZGUgbWF0Y2hlcyB0aGUgdGFyZ2V0IGZvciByZXBsYWNlbWVudCAoZXhjbHVkaW5nIGltcG9ydCBibG9ja3MpLlwiXCJcIlxuICAgIDUxXHQgICAgICAgICMgVGhpcyBtZXRob2Qgc2hvdWxkIE5PVCBiZSB1c2VkIGZvciBpbXBvcnQgYmxvY2sgcmVwbGFjZW1lbnQgbG9naWMuXG4gICAgNTJcdCAgICAgICAgaWYgbm90IHNlbGYuaXNfcmVwbGFjaW5nIG9yIHNlbGYuaXNfaW1wb3J0X2Jsb2NrX3JlcGxhY2U6XG4gICAgNTNcdCAgICAgICAgICAgIHJldHVybiBGYWxzZVxuICAgIDU0XHQgICAgICAgIGlmIG5vdCBoYXNhdHRyKG5vZGUsICdsaW5lbm8nKTogcmV0dXJuIEZhbHNlXG4gICAgNTVcdFxuICAgIDU2XHQgICAgICAgICMgLS0tIFByaW1hcnkgQ2hlY2s6IFN0YXJ0IExpbmUgLS0tXG4gICAgNTdcdCAgICAgICAgIyBBbGxvdyBzbGlnaHQgZGlmZiBpZiBkZWNvcmF0b3JzIG1pZ2h0IGFmZmVjdCB0aGUgRnVuY3Rpb25EZWYvQ2xhc3NEZWYgbGluZW5vXG4gICAgNThcdCAgICAgICAgbGluZV9tYXRjaCA9IEZhbHNlXG4gICAgNTlcdCAgICAgICAgaWYgbm9kZS5saW5lbm8gPT0gc2VsZi50YXJnZXRfc3RhcnRfbGluZTpcbiAgICA2MFx0ICAgICAgICAgICAgbGluZV9tYXRjaCA9IFRydWVcbiAgICA2MVx0ICAgICAgICBlbGlmIGhhc2F0dHIobm9kZSwgJ2RlY29yYXRvcl9saXN0JykgYW5kIG5vZGUuZGVjb3JhdG9yX2xpc3Q6XG4gICAgNjJcdCAgICAgICAgICAgICAjIENoZWNrIGlmIG5vZGUgc3RhcnRzIHNob3J0bHkgYWZ0ZXIgdGFyZ2V0IGlmIGRlY29yYXRvcnMgYXJlIHByZXNlbnRcbiAgICA2M1x0ICAgICAgICAgICAgIGlmIG5vZGUubGluZW5vID4gc2VsZi50YXJnZXRfc3RhcnRfbGluZSBhbmQgKG5vZGUubGluZW5vIC0gc2VsZi50YXJnZXRfc3RhcnRfbGluZSkgPD0gbGVuKG5vZGUuZGVjb3JhdG9yX2xpc3QpOlxuICAgIDY0XHQgICAgICAgICAgICAgICAgICAgbGluZV9tYXRjaCA9IFRydWVcbiAgICA2NVx0ICAgICAgICAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJBY2NlcHRpbmcgbm9kZSB7Z2V0YXR0cihub2RlLCAnbmFtZScsIHR5cGUobm9kZSkuX19uYW1lX18pfSBhdCBsaW5lIHtub2RlLmxpbmVub30gZm9yIHRhcmdldCBsaW5lIHtzZWxmLnRhcmdldF9zdGFydF9saW5lfSBkdWUgdG8gZGVjb3JhdG9ycy5cIilcbiAgICA2Nlx0XG4gICAgNjdcdCAgICAgICAgaWYgbm90IGxpbmVfbWF0Y2g6IHJldHVybiBGYWxzZVxuICAgIDY4XHRcbiAgICA2OVx0ICAgICAgICAjIC0tLSBTZWNvbmRhcnkgQ2hlY2s6IFR5cGUgYW5kIE5hbWUgLS0tXG4gICAgNzBcdCAgICAgICAgbm9kZV9uYW1lID0gZ2V0YXR0cihub2RlLCAnbmFtZScsIE5vbmUpXG4gICAgNzFcdFxuICAgIDcyXHQgICAgICAgIGlmIGlzaW5zdGFuY2Uobm9kZSwgKGFzdC5GdW5jdGlvbkRlZiwgYXN0LkFzeW5jRnVuY3Rpb25EZWYpKTpcbiAgICA3M1x0ICAgICAgICAgICAgaWYgbm9kZV9uYW1lICE9IHNlbGYudGFyZ2V0X25hbWU6IHJldHVybiBGYWxzZVxuICAgIDc0XHQgICAgICAgICAgICBpZiBzZWxmLmVsZW1lbnRfdHlwZSA9PSBDb2RlRWxlbWVudFR5cGUuUFJPUEVSVFlfR0VUVEVSOlxuICAgIDc1XHQgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NoZWNrX3Byb3BlcnR5X2RlY29yYXRvcihub2RlLCAnZ2V0dGVyJylcbiAgICA3Nlx0ICAgICAgICAgICAgZWxpZiBzZWxmLmVsZW1lbnRfdHlwZSA9PSBDb2RlRWxlbWVudFR5cGUuUFJPUEVSVFlfU0VUVEVSOlxuICAgIDc3XHQgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYuX2NoZWNrX3Byb3BlcnR5X2RlY29yYXRvcihub2RlLCAnc2V0dGVyJylcbiAgICA3OFx0ICAgICAgICAgICAgZWxpZiBzZWxmLmVsZW1lbnRfdHlwZSBpbiAoQ29kZUVsZW1lbnRUeXBlLkZVTkNUSU9OLCBDb2RlRWxlbWVudFR5cGUuTUVUSE9EKTpcbiAgICA3OVx0ICAgICAgICAgICAgICAgICBpc19wcm9wID0gc2VsZi5fY2hlY2tfcHJvcGVydHlfZGVjb3JhdG9yKG5vZGUsICdnZXR0ZXInKSBvciBzZWxmLl9jaGVja19wcm9wZXJ0eV9kZWNvcmF0b3Iobm9kZSwgJ3NldHRlcicpXG4gICAgODBcdCAgICAgICAgICAgICAgICAgcmV0dXJuIG5vdCBpc19wcm9wXG4gICAgODFcdCAgICAgICAgICAgIGVsc2U6IHJldHVybiBGYWxzZVxuICAgIDgyXHRcbiAgICA4M1x0ICAgICAgICBlbGlmIGlzaW5zdGFuY2Uobm9kZSwgYXN0LkNsYXNzRGVmKTpcbiAgICA4NFx0ICAgICAgICAgICAgcmV0dXJuIHNlbGYuZWxlbWVudF90eXBlID09IENvZGVFbGVtZW50VHlwZS5DTEFTUyBhbmQgbm9kZV9uYW1lID09IHNlbGYudGFyZ2V0X25hbWVcbiAgICA4NVx0XG4gICAgODZcdCAgICAgICAgZWxpZiBpc2luc3RhbmNlKG5vZGUsIGFzdC5Bc3NpZ24pOlxuICAgIDg3XHQgICAgICAgICAgICAgdGFyZ2V0cyA9IGdldGF0dHIobm9kZSwgJ3RhcmdldHMnLCBbXSlcbiAgICA4OFx0ICAgICAgICAgICAgIGlzX3N0YXRpY19wcm9wX21hdGNoID0gYW55KGlzaW5zdGFuY2UodCwgYXN0Lk5hbWUpIGFuZCB0LmlkID09IHNlbGYudGFyZ2V0X25hbWUgZm9yIHQgaW4gdGFyZ2V0cylcbiAgICA4OVx0ICAgICAgICAgICAgIHJldHVybiBzZWxmLmVsZW1lbnRfdHlwZSA9PSBDb2RlRWxlbWVudFR5cGUuU1RBVElDX1BST1BFUlRZIGFuZCBpc19zdGF0aWNfcHJvcF9tYXRjaFxuICAgIDkwXHRcbiAgICA5MVx0ICAgICAgICAjIEltcG9ydHMgYXJlIGhhbmRsZWQgYnkgdmlzaXRfTW9kdWxlL3Zpc2l0X2xpc3QgZm9yIGJsb2Nrc1xuICAgIDkyXHQgICAgICAgIGVsaWYgaXNpbnN0YW5jZShub2RlLCAoYXN0LkltcG9ydCwgYXN0LkltcG9ydEZyb20pKTpcbiAgICA5M1x0ICAgICAgICAgICAgIHJldHVybiBzZWxmLmVsZW1lbnRfdHlwZSA9PSBDb2RlRWxlbWVudFR5cGUuSU1QT1JUIGFuZCBub3Qgc2VsZi5pc19pbXBvcnRfYmxvY2tfcmVwbGFjZVxuICAgIDk0XHRcbiAgICA5NVx0ICAgICAgICBsb2dnZXIuZGVidWcoZlwiTm9kZSB0eXBlIHt0eXBlKG5vZGUpLl9fbmFtZV9ffSBhdCBsaW5lIHtub2RlLmxpbmVub30gZGlkIG5vdCBtYXRjaCBleHBlY3RlZCBsb2dpYyBmb3IgdGFyZ2V0IHtzZWxmLnRhcmdldF9uYW1lfSAoe3NlbGYuZWxlbWVudF90eXBlLnZhbHVlfSlcIilcbiAgICA5Nlx0ICAgICAgICByZXR1cm4gRmFsc2VcbiAgICA5N1x0XG4gICAgOThcdCAgICBkZWYgX2ZpbmRfaW5zZXJ0aW9uX3BvaW50KHNlbGYsIGJvZHk6IExpc3RbYXN0LkFTVF0pIC0+IGludDpcbiAgICA5OVx0ICAgICAgICBcIlwiXCJEZXRlcm1pbmUgd2hlcmUgdG8gaW5zZXJ0IHRoZSBuZXcgbm9kZShzKS4gKEltcHJvdmVkIHBsYWNlbWVudClcIlwiXCJcbiAgIDEwMFx0ICAgICAgICBpbnNlcnRfcG9zID0gbGVuKGJvZHkpICMgRGVmYXVsdDogYXBwZW5kIGF0IHRoZSBlbmRcbiAgIDEwMVx0XG4gICAxMDJcdCAgICAgICAgZGVmIGZpbmRfYWZ0ZXJfbGFzdChub2RlX3R5cGVzOiB0dXBsZSkgLT4gaW50OlxuICAgMTAzXHQgICAgICAgICAgICBsYXN0X3BvcyA9IC0xXG4gICAxMDRcdCAgICAgICAgICAgIGZvciBpLCBub2RlIGluIGVudW1lcmF0ZShib2R5KTpcbiAgIDEwNVx0ICAgICAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uobm9kZSwgbm9kZV90eXBlcyk6XG4gICAxMDZcdCAgICAgICAgICAgICAgICAgICAgbGFzdF9wb3MgPSBpXG4gICAxMDdcdCAgICAgICAgICAgIHJldHVybiBsYXN0X3BvcyArIDFcbiAgIDEwOFx0XG4gICAxMDlcdCAgICAgICAgaWYgc2VsZi5lbGVtZW50X3R5cGUgPT0gQ29kZUVsZW1lbnRUeXBlLklNUE9SVDpcbiAgIDExMFx0ICAgICAgICAgICAgaW5zZXJ0X3BvcyA9IDBcbiAgIDExMVx0ICAgICAgICAgICAgaWYgYm9keSBhbmQgaXNpbnN0YW5jZShib2R5WzBdLCBhc3QuRXhwcikgYW5kIGlzaW5zdGFuY2UoYm9keVswXS52YWx1ZSwgYXN0LkNvbnN0YW50KSBhbmQgaXNpbnN0YW5jZShib2R5WzBdLnZhbHVlLnZhbHVlLCBzdHIpOlxuICAgMTEyXHQgICAgICAgICAgICAgICAgaW5zZXJ0X3BvcyA9IDFcbiAgIDExM1x0ICAgICAgICAgICAgd2hpbGUgaW5zZXJ0X3BvcyA8IGxlbihib2R5KSBhbmQgaXNpbnN0YW5jZShib2R5W2luc2VydF9wb3NdLCAoYXN0LkltcG9ydCwgYXN0LkltcG9ydEZyb20pKTpcbiAgIDExNFx0ICAgICAgICAgICAgICAgIGluc2VydF9wb3MgKz0gMVxuICAgMTE1XHQgICAgICAgICAgICBsb2dnZXIuZGVidWcoZlwiQ2FsY3VsYXRlZCBpbnNlcnRpb24gcG9pbnQgZm9yIElNUE9SVDoge2luc2VydF9wb3N9XCIpXG4gICAxMTZcdFxuICAgMTE3XHQgICAgICAgIGVsaWYgc2VsZi5wYXJlbnRfbmFtZSBpcyBub3QgTm9uZTogIyBJbnNlcnRpbmcgaW50byBhIGNsYXNzXG4gICAxMThcdCAgICAgICAgICAgIGluc2VydF9wb3MgPSAwXG4gICAxMTlcdCAgICAgICAgICAgIGlmIGJvZHkgYW5kIGlzaW5zdGFuY2UoYm9keVswXSwgYXN0LkV4cHIpIGFuZCBpc2luc3RhbmNlKGJvZHlbMF0udmFsdWUsIGFzdC5Db25zdGFudCkgYW5kIGlzaW5zdGFuY2UoYm9keVswXS52YWx1ZS52YWx1ZSwgc3RyKTpcbiAgIDEyMFx0ICAgICAgICAgICAgICAgIGluc2VydF9wb3MgPSAxXG4gICAxMjFcdCAgICAgICAgICAgICMgU3RhdGljIHByb3BlcnRpZXMgcmlnaHQgYWZ0ZXIgZG9jc3RyaW5nXG4gICAxMjJcdCAgICAgICAgICAgIHdoaWxlIGluc2VydF9wb3MgPCBsZW4oYm9keSkgYW5kIGlzaW5zdGFuY2UoYm9keVtpbnNlcnRfcG9zXSwgYXN0LkFzc2lnbik6XG4gICAxMjNcdCAgICAgICAgICAgICAgICBpbnNlcnRfcG9zICs9IDFcbiAgIDEyNFx0ICAgICAgICAgICAgaWYgc2VsZi5lbGVtZW50X3R5cGUgPT0gQ29kZUVsZW1lbnRUeXBlLlNUQVRJQ19QUk9QRVJUWTpcbiAgIDEyNVx0ICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZlwiQ2FsY3VsYXRlZCBpbnNlcnRpb24gcG9pbnQgZm9yIFNUQVRJQ19QUk9QRVJUWSBpbiBjbGFzczoge2luc2VydF9wb3N9XCIpXG4gICAxMjZcdCAgICAgICAgICAgICAgICAgcmV0dXJuIGluc2VydF9wb3NcbiAgIDEyN1x0XG4gICAxMjhcdCAgICAgICAgICAgICMgTWV0aG9kcy9Qcm9wZXJ0aWVzIHVzdWFsbHkgZ28gYXQgdGhlIGVuZCwgYnV0IGJlZm9yZSBpbm5lciBjbGFzc2VzIGlmIGFueT8gS2VlcCBpdCBzaW1wbGU6IGVuZC5cbiAgIDEyOVx0ICAgICAgICAgICAgaW5zZXJ0X3BvcyA9IGxlbihib2R5KVxuICAgMTMwXHQgICAgICAgICAgICBsb2dnZXIuZGVidWcoZlwiQ2FsY3VsYXRlZCBpbnNlcnRpb24gcG9pbnQgZm9yIHtzZWxmLmVsZW1lbnRfdHlwZS52YWx1ZX0gaW4gY2xhc3M6IHtpbnNlcnRfcG9zfVwiKVxuICAgMTMxXHRcbiAgIDEzMlx0ICAgICAgICBlbGlmIHNlbGYuZWxlbWVudF90eXBlID09IENvZGVFbGVtZW50VHlwZS5GVU5DVElPTiBvciBzZWxmLmVsZW1lbnRfdHlwZSA9PSBDb2RlRWxlbWVudFR5cGUuQ0xBU1M6XG4gICAxMzNcdCAgICAgICAgICAgIGluc2VydF9wb3MgPSBmaW5kX2FmdGVyX2xhc3QoKGFzdC5JbXBvcnQsIGFzdC5JbXBvcnRGcm9tKSlcbiAgIDEzNFx0ICAgICAgICAgICAgaWYgYm9keSBhbmQgaXNpbnN0YW5jZShib2R5WzBdLCBhc3QuRXhwcikgYW5kIGlzaW5zdGFuY2UoYm9keVswXS52YWx1ZSwgYXN0LkNvbnN0YW50KSBhbmQgaXNpbnN0YW5jZShib2R5WzBdLnZhbHVlLnZhbHVlLCBzdHIpOlxuICAgMTM1XHQgICAgICAgICAgICAgICAgIGluc2VydF9wb3MgPSBtYXgoMSwgaW5zZXJ0X3BvcykgIyBFbnN1cmUgYWZ0ZXIgZG9jc3RyaW5nXG4gICAxMzZcdFxuICAgMTM3XHQgICAgICAgICAgICBsYXN0X2RlZl9wb3MgPSAtMVxuICAgMTM4XHQgICAgICAgICAgICBmb3IgaSwgbm9kZSBpbiBlbnVtZXJhdGUoYm9keSk6XG4gICAxMzlcdCAgICAgICAgICAgICAgICAgaWYgaXNpbnN0YW5jZShub2RlLCAoYXN0LkZ1bmN0aW9uRGVmLCBhc3QuQXN5bmNGdW5jdGlvbkRlZiwgYXN0LkNsYXNzRGVmKSk6XG4gICAxNDBcdCAgICAgICAgICAgICAgICAgICAgIGxhc3RfZGVmX3BvcyA9IGlcbiAgIDE0MVx0ICAgICAgICAgICAgaWYgbGFzdF9kZWZfcG9zICE9IC0xOlxuICAgMTQyXHQgICAgICAgICAgICAgICAgICAjIEZpbmQgdGhlIGFjdHVhbCBpbmRleCAqYWZ0ZXIqIHRoZSBsYXN0IGRlZmluaXRpb24gYmxvY2tcbiAgIDE0M1x0ICAgICAgICAgICAgICAgICAgcG90ZW50aWFsX3BvcyA9IGxhc3RfZGVmX3BvcyArIDFcbiAgIDE0NFx0ICAgICAgICAgICAgICAgICAgIyBTaW1wbGUgYXBwZW5kIGFmdGVyIGxhc3Qgc2VlbXMgc3VmZmljaWVudCBtb3N0IHRpbWVzXG4gICAxNDVcdCAgICAgICAgICAgICAgICAgIGluc2VydF9wb3MgPSBtYXgoaW5zZXJ0X3BvcywgcG90ZW50aWFsX3BvcylcbiAgIDE0Nlx0XG4gICAxNDdcdCAgICAgICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJDYWxjdWxhdGVkIGluc2VydGlvbiBwb2ludCBmb3Ige3NlbGYuZWxlbWVudF90eXBlLnZhbHVlfSBhdCBtb2R1bGUgbGV2ZWw6IHtpbnNlcnRfcG9zfVwiKVxuICAgMTQ4XHRcbiAgIDE0OVx0ICAgICAgICByZXR1cm4gaW5zZXJ0X3Bvc1xuICAgMTUwXHRcbiAgIDE1MVx0ICAgIGRlZiB2aXNpdChzZWxmLCBub2RlKTpcbiAgIDE1Mlx0ICAgICAgICBcIlwiXCJWaXNpdCBub2RlcywgaGFuZGxpbmcgcmVwbGFjZW1lbnQsIHRoZW4gdmlzaXRpbmcgY2hpbGRyZW4sIHRoZW4gaW5zZXJ0aW9uLlwiXCJcIlxuICAgMTUzXHQgICAgICAgICMgMS4gSGFuZGxlIFJlcGxhY2VtZW50IChpZiBhcHBsaWNhYmxlIHRvIHRoZSBub2RlIGl0c2VsZilcbiAgIDE1NFx0ICAgICAgICBpZiBzZWxmLmlzX3JlcGxhY2luZyBhbmQgbm90IHNlbGYub3BlcmF0aW9uX2RvbmUgYW5kIHNlbGYuX2lzX3RhcmdldF9ub2RlKG5vZGUpOlxuICAgMTU1XHQgICAgICAgICAgICBsb2dnZXIuaW5mbyhmXCJSZXBsYWNpbmcgbm9kZSB7dHlwZShub2RlKS5fX25hbWVfX30gKHRhcmdldDoge3NlbGYudGFyZ2V0X25hbWV9KSBhdCBsaW5lIHtub2RlLmxpbmVub30gd2l0aCB7bGVuKHNlbGYubmV3X25vZGVzKX0gbmV3IG5vZGUocykuXCIpXG4gICAxNTZcdCAgICAgICAgICAgIHNlbGYub3BlcmF0aW9uX2RvbmUgPSBUcnVlXG4gICAxNTdcdCAgICAgICAgICAgIHJldHVybiBzZWxmLm5ld19ub2RlcyBpZiBzZWxmLm5ld19ub2RlcyBlbHNlIE5vbmUgIyBSZXR1cm4gbGlzdC9Ob25lIGZvciB2aXNpdF9saXN0XG4gICAxNThcdFxuICAgMTU5XHQgICAgICAgICMgMi4gVmlzaXQgQ2hpbGRyZW4gKGdlbmVyaWNfdmlzaXQgaGFuZGxlcyByZWN1cnNpb24pXG4gICAxNjBcdCAgICAgICAgbmV3X25vZGUgPSBzdXBlcigpLmdlbmVyaWNfdmlzaXQobm9kZSlcbiAgIDE2MVx0XG4gICAxNjJcdCAgICAgICAgIyAzLiBIYW5kbGUgSW5zZXJ0aW9uIChpZiBhcHBsaWNhYmxlIHdpdGhpbiB0aGlzIG5vZGUncyBib2R5KVxuICAgMTYzXHQgICAgICAgICMgQ2hlY2sgbm9kZSB0eXBlICphZnRlciogdmlzaXRpbmcgY2hpbGRyZW4sIGFzIGdlbmVyaWNfdmlzaXQgcmV0dXJucyB0aGUgbm9kZVxuICAgMTY0XHQgICAgICAgIGlmIG5ld19ub2RlIGlzIE5vbmU6ICMgTm9kZSBtaWdodCBoYXZlIGJlZW4gZGVsZXRlZCBieSBhIGNoaWxkIHZpc2l0b3I/IFVubGlrZWx5IGhlcmUgYnV0IHNhZmUgY2hlY2suXG4gICAxNjVcdCAgICAgICAgICAgICByZXR1cm4gTm9uZVxuICAgMTY2XHRcbiAgIDE2N1x0ICAgICAgICAjIENoZWNrIGlmIGluc2VydGlvbiBpcyBpbnRlbmRlZCBhbmQgaGFzbid0IGhhcHBlbmVkIHlldFxuICAgMTY4XHQgICAgICAgIGlmIG5vdCBzZWxmLmlzX3JlcGxhY2luZyBhbmQgbm90IHNlbGYub3BlcmF0aW9uX2RvbmU6XG4gICAxNjlcdCAgICAgICAgICAgIGlzX21vZHVsZV90YXJnZXQgPSAoc2VsZi5wYXJlbnRfbmFtZSBpcyBOb25lIGFuZCBpc2luc3RhbmNlKG5ld19ub2RlLCBhc3QuTW9kdWxlKSlcbiAgIDE3MFx0ICAgICAgICAgICAgaXNfY2xhc3NfdGFyZ2V0ID0gKHNlbGYucGFyZW50X25hbWUgaXMgbm90IE5vbmUgYW5kIGlzaW5zdGFuY2UobmV3X25vZGUsIGFzdC5DbGFzc0RlZikgYW5kIG5ld19ub2RlLm5hbWUgPT0gc2VsZi5wYXJlbnRfbmFtZSlcbiAgIDE3MVx0XG4gICAxNzJcdCAgICAgICAgICAgIGlmIGlzX21vZHVsZV90YXJnZXQgb3IgaXNfY2xhc3NfdGFyZ2V0OlxuICAgMTczXHQgICAgICAgICAgICAgICAgaWYgaGFzYXR0cihuZXdfbm9kZSwgJ2JvZHknKSBhbmQgaXNpbnN0YW5jZShuZXdfbm9kZS5ib2R5LCBsaXN0KTpcbiAgIDE3NFx0ICAgICAgICAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmXCJBdHRlbXB0aW5nIHRvIGluc2VydCBuZXcgbm9kZXMgaW50byB7J01vZHVsZScgaWYgaXNfbW9kdWxlX3RhcmdldCBlbHNlIGYnQ2xhc3Mge3NlbGYucGFyZW50X25hbWV9J31cIilcbiAgIDE3NVx0ICAgICAgICAgICAgICAgICAgICBpbnNlcnRfcG9zID0gc2VsZi5fZmluZF9pbnNlcnRpb25fcG9pbnQobmV3X25vZGUuYm9keSlcbiAgIDE3Nlx0XG4gICAxNzdcdCAgICAgICAgICAgICAgICAgICAgIyBBZGp1c3QgbGluZSBudW1iZXJzIChzaW1wbGUgaGV1cmlzdGljKVxuICAgMTc4XHQgICAgICAgICAgICAgICAgICAgIGJhc2VfbGluZW5vID0gMVxuICAgMTc5XHQgICAgICAgICAgICAgICAgICAgIGlmIGluc2VydF9wb3MgPiAwIGFuZCBoYXNhdHRyKG5ld19ub2RlLmJvZHlbaW5zZXJ0X3Bvcy0xXSwgJ2VuZF9saW5lbm8nKSBhbmQgbmV3X25vZGUuYm9keVtpbnNlcnRfcG9zLTFdLmVuZF9saW5lbm8gaXMgbm90IE5vbmU6XG4gICAxODBcdCAgICAgICAgICAgICAgICAgICAgICAgICBiYXNlX2xpbmVubyA9IG5ld19ub2RlLmJvZHlbaW5zZXJ0X3Bvcy0xXS5lbmRfbGluZW5vICsgMVxuICAgMTgxXHQgICAgICAgICAgICAgICAgICAgIGVsaWYgaW5zZXJ0X3BvcyA8IGxlbihuZXdfbm9kZS5ib2R5KSBhbmQgaGFzYXR0cihuZXdfbm9kZS5ib2R5W2luc2VydF9wb3NdLCAnbGluZW5vJykgYW5kIG5ld19ub2RlLmJvZHlbaW5zZXJ0X3Bvc10ubGluZW5vIGlzIG5vdCBOb25lOlxuICAgMTgyXHQgICAgICAgICAgICAgICAgICAgICAgICAgYmFzZV9saW5lbm8gPSBuZXdfbm9kZS5ib2R5W2luc2VydF9wb3NdLmxpbmVub1xuICAgMTgzXHQgICAgICAgICAgICAgICAgICAgIGVsaWYgaGFzYXR0cihuZXdfbm9kZSwnbGluZW5vJykgYW5kIG5ld19ub2RlLmxpbmVubyBpcyBub3QgTm9uZTpcbiAgIDE4NFx0ICAgICAgICAgICAgICAgICAgICAgICAgIGJhc2VfbGluZW5vID0gbmV3X25vZGUubGluZW5vICsgMVxuICAgMTg1XHRcbiAgIDE4Nlx0ICAgICAgICAgICAgICAgICAgICBsb2dnZXIuZGVidWcoZlwiQWRqdXN0aW5nIGxpbmVubyBmb3IgbmV3IG5vZGVzLCBzdGFydGluZyBmcm9tIH57YmFzZV9saW5lbm99XCIpXG4gICAxODdcdCAgICAgICAgICAgICAgICAgICAgY3VycmVudF9saW5lbm8gPSBiYXNlX2xpbmVub1xuICAgMTg4XHQgICAgICAgICAgICAgICAgICAgIGZvciBpLCBuX25vZGUgaW4gZW51bWVyYXRlKHNlbGYubmV3X25vZGVzKTpcbiAgIDE4OVx0ICAgICAgICAgICAgICAgICAgICAgICAgIGZvciBjaGlsZF9ub2RlIGluIGFzdC53YWxrKG5fbm9kZSk6XG4gICAxOTBcdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGhhc2F0dHIoY2hpbGRfbm9kZSwgJ2xpbmVubycpOiBjaGlsZF9ub2RlLmxpbmVubyA9IGN1cnJlbnRfbGluZW5vXG4gICAxOTFcdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIGhhc2F0dHIoY2hpbGRfbm9kZSwgJ2NvbF9vZmZzZXQnKTogY2hpbGRfbm9kZS5jb2xfb2Zmc2V0ID0gMCAjIFJlc2V0IGNvbCBvZmZzZXRcbiAgIDE5Mlx0ICAgICAgICAgICAgICAgICAgICAgICAgICMgSW5jcmVtZW50IGxpbmUgbnVtYmVyIGZvciBuZXh0IG5vZGUgYmFzZWQgb24gdW5wYXJzZWQgbGluZXNcbiAgIDE5M1x0ICAgICAgICAgICAgICAgICAgICAgICAgIHRyeTpcbiAgIDE5NFx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICBudW1fbGluZXMgPSBsZW4oYXN0LnVucGFyc2Uobl9ub2RlKS5zcGxpdGxpbmVzKCkpXG4gICAxOTVcdCAgICAgICAgICAgICAgICAgICAgICAgICAgICAgY3VycmVudF9saW5lbm8gKz0gbnVtX2xpbmVzXG4gICAxOTZcdCAgICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IGN1cnJlbnRfbGluZW5vICs9MSAjIEZhbGxiYWNrXG4gICAxOTdcdFxuICAgMTk4XHQgICAgICAgICAgICAgICAgICAgICMgUGVyZm9ybSBpbnNlcnRpb25cbiAgIDE5OVx0ICAgICAgICAgICAgICAgICAgICBvcmlnaW5hbF9ib2R5X2xlbiA9IGxlbihuZXdfbm9kZS5ib2R5KVxuICAgMjAwXHQgICAgICAgICAgICAgICAgICAgIG5ld19ub2RlLmJvZHkgPSBuZXdfbm9kZS5ib2R5WzppbnNlcnRfcG9zXSArIHNlbGYubmV3X25vZGVzICsgbmV3X25vZGUuYm9keVtpbnNlcnRfcG9zOl1cbiAgIDIwMVx0ICAgICAgICAgICAgICAgICAgICBpZiBsZW4obmV3X25vZGUuYm9keSkgPiBvcmlnaW5hbF9ib2R5X2xlbjpcbiAgIDIwMlx0ICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGZcIkluc2VydGVkIHtsZW4oc2VsZi5uZXdfbm9kZXMpfSBub2RlKHMpIGF0IGluZGV4IHtpbnNlcnRfcG9zfS5cIilcbiAgIDIwM1x0ICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYub3BlcmF0aW9uX2RvbmUgPSBUcnVlXG4gICAyMDRcdCAgICAgICAgICAgICAgICAgICAgZWxzZTpcbiAgIDIwNVx0ICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci53YXJuaW5nKGZcIkluc2VydGlvbiBhdHRlbXB0IGF0IGluZGV4IHtpbnNlcnRfcG9zfSBkaWQgbm90IGNoYW5nZSBib2R5IGxlbmd0aC5cIilcbiAgIDIwNlx0ICAgICAgICAgICAgICAgIGVsc2U6XG4gICAyMDdcdCAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJUYXJnZXQgbm9kZSB7dHlwZShuZXdfbm9kZSkuX19uYW1lX199IGZvciBpbnNlcnRpb24gZG9lcyBub3QgaGF2ZSBhIGxpc3QgJ2JvZHknLlwiKVxuICAgMjA4XHRcbiAgIDIwOVx0ICAgICAgICByZXR1cm4gbmV3X25vZGVcbiAgIDIxMFx0XG4gICAyMTFcdCAgICAjIHZpc2l0X2xpc3QgaXMgY3J1Y2lhbCBmb3IgaGFuZGxpbmcgcmVwbGFjZW1lbnRzIGNvcnJlY3RseVxuICAgMjEyXHQgICAgZGVmIHZpc2l0X2xpc3Qoc2VsZiwgbm9kZXM6IExpc3RbQW55XSkgLT4gTGlzdFtBbnldOlxuICAgMjEzXHQgICAgICAgIG5ld19saXN0ID0gW11cbiAgIDIxNFx0ICAgICAgICBmb3Igbm9kZSBpbiBub2RlczpcbiAgIDIxNVx0ICAgICAgICAgICAgcmVzdWx0ID0gc2VsZi52aXNpdChub2RlKSAjIHZpc2l0IGhhbmRsZXMgcmVwbGFjZW1lbnQgY2hlY2sgZmlyc3RcbiAgIDIxNlx0ICAgICAgICAgICAgaWYgcmVzdWx0IGlzIE5vbmU6ICMgTm9kZSBkZWxldGVkXG4gICAyMTdcdCAgICAgICAgICAgICAgICBjb250aW51ZVxuICAgMjE4XHQgICAgICAgICAgICBlbGlmIGlzaW5zdGFuY2UocmVzdWx0LCBsaXN0KTogIyBOb2RlIHJlcGxhY2VkIGJ5IG11bHRpcGxlIG5vZGVzXG4gICAyMTlcdCAgICAgICAgICAgICAgICBuZXdfbGlzdC5leHRlbmQocmVzdWx0KVxuICAgMjIwXHQgICAgICAgICAgICBlbHNlOiAjIFNpbmdsZSBub2RlIHJldHVybmVkIChvcmlnaW5hbCBvciByZXBsYWNlZClcbiAgIDIyMVx0ICAgICAgICAgICAgICAgIG5ld19saXN0LmFwcGVuZChyZXN1bHQpXG4gICAyMjJcdCAgICAgICAgcmV0dXJuIG5ld19saXN0XG4gICAyMjNcdFxuICAgMjI0XHQgICAgIyBPdmVycmlkZSB2aXNpdG9ycyBmb3IgY29tbW9uIG5vZGUgdHlwZXMgd2l0aCAnYm9keScgbGlzdHNcbiAgIDIyNVx0ICAgIGRlZiB2aXNpdF9Nb2R1bGUoc2VsZiwgbm9kZTogYXN0Lk1vZHVsZSkgLT4gQW55OlxuICAgMjI2XHQgICAgICAgICMgU3BlY2lhbCBoYW5kbGluZyBmb3IgaW1wb3J0IGJsb2NrIHJlcGxhY2VtZW50XG4gICAyMjdcdCAgICAgICAgaWYgc2VsZi5pc19pbXBvcnRfYmxvY2tfcmVwbGFjZSBhbmQgbm90IHNlbGYub3BlcmF0aW9uX2RvbmU6XG4gICAyMjhcdCAgICAgICAgICAgICBsb2dnZXIuaW5mbyhmXCJQZXJmb3JtaW5nIGltcG9ydCBibG9jayByZXBsYWNlbWVudCAoTGluZXMge3NlbGYudGFyZ2V0X3N0YXJ0X2xpbmV9LXtzZWxmLnRhcmdldF9lbmRfbGluZX0pXCIpXG4gICAyMjlcdCAgICAgICAgICAgICBuZXdfYm9keSA9IFtdXG4gICAyMzBcdCAgICAgICAgICAgICBwcm9jZXNzZWRfaW1wb3J0X2Jsb2NrID0gRmFsc2VcbiAgIDIzMVx0ICAgICAgICAgICAgICMgQ29weSBub2RlcyBiZWZvcmUgdGhlIGltcG9ydCBibG9ja1xuICAgMjMyXHQgICAgICAgICAgICAgZm9yIGksIGl0ZW0gaW4gZW51bWVyYXRlKG5vZGUuYm9keSk6XG4gICAyMzNcdCAgICAgICAgICAgICAgICAgaWYgaXRlbS5saW5lbm8gPCBzZWxmLnRhcmdldF9zdGFydF9saW5lOlxuICAgMjM0XHQgICAgICAgICAgICAgICAgICAgICAgbmV3X2JvZHkuYXBwZW5kKGl0ZW0pICMgS2VlcCBub2RlcyBiZWZvcmUgdGhlIGJsb2NrIHN0YXJ0XG4gICAyMzVcdCAgICAgICAgICAgICAgICAgZWxzZTpcbiAgIDIzNlx0ICAgICAgICAgICAgICAgICAgICAgIGJyZWFrICMgUmVhY2hlZCB0aGUgYmxvY2tcbiAgIDIzN1x0XG4gICAyMzhcdCAgICAgICAgICAgICAjIEluc2VydCBuZXcgaW1wb3J0IG5vZGVzXG4gICAyMzlcdCAgICAgICAgICAgICBpZiBzZWxmLm5ld19ub2RlczpcbiAgIDI0MFx0ICAgICAgICAgICAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIkluc2VydGluZyB7bGVuKHNlbGYubmV3X25vZGVzKX0gbmV3IGltcG9ydCBub2Rlcy5cIilcbiAgIDI0MVx0ICAgICAgICAgICAgICAgICAgIyBBZGp1c3QgbGluZW5vIGhldXJpc3RpY2FsbHlcbiAgIDI0Mlx0ICAgICAgICAgICAgICAgICAgYmFzZV9saW5lbm8gPSBuZXdfYm9keVstMV0uZW5kX2xpbmVubyArIDEgaWYgbmV3X2JvZHkgYW5kIGhhc2F0dHIobmV3X2JvZHlbLTFdLCdlbmRfbGluZW5vJykgZWxzZSAxXG4gICAyNDNcdCAgICAgICAgICAgICAgICAgIGN1cnJlbnRfbGluZW5vID0gYmFzZV9saW5lbm9cbiAgIDI0NFx0ICAgICAgICAgICAgICAgICAgZm9yIGksIG5fbm9kZSBpbiBlbnVtZXJhdGUoc2VsZi5uZXdfbm9kZXMpOlxuICAgMjQ1XHQgICAgICAgICAgICAgICAgICAgICAgIGZvciBjaGlsZF9ub2RlIGluIGFzdC53YWxrKG5fbm9kZSk6XG4gICAyNDZcdCAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiBoYXNhdHRyKGNoaWxkX25vZGUsICdsaW5lbm8nKTogY2hpbGRfbm9kZS5saW5lbm8gPSBjdXJyZW50X2xpbmVub1xuICAgMjQ3XHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgaGFzYXR0cihjaGlsZF9ub2RlLCAnY29sX29mZnNldCcpOiBjaGlsZF9ub2RlLmNvbF9vZmZzZXQgPSAwXG4gICAyNDhcdCAgICAgICAgICAgICAgICAgICAgICAgdHJ5OiBudW1fbGluZXMgPSBsZW4oYXN0LnVucGFyc2Uobl9ub2RlKS5zcGxpdGxpbmVzKCkpOyBjdXJyZW50X2xpbmVubyArPSBudW1fbGluZXNcbiAgIDI0OVx0ICAgICAgICAgICAgICAgICAgICAgICBleGNlcHQ6IGN1cnJlbnRfbGluZW5vICs9IDFcbiAgIDI1MFx0ICAgICAgICAgICAgICAgICAgbmV3X2JvZHkuZXh0ZW5kKHNlbGYubmV3X25vZGVzKVxuICAgMjUxXHRcbiAgIDI1Mlx0ICAgICAgICAgICAgICMgU2tpcCBvcmlnaW5hbCBub2RlcyB3aXRoaW4gdGhlIHJlcGxhY2VkIGJsb2NrIHJhbmdlXG4gICAyNTNcdCAgICAgICAgICAgICBmb3IgaSwgaXRlbSBpbiBlbnVtZXJhdGUobm9kZS5ib2R5KTpcbiAgIDI1NFx0ICAgICAgICAgICAgICAgICBpZiBpdGVtLmxpbmVubyA+PSBzZWxmLnRhcmdldF9zdGFydF9saW5lIGFuZCBoYXNhdHRyKGl0ZW0sICdlbmRfbGluZW5vJykgYW5kIGl0ZW0uZW5kX2xpbmVubyA8PSBzZWxmLnRhcmdldF9lbmRfbGluZTpcbiAgIDI1NVx0ICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlICMgU2tpcCBub2RlcyB3aXRoaW4gdGhlIGJsb2NrXG4gICAyNTZcdCAgICAgICAgICAgICAgICAgIyBTcGVjaWFsIGNhc2U6IG5vZGUgc3RhcnRzIHdpdGhpbiBibG9jayBidXQgZW5kcyBhZnRlciAodW5saWtlbHkgZm9yIGltcG9ydHMpXG4gICAyNTdcdCAgICAgICAgICAgICAgICAgZWxpZiBpdGVtLmxpbmVubyA+PSBzZWxmLnRhcmdldF9zdGFydF9saW5lIGFuZCBpdGVtLmxpbmVubyA8PSBzZWxmLnRhcmdldF9lbmRfbGluZTpcbiAgIDI1OFx0ICAgICAgICAgICAgICAgICAgICAgIGNvbnRpbnVlXG4gICAyNTlcdCAgICAgICAgICAgICAgICAgIyBLZWVwIG5vZGVzIGFmdGVyIHRoZSBibG9ja1xuICAgMjYwXHQgICAgICAgICAgICAgICAgIGVsaWYgaXRlbS5saW5lbm8gPiBzZWxmLnRhcmdldF9lbmRfbGluZTpcbiAgIDI2MVx0ICAgICAgICAgICAgICAgICAgICAgIG5ld19ib2R5LmFwcGVuZChpdGVtKVxuICAgMjYyXHRcbiAgIDI2M1x0ICAgICAgICAgICAgIG5vZGUuYm9keSA9IHNlbGYudmlzaXRfbGlzdChuZXdfYm9keSkgIyBWaXNpdCB0aGUgbmV3bHkgY29uc3RydWN0ZWQgYm9keVxuICAgMjY0XHQgICAgICAgICAgICAgc2VsZi5vcGVyYXRpb25fZG9uZSA9IFRydWUgIyBNYXJrIG9wZXJhdGlvbiBhcyBkb25lXG4gICAyNjVcdCAgICAgICAgICAgICByZXR1cm4gbm9kZSAjIFJldHVybiB0aGUgbW9kaWZpZWQgbm9kZVxuICAgMjY2XHRcbiAgIDI2N1x0ICAgICAgICAjIERlZmF1bHQgcHJvY2Vzc2luZyBpZiBub3QgaW1wb3J0IGJsb2NrIHJlcGxhY2VtZW50XG4gICAyNjhcdCAgICAgICAgbm9kZS5ib2R5ID0gc2VsZi52aXNpdF9saXN0KG5vZGUuYm9keSlcbiAgIDI2OVx0ICAgICAgICAjIEFsbG93IGdlbmVyaWNfdmlzaXQgdG8gaGFuZGxlIHBvdGVudGlhbCBpbnNlcnRpb24gaW50byB0aGUgbW9kdWxlIGJvZHlcbiAgIDI3MFx0ICAgICAgICByZXR1cm4gc3VwZXIoKS5nZW5lcmljX3Zpc2l0KG5vZGUpXG4gICAyNzFcdFxuICAgMjcyXHQgICAgZGVmIHZpc2l0X0NsYXNzRGVmKHNlbGYsIG5vZGU6IGFzdC5DbGFzc0RlZikgLT4gQW55OlxuICAgMjczXHQgICAgICAgIG5vZGUuYm9keSA9IHNlbGYudmlzaXRfbGlzdChub2RlLmJvZHkpXG4gICAyNzRcdCAgICAgICAgIyBBbGxvdyBnZW5lcmljX3Zpc2l0IHRvIGhhbmRsZSBwb3RlbnRpYWwgaW5zZXJ0aW9uIG9yIHJlcGxhY2VtZW50IG9mIHRoZSBjbGFzcyBpdHNlbGZcbiAgIDI3NVx0ICAgICAgICByZXR1cm4gc3VwZXIoKS5nZW5lcmljX3Zpc2l0KG5vZGUpXG4gICAyNzZcdFxuICAgMjc3XHQgICAgZGVmIHZpc2l0X0Z1bmN0aW9uRGVmKHNlbGYsIG5vZGU6IGFzdC5GdW5jdGlvbkRlZikgLT4gQW55OlxuICAgMjc4XHQgICAgICAgIG5vZGUuYm9keSA9IHNlbGYudmlzaXRfbGlzdChub2RlLmJvZHkpXG4gICAyNzlcdCAgICAgICAgIyBBbGxvdyBnZW5lcmljX3Zpc2l0IGZvciByZXBsYWNlbWVudCBjaGVjayBvZiB0aGUgZnVuY3Rpb24gaXRzZWxmXG4gICAyODBcdCAgICAgICAgcmV0dXJuIHN1cGVyKCkuZ2VuZXJpY192aXNpdChub2RlKVxuICAgMjgxXHRcbiAgIDI4Mlx0ICAgIGRlZiB2aXNpdF9Bc3luY0Z1bmN0aW9uRGVmKHNlbGYsIG5vZGU6IGFzdC5Bc3luY0Z1bmN0aW9uRGVmKSAtPiBBbnk6XG4gICAyODNcdCAgICAgICAgbm9kZS5ib2R5ID0gc2VsZi52aXNpdF9saXN0KG5vZGUuYm9keSlcbiAgIDI4NFx0ICAgICAgICAgIyBBbGxvdyBnZW5lcmljX3Zpc2l0IGZvciByZXBsYWNlbWVudCBjaGVjayBvZiB0aGUgZnVuY3Rpb24gaXRzZWxmXG4gICAyODVcdCAgICAgICAgcmV0dXJuIHN1cGVyKCkuZ2VuZXJpY192aXNpdChub2RlKVxuICAgMjg2XHRcbiAgIDI4N1x0Y2xhc3MgUHl0aG9uQVNUTWFuaXB1bGF0b3IoTWFuaXB1bGF0b3JCYXNlKTpcbiAgIDI4OFx0ICAgIFwiXCJcIlxuICAgMjg5XHQgICAgQVNULWJhc2VkIG1hbmlwdWxhdG9yIGZvciBQeXRob24gY29kZSB1c2luZyBhc3QuTm9kZVRyYW5zZm9ybWVyLlxuICAgMjkwXHQgICAgU3VwcG9ydHMgcm9idXN0IGluc2VydGlvbiwgcmVwbGFjZW1lbnQgb2YgY2xhc3NlcywgZnVuY3Rpb25zLCBtZXRob2RzLFxuICAgMjkxXHQgICAgcHJvcGVydGllcywgYW5kIGltcG9ydHMuIChWZXJzaW9uIDMpXG4gICAyOTJcdCAgICBcIlwiXCJcbiAgIDI5M1x0XG4gICAyOTRcdCAgICBkZWYgX19pbml0X18oc2VsZiwgKmFyZ3MsICoqa3dhcmdzKTpcbiAgIDI5NVx0ICAgICAgICBzdXBlcigpLl9faW5pdF9fKCphcmdzLCAqKmt3YXJncylcbiAgIDI5Nlx0XG4gICAyOTdcdCAgICBkZWYgX2dldF9lbGVtZW50X3R5cGVfZm9yX3Vwc2VydChzZWxmLCBlbGVtZW50X3R5cGVfc3RyOiBzdHIsIG5ld19jb2RlOiBzdHIpIC0+IENvZGVFbGVtZW50VHlwZTpcbiAgIDI5OFx0ICAgICAgICBcIlwiXCJEZXRlcm1pbmUgdGhlIENvZGVFbGVtZW50VHlwZSBlbnVtLlwiXCJcIlxuICAgMjk5XHQgICAgICAgIGlmIGVsZW1lbnRfdHlwZV9zdHIgYW5kIGVsZW1lbnRfdHlwZV9zdHIgIT0gJ3Vua25vd24nOlxuICAgMzAwXHQgICAgICAgICAgICAgdHJ5OiByZXR1cm4gQ29kZUVsZW1lbnRUeXBlKGVsZW1lbnRfdHlwZV9zdHIpXG4gICAzMDFcdCAgICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjogbG9nZ2VyLndhcm5pbmcoZlwiSW52YWxpZCBlbGVtZW50X3R5cGUgc3RyaW5nICd7ZWxlbWVudF90eXBlX3N0cn0nLiBBdHRlbXB0aW5nIGRldGVjdGlvbi5cIilcbiAgIDMwMlx0XG4gICAzMDNcdCAgICAgICAgc3RyaXBwZWRfY29kZSA9IG5ld19jb2RlLnN0cmlwKClcbiAgIDMwNFx0ICAgICAgICBpZiBub3Qgc3RyaXBwZWRfY29kZTpcbiAgIDMwNVx0ICAgICAgICAgICAgIGlmIGVsZW1lbnRfdHlwZV9zdHIgYW5kIGVsZW1lbnRfdHlwZV9zdHIgIT0gJ3Vua25vd24nOlxuICAgMzA2XHQgICAgICAgICAgICAgICAgICB0cnk6IHJldHVybiBDb2RlRWxlbWVudFR5cGUoZWxlbWVudF90eXBlX3N0cikgIyBVc2UgcHJvdmlkZWQgdHlwZSBpZiBkZWxldGluZ1xuICAgMzA3XHQgICAgICAgICAgICAgICAgICBleGNlcHQgVmFsdWVFcnJvcjogcGFzc1xuICAgMzA4XHQgICAgICAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihcIkNhbm5vdCBkZXRlcm1pbmUgZWxlbWVudCB0eXBlIGZvciBkZWxldGlvbiB3aXRob3V0IGV4cGxpY2l0IHR5cGUgb3IgcGFyc2FibGUgbmV3X2NvZGUuXCIpXG4gICAzMDlcdFxuICAgMzEwXHQgICAgICAgIGlmIHN0cmlwcGVkX2NvZGUuc3RhcnRzd2l0aCgoJ2RlZiAnLCAnYXN5bmMgZGVmJykpOlxuICAgMzExXHQgICAgICAgICAgICAgIyBOZWVkcyBjb250ZXh0IChwYXJlbnRfbmFtZSkgdG8gYmUgTUVUSE9EIHZzIEZVTkNUSU9OLiBEZWZhdWx0IHRvIEZVTkNUSU9OLlxuICAgMzEyXHQgICAgICAgICAgICAgcmV0dXJuIENvZGVFbGVtZW50VHlwZS5GVU5DVElPTlxuICAgMzEzXHQgICAgICAgIGVsaWYgc3RyaXBwZWRfY29kZS5zdGFydHN3aXRoKCdjbGFzcyAnKTogcmV0dXJuIENvZGVFbGVtZW50VHlwZS5DTEFTU1xuICAgMzE0XHQgICAgICAgIGVsaWYgc3RyaXBwZWRfY29kZS5zdGFydHN3aXRoKCgnaW1wb3J0ICcsICdmcm9tICcpKTogcmV0dXJuIENvZGVFbGVtZW50VHlwZS5JTVBPUlRcbiAgIDMxNVx0ICAgICAgICBlbGlmICc9JyBpbiBzdHJpcHBlZF9jb2RlLnNwbGl0bGluZXMoKVswXTogcmV0dXJuIENvZGVFbGVtZW50VHlwZS5TVEFUSUNfUFJPUEVSVFlcbiAgIDMxNlx0XG4gICAzMTdcdCAgICAgICAgbG9nZ2VyLmVycm9yKGZcIkNvdWxkIG5vdCBkZXRlcm1pbmUgZWxlbWVudCB0eXBlIGZvciB1cHNlcnQgZnJvbSAne2VsZW1lbnRfdHlwZV9zdHJ9JyBvciBjb2RlIHNuaXBwZXQuXCIpXG4gICAzMThcdCAgICAgICAgcmFpc2UgVmFsdWVFcnJvcihmXCJJbnZhbGlkIG9yIHVuZGV0ZWN0YWJsZSBlbGVtZW50IHR5cGU6IHtlbGVtZW50X3R5cGVfc3RyfVwiKVxuICAgMzE5XHRcbiAgIDMyMFx0ICAgIGRlZiB1cHNlcnRfZWxlbWVudChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIGVsZW1lbnRfdHlwZV9zdHI6IHN0ciwgbmFtZTogc3RyLCBuZXdfY29kZTogc3RyLCBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXSA9IE5vbmUpIC0+IHN0cjpcbiAgIDMyMVx0ICAgICAgICBcIlwiXCIgQWRkIG9yIHJlcGxhY2UgYSBjb2RlIGVsZW1lbnQgdXNpbmcgQVNUIHRyYW5zZm9ybWF0aW9uLiBcIlwiXCJcbiAgIDMyMlx0ICAgICAgICBsb2dnZXIuaW5mbyhmXCJBU1QgVXBzZXJ0OiB0eXBlPSd7ZWxlbWVudF90eXBlX3N0cn0nLCBuYW1lPSd7bmFtZX0nLCBwYXJlbnQ9J3twYXJlbnRfbmFtZX0nXCIpXG4gICAzMjNcdFxuICAgMzI0XHQgICAgICAgIHRyeTogZWxlbWVudF90eXBlID0gc2VsZi5fZ2V0X2VsZW1lbnRfdHlwZV9mb3JfdXBzZXJ0KGVsZW1lbnRfdHlwZV9zdHIsIG5ld19jb2RlKVxuICAgMzI1XHQgICAgICAgIGV4Y2VwdCBWYWx1ZUVycm9yIGFzIGU6IGxvZ2dlci5lcnJvcihmXCJDYW5ub3QgcGVyZm9ybSB1cHNlcnQ6IHtlfVwiKTsgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgIDMyNlx0XG4gICAzMjdcdCAgICAgICAgIyBSZWZpbmUgdHlwZSBndWVzcyBiYXNlZCBvbiBjb250ZXh0XG4gICAzMjhcdCAgICAgICAgaWYgZWxlbWVudF90eXBlID09IENvZGVFbGVtZW50VHlwZS5GVU5DVElPTiBhbmQgcGFyZW50X25hbWU6IGVsZW1lbnRfdHlwZSA9IENvZGVFbGVtZW50VHlwZS5NRVRIT0RcbiAgIDMyOVx0ICAgICAgICBsb2dnZXIuaW5mbyhmXCJQcm9jZXNzaW5nIGFzIGVsZW1lbnQgdHlwZToge2VsZW1lbnRfdHlwZS52YWx1ZX1cIilcbiAgIDMzMFx0XG4gICAzMzFcdCAgICAgICAgdGFyZ2V0X3N0YXJ0X2xpbmUsIHRhcmdldF9lbmRfbGluZSA9IE5vbmUsIE5vbmVcbiAgIDMzMlx0ICAgICAgICBpc19yZXBsYWNpbmcgPSBGYWxzZVxuICAgMzMzXHQgICAgICAgIGlzX2RlbGV0aW5nID0gbm90IG5ld19jb2RlLnN0cmlwKClcbiAgIDMzNFx0XG4gICAzMzVcdCAgICAgICAgIyBGaW5kIGV4aXN0aW5nIGVsZW1lbnQgcmFuZ2VcbiAgIDMzNlx0ICAgICAgICBpZiBuYW1lIGFuZCBuYW1lICE9ICdhbGwnOlxuICAgMzM3XHQgICAgICAgICAgICB0cnk6XG4gICAzMzhcdCAgICAgICAgICAgICAgICAgc2VhcmNoX3R5cGVzID0gW2VsZW1lbnRfdHlwZV1cbiAgIDMzOVx0ICAgICAgICAgICAgICAgICAjIEFkZCBhbHRlcm5hdGl2ZXMgaWYgaW5pdGlhbCB0eXBlIG1pZ2h0IGJlIGFtYmlndW91c1xuICAgMzQwXHQgICAgICAgICAgICAgICAgIGlmIGVsZW1lbnRfdHlwZSA9PSBDb2RlRWxlbWVudFR5cGUuTUVUSE9EOiBzZWFyY2hfdHlwZXMuZXh0ZW5kKFtDb2RlRWxlbWVudFR5cGUuUFJPUEVSVFlfR0VUVEVSLCBDb2RlRWxlbWVudFR5cGUuUFJPUEVSVFlfU0VUVEVSXSlcbiAgIDM0MVx0ICAgICAgICAgICAgICAgICBlbGlmIGVsZW1lbnRfdHlwZSA9PSBDb2RlRWxlbWVudFR5cGUuRlVOQ1RJT04gYW5kIHBhcmVudF9uYW1lOiBzZWFyY2hfdHlwZXMuYXBwZW5kKENvZGVFbGVtZW50VHlwZS5NRVRIT0QpXG4gICAzNDJcdFxuICAgMzQzXHQgICAgICAgICAgICAgICAgIGZvciBzZWFyY2hfdHlwZSBpbiBzZWFyY2hfdHlwZXM6XG4gICAzNDRcdCAgICAgICAgICAgICAgICAgICAgICBzdGFydCwgZW5kID0gc2VsZi5leHRyYWN0aW9uX3NlcnZpY2UuZmluZF9lbGVtZW50KG9yaWdpbmFsX2NvZGUsIHNlYXJjaF90eXBlLnZhbHVlLCBuYW1lLCBwYXJlbnRfbmFtZSlcbiAgIDM0NVx0ICAgICAgICAgICAgICAgICAgICAgIGlmIHN0YXJ0ID4gMDpcbiAgIDM0Nlx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgdGFyZ2V0X3N0YXJ0X2xpbmUsIHRhcmdldF9lbmRfbGluZSA9IHN0YXJ0LCBlbmRcbiAgIDM0N1x0ICAgICAgICAgICAgICAgICAgICAgICAgICAgaWYgc2VhcmNoX3R5cGUgIT0gZWxlbWVudF90eXBlOlxuICAgMzQ4XHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGZcIkFkanVzdGluZyB0eXBlIHRvIGZvdW5kIHR5cGU6IHtzZWFyY2hfdHlwZS52YWx1ZX1cIilcbiAgIDM0OVx0ICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBlbGVtZW50X3R5cGUgPSBzZWFyY2hfdHlwZSAjIENvcnJlY3QgdHlwZSBiYXNlZCBvbiBmaW5kaW5nXG4gICAzNTBcdCAgICAgICAgICAgICAgICAgICAgICAgICAgIGJyZWFrXG4gICAzNTFcdCAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0X3N0YXJ0X2xpbmUgaXMgbm90IE5vbmU6XG4gICAzNTJcdCAgICAgICAgICAgICAgICAgICAgIGlzX3JlcGxhY2luZyA9IFRydWVcbiAgIDM1M1x0ICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gXCJERUxFVEVcIiBpZiBpc19kZWxldGluZyBlbHNlIFwiUkVQTEFDRVwiXG4gICAzNTRcdCAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGZcIlBsYW5uaW5nIHRvIHthY3Rpb259IGV4aXN0aW5nIGVsZW1lbnQgJ3tuYW1lfScgKHR5cGUge2VsZW1lbnRfdHlwZS52YWx1ZX0pIGF0IGxpbmVzIHt0YXJnZXRfc3RhcnRfbGluZX0te3RhcmdldF9lbmRfbGluZX1cIilcbiAgIDM1NVx0ICAgICAgICAgICAgICAgICBlbHNlOlxuICAgMzU2XHQgICAgICAgICAgICAgICAgICAgICBpZiBpc19kZWxldGluZzogbG9nZ2VyLmVycm9yKGZcIkNhbm5vdCBkZWxldGUgZWxlbWVudCAne25hbWV9JzogTm90IGZvdW5kLlwiKTsgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgIDM1N1x0ICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZlwiRWxlbWVudCAne25hbWV9JyBub3QgZm91bmQuIFBsYW5uaW5nIHRvIElOU0VSVC5cIilcbiAgIDM1OFx0ICAgICAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxuICAgMzU5XHQgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJFcnJvciBmaW5kaW5nIGVsZW1lbnQgJ3tuYW1lfSc6IHtlfS4gQXNzdW1pbmcgaW5zZXJ0aW9uLlwiKVxuICAgMzYwXHQgICAgICAgICAgICAgICAgIGlmIGlzX2RlbGV0aW5nOiByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgMzYxXHQgICAgICAgIGVsaWYgZWxlbWVudF90eXBlID09IENvZGVFbGVtZW50VHlwZS5JTVBPUlQ6XG4gICAzNjJcdCAgICAgICAgICAgICB0cnk6XG4gICAzNjNcdCAgICAgICAgICAgICAgICAgdGFyZ2V0X3N0YXJ0X2xpbmUsIHRhcmdldF9lbmRfbGluZSA9IHNlbGYuZXh0cmFjdGlvbl9zZXJ2aWNlLl9maW5kX2ltcG9ydF9ibG9ja19yYW5nZShvcmlnaW5hbF9jb2RlKVxuICAgMzY0XHQgICAgICAgICAgICAgICAgIGlmIHRhcmdldF9zdGFydF9saW5lID09IDA6IHRhcmdldF9zdGFydF9saW5lLCB0YXJnZXRfZW5kX2xpbmUgPSBOb25lLCBOb25lXG4gICAzNjVcdCAgICAgICAgICAgICAgICAgaWYgdGFyZ2V0X3N0YXJ0X2xpbmUgaXMgbm90IE5vbmU6XG4gICAzNjZcdCAgICAgICAgICAgICAgICAgICAgIGlzX3JlcGxhY2luZyA9IFRydWVcbiAgIDM2N1x0ICAgICAgICAgICAgICAgICAgICAgYWN0aW9uID0gXCJERUxFVEVcIiBpZiBpc19kZWxldGluZyBlbHNlIFwiUkVQTEFDRVwiXG4gICAzNjhcdCAgICAgICAgICAgICAgICAgICAgIGxvZ2dlci5pbmZvKGZcIlBsYW5uaW5nIHRvIHthY3Rpb259IGltcG9ydCBibG9jayBhdCBsaW5lcyB7dGFyZ2V0X3N0YXJ0X2xpbmV9LXt0YXJnZXRfZW5kX2xpbmV9XCIpXG4gICAzNjlcdCAgICAgICAgICAgICAgICAgZWxpZiBpc19kZWxldGluZzogbG9nZ2VyLndhcm5pbmcoXCJDYW5ub3QgZGVsZXRlIGltcG9ydCBibG9jazogTm90IGZvdW5kLlwiKTsgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgIDM3MFx0ICAgICAgICAgICAgICAgICBlbHNlOiBsb2dnZXIuaW5mbyhcIkltcG9ydCBibG9jayBub3QgZm91bmQuIFBsYW5uaW5nIHRvIElOU0VSVCBpbXBvcnQocykuXCIpXG4gICAzNzFcdCAgICAgICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XG4gICAzNzJcdCAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGZcIkVycm9yIGZpbmRpbmcgaW1wb3J0IGJsb2NrIHJhbmdlOiB7ZX0uIEFzc3VtaW5nIGluc2VydGlvbi5cIilcbiAgIDM3M1x0ICAgICAgICAgICAgICAgICBpZiBpc19kZWxldGluZzogcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgIDM3NFx0ICAgICAgICBlbHNlOiAjIE5vIG5hbWUgLyBub3QgaW1wb3J0IGJsb2NrXG4gICAzNzVcdCAgICAgICAgICAgICBpZiBpc19kZWxldGluZzogbG9nZ2VyLmVycm9yKGZcIkNhbm5vdCBkZWxldGUgZWxlbWVudDogTm8gbmFtZSBzcGVjaWZpZWQuXCIpOyByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgMzc2XHQgICAgICAgICAgICAgbG9nZ2VyLmluZm8oZlwiTm8gdmFsaWQgbmFtZSBmb3IgcmVwbGFjZW1lbnQuIFBsYW5uaW5nIHRvIElOU0VSVC5cIilcbiAgIDM3N1x0XG4gICAzNzhcdCAgICAgICAgIyBQYXJzZSBvcmlnaW5hbCBjb2RlXG4gICAzNzlcdCAgICAgICAgdHJ5OiBvcmlnaW5hbF90cmVlID0gYXN0LmZpeF9taXNzaW5nX2xvY2F0aW9ucyhhc3QucGFyc2Uob3JpZ2luYWxfY29kZSkpXG4gICAzODBcdCAgICAgICAgZXhjZXB0IFN5bnRheEVycm9yIGFzIGU6IGxvZ2dlci5lcnJvcihmXCJTeW50YXggZXJyb3IgaW4gb3JpZ2luYWwgY29kZToge2V9XCIpOyByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgMzgxXHRcbiAgIDM4Mlx0ICAgICAgICAjIFBhcnNlIG5ldyBjb2RlIHNuaXBwZXQgKG9yIGhhbmRsZSBkZWxldGlvbilcbiAgIDM4M1x0ICAgICAgICBuZXdfbm9kZXM6IExpc3RbYXN0LkFTVF0gPSBbXVxuICAgMzg0XHQgICAgICAgIGlmIG5vdCBpc19kZWxldGluZzpcbiAgIDM4NVx0ICAgICAgICAgICAgdHJ5OlxuICAgMzg2XHQgICAgICAgICAgICAgICAgbmV3X2NvZGVfc3RyaXBwZWQgPSBuZXdfY29kZS5zdHJpcCgpXG4gICAzODdcdCAgICAgICAgICAgICAgICBpZiBub3QgbmV3X2NvZGVfc3RyaXBwZWQ6IHJhaXNlIFZhbHVlRXJyb3IoXCJDYW5ub3QgdXBzZXJ0IGVtcHR5IGNvZGUgc25pcHBldCB1bmxlc3MgZGVsZXRpbmcuXCIpXG4gICAzODhcdCAgICAgICAgICAgICAgICBuZXdfdHJlZSA9IGFzdC5wYXJzZShuZXdfY29kZV9zdHJpcHBlZCk7IG5ld19ub2RlcyA9IG5ld190cmVlLmJvZHlcbiAgIDM4OVx0ICAgICAgICAgICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG5ld19ub2RlcywgbGlzdCk6IG5ld19ub2RlcyA9IFtuZXdfbm9kZXNdXG4gICAzOTBcdCAgICAgICAgICAgICAgICBpZiBub3QgbmV3X25vZGVzOiBsb2dnZXIud2FybmluZyhcIk5ldyBjb2RlIHNuaXBwZXQgcGFyc2VkIGludG8gYW4gZW1wdHkgbGlzdCBvZiBub2Rlcy4gVHJlYXRpbmcgYXMgZGVsZXRpb24gaWYgcmVwbGFjaW5nLlwiKVxuICAgMzkxXHQgICAgICAgICAgICAgICAgaWYgbm90IG5ld19ub2RlcyBhbmQgaXNfcmVwbGFjaW5nOiBpc19kZWxldGluZyA9IFRydWVcbiAgIDM5Mlx0ICAgICAgICAgICAgICAgIGVsaWYgbm90IG5ld19ub2RlcyBhbmQgbm90IGlzX3JlcGxhY2luZzogcmFpc2UgVmFsdWVFcnJvcihcIkNhbm5vdCBpbnNlcnQgZW1wdHkgcGFyc2VkIG5vZGVzLlwiKVxuICAgMzkzXHQgICAgICAgICAgICBleGNlcHQgU3ludGF4RXJyb3IgYXMgZTogbG9nZ2VyLmVycm9yKGZcIlN5bnRheCBlcnJvciBpbiBuZXcgY29kZSBzbmlwcGV0OiB7ZX1cIik7IHJldHVybiBvcmlnaW5hbF9jb2RlXG4gICAzOTRcdCAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTogbG9nZ2VyLmVycm9yKGZcIkVycm9yIHBhcnNpbmcgbmV3IGNvZGUgc25pcHBldDoge2V9XCIpOyByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgMzk1XHQgICAgICAgIGVsc2U6IGxvZ2dlci5kZWJ1ZyhcIlByb2NlZWRpbmcgd2l0aCBkZWxldGlvbiAobmV3X25vZGVzIGlzIGVtcHR5KS5cIilcbiAgIDM5Nlx0XG4gICAzOTdcdCAgICAgICAgIyBBcHBseSB0cmFuc2Zvcm1hdGlvblxuICAgMzk4XHQgICAgICAgIG1vZGlmaWVkX3RyZWUgPSBOb25lXG4gICAzOTlcdCAgICAgICAgdHJhbnNmb3JtZXIgPSBOb25lXG4gICA0MDBcdCAgICAgICAgdHJ5OlxuICAgNDAxXHQgICAgICAgICAgICB0cmFuc2Zvcm1lciA9IFJlcGxhY2VPckluc2VydFRyYW5zZm9ybWVyKFxuICAgNDAyXHQgICAgICAgICAgICAgICAgdGFyZ2V0X3N0YXJ0X2xpbmU9dGFyZ2V0X3N0YXJ0X2xpbmUsIHRhcmdldF9lbmRfbGluZT10YXJnZXRfZW5kX2xpbmUsXG4gICA0MDNcdCAgICAgICAgICAgICAgICBuZXdfbm9kZXM9bmV3X25vZGVzLCBwYXJlbnRfbmFtZT1wYXJlbnRfbmFtZSxcbiAgIDQwNFx0ICAgICAgICAgICAgICAgIGVsZW1lbnRfdHlwZT1lbGVtZW50X3R5cGUsIHRhcmdldF9uYW1lPW5hbWUgaWYgbmFtZSAhPSAnYWxsJyBlbHNlIE5vbmUgIyBQYXNzIE5vbmUgbmFtZSBmb3IgYmxvY2sgcmVwbGFjZVxuICAgNDA1XHQgICAgICAgICAgICApXG4gICA0MDZcdCAgICAgICAgICAgIG1vZGlmaWVkX3RyZWUgPSB0cmFuc2Zvcm1lci52aXNpdChvcmlnaW5hbF90cmVlKVxuICAgNDA3XHQgICAgICAgICAgICBpZiBtb2RpZmllZF90cmVlIGlzIE5vbmU6IGxvZ2dlci5pbmZvKFwiVHJhbnNmb3JtYXRpb24gcmVzdWx0ZWQgaW4gZW1wdHkgQVNULlwiKTsgcmV0dXJuIFwiXFxuXCJcbiAgIDQwOFx0ICAgICAgICAgICAgbW9kaWZpZWRfdHJlZSA9IGFzdC5maXhfbWlzc2luZ19sb2NhdGlvbnMobW9kaWZpZWRfdHJlZSlcbiAgIDQwOVx0XG4gICA0MTBcdCAgICAgICAgICAgIGlmIG5vdCB0cmFuc2Zvcm1lci5vcGVyYXRpb25fZG9uZTpcbiAgIDQxMVx0ICAgICAgICAgICAgICAgICBhY3Rpb24gPSBcInJlcGxhY2UvZGVsZXRlXCIgaWYgaXNfcmVwbGFjaW5nIGVsc2UgXCJpbnNlcnRcIlxuICAgNDEyXHQgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJUcmFuc2Zvcm1lciBmYWlsZWQgdG8ge2FjdGlvbn0gZWxlbWVudCAne25hbWV9JyBcIlxuICAgNDEzXHQgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmXCJ7ZidhdCBsaW5lcyB7dGFyZ2V0X3N0YXJ0X2xpbmV9LXt0YXJnZXRfZW5kX2xpbmV9JyBpZiBpc19yZXBsYWNpbmcgZWxzZSBmJ2ludG8gcGFyZW50IHtwYXJlbnRfbmFtZX0nfS5cIilcbiAgIDQxNFx0ICAgICAgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxfY29kZSAjIFJldHVybiBvcmlnaW5hbCBpZiBvcGVyYXRpb24gZmFpbGVkXG4gICA0MTVcdFxuICAgNDE2XHQgICAgICAgICAgICBsb2dnZXIuaW5mbyhmXCJUcmFuc2Zvcm1lciBvcGVyYXRpb24gc3VjY2Vzc2Z1bDogeydSZXBsYWNlZC9EZWxldGVkJyBpZiBpc19yZXBsYWNpbmcgZWxzZSAnSW5zZXJ0ZWQnfVwiKVxuICAgNDE3XHQgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgZTpcbiAgIDQxOFx0ICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGZcIkVycm9yIGR1cmluZyBBU1QgdHJhbnNmb3JtYXRpb246IHtlfVwiLCBleGNfaW5mbz1UcnVlKVxuICAgNDE5XHQgICAgICAgICAgICByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgNDIwXHRcbiAgIDQyMVx0ICAgICAgICAjIFVucGFyc2UgdGhlIG1vZGlmaWVkIHRyZWVcbiAgIDQyMlx0ICAgICAgICB0cnk6XG4gICA0MjNcdCAgICAgICAgICAgIGlmIG5vdCBpc2luc3RhbmNlKG1vZGlmaWVkX3RyZWUsIGFzdC5BU1QpOlxuICAgNDI0XHQgICAgICAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJUcmFuc2Zvcm1hdGlvbiByZXN1bHRlZCBpbiBub24tQVNUIHR5cGU6IHt0eXBlKG1vZGlmaWVkX3RyZWUpfS4gQ2Fubm90IHVucGFyc2UuXCIpXG4gICA0MjVcdCAgICAgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgIDQyNlx0ICAgICAgICAgICAgbmV3X3NvdXJjZSA9IGFzdC51bnBhcnNlKG1vZGlmaWVkX3RyZWUpXG4gICA0MjdcdCAgICAgICAgICAgIGlmIG5ld19zb3VyY2UgYW5kIG5vdCBuZXdfc291cmNlLmVuZHN3aXRoKCdcXG4nKTogbmV3X3NvdXJjZSArPSAnXFxuJ1xuICAgNDI4XHQgICAgICAgICAgICBsb2dnZXIuaW5mbyhcIlVucGFyc2luZyBzdWNjZXNzZnVsLlwiKVxuICAgNDI5XHQgICAgICAgICAgICAjIC0tLSBEZWJ1ZyBjb21wYXJpc29uIC0tLVxuICAgNDMwXHQgICAgICAgICAgICAjIGlmIG5ld19zb3VyY2UgPT0gb3JpZ2luYWxfY29kZTpcbiAgIDQzMVx0ICAgICAgICAgICAgIyAgICAgIGxvZ2dlci53YXJuaW5nKFwiQ29kZSBzZWVtcyB1bmNoYW5nZWQgYWZ0ZXIgdXBzZXJ0IG9wZXJhdGlvbi5cIilcbiAgIDQzMlx0ICAgICAgICAgICAgIyBlbHNlOlxuICAgNDMzXHQgICAgICAgICAgICAjICAgICAgbG9nZ2VyLmluZm8oXCJDb2RlIG1vZGlmaWVkLlwiKVxuICAgNDM0XHQgICAgICAgICAgICAjIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS1cbiAgIDQzNVx0ICAgICAgICAgICAgcmV0dXJuIG5ld19zb3VyY2VcbiAgIDQzNlx0ICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6XG4gICA0MzdcdCAgICAgICAgICAgIGxvZ2dlci5lcnJvcihmXCJFcnJvciB1bnBhcnNpbmcgbW9kaWZpZWQgQVNUOiB7ZX1cIiwgZXhjX2luZm89VHJ1ZSlcbiAgIDQzOFx0ICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcbiAgIDQzOVx0XG4gICA0NDBcdCAgICBkZWYgYWRkX2VsZW1lbnQoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCBuZXdfY29kZTogc3RyLCBwYXJlbnRfbmFtZTogT3B0aW9uYWxbc3RyXT1Ob25lKSAtPiBzdHI6XG4gICA0NDFcdCAgICAgICAgbG9nZ2VyLmRlYnVnKGZcIkNhbGxpbmcgYWRkX2VsZW1lbnQgZm9yIHBhcmVudCAne3BhcmVudF9uYW1lfSdcIilcbiAgIDQ0Mlx0ICAgICAgICB0cnk6XG4gICA0NDNcdCAgICAgICAgICAgIG5ld190cmVlID0gYXN0LnBhcnNlKG5ld19jb2RlLnN0cmlwKCkpXG4gICA0NDRcdCAgICAgICAgICAgIGlmIG5vdCBuZXdfdHJlZS5ib2R5OiBsb2dnZXIuZXJyb3IoXCJDYW5ub3QgYWRkIGVtcHR5IGVsZW1lbnQuXCIpOyByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgNDQ1XHQgICAgICAgICAgICBub2RlX3RvX2FkZCA9IG5ld190cmVlLmJvZHlbMF1cbiAgIDQ0Nlx0ICAgICAgICAgICAgdGVtcF9uYW1lID0gZ2V0YXR0cihub2RlX3RvX2FkZCwgJ25hbWUnLCBOb25lKVxuICAgNDQ3XHQgICAgICAgICAgICAjIExldCB1cHNlcnQgaGFuZGxlIHR5cGUgZGVkdWN0aW9uIGJ5IHBhc3NpbmcgXCJ1bmtub3duXCJcbiAgIDQ0OFx0ICAgICAgICAgICAgdGVtcF90eXBlX3N0ciA9IFwidW5rbm93blwiXG4gICA0NDlcdCAgICAgICAgICAgIGlmIGlzaW5zdGFuY2Uobm9kZV90b19hZGQsIChhc3QuSW1wb3J0LCBhc3QuSW1wb3J0RnJvbSkpOiB0ZW1wX25hbWUgPSAnYWxsJ1xuICAgNDUwXHRcbiAgIDQ1MVx0ICAgICAgICAgICAgaWYgdGVtcF9uYW1lIGFuZCB0ZW1wX3R5cGVfc3RyOlxuICAgNDUyXHQgICAgICAgICAgICAgICAgcmV0dXJuIHNlbGYudXBzZXJ0X2VsZW1lbnQob3JpZ2luYWxfY29kZSwgdGVtcF90eXBlX3N0ciwgdGVtcF9uYW1lLCBuZXdfY29kZSwgcGFyZW50X25hbWUpXG4gICA0NTNcdCAgICAgICAgICAgIGVsc2U6IGxvZ2dlci5lcnJvcihmXCJDb3VsZCBub3QgZGVkdWNlIG5hbWUvdHlwZSBmb3IgYWRkX2VsZW1lbnQ6IHtuZXdfY29kZVs6MTAwXX0uLi5cIilcbiAgIDQ1NFx0ICAgICAgICBleGNlcHQgRXhjZXB0aW9uIGFzIGU6IGxvZ2dlci5lcnJvcihmXCJFcnJvciBwcmVwYXJpbmcgZm9yIGFkZF9lbGVtZW50OiB7ZX1cIilcbiAgIDQ1NVx0ICAgICAgICByZXR1cm4gb3JpZ2luYWxfY29kZVxuICAgNDU2XHRcbiAgIDQ1N1x0ICAgIGRlZiByZXBsYWNlX2VsZW1lbnQoc2VsZiwgb3JpZ2luYWxfY29kZTogc3RyLCBuYW1lOiBzdHIsIG5ld19jb2RlOiBzdHIsIHBhcmVudF9uYW1lOiBPcHRpb25hbFtzdHJdPU5vbmUpIC0+IHN0cjpcbiAgIDQ1OFx0ICAgICAgICBsb2dnZXIuZGVidWcoZlwiQ2FsbGluZyByZXBsYWNlX2VsZW1lbnQgZm9yICd7bmFtZX0nLCBwYXJlbnQgJ3twYXJlbnRfbmFtZX0nIC0gZGVsZWdhdGluZyB0eXBlIGRldGVjdGlvbiB0byB1cHNlcnQuXCIpXG4gICA0NTlcdCAgICAgICAgIyBQYXNzIFwidW5rbm93blwiIC0gdXBzZXJ0IHdpbGwgdHJ5IHRvIGZpbmQgZXhpc3Rpbmcgb3IgZGVkdWNlIGZyb20gbmV3X2NvZGVcbiAgIDQ2MFx0ICAgICAgICByZXR1cm4gc2VsZi51cHNlcnRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBcInVua25vd25cIiwgbmFtZSwgbmV3X2NvZGUsIHBhcmVudF9uYW1lKVxuICAgNDYxXHRcbiAgIDQ2Mlx0ICAgIGRlZiByZW1vdmVfZWxlbWVudChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIG5hbWU6IHN0ciwgcGFyZW50X25hbWU6IE9wdGlvbmFsW3N0cl09Tm9uZSkgLT4gc3RyOlxuICAgNDYzXHQgICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJDYWxsaW5nIHJlbW92ZV9lbGVtZW50IGZvciAne25hbWV9JywgcGFyZW50ICd7cGFyZW50X25hbWV9JyAtIGRlbGVnYXRpbmcgdHlwZSBkZXRlY3Rpb24gdG8gdXBzZXJ0LlwiKVxuICAgNDY0XHQgICAgICAgICMgUGFzcyBcInVua25vd25cIiAtIHVwc2VydCB3aWxsIHRyeSB0byBmaW5kIHRoZSBlbGVtZW50IGZpcnN0IHRvIGRldGVybWluZSB0eXBlXG4gICA0NjVcdCAgICAgICAgcmV0dXJuIHNlbGYudXBzZXJ0X2VsZW1lbnQob3JpZ2luYWxfY29kZSwgXCJ1bmtub3duXCIsIG5hbWUsIFwiXCIsIHBhcmVudF9uYW1lKVxuICAgNDY2XHRcbiAgIDQ2N1x0ICAgIGRlZiB1cHNlcnRfZWxlbWVudF9ieV94cGF0aChzZWxmLCBvcmlnaW5hbF9jb2RlOiBzdHIsIHhwYXRoOiBzdHIsIG5ld19jb2RlOiBzdHIpIC0+IHN0cjpcbiAgIDQ2OFx0ICAgICAgICBmcm9tIGNvZGVoZW0uY29yZS5lbmdpbmUueHBhdGhfcGFyc2VyIGltcG9ydCBYUGF0aFBhcnNlclxuICAgNDY5XHQgICAgICAgIGxvZ2dlci5kZWJ1ZyhmXCJDYWxsaW5nIHVwc2VydF9lbGVtZW50X2J5X3hwYXRoIGZvciAne3hwYXRofSdcIilcbiAgIDQ3MFx0ICAgICAgICB0cnk6XG4gICA0NzFcdCAgICAgICAgICAgIGVsZW1lbnRfbmFtZSwgcGFyZW50X25hbWUsIGVsZW1lbnRfdHlwZV9zdHJfZnJvbV94cGF0aCA9IFhQYXRoUGFyc2VyLmdldF9lbGVtZW50X2luZm8oeHBhdGgpXG4gICA0NzJcdCAgICAgICAgICAgIG9wX2VsZW1lbnRfdHlwZV9zdHIgPSBlbGVtZW50X3R5cGVfc3RyX2Zyb21feHBhdGggaWYgZWxlbWVudF90eXBlX3N0cl9mcm9tX3hwYXRoIGVsc2UgXCJ1bmtub3duXCJcbiAgIDQ3M1x0ICAgICAgICAgICAgb3BfbmFtZSA9IGVsZW1lbnRfbmFtZVxuICAgNDc0XHQgICAgICAgICAgICBpZiBub3Qgb3BfbmFtZSBhbmQgb3BfZWxlbWVudF90eXBlX3N0ciA9PSBDb2RlRWxlbWVudFR5cGUuSU1QT1JULnZhbHVlOiBvcF9uYW1lID0gJ2FsbCdcbiAgIDQ3NVx0ICAgICAgICAgICAgZWxpZiBub3Qgb3BfbmFtZTpcbiAgIDQ3Nlx0ICAgICAgICAgICAgICAgICAjIFRyeSBkZWR1Y2luZyBuYW1lIGZyb20gbmV3X2NvZGUgaWYgWFBhdGggd2FzIGxpa2UgJ1tjbGFzc10nXG4gICA0NzdcdCAgICAgICAgICAgICAgICAgdHJ5OlxuICAgNDc4XHQgICAgICAgICAgICAgICAgICAgICAgbmV3X3RyZWUgPSBhc3QucGFyc2UobmV3X2NvZGUuc3RyaXAoKSlcbiAgIDQ3OVx0ICAgICAgICAgICAgICAgICAgICAgIGlmIG5ld190cmVlLmJvZHkgYW5kIGhhc2F0dHIobmV3X3RyZWUuYm9keVswXSwgJ25hbWUnKTogb3BfbmFtZSA9IG5ld190cmVlLmJvZHlbMF0ubmFtZVxuICAgNDgwXHQgICAgICAgICAgICAgICAgICAgICAgZWxzZTogcmFpc2UgVmFsdWVFcnJvcihcIkNhbm5vdCBkZXRlcm1pbmUgbmFtZSBmb3IgWFBhdGggdXBzZXJ0LlwiKVxuICAgNDgxXHQgICAgICAgICAgICAgICAgIGV4Y2VwdCBFeGNlcHRpb24gYXMgcGFyc2VfZXJyOlxuICAgNDgyXHQgICAgICAgICAgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGZcIkNvdWxkIG5vdCBkZWR1Y2UgbmFtZSBmcm9tIG5ldyBjb2RlIGZvciBYUGF0aCAne3hwYXRofSc6IHtwYXJzZV9lcnJ9XCIpXG4gICA0ODNcdCAgICAgICAgICAgICAgICAgICAgICByYWlzZSBWYWx1ZUVycm9yKGZcIkNhbm5vdCB1cHNlcnQgdmlhIFhQYXRoICd7eHBhdGh9JyB3aXRob3V0IG5hbWUuXCIpXG4gICA0ODRcdFxuICAgNDg1XHQgICAgICAgICAgICByZXR1cm4gc2VsZi51cHNlcnRfZWxlbWVudChvcmlnaW5hbF9jb2RlLCBvcF9lbGVtZW50X3R5cGVfc3RyLCBvcF9uYW1lLCBuZXdfY29kZSwgcGFyZW50X25hbWUpXG4gICA0ODZcdCAgICAgICAgZXhjZXB0IEV4Y2VwdGlvbiBhcyBlOlxuICAgNDg3XHQgICAgICAgICAgICAgbG9nZ2VyLmVycm9yKGZcIkVycm9yIHByb2Nlc3NpbmcgWFBhdGggdXBzZXJ0IGZvciAne3hwYXRofSc6IHtlfVwiLCBleGNfaW5mbz1UcnVlKVxuICAgNDg4XHQgICAgICAgICAgICAgcmV0dXJuIG9yaWdpbmFsX2NvZGVcblRvdGFsIGxpbmVzIGluIGZpbGU6IDQ4OFxuIiwiaXNFcnJvciI6ZmFsc2UsInJlcXVlc3RJZCI6IiJ9fX0sImRyYWZ0RXhjaGFuZ2UiOnsicmVxdWVzdF9tZXNzYWdlIjoiIiwicmljaF90ZXh0X2pzb25fcmVwciI6eyJ0eXBlIjoiZG9jIiwiY29udGVudCI6W3sidHlwZSI6InBhcmFncmFwaCJ9XX0sIm1lbnRpb25lZF9pdGVtcyI6W10sInN0YXR1cyI6ImRyYWZ0In0sInJlcXVlc3RJZHMiOltdLCJpc1Bpbm5lZCI6ZmFsc2UsImlzU2hhcmVhYmxlIjp0cnVlLCJleHRyYURhdGEiOnsiaXNBZ2VudENvbnZlcnNhdGlvbiI6dHJ1ZSwiaGFzRGlydHlFZGl0cyI6ZmFsc2V9fX0sImFnZW50RXhlY3V0aW9uTW9kZSI6Im1hbnVhbCIsImlzQWdlbnRFZGl0c0NvbGxhcHNlZCI6dHJ1ZSwic2hvdWxkRGlzcGxheUFnZW50QmFubmVyIjpmYWxzZSwiaGFzTm90VXNlZEFnZW50IjpmYWxzZX0=" />
      </map>
    </option>
  </component>
</project>